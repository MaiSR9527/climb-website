<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<title>Reactive Transactions with Spring</title>
<meta content="width=device-width,initial-scale=1,shrink-to-fit=no" id="Viewport" name="viewport">
<link media="all" rel="stylesheet" type="text/css" href="static/css/main-223d469db63e945f615f4af44ee.css">

<meta content="Level up your Java code and explore what Spring can do for you." name="description">
<link rel="manifest" href="https://spring.io/manifest-0e3065c2bbd1ef7a320e80861393f1a6.json">
<meta content="#6db33f" name="theme-color">
<meta content="spring" name="apple-mobile-web-app-title">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="default" name="apple-mobile-web-app-status-bar-style">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<script src="static/js/run_prettify-b8b4abd61389be25d52.js"></script>
<link rel="stylesheet" type="text/css" href="static/css/blog-4c4a0c3e75b8a4aa24edd4e30d5.css">

<meta content="summary" name="twitter:card">
<meta content="@springcentral" name="twitter:site">
<meta name="twitter:title" content="Reactive Transactions with Spring">
<meta name="twitter:description" content="&lt;p&gt;Back in 2016, our reactive journey started with Spring Framework 5 accompanied by a couple of reactive integrations. Throughout our journey, other projects joined the reactive movement. With R2DBC, we now also provide a reactive integration for SQL databases. With the growth of transaction-capable integrations, we constantly got asked:&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#does-spring-framework-support-reactive-transaction&quot; class=&quot;anchor&quot; name=&quot;does-spring-framework-support-reactive-transaction&quot;&gt;&lt;/a&gt;Does Spring Framework support Reactive @Transaction?&lt;/h2&gt;
&lt;p&gt;At the time our journey began, we had no reactive form of transactional integrations, so this question was simple to answer: There’s no need for reactive transaction management. &lt;/p&gt;
">
<meta name="twitter:creator" content="@mp911de">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/6494a9d91e9ffef9adc8253257f1b35e?s=200">

<meta property="og:title" content="Reactive Transactions with Spring">
<meta property="og:image" content="https://gravatar.com/avatar/6494a9d91e9ffef9adc8253257f1b35e?s=200">
<meta property="og:description" content="&lt;p&gt;Back in 2016, our reactive journey started with Spring Framework 5 accompanied by a couple of reactive integrations. Throughout our journey, other projects joined the reactive movement. With R2DBC, we now also provide a reactive integration for SQL databases. With the growth of transaction-capable integrations, we constantly got asked:&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#does-spring-framework-support-reactive-transaction&quot; class=&quot;anchor&quot; name=&quot;does-spring-framework-support-reactive-transaction&quot;&gt;&lt;/a&gt;Does Spring Framework support Reactive @Transaction?&lt;/h2&gt;
&lt;p&gt;At the time our journey began, we had no reactive form of transactional integrations, so this question was simple to answer: There’s no need for reactive transaction management. &lt;/p&gt;
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2019-05-16 06:59:00.0">
</head>
<body id="blog">
<script src="static/js/theme-f367e6936a70ad2e6b3dcb91c6.js"></script>
<header>
<nav id="nav">
<div class="container flex jc-between ai-center" id="nav-inner">
<a href="javascript:window.open('https://spring.io/');" id="logo-focus" tabindex="1">
<img alt="Spring" class="block" id="springlogo" src="static/picture/spring-logo-9146a4d3298760c2e7e4.svg">
</a>
<ul class="flex jc-between" id="nav-items">
<li><div class="has-menu" id="why-hov"><span tabindex="2">Why Spring</span><div class="nav-arrow"></div></div></li>
<li><div class="has-menu" id="learn-hov"><span tabindex="11">Learn</span><div class="nav-arrow"></div></div></li>
<li><div class="has-menu" id="projects-hov"><span tabindex="17">Projects</span><div class="nav-arrow"></div></div></li>
<li><a class="z-5 rel" href="javascript:window.open('https://spring.io/training');" tabindex="30">Training</a></li>
<li><a class="z-5 rel" href="javascript:window.open('https://spring.io/support');" tabindex="31">Support</a></li>
<li><a class="has-menu" id="community-hov"><span tabindex="32">Community</span><div class="nav-arrow"></div></a></li>
<li>
<a class="theme-switch" id="switch-theme">
<span>
<i class="fas fa-moon"></i>
<i class="fas fa-sun"></i>
</span>
</a>
</li>

</ul>
</div>
<div class="container rel" id="dropdown-menus">
<div class="abs rad-5" id="scope"></div>
<div class="drop-menu" id="why-items">
<div class="drop-target" id="why-target"></div>
<ul>
<li><a href="javascript:window.open('https://spring.io/why-spring');" tabindex="3">Overview</a></li>
<li><a href="javascript:window.open('https://spring.io/microservices');" tabindex="4">Microservices</a></li>
<li><a href="javascript:window.open('https://spring.io/reactive');" tabindex="5">Reactive</a></li>
<li><a href="javascript:window.open('https://spring.io/event-driven');" tabindex="6">Event Driven</a></li>
<li><a href="javascript:window.open('https://spring.io/cloud');" tabindex="7">Cloud</a></li>
<li><a href="javascript:window.open('https://spring.io/web-applications');" tabindex="8">Web Applications</a></li>
<li><a href="javascript:window.open('https://spring.io/serverless');" tabindex="9">Serverless</a></li>
<li><a href="javascript:window.open('https://spring.io/batch');" tabindex="10">Batch</a></li>
</ul>
</div>
<div class="drop-menu" id="learn-items">
<div class="drop-target" id="learn-target"></div>
<ul>
<li><a href="javascript:window.open('https://spring.io/learn');" tabindex="12">Overview</a></li>
<li><a href="javascript:window.open('https://spring.io/quickstart');" tabindex="13">Quickstart</a></li>
<li><a href="guides.html" tabindex="14">Guides</a></li>

<li><a href="javascript:window.open('https://spring.io/blog');" tabindex="16">Blog</a></li>
</ul>
</div>
<div class="drop-menu" id="project-items">
<div class="drop-target" id="project-target"></div>
<ul>
<li><a href="javascript:window.open('https://spring.io/projects');" tabindex="18">Overview</a></li>
<li><a href="spring-boot.html" tabindex="19">Spring Boot</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-framework');" tabindex="20">Spring Framework</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-cloud');" tabindex="21">Spring Cloud</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-cloud-dataflow');" tabindex="22">Spring Cloud Data Flow</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-data');" tabindex="23">Spring Data</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-integration');" tabindex="24">Spring Integration</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-batch');" tabindex="25">Spring Batch</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-security');" tabindex="26">Spring Security</a></li>
<li><a class="blue mb-2 inline-block" href="javascript:window.open('https://spring.io/projects');" tabindex="27">View all projects</a></li>
<li class="uppercase smallest">Development Tools</li>
<li><a href="javascript:window.open('https://spring.io/tools');" tabindex="28">Spring Tools 4</a></li>
<li><a href="index15.html" tabindex="29">Spring Initializr <svg class="external-link-icon" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><polyline fill="none" points="15 10.94 15 15 1 15 1 1 5.06 1" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></polyline><polyline fill="none" points="8.93 1 15 1 15 7.07" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></polyline><line fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2" x1="15" x2="8" y1="1" y2="8"></line></svg></a></li>
</ul>
</div>
<div class="drop-menu" id="community-items">
<div class="drop-target" id="community-target"></div>
<ul>
<li><a href="javascript:window.open('https://spring.io/community');" tabindex="33">Overview</a></li>
<li><a href="javascript:window.open('https://spring.io/events');" tabindex="34">Events</a></li>
<li><a href="javascript:window.open('https://spring.io/team');" tabindex="35">Team</a></li>
</ul>
</div>
</div>
</nav>
<div class="pointer" id="mobile-nav-open">
<div id="hamburger">
<div class="burger-bar"></div>
<div class="burger-bar"></div>
<div class="burger-bar"></div>
</div>
<svg class="mobile-close pointer" id="Layer_1" style="enable-background:new 0 0 14.6 14.6;" version="1.1" viewbox="0 0 14.6 14.6" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:3;stroke-miterlimit:10;}</style><title>close</title><line class="st0" x1="1.5" x2="13.1" y1="1.5" y2="13.1"></line><line class="st0" x1="13.1" x2="1.5" y1="1.5" y2="13.1"></line></svg>
</div>
<nav class="border-box rel" id="mobile-nav">
<div class="rel">
<div class="mobile-category flex jc-between ai-center" id="mobile-why">
<div class="mobile-title antialiased cursor-d">Why Spring</div>
<div class="mobile-nav-arrow"></div>
</div>
<div class="mobile-expanded-category" id="mobile-why-items">
<ul>
<li><a href="javascript:window.open('https://spring.io/why-spring');">Overview</a></li>
<li><a href="javascript:window.open('https://spring.io/microservices');">Microservices</a></li>
<li><a href="javascript:window.open('https://spring.io/reactive');">Reactive</a></li>
<li><a href="javascript:window.open('https://spring.io/event-driven');">Event Driven</a></li>
<li><a href="javascript:window.open('https://spring.io/cloud');">Cloud</a></li>
<li><a href="javascript:window.open('https://spring.io/web-applications');">Web Applications</a></li>
<li><a href="javascript:window.open('https://spring.io/serverless');">Serverless</a></li>
<li><a href="javascript:window.open('https://spring.io/batch');">Batch</a></li>
</ul>
</div>
<div class="mobile-category flex jc-between ai-center" id="mobile-learn">
<div class="mobile-title antialiased cursor-d">Learn</div>
<div class="mobile-nav-arrow"></div>
</div>
<div class="mobile-expanded-category" id="mobile-learn-items">
<ul>
<li><a href="javascript:window.open('https://spring.io/learn');">Overview</a></li>
<li><a href="javascript:window.open('https://spring.io/quickstart');">Quickstart</a></li>
<li><a href="guides.html">Guides</a></li>

<li><a href="javascript:window.open('https://spring.io/blog');">Blog</a></li>
</ul>
</div>
<div class="mobile-category flex jc-between ai-center" id="mobile-projects">
<div class="mobile-title antialiased cursor-d">Projects</div>
<div class="mobile-nav-arrow"></div>
</div>
<div class="mobile-expanded-category" id="mobile-project-items">
<ul>
<li><a href="javascript:window.open('https://spring.io/projects');">Overview</a></li>
<li><a href="spring-boot.html">Spring Boot</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-framework');">Spring Framework</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-cloud');">Spring Cloud</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-cloud-dataflow');">Spring Cloud Data Flow</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-data');">Spring Data</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-integration');">Spring Integration</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-batch');">Spring Batch</a></li>
<li><a href="javascript:window.open('https://spring.io/projects/spring-security');">Spring Security</a></li>
<li><a class="blue mb-2 inline-block" href="javascript:window.open('https://spring.io/projects');">View all projects</a></li>
<p class="uppercase smallest white">Development Tools</p>
<li><a href="javascript:window.open('https://spring.io/tools');">Spring Tools 4</a></li>
<li><a href="index15.html">Spring Initializr <svg class="external-link-icon" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><polyline fill="none" points="15 10.94 15 15 1 15 1 1 5.06 1" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></polyline><polyline fill="none" points="8.93 1 15 1 15 7.07" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></polyline><line fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2" x1="15" x2="8" y1="1" y2="8"></line></svg></a></li>
</ul>
</div>
<a class="mobile-link block" href="javascript:window.open('https://spring.io/training');"><div class="mobile-title antialiased">Training</div></a>
<a class="mobile-link block" href="javascript:window.open('https://spring.io/support');"><div class="mobile-title antialiased">Support</div></a>
<div class="mobile-category flex jc-between ai-center" id="mobile-community">
<div class="mobile-title antialiased cursor-d">Community</div>
<div class="mobile-nav-arrow"></div>
</div>
<div class="mobile-expanded-category" id="mobile-community-items">
<ul>
<li><a href="javascript:window.open('https://spring.io/community');">Overview</a></li>
<li><a href="javascript:window.open('https://spring.io/events');">Events</a></li>
<li><a href="javascript:window.open('https://spring.io/team');">Team</a></li>
</ul>
</div>

</div>
</nav>
<div id="search-nav" role="search">
<div class="container relative">
<form accept-charset="UTF-8" action="/search" id="searchheaderform" method="get"><input name="utf8" type="hidden" value="✓">
<input autocomplete="off" id="searchheaderinput" name="q" placeholder="Search for documentation, guides, and posts..." type="text">
<input data-disable-with="" id="searchheadersubmit" type="submit" value="">
</form>

</div>
</div>
</header>
<div id="main">
<main class="body--container container-fluid">
<div class="main-body--wrapper">
<div class="desktop-only">
<h1 class="blog-category active content--title">
Spring Blog
</h1>
<ul class="right-pane-widget--container secondary-nav with-icon small">
<li class="blog-category">
<a href="javascript:window.open('https://spring.io/blog');">All Posts</a>
<a class="pull-right" href="javascript:window.open('https://spring.io/blog/category/blog.atom');"><i class="fas fa-rss-square"></i></a>
</li>
<li class="blog-category">
<a href="javascript:window.open('https://spring.io/blog/category/engineering');">Engineering</a>
<a class="pull-right" href="javascript:window.open('https://spring.io/blog/category/engineering.atom');"><i class="fas fa-rss-square"></i></a>
</li>
<li class="blog-category">
<a href="javascript:window.open('https://spring.io/blog/category/releases');">Releases</a>
<a class="pull-right" href="javascript:window.open('https://spring.io/blog/category/releases.atom');"><i class="fas fa-rss-square"></i></a>
</li>
<li class="blog-category">
<a href="javascript:window.open('https://spring.io/blog/category/news');">News and Events</a>
<a class="pull-right" href="javascript:window.open('https://spring.io/blog/category/news.atom');"><i class="fas fa-rss-square"></i></a>
</li>
</ul>
</div>
<div class="row-fluid blog--wrapper">
<div class="span8 mobile-left-pane">
<article class="blog--container blog-preview" id="content">
<h2 class="blog--title">
<a href="">Reactive Transactions with Spring</a>
</h2>
<header class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category" href="javascript:window.open('https://spring.io/blog/category/engineering');">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="static/picture/6494a9d91e9ffef9adc8253257f1b35e.jpg">
<a class="author" rel="author" href="javascript:window.open('https://spring.io/team/mp911de');">Mark Paluch</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2019-05-16 06:59:00.0">May 16, 2019</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3668" href="#disqus_thread">
</a></div>
</header>
<section class="blog--post desktop-only">
<div><p>Back in 2016, our reactive journey started with Spring Framework 5 accompanied by a couple of reactive integrations. Throughout our journey, other projects joined the reactive movement. With R2DBC, we now also provide a reactive integration for SQL databases. With the growth of transaction-capable integrations, we constantly got asked:</p><h2><a href="#does-spring-framework-support-reactive-transaction" class="anchor" name="does-spring-framework-support-reactive-transaction"></a>Does Spring Framework support Reactive @Transaction?</h2>
<p>At the time our journey began, we had no reactive form of transactional integrations, so this question was simple to answer: There’s no need for reactive transaction management. </p>
<p>Over time, MongoDB started to support multi-document transactions with MongoDB Server 4.0. R2DBC (the specification for reactive SQL database drivers) started to emerge, and we decided to pick up on R2DBC with Spring Data R2DBC. Both projects wanted to expose transactional behavior, so they eventually provided <code>inTransaction(…)</code> methods on their Template APIs to perform units of work guarded by native transactions.</p>
<p>While it is convenient to use an <code>inTransaction(…)</code> method for smaller chunks of work, it does not reflect the Spring way of supporting transactions. When working with imperative programming models, Spring Framework allows for two arrangements of transaction management: <code>@Transactional</code> and <code>TransactionTemplate</code> (declarative respective programmatic transaction management).</p>
<p>Both approaches to transaction management are built on top of <code>PlatformTransactionManager</code>, which manages transactions for transactional resources. <code>PlatformTransactionManager</code> can be either a Spring-provided transaction manager implementation or a Java EE one based on JTA.</p>
<p>Both approaches have in common that they bind the transactional state to <code>ThreadLocal</code> storage, which allows for transactional state management without passing a <code>TransactionStatus</code> object. Transaction management should happen in the background in a non-invasive manner.<br><code>ThreadLocal</code> works in imperative programming arrangements because of the underlying assumption that we do not engage threads to continue work within a transaction.</p><h2><a href="#how-imperative-transaction-management-works" class="anchor" name="how-imperative-transaction-management-works"></a>How Imperative Transaction Management Works</h2>
<p>Transaction management needs to associate its transactional state with an execution. In imperative programming, this is typically a <code>ThreadLocal</code> storage – Transactional state is bound to a <code>Thread</code>. The underlying assumption is that transactional code gets executed on the same thread on which the container has invoked it.</p>
<p>Reactive programming models remove this fundamental assumption of imperative (synchronous/blocking) programming models. Taking a closer look at reactive execution, we can observe that code gets executed on different threads. This gets more visible when using inter-process communication. We can no longer safely assume that our code is fully executed on the same thread.</p>
<p>This change in assumptions invalidates transaction management implementations that rely on <code>ThreadLocal</code>.</p>
<p>Thread switches happen at arbitrary times, due to integrations and optimizations such as operator fusion. This change breaks all code that relies on <code>ThreadLocal</code>. The consequence is that we need a different arrangement to reflect transactional state without passing a <code>TransactionStatus</code> object all the time.</p>
<p>Associating out-of-band data is not a new requirement in the reactive space. We faced this requirement in other areas, such as the <code>SecurityContext</code> with Spring Security for reactive method security (to name one example). Project Reactor, the reactive library on top of which Spring builds its reactive support, has provided support for subscriber contexts since version 3.1.</p>
<p>Reactor <code>Context</code> is to reactive programming what <code>ThreadLocal</code> is to imperative programming: Contexts allow binding contextual data to a particular execution. For reactive programming, this is a <code>Subscription</code>. Reactor’s <code>Context</code> lets Spring bind the transaction state, along with all resources and synchronizations, to a particular <code>Subscription</code>. All reactive code that uses Project Reactor can now participate in reactive transactions. Code that returns scalar values and that wants to access transactional details must be rewritten to use reactive types to participate in transactions. Otherwise, the <code>Context</code> is not available.</p><h2><a href="#reactive-transaction-management" class="anchor" name="reactive-transaction-management"></a>Reactive Transaction Management</h2>
<p>Starting with Spring Framework 5.2 M2, Spring supports reactive transaction management through the <code>ReactiveTransactionManager</code> SPI.</p>
<p><code>ReactiveTransactionManager</code> is a transaction management abstraction for reactive and non-blocking integrations that uses transactional resources. It is a foundation for reactive <code>@Transactional</code> methods that return <code>Publisher</code> types and for programmatic transaction management that uses <code>TransactionalOperator</code>.</p>
<p>The first two reactive transaction manager implementations are:</p>
<ul>
<li>R2DBC through Spring Data R2DBC 1.0 M2</li>
<li>MongoDB through Spring Data MongoDB 2.2 M4</li>
</ul>
<p>Let’s take a look at how reactive transactions look like:</p>
<pre><code class="prettyprint java">class TransactionalService {

  final DatabaseClient db

  TransactionalService(DatabaseClient db) {
    this.db = db;
  }

  @Transactional
  Mono&lt;Void&gt; insertRows() {

    return db.execute()
      .sql(&quot;INSERT INTO person (name, age) VALUES(&#39;Joe&#39;, 34)&quot;)
      .fetch().rowsUpdated()
      .then(db.execute().sql(&quot;INSERT INTO contacts (name) VALUES(&#39;Joe&#39;)&quot;)
      .then();
  }
}
</code></pre>
<p>Reactive transactions look very similar to imperative transactions in annotation-driven arrangements. The main difference though is that we work with <code>DatabaseClient</code>, which is a reactive resource abstraction. All transaction management happens behind the scenes, leveraging Spring’s transaction interceptors and <code>ReactiveTransactionManager</code>. </p>
<p>Spring distinguishes (based on method return types) which type of transaction management to apply:</p>
<ul>
<li>Method returns a <code>Publisher</code> type: Reactive Transaction Management</li>
<li>All other return types: Imperative Transaction Management</li>
</ul>
<p>This distinction is significant, as you could still use imperative components such as a JPA or JDBC query. Wrapping these results into a <code>Publisher</code> type signals Spring to apply reactive rather than imperative transaction management. That being said, a reactive transaction arrangement does not open a <code>ThreadLocal</code>-bound transaction, which is required for JPA or JDBC.</p><h2><a href="#transactionaloperator" class="anchor" name="transactionaloperator"></a>TransactionalOperator</h2>
<p>As a next step, let’s take a look at programmatic transaction management by using <code>TransactionalOperator</code>:</p>
<pre><code class="prettyprint java">ConnectionFactory factory = …
ReactiveTransactionManager tm = new R2dbcTransactionManager(factory);
DatabaseClient db = DatabaseClient.create(factory);

TransactionalOperator rxtx = TransactionalOperator.create(tm);

Mono&lt;Void&gt; atomicOperation = db.execute()
  .sql(&quot;INSERT INTO person (name, age) VALUES(&#39;joe&#39;, &#39;Joe&#39;)&quot;)
  .fetch().rowsUpdated()
  .then(db.execute()
    .sql(&quot;INSERT INTO contacts (name) VALUES(&#39;Joe&#39;)&quot;)
    .then())
  .as(rxtx::transactional);
</code></pre>
<p>The code above contains some notable components:</p>
<ul>
<li><code>R2dbcTransactionManager</code>: This is the reactive transaction manager for a R2DBC <code>ConnectionFactory</code> .</li>
<li><code>DatabaseClient</code>: The client provides access to SQL databases using R2DBC drivers.</li>
<li><code>TransactionalOperator</code>: This operator associates all upstream R2DBC publishers with a transactional context. You can use it either operator style <code>as(…::transactional)</code> or call-back style with <code>execute(txStatus -&gt; …)</code>.</li>
</ul>
<p>Reactive transactions are started lazily upon subscription. The operator starts a transaction, sets the appropriate isolation level and associates the database connection with its subscriber context. All participating (upstream) <code>Publisher</code> instances use a single <code>Context</code>-bound transactional connection. </p>
<p>Reactive-functional operator chains can be either linear (by using a single <code>Publisher</code>) or non-linear (by merging multiple streams). Reactive transactions affect all upstream <code>Publisher</code>s when using operator style. To limit the transaction scope to a particular set of <code>Publisher</code>s, apply callback style, as follows:</p>
<pre><code class="prettyprint java">TransactionalOperator rxtx = TransactionalOperator.create(tm);

Mono&lt;Void&gt; outsideTransaction = db.execute()
  .sql(&quot;INSERT INTO person (name, age) VALUES(&#39;Jack&#39;, 31)&quot;)
  .then();

Mono&lt;Void&gt; insideTransaction = rxtx.execute(txStatus -&gt; {
  return db.execute()
    .sql(&quot;INSERT INTO person (name, age) VALUES(&#39;Joe&#39;, 34)&quot;)
    .fetch().rowsUpdated()
    .then(db.execute()
      .sql(&quot;INSERT INTO contacts (name) VALUES(&#39;Joe Black&#39;)&quot;)
      .then());
  }).then();

Mono&lt;Void&gt; completion = outsideTransaction.then(insideTransaction);
</code></pre>
<p>In the example above, transaction management is limited to <code>Publisher</code> instances subscribed within <code>execute(…)</code>. Or, to put it differently, the transaction is scoped. <code>Publisher</code> instances within <code>execute(…)</code> participate in the transaction, and the <code>Publisher</code> named <code>outsideTransaction</code> performs its work outside the transaction.</p>
<p>R2DBC is one of Spring’s integrations with reactive transactions. Another integration is MongoDB through Spring Data MongoDB, which you can use to participate in multi-document transactions by using reactive programming.</p>
<p>Spring Data MongoDB ships with <code>ReactiveMongoTransactionManager</code> as a <code>ReactiveTransactionManager</code> implementation. It creates a session and manages transactions so that code executed within a managed transaction participates in multi-document transactions.</p>
<p>The following example shows programmatic transaction management with MongoDB:</p>
<pre><code class="prettyprint java">ReactiveTransactionManager tm 
  = new ReactiveMongoTransactionManager(databaseFactory);
ReactiveMongoTemplate template = …
template.setSessionSynchronization(ALWAYS);                                          

TransactionalOperator rxtx = TransactionalOperator.create(tm);

Mono&lt;Void&gt; atomic = template.update(Step.class)
  .apply(Update.set(&quot;state&quot;, …))
  .then(template.insert(EventLog.class).one(new EventLog(…))
  .as(rxtx::transactional)
  .then();
</code></pre>
<p>The code above sets up a <code>ReactiveTransactionManager</code> and uses <code>TransactionalOperator</code> to perform multiple write actions within a single transaction. <code>ReactiveMongoTemplate</code> gets configured to participate in reactive transactions.</p><h2><a href="#next-steps" class="anchor" name="next-steps"></a>Next Steps</h2>
<p>Reactive Transaction Management ships with Spring Framework 5.2 M2, Spring Data MongoDB 2.2 M4, and Spring Data R2DBC 1.0 M2 milestone releases. You can pick up these and start integrating reactive transaction management in your code. We look forward to community feedback so that we can smooth out any sharp edges before shipping release candidates in early June.</p>
</div>
</section>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3668;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="javascript:window.open('http://disqus.com/?ref_noscript');">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="javascript:window.open('https://disqus.com/');">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
</div>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<div>
<div id="blog-sidebar-newsletter">
<p>Get the Spring newsletter</p>
<script src="static/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
                  MktoForms2.setOptions({formXDPath : "/rs/pivotal/images/marketo-xdframe-relative.html"});
                  MktoForms2.loadForm("//connect.pivotal.io", "625-IUJ-009", 4723, function(form){
                      form.onSuccess(function(values, followUpUrl) {
                          form.getFormElem().html("<p>Thank you!</p>");
                          return false;
                      });
                  });
              </script>
</div>
</div>
</div>
</aside>
</div>
</div>
</main>
</div>
<footer>
<div id="top">
<div class="container flex jc-between mx-auto">
<div id="green-circle-sm"></div>

<img alt="" id="circle-grid" src="static/picture/footer-circles-dc4b03d4edc1f3b7b.svg">
<div class="third">
<h2 class="bold h3 antialiased">Get ahead</h2>
<p>VMware offers training and certification to turbo-charge your progress.</p>
<a class="blue link-animate" href="javascript:window.open('https://spring.io/training');">Learn more</a>
</div>
<div class="third">
<h2 class="bold h3 antialiased">Get support</h2>
<p>Spring Runtime offers support and binaries for OpenJDK&trade;, Spring, and Apache Tomcat&reg; in one simple subscription.</p>
<a class="blue link-animate" href="javascript:window.open('https://spring.io/support');">Learn more</a>
</div>
<div class="third">
<h2 class="bold h3 antialiased">Upcoming events</h2>
<div class="footer-event">
<a class="blue link-animate" href="javascript:window.open('https://springone.io/');">SpringOne</a>
<p>All virtual. All free.</p>
</div>
<br>
<div class="footer-event">
<a class="blue link-animate" href="javascript:window.open('https://springonetour.io/');">SpringOne Tour</a>
<p>The best Cloud-Native Java content brought directly to you.</p>
</div>
</div>
</div>
</div>
<div id="bottom">
<div id="bottom-top">
<div class="mx-auto" id="footer-over">
<div class="container flex jc-between mx-auto">
<div class="left">
<div class="flex jc-between">
<div class="footer-column">
<p><strong><a href="javascript:window.open('https://spring.io/why-spring');">Why Spring</a></strong></p>
<ul>
<li><a href="javascript:window.open('https://spring.io/microservices');">Microservices</a></li>
<li><a href="javascript:window.open('https://spring.io/reactive');">Reactive</a></li>
<li><a href="javascript:window.open('https://spring.io/event-driven');">Event Driven</a></li>
<li><a href="javascript:window.open('https://spring.io/cloud');">Cloud</a></li>
<li><a href="javascript:window.open('https://spring.io/web-applications');">Web Applications</a></li>
<li><a href="javascript:window.open('https://spring.io/serverless');">Serverless</a></li>
<li><a href="javascript:window.open('https://spring.io/batch');">Batch</a></li>
</ul>
</div>
<div class="footer-column">
<p><strong><a href="javascript:window.open('https://spring.io/learn');">Learn</a></strong></p>
<ul>
<li><a href="javascript:window.open('https://spring.io/quickstart');">Quickstart</a></li>
<li><a href="guides.html">Guides</a></li>
<li><a href="javascript:window.open('https://spring.io/blog');">Blog</a></li>
</ul>
</div>
<div class="footer-column">
<p><strong><a href="javascript:window.open('https://spring.io/community');">Community</a></strong></p>
<ul>
<li><a href="javascript:window.open('https://spring.io/events');">Events</a></li>
<li><a href="javascript:window.open('https://spring.io/team');">Team</a></li>
</ul>
</div>
<div class="footer-column">
<p><strong><a href="javascript:window.open('https://spring.io/projects');">Projects</a></strong></p>
<p><strong><a href="javascript:window.open('https://spring.io/training');">Training</a></strong></p>
<p><strong><a href="javascript:window.open('https://spring.io/support');">Support</a></strong></p>
<p><strong><a href="javascript:window.open('https://spring.io/thank-you');">Thank You</a></strong></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="bottom-bottom">
<div class="flex container jc-between">
<div id="spring-links">
<img alt="Spring" id="springlogo-foot" src="static/picture/spring-logo-9146a4d3298760c2e7e4.svg">
<p class="smallest antialiased">© <script>var d = new Date();
                    document.write(d.getFullYear());</script> <a href="javascript:window.open('https://www.vmware.com/');">VMware</a>, Inc. or its affiliates. <a href="javascript:window.open('https://www.vmware.com/help/legal.html');">Terms of Use</a> • <a href="javascript:window.open('https://www.vmware.com/help/privacy.html');" rel="noopener noreferrer">Privacy</a> • <a href="javascript:window.open('https://spring.io/trademarks');">Trademark Guidelines</a> <span id="thank-you-mobile">• <a href="javascript:window.open('https://spring.io/thank-you');">Thank you</a></span> <span id="teconsent"></span></p>
<p class="smallest antialiased">Apache®, Apache Tomcat®, Apache Kafka®, Apache Cassandra&trade;, and Apache Geode&trade; are trademarks or registered trademarks of the Apache Software Foundation in the United States and/or other countries. Java&trade;, Java&trade; SE, Java&trade; EE, and OpenJDK&trade; are trademarks of Oracle and/or its affiliates. Kubernetes® is a registered trademark of the Linux Foundation in the United States and other countries. Linux® is the registered trademark of Linus Torvalds in the United States and other countries. Windows® and Microsoft® Azure are registered trademarks of Microsoft Corporation. “AWS” and “Amazon Web Services” are trademarks or registered trademarks of Amazon.com Inc. or its affiliates. All other trademarks and copyrights are property of their respective owners and are only mentioned for informative purposes. Other names may be trademarks of their respective owners.</p>
</div>
<div class="flex jc-between" id="social-icons">
<a href="javascript:window.open('https://www.youtube.com/user/SpringSourceDev');" title="Youtube"><svg id="youtube-icon" viewbox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><circle class="cls-1" cx="20" cy="20" r="20"></circle><path class="cls-2" d="M30.91,14.53a2.89,2.89,0,0,0-2-2C27.12,12,20,12,20,12s-7.12,0-8.9.47a2.9,2.9,0,0,0-2,2A30.56,30.56,0,0,0,8.63,20a30.44,30.44,0,0,0,.46,5.47,2.89,2.89,0,0,0,2,2C12.9,28,20,28,20,28s7.12,0,8.9-.47a2.87,2.87,0,0,0,2-2A30.56,30.56,0,0,0,31.37,20,28.88,28.88,0,0,0,30.91,14.53ZM17.73,23.41V16.59L23.65,20Z"></path></svg></a>
<a href="javascript:window.open('https://github.com/spring-projects');" title="Github"><svg id="github-icon" viewbox="0 0 75.93 75.93" xmlns="http://www.w3.org/2000/svg"><path class="cls-1" d="M38,0a38,38,0,1,0,38,38A38,38,0,0,0,38,0Z"></path><path class="cls-2" d="M38,15.59A22.95,22.95,0,0,0,30.71,60.3c1.15.21,1.57-.5,1.57-1.11s0-2,0-3.9c-6.38,1.39-7.73-3.07-7.73-3.07A6.09,6.09,0,0,0,22,48.86c-2.09-1.42.15-1.39.15-1.39a4.81,4.81,0,0,1,3.52,2.36c2,3.5,5.37,2.49,6.67,1.91a4.87,4.87,0,0,1,1.46-3.07c-5.09-.58-10.45-2.55-10.45-11.34a8.84,8.84,0,0,1,2.36-6.15,8.29,8.29,0,0,1,.23-6.07s1.92-.62,6.3,2.35a21.82,21.82,0,0,1,11.49,0c4.38-3,6.3-2.35,6.3-2.35a8.29,8.29,0,0,1,.23,6.07,8.84,8.84,0,0,1,2.36,6.15c0,8.81-5.37,10.75-10.48,11.32a5.46,5.46,0,0,1,1.56,4.25c0,3.07,0,5.54,0,6.29s.42,1.33,1.58,1.1A22.94,22.94,0,0,0,38,15.59Z"></path></svg></a>
<a href="javascript:window.open('https://twitter.com/springcentral');" title="Twitter"><svg id="twitter-icon" viewbox="0 0 75.93 75.93" xmlns="http://www.w3.org/2000/svg"><circle class="cls-1" cx="37.97" cy="37.97" r="37.97"></circle><path class="cls-2" d="M55.2,22.73a15.43,15.43,0,0,1-4.88,1.91,7.56,7.56,0,0,0-5.61-2.49A7.78,7.78,0,0,0,37,30a7.56,7.56,0,0,0,.2,1.79,21.63,21.63,0,0,1-15.84-8.23,8,8,0,0,0,2.37,10.52,7.66,7.66,0,0,1-3.48-1v.09A7.84,7.84,0,0,0,26.45,41a7.54,7.54,0,0,1-2,.28A7.64,7.64,0,0,1,23,41.09a7.71,7.71,0,0,0,7.18,5.47,15.21,15.21,0,0,1-9.55,3.37,15.78,15.78,0,0,1-1.83-.11,21.41,21.41,0,0,0,11.78,3.54c14.13,0,21.86-12,21.86-22.42,0-.34,0-.68,0-1a15.67,15.67,0,0,0,3.83-4.08,14.9,14.9,0,0,1-4.41,1.24A7.8,7.8,0,0,0,55.2,22.73Z" data-name="Twitter" id="Twitter-2"></path></svg></a>
</div>
</div>
</div>
</div>
</footer>
<script src="static/js/main-0c8620f9bfc02ced83daef5cff6.js"></script>
</body></html>