<!DOCTYPE html><html lang="zh-CN"><head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Spring Cloud Consul 中文文档 参考手册 中文版</title>
<link rel="stylesheet" href="static/css/css-OpenSans300300italic400400it.css">
<style>article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,video{display:inline-block}audio:not([controls]){display:none;height:0}[hidden],template{display:none}script{display:none!important}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}a{background:transparent}a:focus{outline:thin dotted}a:active,a:hover{outline:0}h1{font-size:2em;margin:.67em 0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}mark{background:#ff0;color:#000}code,kbd,pre,samp{font-family:monospace;font-size:1em}pre{white-space:pre-wrap}q{quotes:"\201C" "\201D" "\2018" "\2019"}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:0}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}button,input{line-height:normal}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}html,body{font-size:100%}body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}a:hover{cursor:pointer}img,object,embed{max-width:100%;height:auto}object,embed{height:100%}img{-ms-interpolation-mode:bicubic}.left{float:left!important}.right{float:right!important}.text-left{text-align:left!important}.text-right{text-align:right!important}.text-center{text-align:center!important}.text-justify{text-align:justify!important}.hide{display:none}body{-webkit-font-smoothing:antialiased}img,object,svg{display:inline-block;vertical-align:middle}textarea{height:auto;min-height:50px}select{width:100%}.center{margin-left:auto;margin-right:auto}.spread{width:100%}p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}a{color:#2156a5;text-decoration:underline;line-height:inherit}a:hover,a:focus{color:#1d4b8f}a img{border:none}p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}em,i{font-style:italic;line-height:inherit}strong,b{font-weight:bold;line-height:inherit}small{font-size:60%;line-height:inherit}code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ul.no-bullet{list-style:none}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em}abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}abbr{text-transform:none}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}blockquote cite:before{content:"\2014 \0020"}blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}table thead,table tfoot{background:#f7f8f7;font-weight:bold}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}body{tab-size:4}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}.clearfix:after,.float-group:after{clear:both}*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}.keyseq{color:rgba(51,51,51,.8)}kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menu{color:rgba(0,0,0,.8)}b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}b.button:before{content:"[";padding:0 3px 0 2px}b.button:after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,.9)}#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}#header:after,#content:after,#footnotes:after,#footer:after{clear:both}#content{margin-top:1.25em}#content:before{content:none}#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}#header .details span:first-child{margin-left:-.125em}#header .details span.email a{color:rgba(0,0,0,.85)}#header .details br{display:none}#header .details br+span:before{content:"\00a0\2013\00a0"}#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}#header .details br+span#revremark:before{content:"\00a0|\00a0"}#header #revnumber{text-transform:capitalize}#header #revnumber:after{content:"\00a0"}#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}#toc>ul{margin-left:.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media only screen and (min-width:768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}#footer-text{color:rgba(255,255,255,.8);line-height:1.44}.sect1{padding-bottom:.625em}@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.listingblock>.content{position:relative}.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}.listingblock:hover code[data-lang]:before{display:block}.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}table.pyhltable td.code{padding-left:.75em;padding-right:0}pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}pre.pygments .lineno{display:inline-block;margin-right:.25em}table.pyhltable .linenodiv{background:none!important;padding-right:0!important}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}.quoteblock .quoteblock blockquote:before{display:none}.verseblock{margin:0 1em 1.25em 1em}.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}.quoteblock.abstract{margin:0 0 1.25em 0;display:block}.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}table.tableblock{max-width:100%;border-collapse:separate}table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}table.frame-all{border-width:1px}table.frame-sides{border-width:0 1px}table.frame-topbot{border-width:1px 0}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}td>div.verse{white-space:pre}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd{margin-left:1.125em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}ul.inline>li>*{display:block}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}.colist>table tr>td:last-of-type{padding:.25em 0}.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:.625em}.image.right{margin-left:.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}.gist .file-data>table td.line-data{width:99%}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background-color:#00fafa}.black{color:#000}.black-background{background-color:#000}.blue{color:#0000bf}.blue-background{background-color:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background-color:#fa00fa}.gray{color:#606060}.gray-background{background-color:#7d7d7d}.green{color:#006000}.green-background{background-color:#007d00}.lime{color:#00bf00}.lime-background{background-color:#00fa00}.maroon{color:#600000}.maroon-background{background-color:#7d0000}.navy{color:#000060}.navy-background{background-color:#00007d}.olive{color:#606000}.olive-background{background-color:#7d7d00}.purple{color:#600060}.purple-background{background-color:#7d007d}.red{color:#bf0000}.red-background{background-color:#fa0000}.silver{color:#909090}.silver-background{background-color:#bcbcbc}.teal{color:#006060}.teal-background{background-color:#007d7d}.white{color:#bfbfbf}.white-background{background-color:#fafafa}.yellow{color:#bfbf00}.yellow-background{background-color:#fafa00}span.icon>.fa{cursor:default}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff!important}.conum[data-value]+b{display:none}.conum[data-value]:after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-.125em}b.conum *{color:inherit!important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt{letter-spacing:-.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}p{margin-bottom:1.25rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}.print-only{display:none!important}@media print{@page{margin:1.25cm .75cm}*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}a{color:inherit!important;text-decoration:underline!important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}abbr[title]:after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}svg{max-width:100%}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}#toc,.sidebarblock,.exampleblock>.content{background:none!important}#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}.sect1{padding-bottom:0!important}.sect1+.sect1{border:0!important}#header>h1:first-child{margin-top:1.25rem}body.book #header{text-align:center}body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}body.book #header .details{border:0!important;display:block;padding:0!important}body.book #header .details span:first-child{margin-left:0!important}body.book #header .details br{display:block}body.book #header .details br+span:before{content:none!important}body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]:before{display:block}#footer{background:none!important;padding:0 .9375em}#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}.hide-on-print{display:none!important}.print-only{display:block!important}.hide-for-print{display:none!important}.show-for-print{display:inherit!important}}</style>
<link type="text/css" rel="stylesheet" href="static/css/springcloud.min.css"><script type="text/javascript" src="static/js/springcloud.min.js"></script></head>
<body class="article">
<div id="header">
<h1>Spring Cloud Consul</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong><font o="2">1.2.0.RELEASE</font></strong></p>
</div>
<div class="paragraph">
<p><font o="3">该项目通过自动配置并绑定到Spring环境和其他Spring编程模型成语，为Spring Boot应用程序提供Consul集成。</font><font o="4">通过几个简单的注释，您可以快速启用和配置应用程序中的常见模式，并使用基于Consul的组件构建大型分布式系统。</font><font o="5">提供的模式包括服务发现，控制总线和配置。</font><font o="6">智能路由（Zuul）和客户端负载平衡（Ribbon），断路器（Hystrix）通过与Spring Cloud Netflix的集成提供。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-install"><font o="7">安装Consul</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="8">请参阅</font><a href="javascript:;"><font o="8">安装文档</font></a><font o="8">获取有关如何安装Consul指令。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-agent">Consul Agent</h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="10">所有Spring Cloud Consul应用程序必须可以使用Consul Agent客户端。</font><font o="11">默认情况下，代理客户端预计位于<code i="13">localhost:8500</code>。</font><font o="12">有关</font><font o="12">如何启动代理客户端以及如何连接到Consul Agent服务器的集群的</font><font o="12">详细信息，请参阅</font><a href="javascript:;"><font o="12">代理文档</font></a><font o="12">。</font><font o="13">对于开发人员，在安装了领事后，您可以使用以下命令启动Consul Agent：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">./src/main/bash/local_run_consul.sh</pre>
</div>
</div>
<div class="paragraph">
<p><font o="14">这将启动端口8500上的服务器模式的代理，其中ui可以在</font><a href="javascript:;" class="bare"><font o="14">http：// localhost：8500上找到</font></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-discovery"><font o="15">服务发现与Consul</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="16">服务发现是基于微服务架构的关键原则之一。</font><font o="17">尝试配置每个客户端或某种形式的约定可能非常困难，可以非常脆弱。</font><font o="18">Consul通过</font><a href="javascript:;"><font o="18">HTTP API</font></a><font o="18">和</font><a href="javascript:;"><font o="18">DNS</font></a><font o="18">提供服务发现服务</font><font o="18">。</font><font o="19">Spring Cloud Consul利用HTTP API进行服务注册和发现。</font><font o="20">这不会阻止非Spring云应用程序利用DNS界面。</font><font o="21">Consul代理服务器在</font><font o="21">通过</font><a href="javascript:;"><font o="21">八卦协议进行通信</font></a><font o="21">的</font><a href="javascript:;"><font o="21">群集中</font></a><font o="21">运行，</font><font o="21">并使用</font><a href="javascript:;"><font o="21">筏式协议协议</font></a><font o="21">。</font><a href="javascript:;"><font></font></a><font></font><a href="javascript:;"><font></font></a><font></font></p>
</div>
<div class="sect2">
<h3 id="_how_to_activate"><font o="22">如何激活</font></h3>
<div class="paragraph">
<p><font o="23">要激活Consul服务发现，请使用组<code i="14">org.springframework.cloud</code>和工件id <code i="15">spring-cloud-starter-consul-discovery</code>的启动器。</font><font o="24">有关</font><font o="24">使用当前Spring云端列车设置构建系统的详细信息，</font><font o="24">请参阅</font><a href="javascript:;"><font o="24">Spring云计算页面</font></a><font o="24">。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_with_consul"><font o="25">注册Consul</font></h3>
<div class="paragraph">
<p><font o="26">当客户端注册Consul时，它提供有关自身的元数据，如主机和端口，ID，名称和标签。</font><font o="27">默认情况下，将创建</font><font o="27">一个HTTP </font><a href="javascript:;"><font o="27">检查</font></a><font o="27">，每隔10秒Consul命中<code i="16">/health</code>端点。</font><font o="28">如果健康检查失败，则服务实例被标记为关键。</font></p>
</div>
<div class="paragraph">
<p><font o="29">示例Consul客户端：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableDiscoveryClient
@RestController
public class Application {

    @RequestMapping("/")
    public String home() {
        return "Hello world";
    }

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="30">（即完全正常的Spring Boot应用程序）。</font><font o="31">如果Consul客户端位于<code i="17">localhost:8500</code>以外的位置，则需要配置来定位客户端。</font><font o="32">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="33">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      host: localhost
      port: 8500</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="34">警告</font></div>
</td>
<td class="content"><font o="35">
如果您使用</font><a href="#spring-cloud-consul-config"><font o="35">Spring Cloud Consul Config</font></a><font o="35">，上述值将需要放置在<code i="18">bootstrap.yml</code>而不是<code i="19">application.yml</code>中。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="36">从<code i="20">Environment</code>获取的默认服务名称，实例ID和端口分别为<code i="21">${spring.application.name}</code>，Spring上下文ID和<code i="22">${server.port}</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="37"><code i="23">@EnableDiscoveryClient</code>使应用程序成为Consul“服务”（即注册自己）和“客户端”（即可以查询Consul查找其他服务）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_http_health_check"><font o="38">HTTP健康检查</font></h3>
<div class="paragraph">
<p><font o="39">Consul实例的运行状况检查默认为“/ health”，它是Spring Boot Actuator应用程序中有用端点的默认位置。</font><font o="40">如果您使用非默认上下文路径或servlet路径（例如<code i="24">server.servletPath=/foo</code>）或管理端点路径（例如<code i="25">management.context-path=/admin</code>）），则需要更改这些，即使是执行器应用程序。</font><font o="41">也可以配置Consul用于检查运行状况端点的间隔。</font><font o="42">“10s”和“1m”分别表示10秒和1分钟。</font><font o="43">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="44">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      discovery:
        healthCheckPath: ${management.context-path}/health
        healthCheckInterval: 15s</pre>
</div>
</div>
<div class="sect3">
<h4 id="_metadata_and_consul_tags"><font o="45">元数据和Consul标签</font></h4>
<div class="paragraph">
<p><font o="46">Consul尚不支持服务元数据。</font><font o="47">Spring Cloud的<code i="26">ServiceInstance</code>有一个<code i="27">Map&lt;String, String&gt; metadata</code>字段。</font><font o="48">Spring Cloud Consul使用Consul标签来近似元数据，直到Consul正式支持元数据。</font><font o="49">具有<code i="28">key=value</code>形式的标签将被分割并分别用作<code i="29">Map</code>键和值。</font><font o="50">没有相等<code i="30">=</code>符号的标签将被用作键和值两者。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="51">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      discovery:
        tags: foo=bar, baz</pre>
</div>
</div>
<div class="paragraph">
<p><font o="52">上述配置将导致具有<code i="31">foo→bar</code>和<code i="32">baz→baz</code>的地图。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_making_the_consul_instance_id_unique"><font o="53">使Consul实例ID唯一</font></h4>
<div class="paragraph">
<p><font o="54">默认情况下，一个领事实体注册了一个等于其Spring应用程序上下文ID的ID。</font><font o="55">缺省情况下，Spring应用上下文ID为<code i="33">${spring.application.name}:comma,separated,profiles:${server.port}</code>。</font><font o="56">在大多数情况下，这将允许一个服务的多个实例在一台机器上运行。</font><font o="57">如果需要进一步的唯一性，使用Spring Cloud可以通过在<code i="34">spring.cloud.consul.discovery.instanceId</code>中提供唯一的标识来覆盖此。</font><font o="58">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="59">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      discovery:
        instanceId: ${spring.application.name}:${vcap.application.instance_id:${spring.application.instance_id:${random.value}}}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="60">使用这个元数据和在localhost上部署的多个服务实例，随机值将在那里进行，以使实例是唯一的。</font><font o="61">在Cloudfoundry中，<code i="35">vcap.application.instance_id</code>将在Spring Boot应用程序中自动填充，因此不需要随机值。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_discoveryclient"><font o="62">使用DiscoveryClient</font></h3>
<div class="paragraph">
<p><font o="63">Spring Cloud支持</font><a href="javascript:;"><font o="63">Feign</font></a><font o="63">（一个REST客户端构建器），还支持</font><a href="javascript:;"><font o="63">Spring <code i="36">RestTemplate</code></font></a><font o="63">使用逻辑服务名称而不是实际的URL。</font></p>
</div>
<div class="paragraph">
<p><font o="64">您还可以使用<code i="37">org.springframework.cloud.client.discovery.DiscoveryClient</code>，它为Netflix不具体的发现客户端提供简单的API，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances("STORES");
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri();
    }
    return null;
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-config"><font o="65">具有Consul的分布式配置</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="66">Consul提供了</font><font o="66">用于存储配置和其他元数据</font><font o="66">的</font><a href="javascript:;"><font o="66">键/值存储</font></a><font o="66">。</font><font o="67">Spring Cloud Consul Config是</font><a href="javascript:;"><font o="67">Config Server和Client</font></a><font o="67">的替代方案</font><font o="67">。</font><font o="68">在特殊的“引导”阶段，配置被加载到Spring环境中。</font><font o="69">默认情况下，配置存储在<code i="38">/config</code>文件夹中。</font><font o="70">根据应用程序的名称和模拟Spring Cloud Config顺序解析属性的活动配置文件，创建多个<code i="39">PropertySource</code>实例。</font><font o="71">例如，名为“testApp”的应用程序和“dev”配置文件将创建以下属性源：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/testApp,dev/
config/testApp/
config/application,dev/
config/application/</pre>
</div>
</div>
<div class="paragraph">
<p><font o="72">最具体的物业来源位于顶部，底部最不具体。</font><font o="73">Properties是<code i="40">config/application</code>文件夹适用于使用consul进行配置的所有应用程序。</font><font o="74"><code i="41">config/testApp</code>文件夹中的Properties仅适用于名为“testApp”的服务实例。</font></p>
</div>
<div class="paragraph">
<p><font o="75">配置当前在应用程序启动时被读取。</font><font o="76">发送HTTP POST到<code i="42">/refresh</code>将导致重新加载配置。</font><font o="77">观看键值存储（Consul支持））目前不可能，但将来将是此项目的补充。</font></p>
</div>
<div class="sect2">
<h3 id="_how_to_activate_2"><font o="78">如何激活</font></h3>
<div class="paragraph">
<p><font o="79">要开始使用Consul配置，请使用组<code i="43">org.springframework.cloud</code>和工件id <code i="44">spring-cloud-starter-consul-config</code>的启动器。</font><font o="80">有关</font><font o="80">使用当前Spring云端列车设置构建系统的详细信息，</font><font o="80">请参阅</font><a href="javascript:;"><font o="80">Spring云计算页面</font></a><font o="80">。</font></p>
</div>
<div class="paragraph">
<p><font o="81">这将启用将配置Spring Cloud Consul配置的自动配置。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_customizing"><font o="82">定制</font></h3>
<div class="paragraph">
<p><font o="83">可以使用以下属性自定义Consul配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="84">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      config:
        enabled: true
        prefix: configuration
        defaultContext: apps
        profileSeparator: '::'</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="85"><code i="45">enabled</code>将此值设置为“false”将禁用Consul配置</font></p>
</li>
<li>
<p><font o="86"><code i="46">prefix</code>设置配置值的基本文件夹</font></p>
</li>
<li>
<p><font o="87"><code i="47">defaultContext</code>设置所有应用程序使用的文件夹名称</font></p>
</li>
<li>
<p><font o="88"><code i="48">profileSeparator</code>设置分隔符的值，用于使用配置文件在属性源中分隔配置文件名称</font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-config-watch"><font o="89">配置观察</font></h3>
<div class="paragraph">
<p><font o="90">Consul配置观察功能可以利用领事</font><a href="javascript:;"><font o="90">看守钥匙前缀</font></a><font o="90">的能力</font><font o="90">。</font><font o="91">Config Watch会阻止Consul HTTP API调用，以确定当前应用程序是否有任何相关配置数据发生更改。</font><font o="92">如果有新的配置数据，则会发布刷新事件。</font><font o="93">这相当于调用<code i="49">/refresh</code>执行器端点。</font></p>
</div>
<div class="paragraph">
<p><font o="94">要更改Config Watch调用的频率change <code i="50">spring.cloud.consul.config.watch.delay</code>。</font><font o="95">默认值为1000，以毫秒为单位。</font></p>
</div>
<div class="paragraph">
<p><font o="96">禁用Config Watch集合<code i="51">spring.cloud.consul.config.watch.enabled=false</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-config-format"><font o="97">YAML或Properties配置</font></h3>
<div class="paragraph">
<p><font o="98">存储与YAML或Properties格式的一组属性相对于单个键/值对可能更为方便。</font><font o="99">将<code i="52">spring.cloud.consul.config.format</code>属性设置为<code i="53">YAML</code>或<code i="54">PROPERTIES</code>。</font><font o="100">例如使用YAML：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="101">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      config:
        format: YAML</pre>
</div>
</div>
<div class="paragraph">
<p><font o="102">必须在适当的<code i="55">data</code>键中设置YAML。</font><font o="103">使用键上面的默认值将如下所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/testApp,dev/data
config/testApp/data
config/application,dev/data
config/application/data</pre>
</div>
</div>
<div class="paragraph">
<p><font o="104">您可以将YAML文档存储在上述任何键中。</font></p>
</div>
<div class="paragraph">
<p><font o="105">您可以使用<code i="56">spring.cloud.consul.config.data-key</code>更改数据密钥。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-config-git2consul"><font o="106">git2consul与配置</font></h3>
<div class="paragraph">
<p><font o="107">git2consul是一个Consul社区项目，将文件从git存储库加载到各个密钥到Consul。</font><font o="108">默认情况下，密钥的名称是文件的名称。</font><font o="109">分别支持文件扩展名为<code i="57">.yml</code>和<code i="58">.properties</code>的YAML和Properties文件。</font><font o="110">将<code i="59">spring.cloud.consul.config.format</code>属性设置为<code i="60">FILES</code>。</font><font o="111">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="112">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      config:
        format: FILES</pre>
</div>
</div>
<div class="paragraph">
<p><font o="113">给定<code i="61">/config</code>中的以下密钥，<code i="62">development</code>配置文件和应用程序名称为<code i="63">foo</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">.gitignore
application.yml
bar.properties
foo-development.properties
foo-production.yml
foo.properties
master.ref</pre>
</div>
</div>
<div class="paragraph">
<p><font o="114">将创建以下属性来源：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/foo-development.properties
config/foo.properties
config/application.yml</pre>
</div>
</div>
<div class="paragraph">
<p><font o="115">每个键的值需要是一个格式正确的YAML或Properties文件。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-failfast"><font o="116">快速失败</font></h3>
<div class="paragraph">
<p><font o="117">在某些情况下（如本地开发或某些测试场景）可能会方便，如果不能配置领事，则不会失败。</font><font o="118">在<code i="65">bootstrap.yml</code>中设置<code i="64">spring.cloud.consul.config.failFast=false</code>将导致配置模块记录一个警告而不是抛出异常。</font><font o="119">这将允许应用程序继续正常启动。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-retry"><font o="120">Consul重试</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="121">如果您希望您的应用程序启动时可能偶尔无法使用代理商，则可以要求您在发生故障后继续尝试。</font><font o="122">您需要在您的类路径中添加<code i="66">spring-retry</code>和<code i="67">spring-boot-starter-aop</code>。</font><font o="123">默认行为是重试6次，初始退避间隔为1000ms，指数乘数为1.1，用于后续退避。</font><font o="124">您可以使用<code i="68">spring.cloud.consul.retry.*</code>配置属性配置这些属性（和其他）。</font><font o="125">这适用于Spring Cloud Consul配置和发现注册。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="126">提示</font></div>
</td>
<td class="content"><font o="127">
要完全控制重试，请使用id为“consulRetryInterceptor”添加<code i="70">RetryOperationsInterceptor</code>类型的<code i="69">@Bean</code>。</font><font o="128">Spring重试有一个<code i="71">RetryInterceptorBuilder</code>，可以轻松创建一个。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-bus"><font o="129">Spring Cloud Bus与Consul</font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_to_activate_3"><font o="130">如何激活</font></h3>
<div class="paragraph">
<p><font o="131">要开始使用Consul总线，请使用组<code i="72">org.springframework.cloud</code>和工件ID <code i="73">spring-cloud-starter-consul-bus</code>的启动器。</font><font o="132">有关</font><font o="132">使用当前Spring云端列车设置构建系统的详细信息，</font><font o="132">请参阅</font><a href="javascript:;"><font o="132">Spring云计算页面</font></a><font o="132">。</font></p>
</div>
<div class="paragraph">
<p><font o="133">有关</font><font o="133">可用的执行机构端点以及如何发送自定义消息，</font><font o="133">请参阅</font><a href="javascript:;"><font o="133">Spring Cloud Bus</font></a><font o="133">文档。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-hystrix"><font o="134">断路器与Hystrix</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="135">应用程序可以使用Spring Cloud Netflix项目提供的Hystrix断路器，将此启动器包含在项目pom.xml：<code i="74">spring-cloud-starter-hystrix</code>中。</font><font o="136">Hystrix不依赖于Netflix Discovery Client。</font><font o="137"><code i="75">@EnableHystrix</code>注释应放置在配置类（通常是主类）上。</font><font o="138">那么方法可以用<code i="76">@HystrixCommand</code>注释来被断路器保护。</font><font o="139">有关</font><font o="139">详细信息，</font><font o="139">请参阅</font><a href="javascript:;"><font o="139">文档</font></a><font o="139">。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-turbine"><font o="140">使用Turbine和Consul Hystrix指标聚合</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="141">Turbine（由Spring Cloud Netflix项目提供），聚合多个实例Hystrix指标流，因此仪表板可以显示聚合视图。</font><font o="142">Turbine使用<code i="77">DiscoveryClient</code>接口查找相关实例。</font><font o="143">要将Turbine与Spring Cloud Consul配合使用与以下示例类似的方式配置Turbine应用程序：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="144">pom.xml</font></div>
<div class="content">
<pre class="notranslate">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-netflix-turbine&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><font o="145">请注意，Turbine依赖不是起始者。</font><font o="146">涡轮启动器包括对Netflix Eureka的支持。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="147">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring.application.name: turbine
applications: consulhystrixclient
turbine:
  aggregator:
    clusterConfig: ${applications}
  appConfig: ${applications}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="148"><code i="78">clusterConfig</code>和<code i="79">appConfig</code>部分必须匹配，因此将逗号分隔的服务标识列表放在单独的配置属性中是有用的。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="149" class="">Turbine.java</font></div>
<div class="content">
<pre class="notranslate">@EnableTurbine
@EnableDiscoveryClient
@SpringBootApplication
public class Turbine {
    public static void main(String[] args) {
        SpringApplication.run(DemoturbinecommonsApplication.class, args);
    }
}</pre>
</div>
</div>
</div>
</div>
</div>

<script type="text/javascript" name="springcloud">springcloud.cc({"original":{"2":"1.2.0.RELEASE","3":"This project provides {9/} integrations for {5/} apps through autoconfiguration and binding to the {12/} Environment and other {12/} programming model idioms.","4":"With a few simple annotations you can quickly enable and configure the common patterns inside your application and build large distributed systems with {9/} based components.","5":"The patterns provided include Service Discovery, Control Bus and Configuration.","6":"Intelligent Routing ({10/}) and Client Side Load Balancing ({11/}), Circuit Breaker ({7/}) are provided by integration with {1/}.","7":"Install {9/}","8":"Please see the installation documentation for instructions on how to install {9/}.","10":"A {4/} client must be available to all {2/} applications.","11":"By default, the Agent client is expected to be at {13/}.","12":"See the Agent documentation for specifics on how to start an Agent client and how to connect to a cluster of {4/} Servers.","13":"For development, after you have installed consul, you may start a {4/} using the following command:","14":"This will start an agent in server mode on port 8500, with the ui available at http://localhost:8500","15":"Service Discovery with {9/}","16":"Service Discovery is one of the key tenets of a microservice based architecture.","17":"Trying to hand configure each client or some form of convention can be very difficult to do and can be very brittle.","18":"{9/} provides Service Discovery services via an HTTP API and DNS .","19":"{2/} leverages the HTTP API for service registration and discovery.","20":"This does not prevent non-{12/} Cloud applications from leveraging the DNS interface.","21":"{9/} Agents servers are run in a cluster that communicates via a gossip protocol and uses the Raft consensus protocol .","22":"How to activate","23":"To activate {9/} Service Discovery use the starter with group {14/} and artifact id {15/}.","24":"See the {12/} Cloud Project page for details on setting up your build system with the current {12/} Cloud Release Train.","25":"Registering with {9/}","26":"When a client registers with {9/}, it provides meta-data about itself such as host and port, id, name and tags.","27":"An HTTP Check is created by default that {9/} hits the {16/} endpoint every 10 seconds.","28":"If the health check fails, the service instance is marked as critical.","29":"Example {9/} client:","30":"(ie utterly normal {5/} app).","31":"If the {9/} client is located somewhere other than {17/}, the configuration is required to locate the client.","32":"Example:","33":"application.yml","34":"Caution","35":"\nIf you use {2/} Config, the above values will need to be placed in {18/} instead of {19/}.\n","36":"The default service name, instance id and port, taken from the {20/}, are {21/}, the {12/} Context ID and {22/} respectively.","37":"{23/} make the app into both a {9/} \"service\" (i.e. it registers itself) and a \"client\" (i.e. it can query {9/} to locate other services).","38":"HTTP Health Check","39":"The health check for a {9/} instance defaults to \"/health\", which is the default locations of a useful endpoint in a {0/} application.","40":"You need to change these, even for an Actuator application if you use a non-default context path or servlet path (eg {24/}) or management endpoint path (eg {25/}).","41":"The interval that {9/} uses to check the health endpoint may also be configured.","42":"\"10s\" and \"1m\" represent 10 seconds and 1 minute respectively.","43":"Example:","44":"application.yml","45":"Metadata and {9/} tags","46":"{9/} does not yet support metadata on services.","47":"{12/} Cloud's {26/} has a {27/} field.","48":"{2/} uses {9/} tags to approximate metadata until {9/} officially supports metadata.","49":"Tags with the form {28/} will be split and used as a {29/} key and value respectively.","50":"Tags without the equal {30/} sign, will be used as both the key and value.","51":"application.yml","52":"The above configuration will result in a map with {31/} and {32/}.","53":"Making the {9/} Instance ID Unique","54":"By default a consul instance is registered with an ID that is equal to its {12/} Application Context ID.","55":"By default, the {12/} Application Context ID is {33/}.","56":"For most cases, this will allow multiple instances of one service to run on one machine.","57":"If further uniqueness is required, Using {12/} Cloud you can override this by providing a unique identifier in {34/}.","58":"For example:","59":"application.yml","60":"With this metadata, and multiple service instances deployed on localhost, the random value will kick in there to make the instance unique.","61":"In Cloudfoundry the {35/} will be populated automatically in a {5/} application, so the random value will not be needed.","62":"Using the DiscoveryClient","63":"{12/} Cloud has support for Feign (a REST client builder) and also {12/} {36/} using the logical service names instead of physical URLs.","64":"You can also use the {37/} which provides a simple API for discovery clients that is not specific to Netflix, e.g.","65":"Distributed Configuration with {9/}","66":"{9/} provides a Key/Value Store for storing configuration and other metadata.","67":"{2/} Config is an alternative to the Config Server and Client .","68":"Configuration is loaded into the {12/} Environment during the special \"bootstrap\" phase.","69":"Configuration is stored in the {38/} folder by default.","70":"Multiple {39/} instances are created based on the application's name and the active profiles that mimicks the {12/} Cloud Config order of resolving properties.","71":"For example, an application with the name \"testApp\" and with the \"dev\" profile will have the following property sources created:","72":"The most specific property source is at the top, with the least specific at the bottom.","73":"{6/} is the {40/} folder are applicable to all applications using consul for configuration.","74":"{6/} in the {41/} folder are only available to the instances of the service named \"testApp\".","75":"Configuration is currently read on startup of the application.","76":"Sending a HTTP POST to {42/} will cause the configuration to be reloaded.","77":"Watching the key value store (which {9/} supports) is not currently possible, but will be a future addition to this project.","78":"How to activate","79":"To get started with {9/} Configuration use the starter with group {43/} and artifact id {44/}.","80":"See the {12/} Cloud Project page for details on setting up your build system with the current {12/} Cloud Release Train.","81":"This will enable auto-configuration that will setup {2/} Config.","82":"Customizing","83":"{9/} Config may be customized using the following properties:","84":"bootstrap.yml","85":"{45/} setting this value to \"false\" disables {9/} Config","86":"{46/} sets the base folder for configuration values","87":"{47/} sets the folder name used by all applications","88":"{48/} sets the value of the separator used to separate the profile name in property sources with profiles","89":"Config Watch","90":"The {9/} Config Watch takes advantage of the ability of consul to watch a key prefix .","91":"The Config Watch makes a blocking {9/} HTTP API call to determine if any relevant configuration data has changed for the current application.","92":"If there is new configuration data a Refresh Event is published.","93":"This is equivalent to calling the {49/} actuator endpoint.","94":"To change the frequency of when the Config Watch is called change {50/}.","95":"The default value is 1000, which is in milliseconds.","96":"To disable the Config Watch set {51/}.","97":"YAML or {6/} with Config","98":"It may be more convenient to store a blob of properties in YAML or {6/} format as opposed to individual key/value pairs.","99":"Set the {52/} property to {53/} or {54/}.","100":"For example to use YAML:","101":"bootstrap.yml","102":"YAML must be set in the appropriate {55/} key in consul.","103":"Using the defaults above the keys would look like:","104":"You could store a YAML document in any of the keys listed above.","105":"You can change the data key using {56/}.","106":"git2consul with Config","107":"git2consul is a {9/} community project that loads files from a git repository to individual keys into {9/}.","108":"By default the names of the keys are names of the files.","109":"YAML and {6/} files are supported with file extensions of {57/} and {58/} respectively.","110":"Set the {59/} property to {60/}.","111":"For example:","112":"bootstrap.yml","113":"Given the following keys in {61/}, the {62/} profile and an application name of {63/}:","114":"the following property sources would be created:","115":"The value of each key needs to be a properly formatted YAML or {6/} file.","116":"Fail Fast","117":"It may be convenient in certain circumstances (like local development or certain test scenarios) to not fail if consul isn't available for configuration.","118":"Setting {64/} in {65/} will cause the configuration module to log a warning rather than throw an exception.","119":"This will allow the application to continue startup normally.","120":"{9/} Retry","121":"If you expect that the consul agent may occasionally be unavailable when your app starts, you can ask it to keep trying after a failure.","122":"You need to add {66/} and {67/} to your classpath.","123":"The default behaviour is to retry 6 times with an initial backoff interval of 1000ms and an exponential multiplier of 1.1 for subsequent backoffs.","124":"You can configure these properties (and others) using {68/} configuration properties.","125":"This works with both {2/} Config and Discovery registration.","126":"Tip","127":"To take full control of the retry add a {69/} of type {70/} with id \"consulRetryInterceptor\".","128":"{12/} Retry has a {71/} that makes it easy to create one.","129":"{3/} with {9/}","130":"How to activate","131":"To get started with the {9/} Bus use the starter with group {72/} and artifact id {73/}.","132":"See the {12/} Cloud Project page for details on setting up your build system with the current {12/} Cloud Release Train.","133":"See the {3/} documentation for the available actuator endpoints and howto send custom messages.","134":"Circuit Breaker with {7/}","135":"Applications can use the {7/} Circuit Breaker provided by the {1/} project by including this starter in the projects pom.xml: {74/}.","136":"{7/} doesn't depend on the Netflix Discovery Client.","137":"The {75/} annotation should be placed on a configuration class (usually the main class).","138":"Then methods can be annotated with {76/} to be protected by a circuit breaker.","139":"See the documentation for more details.","140":"{7/} metrics aggregation with {8/} and {9/}","141":"{8/} (provided by the {1/} project), aggregates multiple instances {7/} metrics streams, so the dashboard can display an aggregate view.","142":"{8/} uses the {77/} interface to lookup relevant instances.","143":"To use {8/} with {2/}, configure the {8/} application in a manner similar to the following examples:","144":"pom.xml","145":"Notice that the {8/} dependency is not a starter.","146":"The turbine starter includes support for Netflix Eureka.","147":"application.yml","148":"The {78/} and {79/} sections must match, so it’s useful to put the comma-separated list of service ID’s into a separate configuration property.","149":"{8/}.java"},"errors":{},"nouns":{"0":"Spring Boot Actuator","1":"Spring Cloud Netflix","2":"Spring Cloud Consul","3":"Spring Cloud Bus","4":"Consul Agent","5":"Spring Boot","6":"Properties","7":"Hystrix","8":"Turbine","9":"Consul","10":"Zuul","11":"Ribbon","12":"Spring"},"name":"spring-cloud-consul","timestamp":1494152117336});</script></body></html>