<!DOCTYPE html><html lang="zh-CN"><head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Spring Cloud Brixton 中文文档 参考手册 中文版</title>
<link rel="stylesheet" href="static/css/css-OpenSans300300italic400400it.css">
<style>article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,video{display:inline-block}audio:not([controls]){display:none;height:0}[hidden],template{display:none}script{display:none!important}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}a{background:transparent}a:focus{outline:thin dotted}a:active,a:hover{outline:0}h1{font-size:2em;margin:.67em 0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}mark{background:#ff0;color:#000}code,kbd,pre,samp{font-family:monospace;font-size:1em}pre{white-space:pre-wrap}q{quotes:"\201C" "\201D" "\2018" "\2019"}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:0}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}button,input{line-height:normal}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}html,body{font-size:100%}body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}a:hover{cursor:pointer}img,object,embed{max-width:100%;height:auto}object,embed{height:100%}img{-ms-interpolation-mode:bicubic}#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}.left{float:left!important}.right{float:right!important}.text-left{text-align:left!important}.text-right{text-align:right!important}.text-center{text-align:center!important}.text-justify{text-align:justify!important}.hide{display:none}.antialiased,body{-webkit-font-smoothing:antialiased}img{display:inline-block;vertical-align:middle}textarea{height:auto;min-height:50px}select{width:100%}p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}a{color:#2156a5;text-decoration:underline;line-height:inherit}a:hover,a:focus{color:#1d4b8f}a img{border:none}p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}em,i{font-style:italic;line-height:inherit}strong,b{font-weight:bold;line-height:inherit}small{font-size:60%;line-height:inherit}code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ul.no-bullet{list-style:none}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em}abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}abbr{text-transform:none}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}blockquote cite:before{content:"\2014 \0020"}blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}table thead,table tfoot{background:#f7f8f7;font-weight:bold}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}.clearfix:after,.float-group:after{clear:both}*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}.keyseq{color:rgba(51,51,51,.8)}kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menu{color:rgba(0,0,0,.8)}b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}b.button:before{content:"[";padding:0 3px 0 2px}b.button:after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,.9)}#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}#header:after,#content:after,#footnotes:after,#footer:after{clear:both}#content{margin-top:1.25em}#content:before{content:none}#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}#header .details span:first-child{margin-left:-.125em}#header .details span.email a{color:rgba(0,0,0,.85)}#header .details br{display:none}#header .details br+span:before{content:"\00a0\2013\00a0"}#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}#header .details br+span#revremark:before{content:"\00a0|\00a0"}#header #revnumber{text-transform:capitalize}#header #revnumber:after{content:"\00a0"}#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}#toc>ul{margin-left:.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media only screen and (min-width:768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}#footer-text{color:rgba(255,255,255,.8);line-height:1.44}.sect1{padding-bottom:.625em}@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.listingblock>.content{position:relative}.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}.listingblock:hover code[data-lang]:before{display:block}.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}table.pyhltable td.code{padding-left:.75em;padding-right:0}pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}pre.pygments .lineno{display:inline-block;margin-right:.25em}table.pyhltable .linenodiv{background:none!important;padding-right:0!important}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}.quoteblock .quoteblock blockquote:before{display:none}.verseblock{margin:0 1em 1.25em 1em}.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}.quoteblock.abstract{margin:0 0 1.25em 0;display:block}.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}table.tableblock{max-width:100%;border-collapse:separate}table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}table.spread{width:100%}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}table.frame-all{border-width:1px}table.frame-sides{border-width:0 1px}table.frame-topbot{border-width:1px 0}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}td>div.verse{white-space:pre}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd{margin-left:1.125em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}ul.inline>li>*{display:block}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1{padding-right:.75em;font-weight:bold}td.hdlist1,td.hdlist2{vertical-align:top}.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}.colist>table tr>td:last-of-type{padding:.25em 0}.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:.625em}.image.right{margin-left:.625em}a.image{text-decoration:none}span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}span.footnote a,span.footnoteref a{text-decoration:none}span.footnote a:active,span.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}.gist .file-data>table td.line-data{width:99%}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background-color:#00fafa}.black{color:#000}.black-background{background-color:#000}.blue{color:#0000bf}.blue-background{background-color:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background-color:#fa00fa}.gray{color:#606060}.gray-background{background-color:#7d7d7d}.green{color:#006000}.green-background{background-color:#007d00}.lime{color:#00bf00}.lime-background{background-color:#00fa00}.maroon{color:#600000}.maroon-background{background-color:#7d0000}.navy{color:#000060}.navy-background{background-color:#00007d}.olive{color:#606000}.olive-background{background-color:#7d7d00}.purple{color:#600060}.purple-background{background-color:#7d007d}.red{color:#bf0000}.red-background{background-color:#fa0000}.silver{color:#909090}.silver-background{background-color:#bcbcbc}.teal{color:#006060}.teal-background{background-color:#007d7d}.white{color:#bfbfbf}.white-background{background-color:#fafafa}.yellow{color:#bfbf00}.yellow-background{background-color:#fafa00}span.icon>.fa{cursor:default}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff!important}.conum[data-value]+b{display:none}.conum[data-value]:after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-.125em}b.conum *{color:inherit!important}.conum:not([data-value]):empty{display:none}h1,h2{letter-spacing:-.01em}dt,th.tableblock,td.content{text-rendering:optimizeLegibility}p,td.content{letter-spacing:-.01em}p strong,td.content strong{letter-spacing:-.005em}p,blockquote,dt,td.content{font-size:1.0625rem}p{margin-bottom:1.25rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}.print-only{display:none!important}@media print{@page{margin:1.25cm .75cm}*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}a{color:inherit!important;text-decoration:underline!important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}abbr[title]:after{content:" (" attr(title) ")"}pre,blockquote,tr,img{page-break-inside:avoid}thead{display:table-header-group}img{max-width:100%!important}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}#toc,.sidebarblock,.exampleblock>.content{background:none!important}#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}.sect1{padding-bottom:0!important}.sect1+.sect1{border:0!important}#header>h1:first-child{margin-top:1.25rem}body.book #header{text-align:center}body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}body.book #header .details{border:0!important;display:block;padding:0!important}body.book #header .details span:first-child{margin-left:0!important}body.book #header .details br{display:block}body.book #header .details br+span:before{content:none!important}body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]:before{display:block}#footer{background:none!important;padding:0 .9375em}#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}.hide-on-print{display:none!important}.print-only{display:block!important}.hide-for-print{display:none!important}.show-for-print{display:inherit!important}}</style>
<link type="text/css" rel="stylesheet" href="static/css/springcloud.min.css"><script type="text/javascript" src="static/js/springcloud.min.js"></script></head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Cloud</h1>
<div id="toc" class="toc2">
<div id="toctitle"><font o="2">目录</font></div>
<ul class="sectlevel1">
<li><a href="#_features"><font o="3">特征</font></a></li>
<li><a href="#_cloud_native_applications"><font o="4" class="">云原生应用程序</font></a>
<ul class="sectlevel1">
<li><a href="#_spring_cloud_context_application_context_services"><font o="5">Spring Cloud上下文：应用程序上下文服务</font></a>
<ul class="sectlevel2">
<li><a href="#_the_bootstrap_application_context"><font o="6">引导应用程序上下文</font></a></li>
<li><a href="#_application_context_hierarchies"><font o="7">应用程序上下文层次结构</font></a></li>
<li><a href="#customizing-bootstrap-properties"><font o="8">改变Bootstrap的位置Properties</font></a></li>
<li><a href="#overriding-bootstrap-properties"><font o="9">覆盖远程Properties的值</font></a></li>
<li><a href="#_customizing_the_bootstrap_configuration"><font o="10">自定义引导配置</font></a></li>
<li><a href="#customizing-bootstrap-property-sources"><font o="11">自定义引导属性源</font></a></li>
<li><a href="#_environment_changes"><font o="12">环境变化</font></a></li>
<li><a href="#_refresh_scope"><font o="13">刷新范围</font></a></li>
<li><a href="#_encryption_and_decryption"><font o="14">加密和解密</font></a></li>
<li><a href="#_endpoints"><font o="15">端点</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_commons_common_abstractions"><font o="16">Spring Cloud Commons：普通抽象</font></a>
<ul class="sectlevel2">
<li><a href="#__enablediscoveryclient"><font o="17">@EnableDiscoveryClient</font></a></li>
<li><a href="#_serviceregistry"><font o="18">ServiceRegistry</font></a></li>
<li><a href="#_spring_resttemplate_as_a_load_balancer_client"><font o="19">Spring RestTemplate作为负载均衡器客户端</font></a></li>
<li><a href="#_multiple_resttemplate_objects"><font o="20">多个RestTemplate对象</font></a></li>
<li><a href="#ignore-network-interfaces"><font o="21">忽略网络接口</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_cloud_config">Spring Cloud Config</a>
<ul class="sectlevel1">
<li><a href="#_quick_start"><font o="23">快速开始</font></a>
<ul class="sectlevel2">
<li><a href="#_client_side_usage"><font o="24">客户端使用</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_config_server"><font o="25">Spring Cloud Config服务器</font></a>
<ul class="sectlevel2">
<li><a href="#_environment_repository"><font o="26">环境库</font></a></li>
<li><a href="#_health_indicator"><font o="27">健康指标</font></a></li>
<li><a href="#_security"><font o="28">安全</font></a></li>
<li><a href="#_encryption_and_decryption_2"><font o="29">加密和解密</font></a></li>
<li><a href="#_key_management"><font o="30">密钥管理</font></a></li>
<li><a href="#_creating_a_key_store_for_testing"><font o="31">创建用于测试的密钥库</font></a></li>
<li><a href="#_using_multiple_keys_and_key_rotation"><font o="32">使用多个键和键旋转</font></a></li>
<li><a href="#_serving_encrypted_properties"><font o="33">服务加密Properties</font></a></li>
</ul>
</li>
<li><a href="#_serving_alternative_formats"><font o="34">服务替代格式</font></a></li>
<li><a href="#_serving_plain_text"><font o="35">服务纯文本</font></a></li>
<li><a href="#_embedding_the_config_server"><font o="36">嵌入配置服务器</font></a></li>
<li><a href="#_push_notifications_and_spring_cloud_bus"><font o="37">推送通知和Spring Cloud Bus</font></a></li>
<li><a href="#_spring_cloud_config_client"><font o="38">Spring Cloud Config客户端</font></a>
<ul class="sectlevel2">
<li><a href="#config-first-bootstrap"><font o="39">配置第一引导</font></a></li>
<li><a href="#discovery-first-bootstrap"><font o="40">发现第一个引导</font></a></li>
<li><a href="#config-client-fail-fast"><font o="41">配置客户端快速失败</font></a></li>
<li><a href="#config-client-retry"><font o="42">配置客户端重试</font></a></li>
<li><a href="#_locating_remote_configuration_resources"><font o="43">查找远程配置资源</font></a></li>
<li><a href="#_security_2"><font o="44">安全</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_cloud_netflix"><font o="45">Spring Cloud Netflix</font></a>
<ul class="sectlevel1">
<li><a href="#_service_discovery_eureka_clients"><font o="46">服务发现：Eureka客户端</font></a>
<ul class="sectlevel2">
<li><a href="#_registering_with_eureka"><font o="47">注册Eureka</font></a></li>
<li><a href="#_authenticating_with_the_eureka_server"><font o="48">使用Eureka服务器进行身份验证</font></a></li>
<li><a href="#_status_page_and_health_indicator"><font o="49">状态页和健康指标</font></a></li>
<li><a href="#_registering_a_secure_application"><font o="50">注册安全应用程序</font></a></li>
<li><a href="#_eureka_s_health_checks"><font o="51">Eureka的健康检查</font></a></li>
<li><a href="#_eureka_metadata_for_instances_and_clients"><font o="52">Eureka实例和客户端的元数据</font></a></li>
<li><a href="#_using_the_eurekaclient"><font o="53">使用EurekaClient</font></a></li>
<li><a href="#_alternatives_to_the_native_netflix_eurekaclient"><font o="54">本机Netflix EurekaClient的替代方案</font></a></li>
<li><a href="#_why_is_it_so_slow_to_register_a_service"><font o="55">为什么注册服务这么慢？</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-eureka-server"><font o="56">服务发现：Eureka服务器</font></a>
<ul class="sectlevel2">
<li><a href="#_high_availability_zones_and_regions"><font o="57">高可用性，区域和地区</font></a></li>
<li><a href="#_standalone_mode"><font o="58">独立模式</font></a></li>
<li><a href="#_peer_awareness"><font o="59">同行意识</font></a></li>
<li><a href="#_prefer_ip_address"><font o="60">IP地址偏好</font></a></li>
</ul>
</li>
<li><a href="#_circuit_breaker_hystrix_clients"><font o="61">断路器：Hystrix客户</font></a>
<ul class="sectlevel2">
<li><a href="#_propagating_the_security_context_or_using_spring_scopes"><font o="62">传播安全上下文或使用Spring范围</font></a></li>
<li><a href="#_health_indicator_2"><font o="63">健康指标</font></a></li>
<li><a href="#_hystrix_metrics_stream"><font o="64">Hystrix指标流</font></a></li>
</ul>
</li>
<li><a href="#_circuit_breaker_hystrix_dashboard"><font o="65">断路器：Hystrix仪表板</font></a>
<ul class="sectlevel2">
<li><a href="#_turbine">Turbine</a></li>
<li><a href="#_turbine_stream"><font o="67">Turbine流</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-ribbon"><font o="68">客户端负载均衡器：Ribbon</font></a>
<ul class="sectlevel2">
<li><a href="#_customizing_the_ribbon_client"><font o="69">自定义Ribbon客户端</font></a></li>
<li><a href="#_using_ribbon_with_eureka"><font o="70">使用Ribbon与Eureka</font></a></li>
<li><a href="#spring-cloud-ribbon-without-eureka"><font o="71">示例：如何使用Ribbon不使用Eureka</font></a></li>
<li><a href="#_example_disable_eureka_use_in_ribbon"><font o="72">示例：在Ribbon中禁用Eureka使用</font></a></li>
<li><a href="#_using_the_ribbon_api_directly"><font o="73">直接使用Ribbon API</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-feign"><font o="74">声明性REST客户端：Feign</font></a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-feign-overriding-defaults"><font o="75">覆盖Feign默认值</font></a></li>
<li><a href="#spring-cloud-feign-hystrix"><font o="76">Feign Hystrix支持</font></a></li>
<li><a href="#spring-cloud-feign-hystrix-fallback"><font o="77">Feign Hystrix回退</font></a></li>
<li><a href="#spring-cloud-feign-inheritance"><font o="78">Feign继承支持</font></a></li>
<li><a href="#_feign_request_response_compression"><font o="79">Feign请求/响应压缩</font></a></li>
<li><a href="#_feign_logging"><font o="80">Feign日志记录</font></a></li>
</ul>
</li>
<li><a href="#_external_configuration_archaius"><font o="81">外部配置：Archaius</font></a></li>
<li><a href="#_router_and_filter_zuul"><font o="82">路由器和过滤器：Zuul</font></a>
<ul class="sectlevel2">
<li><a href="#netflix-zuul-reverse-proxy"><font o="83">嵌入Zuul反向代理</font></a></li>
<li><a href="#_cookies_and_sensitive_headers"><font o="84">Cookie和敏感Header</font></a></li>
<li><a href="#_the_routes_endpoint"><font o="85">路线端点</font></a></li>
<li><a href="#_strangulation_patterns_and_local_forwards"><font o="86">扼杀模式和本地Forwards</font></a></li>
<li><a href="#_uploading_files_through_zuul"><font o="87">通过Zuul上传文件</font></a></li>
<li><a href="#_plain_embedded_zuul"><font o="88">普通嵌入Zuul</font></a></li>
<li><a href="#_disable_zuul_filters"><font o="89">禁用Zuul筛选器</font></a></li>
<li><a href="#_polyglot_support_with_sidecar"><font o="90">Polyglot支持与Sidecar</font></a></li>
</ul>
</li>
<li><a href="#netflix-rxjava-springmvc"><font o="91">RxJava与Spring MVC</font></a></li>
<li><a href="#netflix-metrics"><font o="92">指标：Spectator，Servo和Atlas</font></a>
<ul class="sectlevel2">
<li><a href="#_dimensional_vs_hierarchical_metrics"><font o="93">维度与层次度量</font></a></li>
<li><a href="#_default_metrics_collection"><font o="94">默认度量集合</font></a></li>
<li><a href="#netflix-metrics-spectator"><font o="95">指标集：Spectator</font></a></li>
<li><a href="#netflix-metrics-servo"><font o="96">指标集：Servo</font></a></li>
<li><a href="#netflix-metrics-atlas"><font o="97">指标后端：Atlas</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_cloud_stream">Spring Cloud Stream</a>
<ul class="sectlevel1">
<li><a href="#_introducing_spring_cloud_stream"><font o="99">介绍Spring Cloud Stream</font></a></li>
<li><a href="#_main_concepts"><font o="100">主要概念</font></a>
<ul class="sectlevel2">
<li><a href="#_application_model"><font o="101">应用模型</font></a></li>
<li><a href="#_the_binder_abstraction"><font o="102">Binder抽象</font></a></li>
<li><a href="#_persistent_publish_subscribe_support"><font o="103">持续发布 - 订阅支持</font></a></li>
<li><a href="#consumer-groups"><font o="104">消费群体</font></a></li>
<li><a href="#partitioning"><font o="105">分区支持</font></a></li>
</ul>
</li>
<li><a href="#_programming_model"><font o="106">编程模型</font></a>
<ul class="sectlevel2">
<li><a href="#_declaring_and_binding_channels"><font o="107">声明和绑定频道</font></a></li>
</ul>
</li>
<li><a href="#_binders">Binders</a>
<ul class="sectlevel2">
<li><a href="#_producers_and_consumers"><font o="109">生产者和消费者</font></a></li>
<li><a href="#_binder_spi">Binder SPI</a></li>
<li><a href="#_binder_detection"><font o="111">Binder检测</font></a></li>
<li><a href="#multiple-binders"><font o="112">Classpath上有多个Binders</font></a></li>
<li><a href="#multiple-systems"><font o="113">连接到多个系统</font></a></li>
<li><a href="#_binder_configuration_properties"><font o="114">Binder配置属性</font></a></li>
<li><a href="#_implementation_strategies"><font o="115">实施策略</font></a></li>
</ul>
</li>
<li><a href="#_configuration_options"><font o="116">配置选项</font></a>
<ul class="sectlevel2">
<li><a href="#_spring_cloud_stream_properties">Spring Cloud Stream Properties</a></li>
<li><a href="#binding-properties"><font o="118">绑定Properties</font></a></li>
</ul>
</li>
<li><a href="#binder-specific-configuration"><font o="119">Binder  - 具体配置</font></a>
<ul class="sectlevel2">
<li><a href="#_rabbit_specific_settings"><font o="120">Rabbit-Specific设定</font></a></li>
<li><a href="#_kafka_specific_settings"><font o="121">Kafka  - 具体设置</font></a></li>
</ul>
</li>
<li><a href="#contenttypemanagement"><font o="122">内容类型和转换</font></a>
<ul class="sectlevel2">
<li><a href="#mime-types"><font o="123">MIME类型</font></a></li>
<li><a href="#mime-types-and-java-types"><font o="124">MIME类型和Java类型</font></a></li>
<li><a href="#__code_streamlistener_code_and_message_conversion"><font o="125"><code i="47">@StreamListener</code>和讯息转换</font></a></li>
</ul>
</li>
<li><a href="#_inter_application_communication"><font o="126">应用间通信</font></a>
<ul class="sectlevel2">
<li><a href="#_connecting_multiple_application_instances"><font o="127">连接多个应用程序实例</font></a></li>
<li><a href="#_instance_index_and_instance_count"><font o="128">实例索引和实例计数</font></a></li>
<li><a href="#_partitioning"><font o="129">分区</font></a></li>
</ul>
</li>
<li><a href="#_testing"><font o="130">测试</font></a></li>
<li><a href="#_health_indicator_3"><font o="131">健康指标</font></a></li>
<li><a href="#_samples"><font o="132">样品</font></a></li>
<li><a href="#_getting_started"><font o="133">入门</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_bus">Spring Cloud Bus</a>
<ul class="sectlevel1">
<li><a href="#_quick_start_2"><font o="135">快速开始</font></a></li>
<li><a href="#_addressing_an_instance"><font o="136">处理实例</font></a></li>
<li><a href="#_addressing_all_instances_of_a_service"><font o="137">寻址服务的所有实例</font></a></li>
<li><a href="#_application_context_id_must_be_unique"><font o="138">应用程序上下文ID必须是唯一的</font></a></li>
<li><a href="#_customizing_the_message_broker"><font o="139">自定义Message Broker</font></a></li>
<li><a href="#_tracing_bus_events"><font o="140">追踪Bus Events</font></a></li>
<li><a href="#_broadcasting_your_own_events"><font o="141">广播自己的Events</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_sleuth">Spring Cloud Sleuth</a>
<ul class="sectlevel2">
<li><a href="#_terminology"><font o="143">术语</font></a></li>
<li><a href="#_purpose"><font o="144">目的</font></a></li>
<li><a href="#_adding_to_the_project"><font o="145">添加到项目中</font></a></li>
<li><a href="#_additional_resources"><font o="146">额外的资源</font></a></li>
<li><a href="#_features_2"><font o="147">特征</font></a></li>
<li><a href="#_sampling"><font o="148">采样</font></a></li>
<li><a href="#_instrumentation"><font o="149">仪表</font></a></li>
<li><a href="#_span_lifecycle"><font o="150">跨度生命周期</font></a>
<ul class="sectlevel2">
<li><a href="#creating-and-closing-spans"><font o="151">创建和关闭spans</font></a></li>
<li><a href="#continuing-spans"><font o="152">继续spans</font></a></li>
<li><a href="#creating-spans-with-explicit-parent"><font o="153">用明确的父代创建spans</font></a></li>
</ul>
</li>
<li><a href="#_naming_spans"><font o="154">命名spans</font></a>
<ul class="sectlevel2">
<li><a href="#__spanname_annotation"><font o="155">@SpanName注释</font></a></li>
<li><a href="#_tostring_method"><font o="156">toString（）方法</font></a></li>
</ul>
</li>
<li><a href="#_customizations"><font o="157">自定义</font></a>
<ul class="sectlevel2">
<li><a href="#_spring_integration">Spring Integration</a></li>
<li><a href="#_http"><font o="159">HTTP</font></a></li>
<li><a href="#_example"><font o="160">例</font></a></li>
<li><a href="#_custom_sa_tag_in_zipkin"><font o="161">Zipkin中的自定义SA标签</font></a></li>
<li><a href="#_custom_service_name"><font o="162">自定义服务名称</font></a></li>
</ul>
</li>
<li><a href="#_span_data_as_messages"><font o="163">Span Data作为消息</font></a>
<ul class="sectlevel2">
<li><a href="#_zipkin_consumer"><font o="164">Zipkin消费者</font></a></li>
<li><a href="#_custom_consumer"><font o="165">定制消费者</font></a></li>
</ul>
</li>
<li><a href="#_metrics"><font o="166">度量</font></a></li>
<li><a href="#_integrations"><font o="167">集成</font></a>
<ul class="sectlevel2">
<li><a href="#_runnable_and_callable"><font o="168">可运行和可调用</font></a></li>
<li><a href="#_hystrix">Hystrix</a></li>
<li><a href="#_rxjava"><font o="170">RxJava</font></a></li>
<li><a href="#_http_integration"><font o="171">HTTP集成</font></a></li>
<li><a href="#_http_client_integration"><font o="172">HTTP客户端集成</font></a></li>
<li><a href="#_feign">Feign</a></li>
<li><a href="#_asynchronous_communication"><font o="174">异步通信</font></a></li>
<li><a href="#_messaging"><font o="175">消息</font></a></li>
<li><a href="#_zuul">Zuul</a></li>
</ul>
</li>
<li><a href="#_running_examples"><font o="177">运行示例</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_consul">Spring Cloud Consul</a>
<ul class="sectlevel1">
<li><a href="#spring-cloud-consul-install"><font o="179">安装Consul</font></a></li>
<li><a href="#spring-cloud-consul-agent"><font o="180">Consul代理</font></a></li>
<li><a href="#spring-cloud-consul-discovery"><font o="181">服务发现与Consul</font></a>
<ul class="sectlevel2">
<li><a href="#_registering_with_consul"><font o="182">注册Consul</font></a></li>
<li><a href="#_http_health_check"><font o="183">HTTP健康检查</font></a></li>
<li><a href="#_using_the_discoveryclient"><font o="184">使用DiscoveryClient</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-consul-config"><font o="185">具有Consul的分布式配置</font></a>
<ul class="sectlevel2">
<li><a href="#_how_to_activate"><font o="186">如何激活</font></a></li>
<li><a href="#_customizing"><font o="187">定制</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-consul-config-format"><font o="188">YAML或Properties配置</font></a></li>
<li><a href="#spring-cloud-consul-config-git2consul"><font o="189">git2consul与配置</font></a></li>
<li><a href="#spring-cloud-consul-failfast"><font o="190">快速失败</font></a></li>
<li><a href="#spring-cloud-consul-retry"><font o="191">Consul重试</font></a></li>
<li><a href="#spring-cloud-consul-bus"><font o="192">Spring Cloud Bus与Consul</font></a></li>
<li><a href="#spring-cloud-consul-hystrix"><font o="193">断路器与Hystrix</font></a></li>
<li><a href="#spring-cloud-consul-turbine"><font o="194">使用Turbine和Consul Hystrix指标聚合</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_zookeeper">Spring Cloud Zookeeper</a>
<ul class="sectlevel1">
<li><a href="#spring-cloud-zookeeper-install"><font o="196">安装Zookeeper</font></a></li>
<li><a href="#spring-cloud-zookeeper-discovery"><font o="197">服务发现与Zookeeper</font></a>
<ul class="sectlevel2">
<li><a href="#_how_to_activate_2"><font o="198">如何激活</font></a></li>
<li><a href="#_registering_with_zookeeper"><font o="199">注册Zookeeper</font></a></li>
<li><a href="#_using_the_discoveryclient_2"><font o="200">使用DiscoveryClient</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-zookeeper-dependencies"><font o="201">Zookeeper依赖关系</font></a>
<ul class="sectlevel2">
<li><a href="#_using_the_zookeeper_dependencies"><font o="202">使用Zookeeper依赖关系</font></a></li>
<li><a href="#_how_to_activate_zookeeper_dependencies"><font o="203">如何激活Zookeeper依赖关系</font></a></li>
<li><a href="#_setting_up_zookeeper_dependencies"><font o="204">设置Zookeeper依赖关系</font></a></li>
<li><a href="#_configuring_spring_cloud_zookeeper_dependencies"><font o="205">配置Spring Cloud Zookeeper依赖关系</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-zookeeper-dependency-watcher"><font o="206">Spring Cloud Zookeeper依赖关系观察者</font></a>
<ul class="sectlevel2">
<li><a href="#_how_to_activate_3"><font o="207">如何激活</font></a></li>
<li><a href="#_registering_a_listener"><font o="208">注册侦听器</font></a></li>
<li><a href="#_presence_checker"><font o="209">存在检查</font></a></li>
</ul>
</li>
<li><a href="#spring-cloud-zookeeper-config"><font o="210">分布式配置与Zookeeper</font></a>
<ul class="sectlevel2">
<li><a href="#_how_to_activate_4"><font o="211">如何激活</font></a></li>
<li><a href="#_customizing_2"><font o="212">定制</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_boot_cloud_cli">Spring Boot Cloud CLI</a>
<ul class="sectlevel1">
<li><a href="#_installation"><font o="214">安装</font></a></li>
<li><a href="#_running_spring_cloud_services_in_development"><font o="215">在开发中运行Spring Cloud服务</font></a>
<ul class="sectlevel2">
<li><a href="#_adding_additional_applications"><font o="216">添加其他应用程序</font></a></li>
</ul>
</li>
<li><a href="#_writing_groovy_scripts_and_running_applications"><font o="217">编写Groovy脚本并运行应用程序</font></a></li>
<li><a href="#_encryption_and_decryption_3"><font o="218">加密和解密</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_security">Spring Cloud Security</a>
<ul class="sectlevel1">
<li><a href="#_quickstart"><font o="220">快速开始</font></a>
<ul class="sectlevel2">
<li><a href="#_oauth2_single_sign_on"><font o="221">OAuth2单一登录</font></a></li>
<li><a href="#_oauth2_protected_resource"><font o="222">OAuth2受保护资源</font></a></li>
</ul>
</li>
<li><a href="#_more_detail"><font o="223">更多详情</font></a>
<ul class="sectlevel2">
<li><a href="#_single_sign_on"><font o="224">单点登录</font></a></li>
<li><a href="#_token_relay"><font o="225">令牌中继</font></a></li>
</ul>
</li>
<li><a href="#_configuring_authentication_downstream_of_a_zuul_proxy"><font o="226">配置Zuul代理下游的认证</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_for_cloud_foundry">Spring Cloud for Cloud Foundry</a>
<ul class="sectlevel1">
<li><a href="#_discovery"><font o="228">发现</font></a></li>
<li><a href="#_single_sign_on_2"><font o="229">单点登录</font></a></li>
</ul>
</li>
<li><a href="#_spring_cloud_cluster"><font o="230">Spring Cloud集群</font></a>
<ul class="sectlevel1">
<li><a href="#_leader_election"><font o="231">Leader选举</font></a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-cluster-leaderelection-zookeeper">Zookeeper</a></li>
<li><a href="#spring-cloud-cluster-leaderelection-hazelcast">Hazelcast</a></li>
<li><a href="#spring-cloud-cluster-leaderelection-etcd">Etcd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendix_compendium_of_configuration_properties"><font o="235">附录：配置纲要Properties</font></a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><font o="236">Spring Cloud为开发人员提供了快速构建分布式系统中一些常见模式的工具（例如配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁，领导选举，分布式会话，集群状态）。</font><font o="237">分布式系统的协调导致了样板模式, 使用Spring Cloud开发人员可以快速地支持实现这些模式的服务和应用程序。</font><font o="238">他们将在任何分布式环境中运行良好，包括开发人员自己的笔记本电脑，裸机数据中心，以及Cloud Foundry等托管平台。</font></p>
</div>
<div class="paragraph">
<p><font o="239">版本：Brixton.BUILD-SNAPSHOT</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features"><font o="240">特征</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="241">Spring Cloud专注于提供良好的开箱即用经验的典型用例和可扩展性机制覆盖。</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="242">分布式/版本化配置</font></p>
</li>
<li>
<p><font o="243">服务注册和发现</font></p>
</li>
<li>
<p><font o="244">路由</font></p>
</li>
<li>
<p><font o="245">service - to - service调用</font></p>
</li>
<li>
<p><font o="246">负载均衡</font></p>
</li>
<li>
<p><font o="247">断路器</font></p>
</li>
<li>
<p><font o="248">全局锁</font></p>
</li>
<li>
<p><font o="249">Leadership选举与集群状态</font></p>
</li>
<li>
<p><font o="250">分布式消息传递</font></p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_cloud_native_applications" class="sect0"><font o="251">云原生应用程序</font></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><a href="javascript:;"><font o="252">云原生</font></a><font o="252">是一种应用开发风格，鼓励在持续交付和价值驱动开发领域轻松采用最佳实践。</font><font o="253" class="">相关的学科是建立</font><a href="javascript:;"><font o="253" class="">12-factor Apps</font></a><font o="253" class="">，其中开发实践与交付和运营目标相一致，例如通过使用声明式编程和管理和监控。</font><font o="254">Spring Cloud以许多具体方式促进这些开发风格，起点是分布式系统中的所有组件需要或需要时轻松访问的一组功能。</font></p>
</div>
<div class="paragraph">
<p><font o="255">许多这些功能都由</font><a href="javascript:;"><font o="255">Spring Boot</font></a><font o="255">覆盖</font><font o="255">，我们在Spring Cloud中建立。</font><font o="256">更多的由Spring Cloud提供为两个库：Spring Cloud上下文和Spring Cloud Commons。</font><font o="257">Spring Cloud上下文为Spring Cloud应用程序（引导上下文，加密，刷新范围和环境端点）的<code i="48">ApplicationContext</code>提供实用程序和特殊服务。</font><font o="258">Spring Cloud Commons是一组在不同的Spring Cloud实现中使用的抽象和常用类（例如Spring Cloud Netflix vs. Spring Cloud Consul）。</font></p>
</div>
<div class="paragraph">
<p><font o="259" class="">如果由于“非法密钥大小”而导致异常，并且您正在使用Sun的JDK，则需要安装Java加密扩展（JCE）无限强度管理策略文件。</font><font o="260">有关详细信息，请参阅以下链接：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javascript:;"><font o="261">Java 6 JCE</font></a></p>
</li>
<li>
<p><a href="javascript:;"><font o="262">Java 7 JCE</font></a></p>
</li>
<li>
<p><a href="javascript:;"><font o="263">Java 8 JCE</font></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="264">将文件解压缩到JDK / jre / lib / security文件夹（无论您使用的是哪个版本的JRE / JDK x64 / x86）。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="265">注意</font></div>
</td>
<td class="content"><font o="266">
Spring Cloud在非限制性Apache 2.0许可证下发布。</font><font o="267" class="">如果您想为文档的这一部分做出贡献，或者发现错误，请在</font><a href="javascript:;"><font o="267" class="">github</font></a><font o="267" class="">中找到项目中的源代码和问题跟踪器</font><font o="267" class="">。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_context_application_context_services"><font o="268">Spring Cloud上下文：应用程序上下文服务</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="269">Spring Boot有如何使用Spring构建应用程序的意见：例如它具有常规配置文件的常规位置，以及用于常见管理和监视任务的端点。</font><font o="270">Spring Cloud建立在此之上，并添加了一些可能系统中所有组件将使用或偶尔需要的功能。</font></p>
</div>
<div class="sect2">
<h3 id="_the_bootstrap_application_context"><font o="271">引导应用程序上下文</font></h3>
<div class="paragraph">
<p><font o="272">一个Spring Cloud应用程序通过创建一个“引导”上下文来运行，上下文是主应用程序的父上下文。</font><font o="273">开箱即用，负责从外部源加载配置属性，还解密本地外部配置文件中的属性。</font><font o="274">这两个上下文共享一个<code i="49">Environment</code>，这是任何Spring应用程序的外部属性的来源。</font><font o="275">Bootstrap属性的优先级高，因此默认情况下不能被本地配置覆盖。</font></p>
</div>
<div class="paragraph">
<p><font o="276">引导上下文使用与主应用程序上下文定位外部配置的不同约定，因此使用<code i="52">bootstrap.yml</code>而不是<code i="50">application.yml</code>（或<code i="51">.properties</code>），保持引导和主上下文的外部配置非常独立。</font><font o="277">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="278">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  application:
    name: foo
  cloud:
    config:
      uri: ${SPRING_CONFIG_URI:http://localhost:8888}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="279">如果您的应用程序需要从服务器进行特定于应用程序的配置，那么设置<code i="53">spring.application.name</code>（<code i="54">bootstrap.yml</code>或<code i="55">application.yml</code>）是个好主意。</font></p>
</div>
<div class="paragraph">
<p><font o="280">您可以通过设置<code i="56">spring.cloud.bootstrap.enabled=false</code>（例如在系统属性中）来完全禁用引导过程。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_application_context_hierarchies"><font o="281">应用程序上下文层次结构</font></h3>
<div class="paragraph">
<p><font o="282">如果您从<code i="57">SpringApplication</code>或<code i="58">SpringApplicationBuilder</code>构建应用程序上下文，则将Bootstrap上下文添加为该上下文的父级。</font><font o="283">这是一个Spring的功能，即子上下文从其父级继承属性源和配置文件，因此与主要构建相同的上下文相比，“主”应用程序上下文将包含其他属性源，而不使用Spring Cloud Config。</font><font o="284">额外的财产来源是：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="285">“bootstrap”：如果在引导上下文中找到任何<code i="60">PropertySourceLocators</code>，则可选的<code i="59">CompositePropertySource</code>显示为高优先级，它们具有非空属性。</font><font o="286">一个例子就是Spring Cloud Config服务器的属性。</font><font o="287">有关</font><font o="287">如何自定义此属性源的内容的</font><a href="#customizing-bootstrap-property-sources"><font o="287">说明</font></a><font o="287">，</font><font o="287">请参阅
 </font><a href="#customizing-bootstrap-property-sources"><font o="287">下文</font></a><font o="287">。</font></p>
</li>
<li>
<p><font o="288">“applicationConfig：[classpath：bootstrap.yml]”（和朋友，如果Spring配置文件处于活动状态）。</font><font o="289">如果您有一个<code i="61">bootstrap.yml</code>（或属性），那么这些属性用于配置引导上下文，然后在父设置时将它们添加到子上下文中。</font><font o="290">它们的优先级低于<code i="62">application.yml</code>（或属性）以及作为创建Spring Boot应用程序进程的正常部分添加到子级的任何其他属性源的优先级。</font><font o="291">有关</font><font o="291">如何自定义这些属性源的内容的</font><a href="#customizing-bootstrap-properties"><font o="291">说明</font></a><font o="291">，</font><font o="291">请参阅</font><a href="#customizing-bootstrap-properties"><font o="291">下文</font></a><font o="291">。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="292">由于属性源的排序规则，“引导”条目优先，但请注意，这些条目不包含来自<code i="63">bootstrap.yml</code>的任何数据，其优先级非常低，但可用于设置默认值。</font></p>
</div>
<div class="paragraph">
<p><font o="293">您可以通过简单地设置您创建的任何<code i="64">ApplicationContext</code>的父上下文来扩展上下文层次结构，例如使用自己的界面，或使用<code i="65">SpringApplicationBuilder</code>方便方法（<code i="66">parent()</code>，<code i="67">child()</code>和<code i="68">sibling()</code>）。</font><font o="294">引导环境将是您创建自己的最高级祖先的父级。</font><font o="295">层次结构中的每个上下文都将有自己的“引导”属性源（可能为空），以避免无意中将值从父级升级到其后代。</font><font o="296">层次结构中的每个上下文也可以（原则上）具有不同的<code i="69">spring.application.name</code>，因此，如果存在配置服务器，则不同的远程属性源。</font><font o="297">正常Spring应用程序上下文行为规则适用于属性解析：子上下文的属性通过名称以及属性源名称覆盖父项中的属性（如果子级具有与父级名称相同的属性源，一个来自父母的孩子不包括在孩子中）。</font></p>
</div>
<div class="paragraph">
<p><font o="298">请注意，<code i="70">SpringApplicationBuilder</code>允许您在整个层次结构中共享<code i="71">Environment</code>，但这不是默认的。</font><font o="299">因此，兄弟情境尤其不需要具有相同的资料或财产来源，尽管它们与父母共享共同点。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-bootstrap-properties"><font o="300">改变Bootstrap的位置Properties</font></h3>
<div class="paragraph">
<p><font o="301">可以使用<code i="74">spring.cloud.bootstrap.name</code>（默认“引导”）或<code i="75">spring.cloud.bootstrap.location</code>（默认为空）指定<code i="72">bootstrap.yml</code>（或<code i="73">.properties</code>）位置，例如系统属性。</font><font o="302">这些属性的行为类似于具有相同名称的<code i="76">spring.config.*</code>变体，实际上它们用于通过在其<code i="78">Environment</code>中设置这些属性来设置引导<code i="77">ApplicationContext</code>。</font><font o="303">如果在正在建立的上下文中有活动的配置文件（来自<code i="79">spring.profiles.active</code>或通过<code i="80">Environment</code> API），则该配置文件中的属性也将被加载，就像在常规的Spring Boot应用程序中，例如来自<code i="81">bootstrap-development.properties</code>的“开发”简介。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="overriding-bootstrap-properties"><font o="304">覆盖远程Properties的值</font></h3>
<div class="paragraph">
<p><font o="305">通过引导上下文添加到应用程序的属性源通常是“远程”（例如从配置服务器），并且默认情况下，不能在本地覆盖，除了在命令行上。</font><font o="306">如果要允许应用程序使用自己的系统属性或配置文件覆盖远程属性，则远程属性源必须通过设置<code i="82">spring.cloud.config.allowOverride=true</code>（无法在本地设置）授予权限。</font><font o="307">一旦设置了该标志，就会有一些更精细的设置来控制远程属性与系统属性和应用程序本地配置的位置：<code i="83">spring.cloud.config.overrideNone=true</code>覆盖任何本地属性源，<code i="84">spring.cloud.config.overrideSystemProperties=false</code>如果只有系统属性和env var应该覆盖远程设置，而不是本地配置文件。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_the_bootstrap_configuration"><font o="308">自定义引导配置</font></h3>
<div class="paragraph">
<p><font o="309">可以通过在<code i="86">org.springframework.cloud.bootstrap.BootstrapConfiguration</code>关键字<code i="85">/META-INF/spring.factories</code>下添加条目来训练自举上下文来执行任何您喜欢的操作。</font><font o="310">这是用于创建上下文的Spring <code i="87">@Configuration</code>类的逗号分隔列表。</font><font o="311">您可以在此处创建要用于自动布线的主应用程序上下文的任何bean，并且还有一个<code i="88">@Beans</code>类型为<code i="89">ApplicationContextInitializer</code>的特殊合同。</font><font o="312">如果要控制启动顺序（默认顺序为“最后”），可以使用<code i="90">@Order</code>标记类。</font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="313">警告</font></div>
</td>
<td class="content"><font o="314">
添加自定义<code i="91">BootstrapConfiguration</code>时，请注意，您添加的类不是错误的<code i="92">@ComponentScanned</code>到您的“主”应用程序上下文中，可能不需要它们。</font><font o="315">对于您的<code i="93">@ComponentScan</code>或<code i="94">@SpringBootApplication</code>注释配置类尚未涵盖的引导配置类，请使用单独的包名称。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="316">引导过程通过将初始化器注入主<code i="95">SpringApplication</code>实例（即正常的Spring Boot启动顺序，无论是作为独立应用程序运行还是部署在应用程序服务器中）结束。</font><font o="317">首先，从<code i="96">spring.factories</code>中找到的类创建一个引导上下文，然后在<code i="99">SpringApplication</code>类型之前将<code i="98">ApplicationContextInitializer</code>类型的所有<code i="97">@Beans</code>添加到开始之前。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-bootstrap-property-sources"><font o="318">自定义引导属性源</font></h3>
<div class="paragraph">
<p><font o="319">引导过程添加的外部配置的默认属性源是Config Server，但您可以通过将<code i="100">PropertySourceLocator</code>类型的bean添加到引导上下文中（通过<code i="101">spring.factories</code>）添加其他源。</font><font o="320">您可以使用此方法从其他服务器或数据库中插入其他属性。</font></p>
</div>
<div class="paragraph">
<p><font o="321">作为一个例子，请考虑以下微不足道的自定义定位器：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class CustomPropertySourceLocator implements PropertySourceLocator {

    @Override
    public PropertySource&lt;?&gt; locate(Environment environment) {
        return new MapPropertySource("customProperty",
                Collections.&lt;String, Object&gt;singletonMap("property.from.sample.custom.source", "worked as intended"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="322">传入的<code i="102">Environment</code>是要创建的<code i="103">ApplicationContext</code>的<code i="102">Environment</code>，即为我们提供额外的属性来源的。</font><font o="323">它将已经具有正常的Spring Boot提供的资源来源，因此您可以使用这些资源来定位特定于此<code i="104">Environment</code>的属性源（例如，通过在<code i="105">spring.application.name</code>上键入，就像在默认值Config Server属性源定位器）。</font></p>
</div>
<div class="paragraph">
<p><font o="324">如果你在这个类中创建一个jar，然后添加一个<code i="106">META-INF/spring.factories</code>包含：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">org.springframework.cloud.bootstrap.BootstrapConfiguration=sample.custom.CustomPropertySourceLocator</pre>
</div>
</div>
<div class="paragraph">
<p><font o="325">那么“customProperty”<code i="107">PropertySource</code>将显示在其类路径中包含该jar的任何应用程序中。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_changes"><font o="326">环境变化</font></h3>
<div class="paragraph">
<p><font o="327">应用程序将收听<code i="108">EnvironmentChangeEvent</code>，并以几种标准方式对此更改作出反应（用户可以按常规方式添加<code i="109">ApplicationListeners</code>另外的<code i="109">ApplicationListeners</code>）。</font><font o="328">当观察到<code i="111">EnvironmentChangeEvent</code>时，它将有一个已经更改的键值列表，应用程序将使用以下内容：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="329">重新绑定上下文中的所有<code i="112">@ConfigurationProperties</code> bean</font></p>
</li>
<li>
<p><font o="330">为<code i="113">logging.level.*</code>中的任何属性设置记录器级别</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="331">请注意，配置客户端不会通过默认轮询查看<code i="114">Environment</code>中的更改，通常我们不建议检测更改的方法（尽管可以使用<code i="115">@Scheduled</code>注释进行设置）。</font><font o="332">如果您有一个扩展的客户端应用程序，那么最好将<code i="116">EnvironmentChangeEvent</code>广播到所有实例，而不是让它们轮询更改（例如使用</font><a href="javascript:;"><font o="332">Spring Cloud总线</font></a><font o="332">）。</font></p>
</div>
<div class="paragraph">
<p><font o="333"><code i="117">EnvironmentChangeEvent</code>涵盖了大量的刷新用例，只要您实际可以更改<code i="118">Environment</code>并发布事件（这些API是公开的，并且是核心Spring的一部分）。</font><font o="334">您可以通过访问<code i="120">/configprops</code>端点（普通Spring Boot Actuator功能）来验证更改是否绑定到<code i="119">@ConfigurationProperties</code> bean。</font><font o="335">例如，<code i="121">DataSource</code>可以在运行时更改其<code i="122">maxPoolSize</code>（由Spring Boot创建的默认<code i="123">DataSource</code>是一个<code i="124">@ConfigurationProperties</code> bean），并且动态增加容量。</font><font o="336">重新绑定<code i="125">@ConfigurationProperties</code>不涵盖另一大类用例，您需要更多的控制刷新，而您需要将整个<code i="126">ApplicationContext</code>变更为原子。</font><font o="337">为了解决这些担忧，我们有<code i="127">@RefreshScope</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_refresh_scope"><font o="338">刷新范围</font></h3>
<div class="paragraph">
<p><font o="339">当配置更改时，标记为<code i="129">@RefreshScope</code>的Spring <code i="128">@Bean</code>将得到特殊处理。</font><font o="340">这解决了状态bean在初始化时只注入配置的问题。</font><font o="341">例如，如果通过<code i="131">Environment</code>更改数据库URL时<code i="130">DataSource</code>有开放连接，我们可能希望这些连接的持有者能够完成他们正在做的工作。</font><font o="342">然后下一次有人从游泳池借用一个连接，他得到一个新的URL。</font></p>
</div>
<div class="paragraph">
<p><font o="343">刷新范围bean是在使用时初始化的懒惰代理（即当调用一个方法时），并且作用域作为初始值的缓存。</font><font o="344">要强制bean重新初始化下一个方法调用，您只需要使其缓存条目无效。</font></p>
</div>
<div class="paragraph">
<p><font o="345"><code i="132">RefreshScope</code>是上下文中的一个bean，它有一个公共方法<code i="133">refreshAll()</code>来清除目标缓存中的范围内的所有bean。</font><font o="346">还有一个<code i="134">refresh(String)</code>方法通过名称刷新单个bean。</font><font o="347">此功能在<code i="135">/refresh</code>端点（通过HTTP或JMX）中公开。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="348">注意</font></div>
</td>
<td class="content"><font o="349">
<code i="136">@RefreshScope</code>工程（技术）上的<code i="137">@Configuration</code>类，但它可能会导致令人惊讶的行为：例如，它</font><strong><font o="349">并不</font></strong><font o="349"> 
意味着所有的<code i="138">@Beans</code>在类中定义本身<code i="139">@RefreshScope</code>。</font><font o="350">具体来说，任何取决于这些bean的东西都不能依赖它们在刷新启动时被更新，除非它本身在<code i="140">@RefreshScope</code>（在其中将重新刷新并重新注入其依赖关系），那么它们将从刷新的<code i="141">@Configuration</code>重新初始化）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_encryption_and_decryption"><font o="351">加密和解密</font></h3>
<div class="paragraph">
<p><font o="352">Spring Cloud具有用于在本地解密属性值的<code i="142">Environment</code>预处理器。</font><font o="353">它遵循与Config Server相同的规则，并通过<code i="143">encrypt.*</code>具有相同的外部配置。</font><font o="354">因此，您可以使用<code i="144">{cipher}*</code>格式的加密值，只要有一个有效的密钥，那么在主应用程序上下文获取<code i="145">Environment</code>之前，它们将被解密。</font><font o="355">要在应用程序中使用加密功能，您需要在您的类路径中包含Spring Security RSA（Maven协调“org.springframework.security:spring-security-rsa”），并且还需要全面强大的JCE扩展你的JVM</font></p>
</div>
<div class="paragraph">
<p><font o="356">如果由于“非法密钥大小”而导致异常，并且您正在使用Sun的JDK，则需要安装Java加密扩展（JCE）无限强度管理策略文件。</font><font o="357">有关详细信息，请参阅以下链接：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javascript:;"><font o="358">Java 6 JCE</font></a></p>
</li>
<li>
<p><a href="javascript:;"><font o="359">Java 7 JCE</font></a></p>
</li>
<li>
<p><a href="javascript:;"><font o="360">Java 8 JCE</font></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="361">将文件解压缩到JDK / jre / lib / security文件夹（无论您使用的是哪个版本的JRE / JDK x64 / x86）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints"><font o="362">端点</font></h3>
<div class="paragraph">
<p><font o="363">对于Spring Boot Actuator应用程序，还有一些额外的管理端点：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="364">POST到<code i="146">/env</code>以更新<code i="147">Environment</code>并重新绑定<code i="148">@ConfigurationProperties</code>和日志级别</font></p>
</li>
<li>
<p><font o="365"><code i="149">/refresh</code>重新加载引导带上下文并刷新<code i="150">@RefreshScope</code> bean</font></p>
</li>
<li>
<p><font o="366"><code i="151">/restart</code>关闭<code i="152">ApplicationContext</code>并重新启动（默认情况下禁用）</font></p>
</li>
<li>
<p><font o="367"><code i="153">/pause</code>和<code i="154">/resume</code>调用<code i="155">Lifecycle</code>方法（<code i="156">stop()</code>和<code i="157">start()</code>）上的<code i="158">ApplicationContext</code>）</font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_commons_common_abstractions"><font o="368">Spring Cloud Commons：普通抽象</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="369">诸如服务发现，负载平衡和断路器之类的模式适用于所有Spring Cloud客户端可以独立于实现（例如，通过Eureka或Consul发现）可以使用的普通抽象层。</font></p>
</div>
<div class="sect2">
<h3 id="__enablediscoveryclient"><font o="370">@EnableDiscoveryClient</font></h3>
<div class="paragraph">
<p><font o="371">Commons提供<code i="159">@EnableDiscoveryClient</code>注释。</font><font o="372">这通过<code i="161">META-INF/spring.factories</code>查找<code i="160">DiscoveryClient</code>接口的实现。</font><font o="373">Discovery Client的实现将在<code i="163">org.springframework.cloud.client.discovery.EnableDiscoveryClient</code>键下的<code i="162">spring.factories</code>中添加一个配置类。</font><font o="374"><code i="164">DiscoveryClient</code>实现的例子是</font><a href="javascript:;"><font o="374">Spring Cloud Netflix Eureka</font></a><font o="374">，</font><a href="javascript:;"><font o="374">Spring Cloud Consul发现</font></a><font o="374">和</font><a href="javascript:;"><font o="374">Spring Cloud Zookeeper发现</font></a><font o="374">。</font></p>
</div>
<div class="paragraph">
<p><font o="375">默认情况下，<code i="165">DiscoveryClient</code>的实现将使用远程发现服务器自动注册本地Spring Boot服务器。</font><font o="376">可以通过在<code i="167">@EnableDiscoveryClient</code>中设置<code i="166">autoRegister=false</code>来禁用此功能。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_serviceregistry"><font o="377">ServiceRegistry</font></h3>
<div class="paragraph">
<p><font o="378">Commons现在提供了一个<code i="168">ServiceRegistry</code>接口，它提供了诸如<code i="169">register(Registration)</code>和<code i="170">deregister(Registration)</code>之类的方法，允许您提供自定义的注册服务。</font><font o="379"><code i="171">Registration</code>是一个标记界面。</font></p>
</div>
<div class="sect3">
<h4 id="_service_registry_actuator_endpoint"><font o="380">服务注册执行器端点</font></h4>
<div class="paragraph">
<p><font o="381">Commons提供<code i="172">/service-registry</code>致动器端点。</font><font o="382">此端点依赖于Spring应用程序上下文中的<code i="173">Registration</code> bean。</font><font o="383">通过GET调用<code i="174">/service-registry/instance-status</code>将返回<code i="175">Registration</code>的状态。</font><font o="384">具有<code i="176">String</code>主体的同一端点的POST将将当前<code i="177">Registration</code>的状态更改为新值。</font><font o="385">请参阅您正在使用的<code i="178">ServiceRegistry</code>实现的文档，以获取更新状态的允许值以及为状态获取的值。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_resttemplate_as_a_load_balancer_client"><font o="386">Spring RestTemplate作为负载均衡器客户端</font></h3>
<div class="paragraph">
<p><font o="387"><code i="179">RestTemplate</code>可以自动配置为使用功能区。</font><font o="388">要创建负载平衡<code i="180">RestTemplate</code>创建<code i="181">RestTemplate</code> <code i="182">@Bean</code>并使用<code i="183">@LoadBalanced</code>限定符。</font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="389">警告</font></div>
</td>
<td class="content"><font o="390">
通过自动配置不再创建<code i="184">RestTemplate</code> bean。</font><font o="391">它必须由单个应用程序创建。
</font></td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class MyConfiguration {

    @LoadBalanced
    @Bean
    RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

public class MyClass {
    @Autowired
    private RestTemplate restTemplate;

    public String doOtherStuff() {
        String results = restTemplate.getForObject("http://stores/stores", String.class);
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="392">URI需要使用虚拟主机名（即服务名称，而不是主机名）。</font><font o="393">Ribbon客户端用于创建完整的物理地址。</font><font o="394">有关</font><font o="394">
如何设置<code i="185">RestTemplate</code>的详细信息，</font><font o="394">请参阅
 </font><a href="javascript:;"><font o="394">RibbonAutoConfiguration</font></a><font o="394">。</font></p>
</div>
<div class="sect3">
<h4 id="_retrying_failed_requests"><font o="395">重试失败的请求</font></h4>
<div class="paragraph">
<p><font o="396">负载平衡<code i="186">RestTemplate</code>可以配置为重试失败的请求。</font><font o="397">默认情况下，该逻辑被禁用，您可以通过设置<code i="187">spring.cloud.loadbalancer.retry.enabled=true</code>启用该逻辑。</font><font o="398">负载平衡<code i="188">RestTemplate</code>将符合与重试失败请求相关的某些Ribbon配置值。</font><font o="399">您可以使用的属性是<code i="189">client.ribbon.MaxAutoRetries</code>，<code i="190">client.ribbon.MaxAutoRetriesNextServer</code>和<code i="191">client.ribbon.OkToRetryOnAllOperations</code>。</font><font o="400">请参阅</font><a href="javascript:;"><font o="400">Ribbon文档</font></a><font o="400"> 
，了解属性的具体内容。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="401">注意</font></div>
</td>
<td class="content"><font o="402">
上述示例中的<code i="192">client</code>应替换为您的Ribbon客户端名称。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_resttemplate_objects"><font o="403">多个RestTemplate对象</font></h3>
<div class="paragraph">
<p><font o="404">如果你想要一个没有负载平衡的<code i="193">RestTemplate</code>，创建一个<code i="194">RestTemplate</code> bean并注入它。</font><font o="405">创建<code i="196">@Bean</code>时访问负载平衡<code i="195">RestTemplate use
the `@LoadBalanced</code>限定词。</font></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="406">重要</font></div>
</td>
<td class="content"><font o="407">
请注意下面示例中明文<code i="198">RestTemplate</code>声明的<code i="197">@Primary</code>注释，以消除不合格的<code i="199">@Autowired</code>注入。
</font></td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class MyConfiguration {

    @LoadBalanced
    @Bean
    RestTemplate loadBalanced() {
        return new RestTemplate();
    }

    @Primary
    @Bean
    RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

public class MyClass {
    @Autowired
    private RestTemplate restTemplate;

    @Autowired
    @LoadBalanced
    private RestTemplate loadBalanced;

    public String doOtherStuff() {
        return loadBalanced.getForObject("http://stores/stores", String.class);
    }

    public String doStuff() {
        return restTemplate.getForObject("http://example.com", String.class);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="408">提示</font></div>
</td>
<td class="content"><font o="409">
如果您发现错误<code i="200">java.lang.IllegalArgumentException: Can not set org.springframework.web.client.RestTemplate field com.my.app.Foo.restTemplate to com.sun.proxy.$Proxy89</code>，请尝试注销<code i="201">RestOperations</code>或设置<code i="202">spring.aop.proxyTargetClass=true</code>。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="ignore-network-interfaces"><font o="410">忽略网络接口</font></h3>
<div class="paragraph">
<p><font o="411">有时，忽略某些命名网络接口是有用的，因此可以将其从服务发现注册中排除（例如，在Docker容器中运行）。</font><font o="412">可以设置正则表达式的列表，这将导致所需的网络接口被忽略。</font><font o="413">以下配置将忽略“docker0”接口和以“veth”开头的所有接口。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="414">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    inetutils:
      ignoredInterfaces:
        - docker0
        - veth.*</pre>
</div>
</div>
<div class="paragraph">
<p><font o="415">您还可以强制使用正则表达式列表中指定的网络地址：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="416">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    inetutils:
      preferredNetworks:
        - 192.168
        - 10.0</pre>
</div>
</div>
<div class="paragraph">
<p><font o="417">您也可以强制仅使用站点本地地址。</font><font o="418">有关</font><font o="418">更多详细信息，</font><font o="418">请参阅</font><a href="javascript:;"><font o="418">Inet4Address.html.isSiteLocalAddress（））</font></a><font o="418">是什么是站点本地地址。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="419">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    inetutils:
      useOnlySiteLocalInterfaces: true</pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_spring_cloud_config" class="sect0">Spring Cloud Config</h1>
<div class="openblock partintro">
<div class="content"><font o="421">
Spring Cloud Config为分布式系统中的外部化配置提供服务器和客户端支持。</font><font o="422">使用Config Server，您可以在所有环境中管理应用程序的外部属性。</font><font o="423">客户端和服务器映射的概念与Spring <code i="203">Environment</code>和<code i="204">PropertySource</code>抽象相同，因此它们与Spring应用程序非常契合，但可以与任何以任何语言运行的应用程序一起使用。</font><font o="424">随着应用程序通过从开发人员到测试和生产的部署流程，您可以管理这些环境之间的配置，并确定应用程序具有迁移时需要运行的一切。</font><font o="425">服务器存储后端的默认实现使用git，因此它轻松支持标签版本的配置环境，以及可以访问用于管理内容的各种工具。</font><font o="426">可以轻松添加替代实现，并使用Spring配置将其插入。
</font></div>
</div>
<div class="sect1">
<h2 id="_quick_start"><font o="427">快速开始</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="428">启动服务器：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ cd spring-cloud-config-server
$ ../mvnw spring-boot:run</pre>
</div>
</div>
<div class="paragraph">
<p><font o="429">该服务器是一个Spring Boot应用程序，所以您可以从IDE（而不是主类（<code i="205">ConfigServerApplication</code>））运行它。</font><font o="430">然后尝试一个客户端：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ curl localhost:8888/foo/development
{"name":"development","label":"master","propertySources":[
  {"name":"https://github.com/scratches/config-repo/foo-development.properties","source":{"bar":"spam"}},
  {"name":"https://github.com/scratches/config-repo/foo.properties","source":{"foo":"bar"}}
]}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="431">定位资源的默认策略是克隆一个git仓库（在<code i="206">spring.cloud.config.server.git.uri</code>），并使用它来初始化一个迷你<code i="207">SpringApplication</code>。</font><font o="432">迷你应用程序的<code i="208">Environment</code>用于枚举属性源并通过JSON端点发布。</font></p>
</div>
<div class="paragraph">
<p><font o="433">HTTP服务具有以下格式的资源：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">/{application}/{profile}[/{label}]
/{application}-{profile}.yml
/{label}/{application}-{profile}.yml
/{application}-{profile}.properties
/{label}/{application}-{profile}.properties</pre>
</div>
</div>
<div class="paragraph">
<p><font o="434">其中“应用程序”作为<code i="210">SpringApplication</code>中的<code i="209">spring.config.name</code>注入（即常规Spring Boot应用程序中通常为“应用程序”），“配置文件”是活动配置文件（或逗号分隔列表的属性），“label”是可选的git标签（默认为“master”）。</font></p>
</div>
<div class="paragraph">
<p><font o="435">Spring Cloud Config服务器从git存储库中提取远程客户端的配置（必须提供）：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_client_side_usage"><font o="436">客户端使用</font></h3>
<div class="paragraph">
<p><font o="437">要在应用程序中使用这些功能，只需将其构建为依赖于spring-cloud-config-client的Spring引导应用程序（例如，查看配置客户端或示例应用程序的测试用例）。</font><font o="438">添加依赖关系的最方便的方法是通过Spring Boot启动器<code i="211">org.springframework.cloud:spring-cloud-starter-config</code>。</font><font o="439">还有一个Maven用户的父pom和BOM（<code i="212">spring-cloud-starter-parent</code>）以及Gradle和Spring CLI用户的Spring IO版本管理属性文件。</font><font o="440">示例Maven配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="441">的pom.xml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
    &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;

&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
            &lt;version&gt;Brixton.RELEASE&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;

&lt;!-- repositories also needed for snapshots and milestones --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="442">那么您可以创建一个标准的Spring Boot应用程序，就像这个简单的HTTP服务器：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@SpringBootApplication
@RestController
public class Application {

    @RequestMapping("/")
    public String home() {
        return "Hello World!";
    }

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="443">当它运行它将从端口8888上的默认本地配置服务器接收外部配置，如果它正在运行。</font><font o="444">要修改启动行为，您可以使用<code i="213">bootstrap.properties</code>更改配置服务器的位置（如<code i="214">application.properties</code>，但用于应用程序上下文的引导阶段），例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">spring.cloud.config.uri: http://myconfigserver.com</pre>
</div>
</div>
<div class="paragraph">
<p><font o="445">引导属性将在<code i="215">/env</code>端点中显示为高优先级属性源，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ curl localhost:8080/env
{
  "profiles":[],
  "configService:https://github.com/spring-cloud-samples/config-repo/bar.properties":{"foo":"bar"},
  "servletContextInitParams":{},
  "systemProperties":{...},
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="446">（名为“configService：&lt;远程存储库的URL&gt; / &lt;文件名&gt;”的属性源包含值为“bar”的属性“foo”，是最高优先级）。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="447">注意</font></div>
</td>
<td class="content"><font o="448">
属性源名称中的URL是git存储库，而不是配置服务器URL。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_config_server"><font o="449">Spring Cloud Config服务器</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="450">服务器为外部配置（名称值对或等效的YAML内容）提供了基于资源的HTTP。</font><font o="451">服务器可以使用<code i="216">@EnableConfigServer</code>注释轻松嵌入到Spring Boot应用程序中。</font><font o="452">所以这个应用程序是一个配置服务器：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="453">ConfigServer.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableConfigServer
public class ConfigServer {
  public static void main(String[] args) {
    SpringApplication.run(ConfigServer.class, args);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="454">像所有默认端口8080上运行的所有Spring Boot应用程序一样，但您可以通过各种方式将其切换到常规端口8888。</font><font o="455">最简单的（也设置默认配置库）是通过使用<code i="217">spring.config.name=configserver</code>启动（在Config Server jar中有一个<code i="218">configserver.yml</code>）。</font><font o="456">另一个是使用你自己的<code i="219">application.properties</code>，例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="457">application.properties</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-properties" data-lang="properties">server.port: 8888
spring.cloud.config.server.git.uri: file://${user.home}/config-repo</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="458">其中<code i="220">${user.home}/config-repo</code>是包含YAML和属性文件的git仓库。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="459">注意</font></div>
</td>
<td class="content"><font o="460">
在Windows中，如果文件URL为绝对驱动器前缀，例如<code i="221"><a href="javascript:;" class="bare">file:///${user.home}/config-repo</a></code>，则需要额外的“/”。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="461">提示</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="462">以下是上面示例中创建git仓库的方法：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ cd $HOME
$ mkdir config-repo
$ cd config-repo
$ git init .
$ echo info.foo: bar &gt; application.properties
$ git add -A .
$ git commit -m "Add application.properties"</pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="463">警告</font></div>
</td>
<td class="content"><font o="464">
使用本地文件系统进行git存储库仅用于测试。</font><font o="465">使用服务器在生产环境中托管配置库。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="466">警告</font></div>
</td>
<td class="content"><font o="467">
如果您只保留文本文件，则配置库的初始克隆将会快速有效。</font><font o="468">如果您开始存储二进制文件，尤其是较大的文件，则可能会遇到服务器中第一个配置请求和/或内存不足错误的延迟。
</font></td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_environment_repository"><font o="469">环境库</font></h3>
<div class="paragraph">
<p><font o="470">您要在哪里存储配置服务器的配置数据？</font><font o="471">管理此行为的策略是<code i="222">EnvironmentRepository</code>，服务于<code i="223">Environment</code>对象。</font><font o="472">此<code i="224">Environment</code>是Spring <code i="225">Environment</code>（包括<code i="226">propertySources</code>作为主要功能）的域的浅层副本。</font><font o="473"><code i="227">Environment</code>资源由三个变量参数化：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="474"><code i="228">{application}</code>映射到客户端的“spring.application.name”;</font></p>
</li>
<li>
<p><font o="475"><code i="229">{profile}</code>映射到客户端上的“spring.profiles.active”（逗号分隔列表）; </font><font o="476">和</font></p>
</li>
<li>
<p><font o="477"><code i="230">{label}</code>这是一个服务器端功能，标记“版本”的配置文件集。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="478">存储库实现通常表现得像一个Spring Boot应用程序从“spring.config.name”等于<code i="231">{application}</code>参数加载配置文件，“spring.profiles.active”等于<code i="232">{profiles}</code>参数。</font><font o="479">配置文件的优先级规则也与常规启动应用程序相同：活动配置文件优先于默认配置，如果有多个配置文件，则最后一个获胜（例如向<code i="233">Map</code>添加条目）。</font></p>
</div>
<div class="paragraph">
<p><font o="480">示例：客户端应用程序具有此引导配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="481">bootstrap.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  application:
    name: foo
  profiles:
    active: dev,mysql</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="482">（通常使用Spring Boot应用程序，这些属性也可以设置为环境变量或命令行参数）。</font></p>
</div>
<div class="paragraph">
<p><font o="483">如果存储库是基于文件的，则服务器将从<code i="235">application.yml</code>创建<code i="234">Environment</code>（在所有客户端之间共享），<code i="236">foo.yml</code>（以<code i="237">foo.yml</code>优先））。</font><font o="484">如果YAML文件中有文档指向Spring配置文件，那么应用的优先级更高（按照列出的配置文件的顺序），并且如果有特定于配置文件的YAML（或属性）文件，那么这些文件也应用于优先级高于默认值。</font><font o="485">较高的优先级转换为<code i="239">Environment</code>之前列出的<code i="238">PropertySource</code>。</font><font o="486">（这些规则与独立的Spring Boot应用程序相同。）</font></p>
</div>
<div class="sect3">
<h4 id="_git_backend"><font o="487">Git后端</font></h4>
<div class="paragraph">
<p><font o="488"><code i="240">EnvironmentRepository</code>的默认实现使用Git后端，这对于管理升级和物理环境以及审核更改非常方便。</font><font o="489">要更改存储库的位置，可以在Config Server中设置“spring.cloud.config.server.git.uri”配置属性（例如<code i="241">application.yml</code>）。</font><font o="490">如果您使用<code i="242">file:</code>前缀进行设置，则应从本地存储库中运行，以便在没有服务器的情况下快速轻松地启动，但在这种情况下，服务器将直接在本地存储库中进行操作，而不会克隆它（不会如果它不是裸机，因为配置服务器永远不会更改“远程”资源库）。</font><font o="491">要扩展Config Server并使其高度可用，您需要将服务器的所有实例指向同一个存储库，因此只有共享文件系统才能正常工作。</font><font o="492">即使在这种情况下，最好使用共享文件系统存储库的<code i="243">ssh:</code>协议，以便服务器可以将其克隆并使用本地工作副本作为缓存。</font></p>
</div>
<div class="paragraph">
<p><font o="493">该存储库实现将HTTP资源的<code i="244">{label}</code>参数映射到git标签（提交ID，分支名称或标签）。</font><font o="494">如果git分支或标签名称包含斜杠（“/”），则应使用特殊字符串“（_）”指定HTTP URL中的标签，以避免与其他URL路径模糊。</font><font o="495">如果您使用像curl这样的命令行客户端（例如使用引号将其从shell中转出来），请小心URL中的方括号。</font></p>
</div>
<div class="sect4">
<h5 id="_placeholders_in_git_uri"><font o="496">Git URI中的占位符</font></h5>
<div class="paragraph">
<p><font o="497">Spring Cloud Config服务器支持具有<code i="245">{application}</code>和<code i="246">{profile}</code>（以及<code i="247">{label}</code>（如果需要）的占位符的git仓库URL，但请记住，标签应用为git标签）。</font><font o="498">因此，您可以使用（例如）轻松支持“每个应用程序的一个repo”策略：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/myorg/{application}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="499">或使用类似模式“{一个回购每个配置文件”策略，但是使用<code i="248">{profile}</code>。</font></p>
</div>
</div>
<div class="sect4">
<h5 id="_pattern_matching_and_multiple_repositories"><font o="500">模式匹配和多个存储库</font></h5>
<div class="paragraph">
<p><font o="501">还可以通过应用程序和配置文件名称的模式匹配来支持更复杂的需求。</font><font o="502">模式格式是带有通配符的<code i="249">{application}/{profile}</code>名称的逗号分隔列表（其中以通配符开头的模式可能需要引用）。</font><font o="503">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          repos:
            simple: https://github.com/simple/config-repo
            special:
              pattern: special*/dev*,*special*/dev*
              uri: https://github.com/special/config-repo
            local:
              pattern: local*
              uri: file:/home/configsvc/config-repo</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="504">如果<code i="250">{application}/{profile}</code>不匹配任何模式，它将使用在“spring.cloud.config.server.git.uri”下定义的默认uri。</font><font o="505">在上面的例子中，对于“简单”存储库，模式是<code i="251">simple/*</code>（即它只匹配一个在所有配置文件中名为“简单”的应用程序）。</font><font o="506">“本地”存储库将所有配置文件中以“local”开头的所有应用程序名称进行匹配（将<code i="252">/*</code>后缀自动添加到任何没有配置文件匹配器的模式）。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="507">注意</font></div>
</td>
<td class="content"><font o="508">
在上述“简单”示例中使用的“单行”快捷方式只能在唯一要设置的属性为URI的情况下使用。</font><font o="509">如果您需要设置其他任何内容（凭据，模式等），则需要使用完整的表单。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="510">repo中的<code i="253">pattern</code>属性实际上是一个数组，因此您可以使用属性文件中的YAML数组（或<code i="254">[0]</code>，<code i="255">[1]</code>等后缀）绑定到多个模式。</font><font o="511">如果要运行具有多个配置文件的应用程序，则可能需要执行此操作。</font><font o="512">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          repos:
            development:
              pattern:
                - */development
                - */staging
              uri: https://github.com/development/config-repo
            staging:
              pattern:
                - */qa
                - */production
              uri: https://github.com/staging/config-repo</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="513">注意</font></div>
</td>
<td class="content"><font o="514">
Spring Cloud将猜测包含不在<code i="256">*</code>中的配置文件的模式意味着您实际上要匹配从此模式开始的配置文件列表（所以<code i="257">*/staging</code>是<code i="258">["*/staging", "*/staging,*"]</code>）。</font><font o="515">这是常见的，您需要在本地的“开发”配置文件中运行应用程序，但也可以远程运行“云”配置文件。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="516">每个存储库还可以选择将配置文件存储在子目录中，搜索这些目录的模式可以指定为<code i="259">searchPaths</code>。</font><font o="517">例如在顶层：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          searchPaths: foo,bar*</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="518">在此示例中，服务器搜索顶级和“foo /”子目录以及名称以“bar”开头的任何子目录中的配置文件。</font></p>
</div>
<div class="paragraph">
<p><font o="519">默认情况下，首次请求配置时，服务器克隆远程存储库。</font><font o="520">服务器可以配置为在启动时克隆存储库。</font><font o="521">例如在顶层：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://git/common/config-repo.git
          repos:
            team-a:
                pattern: team-a-*
                cloneOnStart: true
                uri: http://git/team-a/config-repo.git
            team-b:
                pattern: team-b-*
                cloneOnStart: false
                uri: http://git/team-b/config-repo.git
            team-c:
                pattern: team-c-*
                uri: http://git/team-a/config-repo.git</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="522">在此示例中，服务器在启动之前克隆了team-a的config-repo，然后它接受任何请求。</font><font o="523">所有其他存储库将不被克隆，直到请求从存储库配置。</font></p>
</div>
<div class="paragraph">
<p><font o="524">要在远程存储库上使用HTTP基本身份验证，请分别添加“username”和“password”属性（不在URL中），例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          username: trolley
          password: strongpassword</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="525">如果您不使用HTTPS和用户凭据，当您将密钥存储在默认目录（<code i="260">~/.ssh</code>）中并且uri指向SSH位置时，SSH也应该开箱即用，例如“ </font><a href="email-protection.html#096e607d496e607d617c6b276a6664"><font o="525"><span class="__cf_email__" data-cfemail="2b4c425f6b4c425f435e4905484446">[email&#160;protected]</span></font></a><font o="525">：配置/云配置”。</font><font o="526">使用JGit访问存储库，因此您发现的任何文档都应适用。</font><font o="527">HTTPS代理设置可以<code i="261">~/.git/config</code>设置，也可以通过系统属性（<code i="262">-Dhttps.proxyHost</code>和<code i="263">-Dhttps.proxyPort</code>）与任何其他JVM进程相同。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="528">提示</font></div>
</td>
<td class="content"><font o="529">
如果你不知道<code i="264">~/.git</code>目录是我们<code i="265">git config
--global</code>操纵设置（例如<code i="266">git config --global
http.sslVerify false</code>）的位置。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_placeholders_in_git_search_paths"><font o="530">Git搜索路径中的占位符</font></h5>
<div class="paragraph">
<p><font o="531">Spring Cloud Config服务器还支持具有<code i="267">{application}</code>和<code i="268">{profile}</code>（以及<code i="269">{label}</code>（如果需要））占位符的搜索路径。</font><font o="532">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          searchPaths: '{application}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="533">在资源库中搜索与目录（以及顶级）相同名称的文件。</font><font o="534">通配符在具有占位符的搜索路径中也是有效的（搜索中包含任何匹配的目录）。</font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_version_control_backend_filesystem_use"><font o="535">版本控制后端文件系统使用</font></h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="536">警告</font></div>
</td>
<td class="content"><font o="537">
使用基于VCS的后端（git，svn）文件被检出或克隆到本地文件系统。</font><font o="538">默认情况下，它们放在系统临时目录中，前缀为<code i="270">config-repo-</code>。</font><font o="539">在linux上，例如可以是<code i="271">/tmp/config-repo-&lt;randomid&gt;</code>。</font><font o="540">一些操作系统会</font><a href="javascript:;"><font o="540">定期清除</font></a><font o="540">临时目录。</font><font o="541">这可能会导致意外的行为，例如缺少属性。</font><font o="542">要避免此问题，请通过将<code i="272">spring.cloud.config.server.git.basedir</code>或<code i="273">spring.cloud.config.server.svn.basedir</code>设置为不驻留在系统临时结构中的目录来更改Config Server使用的目录。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_file_system_backend"><font o="543">文件系统后端</font></h4>
<div class="paragraph">
<p><font o="544">配置服务器中还有一个不使用Git的“本机”配置文件，只是从本地类路径或文件系统加载配置文件（您想要指向的任何静态URL“spring.cloud.config.server .native.searchLocations“）。</font><font o="545">要使用本机配置文件，只需使用“spring.profiles.active = native”启动Config Server。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="546">注意</font></div>
</td>
<td class="content"><font o="547">
记住使用文件资源的<code i="274">file:</code>前缀（缺省没有前缀通常是classpath）。</font><font o="548">与任何Spring Boot配置一样，您可以嵌入<code i="275">${}</code>风格的环境占位符，但请记住，Windows中的绝对路径需要额外的“/”，例如<code i="276"><a href="javascript:;" class="bare">file:///${user.home}/config-repo</a></code>
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="549">警告</font></div>
</td>
<td class="content"><font o="550">
<code i="277">searchLocations</code>的默认值与本地Spring Boot应用程序（所以<code i="278">[classpath:/, classpath:/config,
file:./, file:./config]</code>）相同。</font><font o="551">这不会将<code i="279">application.properties</code>从服务器暴露给所有客户端，因为在发送到客户端之前，服务器中存在的任何属性源都将被删除。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="552">提示</font></div>
</td>
<td class="content"><font o="553">
文件系统后端对于快速入门和测试是非常好的。</font><font o="554">要在生产中使用它，您需要确保文件系统是可靠的，并在配置服务器的所有实例中共享。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="555">搜索位置可以包含<code i="280">{application}</code>，<code i="281">{profile}</code>和<code i="282">{label}</code>的占位符。</font><font o="556">以这种方式，您可以隔离路径中的目录，并选择一个有用的策略（例如每个应用程序的子目录或每个配置文件的子目录）。</font></p>
</div>
<div class="paragraph">
<p><font o="557">如果您不在搜索位置使用占位符，则该存储库还将HTTP资源的<code i="283">{label}</code>参数附加到搜索路径上的后缀，因此属性文件将从每个搜索位置加载</font><strong><font o="557">并</font></strong><font o="557">具有相同名称的子目录作为标签（标记的属性在Spring环境中优先）。</font><font o="558">因此，没有占位符的默认行为与添加以<code i="284">/{label}/. For example `file:/tmp/config</code>结尾的搜索位置的添加与<code i="285">file:/tmp/config,file:/tmp/config/{label}</code>相同</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_sharing_configuration_with_all_applications"><font o="559">与所有应用共享配置</font></h4>
<div class="paragraph">
<p><font o="560">使用基于文件（即git，svn和native）的存储库，所有客户端应用程序（{<code i="287">application.properties</code>，<code i="288">application.yml</code>，<code i="289">application-*.properties</code>等））共享文件名为<code i="286">application*</code>的资源。</font><font o="561">您可以使用这些文件名的资源来配置全局默认值，并根据需要将其覆盖应用程序特定的文件。</font></p>
</div>
<div class="paragraph">
<p><font o="562">#_property_overrides [属性覆盖]功能也可用于设置全局默认值，并且允许占位符应用程序在本地覆盖它们。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="563">提示</font></div>
</td>
<td class="content"><font o="564">
使用“本机”配置文件（本地文件系统后端），建议您使用不属于服务器自身配置的显式搜索位置。</font><font o="565">否则默认搜索位置中的<code i="290">application*</code>资源将被删除，因为它们是服务器的一部分。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_property_overrides"><font o="566">属性覆盖</font></h4>
<div class="paragraph">
<p><font o="567">配置服务器具有“覆盖”功能，允许操作员为所有应用程序提供配置属性，这些应用程序不会被应用程序使用普通的Spring Boot钩子意外更改。</font><font o="568">要声明覆盖，只需将名称/值对的地图添加到<code i="291">spring.cloud.config.server.overrides</code>。</font><font o="569">例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        overrides:
          foo: bar</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="570">将导致配置客户端的所有应用程序独立于自己的配置读取<code i="292">foo=bar</code>。</font><font o="571">（当然，应用程序可以使用任何它喜欢的配置服务器中的数据，所以覆盖是不可执行的，但如果他们是Spring Cloud Config客户端，它们确实提供有用的默认行为。）</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="572">提示</font></div>
</td>
<td class="content"><font o="573">
通过使用反斜杠（“\”）来转义“$”或“{”，例如<code i="293">\${app.foo:bar}</code>解析，可以将正常的Spring环境占位符与“$ {}”进行转义（并在客户端上解析）到“bar”，除非应用程序提供自己的“app.foo”。</font><font o="574">请注意，在YAML中，您不需要转义反斜杠本身，而是在您执行的属性文件中配置服务器上的覆盖。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="575">您可以将客户端中所有覆盖的优先级更改为默认值，允许应用程序通过在远程存储库中设置标志<code i="294">spring.cloud.config.overrideNone=true</code>（默认值为false），在环境变量或系统属性中提供自己的值。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_health_indicator"><font o="576">健康指标</font></h3>
<div class="paragraph">
<p><font o="577">配置服务器附带一个运行状况指示器，用于检查配置的<code i="295">EnvironmentRepository</code>是否正常工作。</font><font o="578">默认情况下，请求<code i="297">app</code>的应用程序<code i="298">default</code>，<code i="298">default</code>配置文件和<code i="299">EnvironmentRepository</code>实现提供的默认标签。</font></p>
</div>
<div class="paragraph">
<p><font o="579">您可以配置运行状况指示器以检查更多应用程序以及自定义配置文件和自定义标签，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
      server:
        health:
          repositories:
            myservice:
              label: mylabel
            myservice-dev:
              name: myservice
              profiles: development</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="580">您可以通过设置<code i="300">spring.cloud.config.server.health.enabled=false</code>来禁用运行状况指示器。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_security"><font o="581">安全</font></h3>
<div class="paragraph">
<p><font o="582">您可以以任何对您有意义的方式（从物理网络安全性到OAuth2承载令牌）来保护您的Config Server，并且Spring Security和Spring Boot可以轻松做任何事情。</font></p>
</div>
<div class="paragraph">
<p><font o="583">要使用默认的Spring Boot配置的HTTP Basic安全性，只需在类路径中包含Spring Security（例如通过<code i="301">spring-boot-starter-security</code>）。</font><font o="584">默认值为“user”和随机生成的密码，这在实践中不会非常有用，因此我们建议您配置密码（通过<code i="302">security.user.password</code>）进行加密（请参阅下面的说明）怎么做）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_encryption_and_decryption_2"><font o="585">加密和解密</font></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="586">重要</font></div>
</td>
<td class="content">
<strong><font o="587">先决条件：</font></strong><font o="587">要使用加密和解密功能，您需要在JVM中安装全面的JCE（默认情况下不存在）。</font><font o="588">您可以从Oracle下载“Java加密扩展（JCE）无限强度管理策略文件”，并按照安装说明（实际上将JRE lib / security目录中的2个策略文件替换为您下载的文件）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="589">如果远程属性源包含加密内容（以<code i="303">{cipher}</code>开头的值），则在通过HTTP发送给客户端之前，它们将被解密。</font><font o="590">这种设置的主要优点是，当它们“静止”时，属性值不必是纯文本（例如在git仓库中）。</font><font o="591">如果值无法解密，则从属性源中删除该值，并添加具有相同键的附加属性，但以“无效”作为前缀。</font><font o="592">和“不适用”的值（通常为“&lt;n / a&gt;”）。</font><font o="593">这主要是为了防止密码被用作密码并意外泄漏。</font></p>
</div>
<div class="paragraph">
<p><font o="594">如果您正在为配置客户端应用程序设置远程配置存储库，可能会包含这样的<code i="304">application.yml</code>，例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="595">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  datasource:
    username: dbuser
    password: '{cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ'</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="596">.properties文件中的加密值不能用引号括起来，否则不会解密该值：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="597">application.properties</font></div>
<div class="content">
<pre class="notranslate">spring.datasource.username: dbuser
spring.datasource.password: {cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ</pre>
</div>
</div>
<div class="paragraph">
<p><font o="598">您可以安全地将此纯文本推送到共享git存储库，并且保密密码。</font></p>
</div>
<div class="paragraph">
<p><font o="599">服务器还暴露了<code i="305">/encrypt</code>和<code i="306">/decrypt</code>端点（假设这些端点将被保护并且只能由授权代理访问）。</font><font o="600">如果您正在编辑远程配置文件，可以使用Config Server通过POST到<code i="307">/encrypt</code>端点来加密值，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ curl localhost:8888/encrypt -d mysecret
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda</pre>
</div>
</div>
<div class="paragraph">
<p><font o="601">逆向操作也可通过<code i="308">/decrypt</code>获得（如果服务器配置了对称密钥或全密钥对）：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ curl localhost:8888/decrypt -d 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
mysecret</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="602">提示</font></div>
</td>
<td class="content"><font o="603">
如果您使用curl进行测试，则使用<code i="309">--data-urlencode</code>（而不是<code i="310">-d</code>）或设置显式<code i="311">Content-Type:
text/plain</code>，以确保在有特殊字符时正确地对数据进行编码（'+'特别是棘手）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="604">在加入值之前，先添加<code i="312">{cipher}</code>前缀，然后再将其放入YAML或属性文件中，然后再将其推送到远程，可能不安全的存储区。</font></p>
</div>
<div class="paragraph">
<p><font o="605"><code i="313">/encrypt</code>和<code i="314">/decrypt</code>端点也接受<code i="315">/*/{name}/{profiles}</code>形式的路径，当客户端调用到主环境资源时，可以用于每个应用程序（名称）和配置文件控制密码。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="606">注意</font></div>
</td>
<td class="content"><font o="607">
为了以这种细微的方式控制密码，您还必须提供一种<code i="317">TextEncryptorLocator</code>类型的<code i="316">@Bean</code>，每个名称和配置文件都会创建一个不同的加密器。</font><font o="608">默认提供的不会这样做（所有加密使用相同的密钥）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="609"><code i="318">spring</code>命令行客户端（安装了Spring Cloud CLI扩展）也可以用于加密和解密，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring encrypt mysecret --key foo
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
$ spring decrypt --key foo 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
mysecret</pre>
</div>
</div>
<div class="paragraph">
<p><font o="610">要在文件中使用密钥（例如用于加密的RSA公钥），使用“@”键入键值，并提供文件路径，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring encrypt mysecret --key @${HOME}/.ssh/id_rsa.pub
AQAjPgt3eFZQXwt8tsHAVv/QHiY5sI2dRcR+...</pre>
</div>
</div>
<div class="paragraph">
<p><font o="611">关键参数是强制性的（尽管有一个<code i="319">--</code>前缀）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_key_management"><font o="612">密钥管理</font></h3>
<div class="paragraph">
<p><font o="613">Config Server可以使用对称（共享）密钥或非对称密钥（RSA密钥对）。</font><font o="614">非对称选择在安全性方面是优越的，但是使用对称密钥往往更方便，因为它只是配置的一个属性值。</font></p>
</div>
<div class="paragraph">
<p><font o="615">要配置对称密钥，您只需要将<code i="320">encrypt.key</code>设置为一个秘密字符串（或使用环境变量<code i="321">ENCRYPT_KEY</code>将其从纯文本配置文件中删除）。</font></p>
</div>
<div class="paragraph">
<p><font o="616">要配置非对称密钥，您可以将密钥设置为PEM编码的文本值（以<code i="322">encrypt.key</code>）或密钥库（例如由JDK附带的<code i="323">keytool</code>实用程序创建）。</font><font o="617">密钥库属性为<code i="324">encrypt.keyStore.*</code>，<code i="325">*</code>等于</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="618"><code i="326">location</code>（a <code i="327">Resource</code>位置），</font></p>
</li>
<li>
<p><font o="619"><code i="328">password</code>（解锁密钥库）和</font></p>
</li>
<li>
<p><font o="620"><code i="329">alias</code>（以识别商店中使用的密钥）。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="621">使用公钥进行加密，需要私钥进行解密。</font><font o="622">因此，原则上您只能在服务器中配置公钥，如果您只想进行加密（并准备使用私钥本地解密值）。</font><font o="623">实际上，您可能不想这样做，因为它围绕所有客户端传播密钥管理流程，而不是将其集中在服务器中。</font><font o="624">另一方面，如果您的配置服务器真的相对不安全，并且只有少数客户端需要加密的属性，这是一个有用的选项。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_key_store_for_testing"><font o="625">创建用于测试的密钥库</font></h3>
<div class="paragraph">
<p><font o="626">要创建一个密钥库进行测试，您可以执行以下操作：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ keytool -genkeypair -alias mytestkey -keyalg RSA \
  -dname "CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US" \
  -keypass changeme -keystore server.jks -storepass letmein</pre>
</div>
</div>
<div class="paragraph">
<p><font o="627">将<code i="330">server.jks</code>文件放在类路径（例如）中，然后在您的<code i="331">application.yml</code>中配置服务器：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">encrypt:
  keyStore:
    location: classpath:/server.jks
    password: letmein
    alias: mytestkey
    secret: changeme</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_multiple_keys_and_key_rotation"><font o="628">使用多个键和键旋转</font></h3>
<div class="paragraph">
<p><font o="629">除了加密属性值中的<code i="332">{cipher}</code>前缀之外，配置服务器在（Base64编码）密文开始之前查找<code i="333">{name:value}</code>前缀（零或多个）。</font><font o="630">密钥被传递给一个<code i="334">TextEncryptorLocator</code>，它可以做任何逻辑，需要找到一个<code i="335">TextEncryptor</code>的密码。</font><font o="631">如果配置了密钥库（<code i="336">encrypt.keystore.location</code>），默认定位器将使用“key”前缀提供的别名，即使用如下密码查找存储中的密钥：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">foo:
  bar: `{cipher}{key:testkey}...`</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="632">定位器将寻找一个名为“testkey”的键。</font><font o="633">也可以通过前缀中的<code i="337">{secret:…​}</code>值提供秘密，但如果不是默认值，则使用密钥库密码（这是您构建密钥存储并且不指定密码时获得的密码）。</font><font o="634">如果你</font><strong><font o="634">这样做</font></strong><font o="634"> 
提供一个秘密建议你也加密使用自定义<code i="338">SecretLocator</code>的秘密。</font></p>
</div>
<div class="paragraph">
<p><font o="635">如果密钥只用于加密几个字节的配置数据（即它们没有在其他地方使用），则密码转换几乎不是必需的，但是如果存在安全漏洞，有时您可能需要更改密钥实例。</font><font o="636">在这种情况下，所有客户端都需要更改其源配置文件（例如git），并在所有密码中使用新的<code i="339">{key:…​}</code>前缀，当然事先检查配置服务器密钥库中的密钥别名可用。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="637">提示</font></div>
</td>
<td class="content"><font o="638">
如果要让配置服务器处理所有加密以及解密，也可以将<code i="340">{name:value}</code>前缀添加到发布到<code i="341">/encrypt</code>端点的明文。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_serving_encrypted_properties"><font o="639">服务加密Properties</font></h3>
<div class="paragraph">
<p><font o="640">有时您希望客户端在本地解密配置，而不是在服务器中进行配置。</font><font o="641">在这种情况下，您仍然可以拥有/加密和/解密端点（如果您提供<code i="342">encrypt.*</code>配置来定位密钥），但是您需要使用<code i="343">spring.cloud.config.server.encrypt.enabled=false</code>明确地关闭传出属性的解密。</font><font o="642">如果您不关心端点，那么如果您既不配置密钥也不配置使能的标志，则应该起作用。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serving_alternative_formats"><font o="643">服务替代格式</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="644">来自环境端点的默认JSON格式非常适合Spring应用程序的使用，因为它直接映射到<code i="344">Environment</code>抽象。</font><font o="645">如果您喜欢，可以通过向资源路径（“.yml”，“.yaml”或“.properties”）添加后缀来使用与YAML或Java属性相同的数据。</font><font o="646">这对于不关心JSON端点的结构的应用程序或其提供的额外的元数据的应用程序可能会有用，例如，不使用Spring的应用程序可能会受益于此方法的简单性。</font></p>
</div>
<div class="paragraph">
<p><font o="647">YAML和属性表示有一个附加标志（作为布尔查询参数<code i="345">resolvePlaceholders</code>提供）），以标示Spring <code i="346">${…​}</code>形式的源文档中的占位符信号，应在输出中解析可能在渲染之前。</font><font o="648">对于不了解Spring占位符约定的消费者来说，这是一个有用的功能。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="649">注意</font></div>
</td>
<td class="content"><font o="650">
使用YAML或属性格式存在局限性，主要是与元数据的丢失有关。</font><font o="651">JSON被构造为属性源的有序列表，例如，名称与源相关联。</font><font o="652">即使源的起源具有多个源，并且原始源文件的名称丢失，YAML和属性表也合并成一个映射。</font><font o="653">YAML表示不一定是后台存储库中YAML源的忠实表示：它是由平面属性源的列表构建的，并且必须对键的形式进行假设。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serving_plain_text"><font o="654">服务纯文本</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="655">您的应用程序可能需要通用的纯文本配置文件，而不是使用<code i="347">Environment</code>抽象（或YAML或属性格式的其他替代表示形式）。</font><font o="656">配置服务器通过<code i="348">/{name}/{profile}/{label}/{path}</code>附加的端点提供这些服务，其中“name”，“profile”和“label”的含义与常规环境端点相同，但“path”是文件名（例如<code i="349">log.xml</code> ）。</font><font o="657">此端点的源文件位于与环境端点相同的方式：与属性或YAML文件相同的搜索路径，而不是聚合所有匹配的资源，只返回匹配的第一个。</font></p>
</div>
<div class="paragraph">
<p><font o="658">在找到资源后，使用正确格式（<code i="350">${…​}</code>）的占位符使用有效的<code i="351">Environment</code>解析应用程序名称，配置文件和标签。</font><font o="659">以这种方式，资源端点与环境端点紧密集成。</font><font o="660">例如，如果您有一个GIT（或SVN）资源库的布局：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">application.yml
nginx.conf</pre>
</div>
</div>
<div class="paragraph">
<p><font o="661">其中<code i="352">nginx.conf</code>如下所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">server {
    listen              80;
    server_name         ${nginx.server.name};
}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="662">和<code i="353">application.yml</code>这样：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">nginx:
  server:
    name: example.com
---
spring:
  profiles: development
nginx:
  server:
    name: develop.com</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="663">那么<code i="354">/foo/default/master/nginx.conf</code>资源如下所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">server {
    listen              80;
    server_name         example.com;
}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="664">和<code i="355">/foo/development/master/nginx.conf</code>这样：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">server {
    listen              80;
    server_name         develop.com;
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="665">注意</font></div>
</td>
<td class="content"><font o="666">
就像环境配置的源文件一样，“配置文件”用于解析文件名，因此，如果您想要一个特定于配置文件的文件，则<code i="356">/*/development/*/logback.xml</code>将由一个名为<code i="357">logback-development.xml</code>的文件解析（优先于<code i="358">logback.xml</code>）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_embedding_the_config_server"><font o="667">嵌入配置服务器</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="668">配置服务器最好作为独立应用程序运行，但如果需要，可以将其嵌入到另一个应用程序中。</font><font o="669">只需使用<code i="359">@EnableConfigServer</code>注释。</font><font o="670">在这种情况下可以使用的可选属性是<code i="360">spring.cloud.config.server.bootstrap</code>，它是一个标志，表示服务器应该从自己的远程存储库配置自己。</font><font o="671">该标志默认关闭，因为它可能会延迟启动，但是当嵌入在另一个应用程序中时，以与其他应用程序相同的方式初始化是有意义的。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="672">注意</font></div>
</td>
<td class="content"><font o="673">
应该很明显，但请记住，如果使用引导标志，配置服务器将需要在<code i="361">bootstrap.yml</code>中配置其名称和存储库URI。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="674">要更改服务器端点的位置，您可以（可选）设置<code i="362">spring.cloud.config.server.prefix</code>，例如“/ config”，以提供前缀下的资源。</font><font o="675">前缀应该开始但不以“/”结尾。</font><font o="676">它应用于Config Server中的<code i="363">@RequestMappings</code>（即Spring Boot前缀<code i="364">server.servletPath</code>和<code i="365">server.contextPath</code>）之下。</font></p>
</div>
<div class="paragraph">
<p><font o="677">如果您想直接从后端存储库（而不是从配置服务器）读取应用程序的配置，这基本上是一个没有端点的嵌入式配置服务器。</font><font o="678">如果不使用<code i="366">@EnableConfigServer</code>注释（仅设置<code i="367">spring.cloud.config.server.bootstrap=true</code>），则可以完全关闭端点。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_push_notifications_and_spring_cloud_bus"><font o="679">推送通知和Spring Cloud Bus</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="680">许多源代码存储库提供程序（例如Github，Gitlab或Bitbucket）将通过webhook通知您存储库中的更改。</font><font o="681">您可以通过提供商的用户界面将webhook配置为URL和一组感兴趣的事件。</font><font o="682">例如，
 </font><a href="javascript:;"><font o="682">Github</font></a><font o="682"> 
将使用包含提交列表的JSON主体和“X-Github-Event”等于“push”的头文件发送到webhook。</font><font o="683">如果您在<code i="368">spring-cloud-config-monitor</code>库中添加依赖关系并激活Config Server中的Spring Cloud Bus，则启用“/ monitor”端点。</font></p>
</div>
<div class="paragraph">
<p><font o="684">当Webhook被激活时，配置服务器将发送一个针对他认为可能已经改变的应用的<code i="369">RefreshRemoteApplicationEvent</code>。</font><font o="685">变更检测可以进行策略化，但默认情况下，它只是查找与应用程序名称匹配的文件的更改（例如，“foo.properties”针对的是“foo”应用程序，“application.properties”针对所有应用程序） 。</font><font o="686">如果要覆盖该行为的策略是<code i="370">PropertyPathNotificationExtractor</code>，它接受​​请求标头和正文作为参数，并返回已更改的文件路径列表。</font></p>
</div>
<div class="paragraph">
<p><font o="687">默认配置与Github，Gitlab或Bitbucket配合使用。</font><font o="688">除了来自Github，Gitlab或Bitbucket的JSON通知之外，您还可以通过使用表单编码的身体参数<code i="371">path={name}</code>打印到“/ monitor”来触发更改通知。</font><font o="689">这将广播到匹配“{name}”模式的应用程序（可以包含通配符）。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="690">注意</font></div>
</td>
<td class="content"><font o="691">
只有在配置服务器和客户端应用程序中激活<code i="373">spring-cloud-bus</code>时，才会传送<code i="372">RefreshRemoteApplicationEvent</code>。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="692">注意</font></div>
</td>
<td class="content"><font o="693">
默认配置还检测本地git存储库中的文件系统更改（在这种情况下不使用webhook，但是一旦编辑配置文件，将会播放刷新）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_config_client"><font o="694">Spring Cloud Config客户端</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="695">Spring Boot应用程序可以立即利用Spring配置服务器（或应用程序开发人员提供的其他外部属性源），并且还会选择与<code i="374">Environment</code>更改事件相关的一些其他有用功能。</font></p>
</div>
<div class="sect2">
<h3 id="config-first-bootstrap"><font o="696">配置第一引导</font></h3>
<div class="paragraph">
<p><font o="697">这是在类路径上具有Spring Cloud Config Client的任何应用程序的默认行为。</font><font o="698">当配置客户端启动时，它将绑定到配置服务器（通过引导配置属性<code i="375">spring.cloud.config.uri</code>）并使用远程属性源初始化Spring <code i="376">Environment</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="699">这样做的最终结果是所有想要使用Config Server的客户端应用程序都需要<code i="377">bootstrap.yml</code>（或环境变量），服务器地址为<code i="378">spring.cloud.config.uri</code>（默认为“http：// localhost：8888” ）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="discovery-first-bootstrap"><font o="700">发现第一个引导</font></h3>
<div class="paragraph">
<p><font o="701">如果您正在使用“DiscoveryClient”实现，例如Spring Cloud Netflix和Eureka服务发现或Spring Cloud Consul（Spring Cloud Zookeeper不支持此功能），那么您如果您想要配置服务器可以使用发现服务器注册，但在默认的“配置优先”模式下，客户端将无法利用注册功能。</font></p>
</div>
<div class="paragraph">
<p><font o="702">如果您希望使用<code i="379">DiscoveryClient</code>找到配置服务器，可以通过设置<code i="380">spring.cloud.config.discovery.enabled=true</code>（默认为“false”）来实现。</font><font o="703">最终的结果是客户端应用程序都需要具有适当发现配置的<code i="381">bootstrap.yml</code>（或环境变量）。</font><font o="704">例如，使用Spring Cloud Netflix，您需要定义Eureka服务器地址，例如<code i="382">eureka.client.serviceUrl.defaultZone</code>。</font><font o="705">使用此选项的价格是启动时额外的网络往返，以定位服务注册。</font><font o="706">好处是配置服务器可以更改其坐标，只要发现服务是一个固定点。</font><font o="707">默认服务ID为“configserver”，但您可以使用<code i="383">spring.cloud.config.discovery.serviceId</code>（在服务器上以通常的方式更改服务的方式，例如设置<code i="384">spring.application.name</code>）。</font></p>
</div>
<div class="paragraph">
<p><font o="708">发现客户端实现都支持某种元数据映射（例如Eureka，我们有<code i="385">eureka.instance.metadataMap</code>）。</font><font o="709">可能需要在其服务注册元数据中配置Config Server的一些其他属性，以便客户端可以正确连接。</font><font o="710">如果使用HTTP Basic安全配置服务器，则可以将凭据配置为“用户名”和“密码”。</font><font o="711">并且如果配置服务器具有上下文路径，您可以设置“configPath”。</font><font o="712">例如，对于作为Eureka客户端的配置服务器：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="713">bootstrap.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">eureka:
  instance:
    ...
    metadataMap:
      user: osufhalskjrtl
      password: lviuhlszvaorhvlo5847
      configPath: /config</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-client-fail-fast"><font o="714">配置客户端快速失败</font></h3>
<div class="paragraph">
<p><font o="715">在某些情况下，如果服务无法连接到配置服务器，则可能希望启动服务失败。</font><font o="716">如果这是所需的行为，请设置引导配置属性<code i="386">spring.cloud.config.failFast=true</code>，并且客户端将以异常停止。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="config-client-retry"><font o="717">配置客户端重试</font></h3>
<div class="paragraph">
<p><font o="718">如果您希望配置服务器在您的应用程序启动时可能偶尔不可用，您可以要求它在发生故障后继续尝试。</font><font o="719">首先，您需要设置<code i="387">spring.cloud.config.failFast=true</code>，然后您需要将<code i="388">spring-retry</code>和<code i="389">spring-boot-starter-aop</code>添加到您的类路径中。</font><font o="720">默认行为是重试6次，初始退避间隔为1000ms，指数乘数为1.1，用于后续退避。</font><font o="721">您可以使用<code i="390">spring.cloud.config.retry.*</code>配置属性配置这些属性（和其他）。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="722">提示</font></div>
</td>
<td class="content"><font o="723">
要完全控制重试，请使用id“configServerRetryInterceptor”添加<code i="392">RetryOperationsInterceptor</code>类型的<code i="391">@Bean</code>。</font><font o="724">Spring重试有一个<code i="393">RetryInterceptorBuilder</code>可以轻松创建一个。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_locating_remote_configuration_resources"><font o="725">查找远程配置资源</font></h3>
<div class="paragraph">
<p><font o="726">配置服务提供来自<code i="394">/{name}/{profile}/{label}</code>的属性来源，客户端应用程序中的默认绑定</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="727">“name”= <code i="395">${spring.application.name}</code></font></p>
</li>
<li>
<p><font o="728">“profile”= <code i="396">${spring.profiles.active}</code>（实际上是<code i="397">Environment.getActiveProfiles()</code>）</font></p>
</li>
<li>
<p><font o="729">“label”=“master”</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="730">所有这些都可以通过设置<code i="398">spring.cloud.config.*</code>（其中<code i="399">*</code>为“name”，“profile”或“label”）来覆盖。</font><font o="731">“标签”可用于回滚到以前版本的配置; </font><font o="732">使用默认的Config Server实现，它可以是git标签，分支名称或提交ID。</font><font o="733">标签也可以以逗号分隔的列表形式提供，在这种情况下，列表中的项目会逐个尝试，直到成功。</font><font o="734">当在特征分支上工作时，例如，当您可能希望将配置标签与分支对齐，但使其成为可选（例如<code i="400">spring.cloud.config.label=myfeature,develop</code>）时，这可能非常有用。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_security_2"><font o="735">安全</font></h3>
<div class="paragraph">
<p><font o="736">如果您在服务器上使用HTTP基本安全性，那么客户端只需要知道密码（如果不是默认用户名）。</font><font o="737">您可以通过配置服务器URI，或通过单独的用户名和密码属性，例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="738">bootstrap.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
     uri: https://user:<a href="email-protection.html" class="__cf_email__" data-cfemail="e4978187968190a4899d878b8a828d83ca899d878b8994858a9dca878b89">[email&#160;protected]</a></code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="739">要么</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="740">bootstrap.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
     uri: https://myconfig.mycompany.com
     username: user
     password: secret</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="741"><code i="401">spring.cloud.config.password</code>和<code i="402">spring.cloud.config.username</code>值覆盖URI中提供的任何内容。</font></p>
</div>
<div class="paragraph">
<p><font o="742">如果您在Cloud Foundry部署应用程序，则提供密码的最佳方式是通过服务凭证（例如URI），因为它甚至不需要在配置文件中。</font><font o="743">在Cloud Foundry上为本地工作的用户提供的服务的一个例子，名为“configserver”：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="744">bootstrap.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    config:
     uri: ${vcap.services.configserver.credentials.uri:http://user:<a href="email-protection.html" class="__cf_email__" data-cfemail="b8c8d9cbcbcfd7cadcf8d4d7dbd9d4d0d7cbcc">[email&#160;protected]</a>:8888}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="745">如果您使用另一种形式的安全性，您可能需要向<code i="404">ConfigServicePropertySourceLocator</code>提供<code i="403">RestTemplate</code>（例如，通过在引导上下文中获取它并注入一个）。</font></p>
</div>
</div>
</div>
</div>
<h1 id="_spring_cloud_netflix" class="sect0"><font o="746">Spring Cloud Netflix</font></h1>
<div class="openblock partintro">
<div class="content"><font o="747">
该项目通过自动配置为Spring Boot应用程序提供Netflix OSS集成，并绑定到Spring环境和其他Spring编程模型成语。</font><font o="748">通过几个简单的注释，您可以快速启用和配置应用程序中的常见模式，并通过经过测试的Netflix组件构建大型分布式系统。</font><font o="749">提供的模式包括服务发现（Eureka），断路器（Hystrix），智能路由（Zuul）和客户端负载平衡（Ribbon）。
</font></div>
</div>
<div class="sect1">
<h2 id="_service_discovery_eureka_clients"><font o="750">服务发现：Eureka客户端</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="751">服务发现是基于微服务架构的关键原则之一。</font><font o="752">尝试配置每个客户端或某种形式的约定可能非常困难，可以非常脆弱。</font><font o="753">Netflix服务发现服务器和客户端是Eureka。</font><font o="754">可以将服务器配置和部署为高可用性，每个服务器将注册服务的状态复制到其他服务器。</font></p>
</div>
<div class="sect2">
<h3 id="_registering_with_eureka"><font o="755">注册Eureka</font></h3>
<div class="paragraph">
<p><font o="756">当客户端注册Eureka时，它提供有关自身的元数据，例如主机和端口，运行状况指示符URL，主页等。Eureka从属于服务的每个实例接收心跳消息。</font><font o="757">如果心跳失败超过可配置的时间表，则通常将该实例从注册表中删除。</font></p>
</div>
<div class="paragraph">
<p><font o="758">示例eureka客户端：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
@ComponentScan
@EnableAutoConfiguration
@EnableEurekaClient
@RestController
public class Application {

    @RequestMapping("/")
    public String home() {
        return "Hello world";
    }

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="759">（即完全正常的Spring Boot应用程序）。</font><font o="760">在这个例子中，我们明确地使用<code i="405">@EnableEurekaClient</code>，但只有Eureka可用，你也可以使用<code i="406">@EnableDiscoveryClient</code>。</font><font o="761">找到Eureka服务器需要进行配置。</font><font o="762">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="763">application.yml</font></div>
<div class="content">
<pre class="notranslate">eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/</pre>
</div>
</div>
<div class="paragraph">
<p><font o="764">其中“defaultZone”是一个魔术字符串后备值，为任何不表示首选项的客户端提供服务URL（即它是有用的默认值）。</font></p>
</div>
<div class="paragraph">
<p><font o="765">从<code i="407">Environment</code>获取的默认应用程序名称（服务ID），虚拟主机和非安全端口分别为<code i="408">${spring.application.name}</code>，<code i="409">${spring.application.name}</code>和<code i="410">${server.port}</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="766"><code i="411">@EnableEurekaClient</code>使应用程序成为Eureka“实例”（即注册自身）和“客户端”（即它可以查询注册表以查找其他服务）。</font><font o="767">实例行为由<code i="412">eureka.instance.*</code>配置键驱动，但如果您确保您的应用程序具有<code i="413">spring.application.name</code>（这是Eureka服务ID或VIP的默认值），默认情况下将是正常的。</font></p>
</div>
<div class="paragraph">
<p><font o="768">有关可</font><a href="javascript:;"><font o="768">配置</font></a><font></font><a href="javascript:;"><font o="768">选项</font></a><font o="768">的更多详细信息，</font><font o="768">请参阅</font><a href="javascript:;"><font o="768">EurekaInstanceConfigBean</font></a><font o="768">和</font><a href="javascript:;"><font o="768">EurekaClientConfigBean</font></a><font o="768">。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_authenticating_with_the_eureka_server"><font o="769">使用Eureka服务器进行身份验证</font></h3>
<div class="paragraph">
<p><font o="770">如果其中一个<code i="414">eureka.client.serviceUrl.defaultZone</code> URL中嵌入了凭证（如<code i="415"><a href="javascript:;" class="bare">http://user:<span class="__cf_email__" data-cfemail="ef9f8e9c9c98809d8baf83808c8e8387809c9b">[email&#160;protected]</span>:8761/eureka</a></code>）），HTTP基本身份验证将自动添加到您的eureka客户端。</font><font o="771">对于更复杂的需求，您可以创建<code i="417">DiscoveryClientOptionalArgs</code>类型的<code i="416">@Bean</code>并将<code i="418">ClientFilter</code>实例注入到其中，所有这些都将应用于从客户端到服务器的调用。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="772">注意</font></div>
</td>
<td class="content"><font o="773">
由于Eureka中的限制，不可能支持每个服务器的基本身份验证凭据，因此只能使用第一个找到的集合。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_status_page_and_health_indicator"><font o="774">状态页和健康指标</font></h3>
<div class="paragraph">
<p><font o="775">Eureka实例的状态页面和运行状况指示符分别默认为“/ info”和“/ health”，它们是Spring Boot Actuator应用程序中有用端点的默认位置。</font><font o="776">如果您使用非默认上下文路径或servlet路径（例如<code i="419">server.servletPath=/foo</code>）或管理端点路径（例如<code i="420">management.contextPath=/admin</code>），则需要更改这些，即使是执行程序应用程序。</font><font o="777">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="778">application.yml</font></div>
<div class="content">
<pre class="notranslate">eureka:
  instance:
    statusPageUrlPath: ${management.context-path}/info
    healthCheckUrlPath: ${management.context-path}/health</pre>
</div>
</div>
<div class="paragraph">
<p><font o="779">这些链接显示在客户端使用的元数据中，并在某些情况下用于决定是否将请求发送到应用程序，因此如果它们是准确的，这是有帮助的。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_a_secure_application"><font o="780">注册安全应用程序</font></h3>
<div class="paragraph">
<p><font o="781">如果您的应用程序想通过HTTPS联系，则可以分别在<code i="421">EurekaInstanceConfig</code>，即<code i="422">eureka.instance.[nonSecurePortEnabled,securePortEnabled]=[false,true]</code>中设置两个标志。</font><em><font o="781">即</font></em><font o="781"> 
v32 { </font><font o="781">}中设置两个标志</font><font o="781">。</font><font o="782">这将使Eureka发布实例信息显示安全通信的明确偏好。</font><font o="783">Spring云<code i="423">DiscoveryClient</code>将始终为以这种方式配置的服务返回<code i="424"><a href="javascript:;" class="bare">https://…​</a>;</code> URI，并且Eureka（本机）实例信息将具有安全的健康检查URL。</font></p>
</div>
<div class="paragraph">
<p><font o="784">由于Eureka在内部工作，它仍然会发布状态和主页的非安全URL，除非您也明确地覆盖。</font><font o="785">您可以使用占位符来配置eureka实例URL，例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="786">application.yml</font></div>
<div class="content">
<pre class="notranslate">eureka:
  instance:
    statusPageUrl: https://${eureka.hostname}/info
    healthCheckUrl: https://${eureka.hostname}/health
    homePageUrl: https://${eureka.hostname}/</pre>
</div>
</div>
<div class="paragraph">
<p><font o="787">（请注意，<code i="425">${eureka.hostname}</code>是仅在稍后版本的Eureka中可用的本机占位符，您也可以使用Spring占位符实现同样的功能，例如使用<code i="426">${eureka.instance.hostName}</code>。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="788">注意</font></div>
</td>
<td class="content"><font o="789">
如果您的应用程序在代理服务器后面运行，并且SSL终止服务在代理中（例如，如果您运行在Cloud Foundry或其他平台作为服务），则需要确保代理“转发”头部被截取并处理应用程序。</font><font o="790">Spring Boot应用程序中的嵌入式Tomcat容器会自动执行“X-Forwarded  -  \ *”头的显式配置。</font><font o="791">你这个错误的一个迹象就是你的应用程序本身所呈现的链接是错误的（错误的主机，端口或协议）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_eureka_s_health_checks"><font o="792">Eureka的健康检查</font></h3>
<div class="paragraph">
<p><font o="793">默认情况下，Eureka使用客户端心跳来确定客户端是否启动。</font><font o="794">除非另有规定，否则发现客户端将不会根据Spring Boot Actuator传播应用程序的当前运行状况检查状态。</font><font o="795">这意味着成功注册后，Eureka将永远宣布申请处于“UP”状态。</font><font o="796">可以通过启用Eureka运行状况检查来改变此行为，从而将应用程序状态传播到Eureka。</font><font o="797">因此，每个其他应用程序将不会在“UP”之外的状态下将流量发送到应用程序。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="798">application.yml</font></div>
<div class="content">
<pre class="notranslate">eureka:
  client:
    healthcheck:
      enabled: true</pre>
</div>
</div>
<div class="paragraph">
<p><font o="799">如果您需要更多的控制健康检查，您可以考虑实施自己的<code i="427">com.netflix.appinfo.HealthCheckHandler</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_eureka_metadata_for_instances_and_clients"><font o="800">Eureka实例和客户端的元数据</font></h3>
<div class="paragraph">
<p><font o="801">值得花点时间了解Eureka元数据的工作原理，以便您可以在平台上使用它。</font><font o="802">有主机名，IP地址，端口号，状态页和运行状况检查等标准元数据。</font><font o="803">这些发布在服务注册表中，由客户使用，以直接的方式联系服务。</font><font o="804">额外的元数据可以添加到<code i="428">eureka.instance.metadataMap</code>中的实例注册中，并且这将在远程客户端中可访问，但通常不会更改客户端的行为，除非意识到元数据的含义。</font><font o="805">下面描述了几个特殊情况，其中Spring Cloud已经为元数据映射指定了含义。</font></p>
</div>
<div class="sect3">
<h4 id="_using_eureka_on_cloudfoundry"><font o="806">在Cloudfoundry上使用Eureka</font></h4>
<div class="paragraph">
<p><font o="807">Cloudfoundry有一个全局路由器，所以同一个应用程序的所有实例都具有相同的主机名（在具有相似架构的其他PaaS解决方案中也是如此）。</font><font o="808">这不一定是使用Eureka的障碍，但是如果您使用路由器（建议，甚至是强制性的，具体取决于您的平台的设置方式），则需要显式设置主机名和端口号（安全或非安全），以便他们使用路由器。</font><font o="809">您可能还需要使用实例元数据，以便您可以区分客户端上的实例（例如，在自定义负载平衡器中）。</font><font o="810">默认情况下，<code i="429">eureka.instance.instanceId</code>为<code i="430">vcap.application.instance_id</code>。</font><font o="811">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="812">application.yml</font></div>
<div class="content">
<pre class="notranslate">eureka:
  instance:
    hostname: ${vcap.application.uris[0]}
    nonSecurePort: 80</pre>
</div>
</div>
<div class="paragraph">
<p><font o="813">根据Cloudfoundry实例中安全规则的设置方式，您可以注册并使用主机VM的IP地址进行直接的服务到服务调用。</font><font o="814">此功能尚未在Pivotal Web Services（</font><a href="javascript:;"><font o="814">PWS</font></a><font o="814">）上提供。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_using_eureka_on_aws"><font o="815">在AWS上使用Eureka</font></h4>
<div class="paragraph">
<p><font o="816">如果应用程序计划将部署到AWS云，那么Eureka实例必须被配置为亚马逊意识到，这可以通过定制来完成</font><a href="javascript:;"><font o="816">EurekaInstanceConfigBean</font></a><font o="816">方式如下：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
@Profile("!default")
public EurekaInstanceConfigBean eurekaInstanceConfig() {
  EurekaInstanceConfigBean b = new EurekaInstanceConfigBean();
  AmazonInfo info = AmazonInfo.Builder.newBuilder().autoBuild("eureka");
  b.setDataCenterInfo(info);
  return b;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changing_the_eureka_instance_id"><font o="817">更改Eureka实例ID</font></h4>
<div class="paragraph">
<p><font o="818">香草Netflix Eureka实例注册了与其主机名相同的ID（即每个主机只有一个服务）。</font><font o="819">Spring Cloud Eureka提供了一个明智的默认，如下所示：<code i="431">${spring.cloud.client.hostname}:${spring.application.name}:${spring.application.instance_id:${server.port}}}</code>。</font><font o="820">例如<code i="432">myhost:myappname:8080</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="821">使用Spring Cloud，您可以通过在<code i="433">eureka.instance.instanceId</code>中提供唯一的标识来覆盖此。</font><font o="822">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="823">application.yml</font></div>
<div class="content">
<pre class="notranslate">eureka:
  instance:
    instanceId: ${spring.application.name}:${spring.application.instance_id:${random.value}}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="824">使用这个元数据和在localhost上部署的多个服务实例，随机值将在那里进行，以使实例是唯一的。</font><font o="825">在Cloudfoundry中，<code i="434">spring.application.instance_id</code>将在Spring Boot Actuator应用程序中自动填充，因此不需要随机值。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_eurekaclient"><font o="826">使用EurekaClient</font></h3>
<div class="paragraph">
<p><font o="827">一旦您有一个<code i="435">@EnableDiscoveryClient</code>（或<code i="436">@EnableEurekaClient</code>）的应用程序，您可以使用它来发现</font><a href="#spring-cloud-eureka-server"><font o="827">Eureka服务器的</font></a><font o="827">服务实例</font><font o="827">。</font><font o="828">一种方法是使用本机<code i="437">com.netflix.discovery.EurekaClient</code>（而不是Spring Cloud <code i="438">DiscoveryClient</code>），例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@Autowired
private EurekaClient discoveryClient;

public String serviceUrl() {
    InstanceInfo instance = discoveryClient.getNextServerFromEureka("STORES", false);
    return instance.getHomePageUrl();
}</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="829">提示</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="830">不要使用<code i="440">@PostConstruct</code>方法或<code i="441">@Scheduled</code>方法中的<code i="439">EurekaClient</code>（或<code i="442">ApplicationContext</code>可能尚未启动的任何位置）。</font><font o="831">它被初始化为<code i="443">SmartLifecycle</code>（带有<code i="444">phase=0</code>），所以你可以依靠它最早可用的是另一个具有较高阶段的<code i="445">SmartLifecycle</code>。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_alternatives_to_the_native_netflix_eurekaclient"><font o="832">本机Netflix EurekaClient的替代方案</font></h3>
<div class="paragraph">
<p><font o="833">您不必使用原始的Netflix <code i="446">EurekaClient</code>，通常在某种包装器后面使用它更为方便。</font><font o="834">Spring Cloud支持</font><a href="#spring-cloud-feign"><font o="834">Feign</font></a><font o="834">（REST客户端构建器），还支持</font><a href="#spring-cloud-ribbon"><font o="834">Spring <code i="447">RestTemplate</code></font></a><font o="834">使用逻辑Eureka服务标识符（VIP）而不是物理URL。</font><font o="835">要使用固定的物理服务器列表配置Ribbon，您可以将<code i="448">&lt;client&gt;.ribbon.listOfServers</code>设置为逗号分隔的物理地址（或主机名）列表，其中<code i="449">&lt;client&gt;</code>是客户端的ID。</font></p>
</div>
<div class="paragraph">
<p><font o="836">您还可以使用<code i="450">org.springframework.cloud.client.discovery.DiscoveryClient</code>，它为Netflix不具体的发现客户端提供简单的API，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances("STORES");
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri();
    }
    return null;
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_is_it_so_slow_to_register_a_service"><font o="837">为什么注册服务这么慢？</font></h3>
<div class="paragraph">
<p><font o="838">作为一个实例也包括定期心跳到注册表（通过客户端的<code i="451">serviceUrl</code>），默认持续时间为30秒。</font><font o="839">在实例，服务器和客户端在其本地缓存中都具有相同的元数据（因此可能需要3个心跳）之前，客户端才能发现服务。</font><font o="840">您可以使用<code i="452">eureka.instance.leaseRenewalIntervalInSeconds</code>更改期限，这将加快客户端连接到其他服务的过程。</font><font o="841">在生产中，最好坚持使用默认值，因为服务器内部有一些计算可以对租赁更新期进行假设。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-eureka-server"><font o="842">服务发现：Eureka服务器</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="843">示例eureka服务器（例如使用spring-cloud-starter-eureka-server设置类路径）：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableEurekaServer
public class Application {

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="844">根据<code i="453">/eureka/*</code>的正常Eureka功能，服务器具有带有UI的主页和HTTP API端点。</font></p>
</div>
<div class="paragraph">
<p><font o="845">Eureka背景阅读：看</font><a href="javascript:;"><font o="845">助焊剂电容</font></a><font o="845">和</font><a href="javascript:;"><font o="845">谷歌小组讨论</font></a><font o="845">。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="846">提示</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="847">由于Gradle的依赖关系解决规则和父母的bom功能缺乏，只要依靠spring-cloud-starter-eureka-server就可能导致应用程序启动失败。</font><font o="848">为了解决这个问题，必须添加Spring Boot Gradle插件，并且必须像这样导入Spring云启动器父母bom：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="849">的build.gradle</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">buildscript {
  dependencies {
    classpath("org.springframework.boot:spring-boot-gradle-plugin:1.3.5.RELEASE")
  }
}

apply plugin: "spring-boot"

dependencyManagement {
  imports {
    mavenBom "org.springframework.cloud:spring-cloud-dependencies:Brixton.RELEASE"
  }
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_high_availability_zones_and_regions"><font o="850">高可用性，区域和地区</font></h3>
<div class="paragraph">
<p><font o="851">Eureka服务器没有后端存储，但是注册表中的服务实例都必须发送心跳线以保持其注册更新（因此可以在内存中完成）。</font><font o="852">客户端还具有eureka注册的内存缓存（因此，他们不必为注册表提供每个服务请求）。</font></p>
</div>
<div class="paragraph">
<p><font o="853">默认情况下，每个Eureka服务器也是Eureka客户端，并且需要（至少一个）服务URL来定位对等体。</font><font o="854">如果您不提供该服务将运行和工作，但它将淋浴您的日志与大量的噪音无法注册对等体。</font></p>
</div>
<div class="paragraph">
<p><font o="855">有关</font><font o="855">区域和区域的客户端</font><a href="#spring-cloud-ribbon"><font o="855">Ribbon支持的详细信息，</font></a><font o="855">请参见</font><a href="#spring-cloud-ribbon"><font o="855">下文</font></a><font o="855">。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_standalone_mode"><font o="856">独立模式</font></h3>
<div class="paragraph">
<p><font o="857">只要存在某种监视器或弹性运行时间（例如Cloud Foundry），两个缓存（客户机和服务器）和心跳的组合使独立的Eureka服务器对故障具有相当的弹性。</font><font o="858">在独立模式下，您可能更喜欢关闭客户端行为，因此不会继续尝试并且无法访问其对等体。</font><font o="859">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="860">application.yml（Standalone Eureka Server）</font></div>
<div class="content">
<pre class="notranslate">server:
  port: 8761

eureka:
  instance:
    hostname: localhost
  client:
    registerWithEureka: false
    fetchRegistry: false
    serviceUrl:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/</pre>
</div>
</div>
<div class="paragraph">
<p><font o="861">请注意，<code i="454">serviceUrl</code>指向与本地实例相同的主机。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_peer_awareness"><font o="862">同行意识</font></h3>
<div class="paragraph">
<p><font o="863">通过运行多个实例并请求他们相互注册，可以使Eureka更具弹性和可用性。</font><font o="864">实际上，这是默认的行为，所以你需要做的只是为对方添加一个有效的<code i="455">serviceUrl</code>，例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="865">application.yml（Two Peer Aware Eureka Servers）</font></div>
<div class="content">
<pre class="notranslate">---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1
  client:
    serviceUrl:
      defaultZone: http://peer2/eureka/

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2
  client:
    serviceUrl:
      defaultZone: http://peer1/eureka/</pre>
</div>
</div>
<div class="paragraph">
<p><font o="866">在这个例子中，我们有一个YAML文件可以用于通过在不同的Spring配置文件中运行，在2台主机（peer1和peer2）上运行相同的服务器。</font><font o="867">您可以使用此配置来测试单个主机上的对等体感知（通过操作<code i="456">/etc/hosts</code>来解析主机名，在生产中没有太多价值）。</font><font o="868">事实上，如果您在一台知道自己的主机名的机器上运行（默认情况下使用<code i="458">java.net.InetAddress</code>查找），则不需要<code i="457">eureka.instance.hostname</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="869">您可以向系统添加多个对等体，只要它们彼此直接相连，就可以将它们之间的注册同步。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="870">application.yml（Three Peer Aware Eureka Servers）</font></div>
<div class="content">
<pre class="notranslate">eureka:
  client:
    serviceUrl:
      defaultZone: http://peer1/eureka/,http://peer2/eureka/,http://peer3/eureka/

---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2

---
spring:
  profiles: peer3
eureka:
  instance:
    hostname: peer3</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prefer_ip_address"><font o="871">喜欢IP地址</font></h3>
<div class="paragraph">
<p><font o="872">在某些情况下，Eureka最好广告服务的IP地址，而不是主机名。</font><font o="873">将<code i="459">eureka.instance.preferIpAddress</code>设置为<code i="460">true</code>，当应用程序向eureka注册时，它将使用其IP地址而不是其主机名。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_circuit_breaker_hystrix_clients"><font o="874">断路器：Hystrix客户</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="875">Netflix的创造了一个调用的库</font><a href="javascript:;"><font o="875">Hystrix</font></a><font o="875">实现了</font><a href="javascript:;"><font o="875">断路器图案</font></a><font o="875">。</font><font o="876">在微服务架构中，通常有多层服务调用。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/HystrixGraph.png" alt="HystrixGraph">
</div>
<div class="title"><font o="877">图1.微服务图</font></div>
</div>
<div class="paragraph">
<p><font o="878">较低级别的服务中的服务故障可能导致用户级联故障。</font><font o="879">当对特定服务的呼叫达到一定阈值时（Hystrix中默认为20秒，20秒），电路打开，不进行通话。</font><font o="880">在错误和开路的情况下，开发人员可以提供后备。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/HystrixFallback.png" alt="HystrixFallback">
</div>
<div class="title"><font o="881">图2. Hystrix回退防止级联故障</font></div>
</div>
<div class="paragraph">
<p><font o="882">开放式电路会停止级联故障，并允许不必要的或失败的服务时间来愈合。</font><font o="883">回退可以是另一个Hystrix保护的调用，静态数据或一个正常的空值。</font><font o="884">回退可能被链接，所以第一个回退使得一些其他业务电话又回到静态数据。</font></p>
</div>
<div class="paragraph">
<p><font o="885">示例启动应用程序：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@SpringBootApplication
@EnableCircuitBreaker
public class Application {

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}

@Component
public class StoreIntegration {

    @HystrixCommand(fallbackMethod = "defaultStores")
    public Object getStores(Map&lt;String, Object&gt; parameters) {
        //do stuff that might fail
    }

    public Object defaultStores(Map&lt;String, Object&gt; parameters) {
        return /* something useful */;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="886"><code i="461">@HystrixCommand</code>由名为</font><a href="javascript:;"><font o="886">“javanica”</font></a><font o="886">的Netflix contrib库提供
 </font><font o="886">。</font><font o="887">Spring Cloud在连接到Hystrix断路器的代理中使用该注释自动包装Spring bean。</font><font o="888">断路器计算何时打开和关闭电路，以及在发生故障时应该做什么。</font></p>
</div>
<div class="paragraph">
<p><font o="889">要配置<code i="462">@HystrixCommand</code>，您可以使用<code i="463">commandProperties</code>属性列出<code i="464">@HystrixProperty</code>注释。</font><font o="890">请参阅
 </font><a href="javascript:;"><font o="890">这里</font></a><font o="890"> 
了解更多详情。</font><font o="891">有关</font><font o="891">
可用属性的详细信息，</font><font o="891">请参阅</font><a href="javascript:;"><font o="891">Hystrix维基</font></a><font o="891">。</font></p>
</div>
<div class="sect2">
<h3 id="_propagating_the_security_context_or_using_spring_scopes"><font o="892">传播安全上下文或使用Spring范围</font></h3>
<div class="paragraph">
<p><font o="893">如果您希望某些线程本地上下文传播到<code i="465">@HystrixCommand</code>中，默认声明将不起作用，因为它在线程池中执行命令（超时）。</font><font o="894">您可以使用某些配置或直接在注释中将Hystrix切换为使用与调用者相同的线程，要求使用不同的“隔离策略”。</font><font o="895">例如：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@HystrixCommand(fallbackMethod = "stubMyService",
    commandProperties = {
      @HystrixProperty(name="execution.isolation.strategy", value="SEMAPHORE")
    }
)
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="896">如果您使用<code i="466">@SessionScope</code>或<code i="467">@RequestScope</code>，同样的事情也适用。</font><font o="897">您将知道何时需要执行此操作，因为运行时异常说它找不到范围的上下文。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_health_indicator_2"><font o="898">健康指标</font></h3>
<div class="paragraph">
<p><font o="899">连接断路器的状态也暴露在呼叫应用程序的<code i="468">/health</code>端点。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-json" data-lang="json">{
    "hystrix": {
        "openCircuitBreakers": [
            "StoreIntegration::getStoresByLocationLink"
        ],
        "status": "CIRCUIT_OPEN"
    },
    "status": "UP"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hystrix_metrics_stream"><font o="900">Hystrix指标流</font></h3>
<div class="paragraph">
<p><font o="901">要使Hystrix指标流包含对<code i="469">spring-boot-starter-actuator</code>的依赖。</font><font o="902">这将使<code i="470">/hystrix.stream</code>作为管理端点。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_circuit_breaker_hystrix_dashboard"><font o="903">断路器：Hystrix仪表板</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="904">Hystrix的主要优点之一是它收集关于每个HystrixCommand的一套指标。</font><font o="905">Hystrix仪表板以有效的方式显示每个断路器的运行状况。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/Hystrix.png" alt="豪猪">
</div>
<div class="title"><font o="906">图3. Hystrix仪表板</font></div>
</div>
<div class="paragraph">
<p><font o="907">运行Hystrix仪表板使用<code i="471">@EnableHystrixDashboard</code>注释您的Spring Boot主类。</font><font o="908">然后访问<code i="472">/hystrix</code>，并将仪表板指向Hystrix客户端应用程序中的单个实例<code i="473">/hystrix.stream</code>端点。</font></p>
</div>
<div class="sect2">
<h3 id="_turbine">Turbine</h3>
<div class="paragraph">
<p><font o="910">查看个别实例Hystrix数据在系统整体健康方面不是非常有用。</font><a href="javascript:;"><font o="911">Turbine</font></a><font o="911">是将所有相关<code i="474">/hystrix.stream</code>端点聚合成Hystrix仪表板中使用的组合<code i="475">/turbine.stream</code>的应用程序。</font><font o="912">个人实例位于Eureka。</font><font o="913">运行Turbine就像使用<code i="476">@EnableTurbine</code>注释（例如使用spring-cloud-starter-turbine设置类路径）注释主类一样简单。</font><font o="914">来自</font><a href="javascript:;"><font o="914">Turbine 1维基的</font></a><font o="914">所有文档配置属性都</font><font o="914">适用。</font><font o="915">唯一的区别是<code i="477">turbine.instanceUrlSuffix</code>不需要预先添加的端口，除非<code i="478">turbine.instanceInsertPort=false</code>自动处理。</font></p>
</div>
<div class="paragraph">
<p><font o="916">配置密钥<code i="479">turbine.appConfig</code>是涡轮机将用于查找实例的尤里卡服务列表。</font><font o="917">涡轮流然后在Hystrix仪表板中使用如下URL：<code i="480"><a href="javascript:;" class="bare">http://my.turbine.sever:8080/turbine.stream?cluster=&lt;CLUSTERNAME&gt;</a>;</code>（如果名称为“默认值”，则可以省略群集参数）。</font><font o="918"><code i="481">cluster</code>参数必须与<code i="482">turbine.aggregator.clusterConfig</code>中的条目相匹配。</font><font o="919">从eureka返回的值是大写字母，因此如果有一个名为“customers”的Eureka注册了一个应用程序，我们希望这个例子可以工作：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">turbine:
  aggregator:
    clusterConfig: CUSTOMERS
  appConfig: customers</pre>
</div>
</div>
<div class="paragraph">
<p><font o="920"><code i="483">clusterName</code>可以通过<code i="484">turbine.clusterNameExpression</code>中的SPEL表达式以root身份<code i="485">InstanceInfo</code>定制。</font><font o="921">默认值为<code i="486">appName</code>，这意味着Eureka serviceId最终作为集群密钥（即客户的<code i="487">InstanceInfo</code>具有<code i="488">appName</code>“CUSTOMERS”）。</font><font o="922">一个不同的例子是<code i="489">turbine.clusterNameExpression=aSGName</code>，它将从AWS ASG名称获取集群名称。</font><font o="923">另一个例子：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">turbine:
  aggregator:
    clusterConfig: SYSTEM,USER
  appConfig: customers,stores,ui,admin
  clusterNameExpression: metadata['cluster']</pre>
</div>
</div>
<div class="paragraph">
<p><font o="924">在这种情况下，来自4个服务的集群名称从其元数据映射中提取，并且预期具有包含“SYSTEM”和“USER”的值。</font></p>
</div>
<div class="paragraph">
<p><font o="925">要为所有应用程序使用“默认”集群，您需要一个字符串文字表达式（带单引号，并且如果它在YAML中也使用双引号进行转义）：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">turbine:
  appConfig: customers,stores
  clusterNameExpression: "'default'"</pre>
</div>
</div>
<div class="paragraph">
<p><font o="926">Spring Cloud提供了一个<code i="490">spring-cloud-starter-turbine</code>，它具有运行Turbine服务器所需的所有依赖关系。</font><font o="927">只需创建一个Spring Boot应用程序并用<code i="491">@EnableTurbine</code>注释它。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="928">注意</font></div>
</td>
<td class="content"><font o="929">
默认情况下，天然的Netflix行为内置到Turbine并</font><em><font o="929">没有</font></em><font o="929">允许每台主机多个进程，每个群集（关键到实例id是主机名）。</font><font o="930">Spring Cloud概括一下，允许主机和端口用作键，但只有设置属性<code i="492">turbine.combineHostPort=true</code>
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_turbine_stream"><font o="931">Turbine流</font></h3>
<div class="paragraph">
<p><font o="932">在某些环境中（例如在PaaS设置中），所有分布式Hystrix命令拉取度量的经典Turbine模型不起作用。</font><font o="933">在这种情况下，您可能希望让您的Hystrix命令将度量标准推送到Turbine，并且Spring Cloud可以使用消息传递。</font><font o="934">您需要在客户端上执行的所有操作都为您选择的<code i="493">spring-cloud-netflix-hystrix-stream</code>和<code i="494">spring-cloud-starter-stream-*</code>添加依赖关系（有关经纪人的详细信息，请参阅Spring Cloud Stream文档，以及如何配置客户端凭据，但应该为当地经纪人开箱即用）。</font></p>
</div>
<div class="paragraph">
<p><font o="935">在服务器端只需创建一个Spring Boot应用程序并使用<code i="495">@EnableTurbineStream</code>进行注释，默认情况下，它将出现在端口8989（将您的Hystrix仪表板指向该端口，任何路径）。</font><font o="936">您可以使用<code i="496">server.port</code>或<code i="497">turbine.stream.port</code>自定义端口。</font><font o="937">如果类路径中还有<code i="498">spring-boot-starter-web</code>和<code i="499">spring-boot-starter-actuator</code>，那么您可以通过提供不同的<code i="500">management.port</code>在单独的端口（默认情况下使用Tomcat）打开Actuator端点。</font></p>
</div>
<div class="paragraph">
<p><font o="938">然后，您可以将Hystrix仪表板指向Turbine流服务器，而不是单个Hystrix流。</font><font o="939">如果Turbine Stream在myhost上的端口8989上运行，则将<code i="501"><a href="javascript:;" class="bare">http://myhost:8989</a></code>放在Hystrix仪表板中的流输入字段中。</font><font o="940">电路将以各自的serviceId为前缀，后跟一个点，然后是电路名称。</font></p>
</div>
<div class="paragraph">
<p><font o="941">Spring Cloud提供了一个<code i="502">spring-cloud-starter-turbine-stream</code>，它具有您需要的所有依赖关系，以获取Turbine Stream服务器运行 - 只需添加您选择的Stream binder，例如<code i="503">spring-cloud-starter-stream-rabbit</code>。</font><font o="942">您需要Java 8来运行应用程序，因为它是基于Netty的。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-ribbon"><font o="943">客户端负载均衡器：Ribbon</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="944">Ribbon是一个客户端负载平衡器，可以很好地控制HTTP和TCP客户端的行为。</font><font o="945">Feign已经使用Ribbon，所以如果您使用<code i="504">@FeignClient</code>，则此部分也适用。</font></p>
</div>
<div class="paragraph">
<p><font o="946">Ribbon中的中心概念是命名客户端的概念。</font><font o="947">每个负载均衡器是组合的组合的一部分，它们一起工作以根据需要联系远程服务器，并且集合具有将其作为应用程序开发人员（例如使用<code i="505">@FeignClient</code>注释）的名称。</font><font o="948">Spring Cloud使用<code i="507">RibbonClientConfiguration</code>为每个已命名的客户端根据需要创建一个新的集合，作为<code i="506">ApplicationContext</code>。</font><font o="949">这包含（其中包括）<code i="508">ILoadBalancer</code>，<code i="509">RestClient</code>和<code i="510">ServerListFilter</code>。</font></p>
</div>
<div class="sect2">
<h3 id="_customizing_the_ribbon_client"><font o="950">自定义Ribbon客户端</font></h3>
<div class="paragraph">
<p><font o="951">您可以使用<code i="511">&lt;client&gt;.ribbon.*</code>中的外部属性配置Ribbon客户端的某些位，这与使用Netflix API本身没有区别，只是您可以使用Spring Boot配置文件。</font><font o="952">本地选项可以作为<code i="512">CommonClientConfigKey</code>（功能区内核心部分）中的静态字段进行检查。</font></p>
</div>
<div class="paragraph">
<p><font o="953">Spring Cloud还允许您通过使用<code i="514">@RibbonClient</code>声明其他配置（位于<code i="513">RibbonClientConfiguration</code>之上）来完全控制客户端。</font><font o="954">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
@RibbonClient(name = "foo", configuration = FooConfiguration.class)
public class TestConfiguration {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="955">在这种情况下，客户端由<code i="515">RibbonClientConfiguration</code>中的组件与<code i="516">FooConfiguration</code>中的任何组件组成（后者通常将覆盖前者）。</font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="956">警告</font></div>
</td>
<td class="content"><font o="957">
<code i="517">FooConfiguration</code>必须是<code i="518">@Configuration</code>，但要注意主应用程序上下文不属于<code i="519">@ComponentScan</code>，否则将由<code i="520">@RibbonClients</code>所有者共享。</font><font o="958">如果您使用<code i="521">@ComponentScan</code>（或<code i="522">@SpringBootApplication</code>），则需要采取措施避免包含（例如将其放在一个单独的，不重叠的包中，或者指定要在<code i="523">@ComponentScan</code>）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="959">Spring Cloud Netflix默认提供以下功能区（<code i="524">BeanType</code> beanName：<code i="525">ClassName</code>）的bean：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="960"><code i="526">IClientConfig</code> ribbonClientConfig：<code i="527">DefaultClientConfigImpl</code></font></p>
</li>
<li>
<p><font o="961"><code i="528">IRule</code> ribbonRule：<code i="529">ZoneAvoidanceRule</code></font></p>
</li>
<li>
<p><font o="962"><code i="530">IPing</code> ribbonPing：<code i="531">NoOpPing</code></font></p>
</li>
<li>
<p><font o="963"><code i="532">ServerList&lt;Server&gt;</code> ribbonServerList：<code i="533">ConfigurationBasedServerList</code></font></p>
</li>
<li>
<p><font o="964"><code i="534">ServerListFilter&lt;Server&gt;</code> ribbonServerListFilter：<code i="535">ZonePreferenceServerListFilter</code></font></p>
</li>
<li>
<p><font o="965"><code i="536">ILoadBalancer</code> ribbonLoadBalancer：<code i="537">ZoneAwareLoadBalancer</code></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="966">创建一个类型的bean并将其放置在<code i="538">@RibbonClient</code>配置（例如上面的<code i="539">FooConfiguration</code>）中）允许您覆盖所描述的每个bean。</font><font o="967">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class FooConfiguration {
    @Bean
    public IPing ribbonPing(IClientConfig config) {
        return new PingUrl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="968">这将<code i="541">PingUrl</code>替换为<code i="540">NoOpPing</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_ribbon_with_eureka"><font o="969">使用Ribbon与Eureka</font></h3>
<div class="paragraph">
<p><font o="970">当Eureka与Ribbon结合使用时，<code i="542">ribbonServerList</code>的扩展名<code i="543">DiscoveryEnabledNIWSServerList</code>将被覆盖，从Eureka填充服务器列表。</font><font o="971">它还将<code i="544">IPing</code>接口替换为<code i="545">NIWSDiscoveryPing</code>，委托给Eureka以确定服务器是否已启动。</font><font o="972">默认情况下安装的<code i="546">ServerList</code>是一个<code i="547">DomainExtractingServerList</code>，其目的是使物理元数据可用于负载平衡器，而不使用AWS AMI元数据（Netflix依赖于此）。</font><font o="973">默认情况下，服务器列表将使用实例元数据（如远程客户端集合<code i="548">eureka.instance.metadataMap.zone</code>）中提供的“区域”信息构建，如果缺少，则可以使用服务器主机名中的域名作为代理用于区域（如果设置了标志<code i="549">approximateZoneFromHostname</code>）。</font><font o="974">一旦区域信息可用，它可以在<code i="550">ServerListFilter</code>中使用。</font><font o="975">默认情况下，它将用于定位与客户端相同区域的服务器，因为默认值为<code i="551">ZonePreferenceServerListFilter</code>。</font><font o="976">默认情况下，客户端的区域与远程实例相同，即通过<code i="552">eureka.instance.metadataMap.zone</code>确定。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="977">注意</font></div>
</td>
<td class="content"><font o="978">
设置客户端区域的正统“archaius”方式是通过名为“@zone”的配置属性，如果可用，Spring Cloud将优先使用所有其他设置（请注意，该键必须被引用）在YAML配置中）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="979">注意</font></div>
</td>
<td class="content"><font o="980">
如果没有其他的区域数据源，则基于客户端配置（与实例配置相反）进行猜测。</font><font o="981">我们将<code i="553">eureka.client.availabilityZones</code>（从区域名称映射到区域列表），并拉出实例本身区域的第一个区域（即<code i="554">eureka.client.region</code>，默认为“us-east-1”为与本机Netflix的兼容性）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-ribbon-without-eureka"><font o="982">示例：如何使用Ribbon不使用Eureka</font></h3>
<div class="paragraph">
<p><font o="983">Eureka是一种方便的方法来抽象远程服务器的发现，因此您不必在客户端中对其URL进行硬编码，但如果您不想使用它，Ribbon和Feign仍然很适用的。</font><font o="984">假设您已经为“商店”申明了<code i="555">@RibbonClient</code>，并且Eureka未被使用（甚至不在类路径上）。</font><font o="985">Ribbon客户端默认为已配置的服务器列表，您可以提供这样的配置</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="986">application.yml</font></div>
<div class="content">
<pre class="notranslate">stores:
  ribbon:
    listOfServers: example.com,google.com</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_disable_eureka_use_in_ribbon"><font o="987">示例：在Ribbon中禁用Eureka使用</font></h3>
<div class="paragraph">
<p><font o="988">设置属性<code i="556">ribbon.eureka.enabled = false</code>将明确禁用在Ribbon中使用Eureka。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="989">application.yml</font></div>
<div class="content">
<pre class="notranslate">ribbon:
  eureka:
   enabled: false</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_ribbon_api_directly"><font o="990">直接使用Ribbon API</font></h3>
<div class="paragraph">
<p><font o="991">您也可以直接使用<code i="557">LoadBalancerClient</code>。</font><font o="992">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public class MyClass {
    @Autowired
    private LoadBalancerClient loadBalancer;

    public void doStuff() {
        ServiceInstance instance = loadBalancer.choose("stores");
        URI storesUri = URI.create(String.format("http://%s:%s", instance.getHost(), instance.getPort()));
        // ... do something with the URI
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-feign"><font o="993">声明性REST客户端：Feign</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="javascript:;"><font o="994">Feign</font></a><font o="994">是一个声明式的Web服务客户端。</font><font o="995">这使得Web服务客户端的写入更加方便 </font><font o="996">要使用Feign创建一个界面并对其进行注释。</font><font o="997">它具有可插入的注释支持，包括Feign注释和JAX-RS注释。</font><font o="998">Feign还支持可插拔编码器和解码器。</font><font o="999">Spring Cloud添加了对Spring MVC注释的支持，并在Spring Web中使用默认使用的相同<code i="558">HttpMessageConverters</code>。</font><font o="1000">Spring Cloud集成Ribbon和Eureka以在使用Feign时提供负载平衡的http客户端。</font></p>
</div>
<div class="paragraph">
<p><font o="1001" class="">示例Spring Boot应用程序</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
@ComponentScan
@EnableAutoConfiguration
@EnableEurekaClient
@EnableFeignClients
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><font o="1002">StoreClient.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@FeignClient("stores")
public interface StoreClient {
    @RequestMapping(method = RequestMethod.GET, value = "/stores")
    List&lt;Store&gt; getStores();

    @RequestMapping(method = RequestMethod.POST, value = "/stores/{storeId}", consumes = "application/json")
    Store update(@PathVariable("storeId") Long storeId, Store store);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1003">在<code i="559">@FeignClient</code>注释中，String值（以上“存储”）是一个任意的客户端名称，用于创建Ribbon负载平衡器（</font><a href="#spring-cloud-ribbon"><font o="1003">有关Ribbon支持的详细信息，</font></a><font o="1003">请参阅</font><a href="#spring-cloud-ribbon"><font o="1003">下文</font></a><font o="1003">））。</font><font o="1004">您还可以使用<code i="560">url</code>属性（绝对值或仅主机名）指定URL。</font><font o="1005">应用程序上下文中的bean的名称是该接口的完全限定名称。</font><font o="1006">还创建了一个别名，它是'name'属性加'FeignClient'。</font><font o="1007">对于上面的示例，可以使用<code i="561">@Qualifier("storesFeignClient")</code>来引用该bean。</font></p>
</div>
<div class="paragraph">
<p><font o="1008">以上的Ribbon客户端将要发现“商店”服务的物理地址。</font><font o="1009">如果您的应用程序是Eureka客户端，那么它将解决Eureka服务注册表中的服务。</font><font o="1010">如果您不想使用Eureka，您可以简单地配置外部配置中的服务器列表（</font><a href="#spring-cloud-ribbon-without-eureka"><font o="1010">例如，</font></a><font o="1010">参见
 </font><a href="#spring-cloud-ribbon-without-eureka"><font o="1010">上文</font></a><font o="1010">）。</font></p>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-overriding-defaults"><font o="1011">覆盖Feign默认值</font></h3>
<div class="paragraph">
<p><font o="1012">Spring Cloud的Feign支持中的中心概念是指定的客户端。</font><font o="1013">每个假装客户端都是组合的组件的一部分，它们一起工作以按需联系远程服务器，并且该集合具有您将其作为应用程序开发人员使用<code i="562">@FeignClient</code>注释的名称。</font><font o="1014">Spring Cloud使用<code i="564">FeignClientsConfiguration</code>为每个命名的客户端按需要创建一个新的集合<code i="563">ApplicationContext</code>。</font><font o="1015">这包含（除其他外）<code i="565">feign.Decoder</code>，<code i="566">feign.Encoder</code>和<code i="567">feign.Contract</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="1016">Spring Cloud可以通过使用<code i="569">@FeignClient</code>声明额外的配置（<code i="568">FeignClientsConfiguration</code>之外）来完全控制假客户端。</font><font o="1017">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@FeignClient(name = "stores", configuration = FooConfiguration.class)
public interface StoreClient {
    //..
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1018">在这种情况下，客户端由<code i="570">FeignClientsConfiguration</code>中已经存在的组件与<code i="571">FooConfiguration</code>中的任何组件组成（后者将覆盖前者）。</font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1019">警告</font></div>
</td>
<td class="content"><font o="1020">
<code i="572">FooConfiguration</code>必须是<code i="573">@Configuration</code>，但请注意，对于主应用程序上下文，它不在<code i="574">@ComponentScan</code>中，否则将用于每个<code i="575">@FeignClient</code>。</font><font o="1021">如果您使用<code i="576">@ComponentScan</code>（或<code i="577">@SpringBootApplication</code>），则需要采取措施避免包含（例如将其放在一个单独的，不重叠的包中，或者指定要在<code i="578">@ComponentScan</code>）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1022">注意</font></div>
</td>
<td class="content"><font o="1023">
<code i="579">serviceId</code>属性现在已被弃用，有利于<code i="580">name</code>属性。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1024">警告</font></div>
</td>
<td class="content"><font o="1025">
以前，使用<code i="581">url</code>属性，不需要<code i="582">name</code>属性。</font><font o="1026">现在需要使用<code i="583">name</code>。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1027"><code i="584">name</code>和<code i="585">url</code>属性支持占位符。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@FeignClient(name = "${feign.name}", url = "${feign.url}")
public interface StoreClient {
    //..
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1028">Spring Cloud Netflix默认为feign（<code i="586">BeanType</code> beanName：<code i="587">ClassName</code>）提供以下bean：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1029"><code i="588">Decoder</code> feignDecoder：<code i="589">ResponseEntityDecoder</code>（其中包含<code i="590">SpringDecoder</code>）</font></p>
</li>
<li>
<p><font o="1030"><code i="591">Encoder</code> feignEncoder：<code i="592">SpringEncoder</code></font></p>
</li>
<li>
<p><font o="1031"><code i="593">Logger</code> feignLogger：<code i="594">Slf4jLogger</code></font></p>
</li>
<li>
<p><font o="1032"><code i="595">Contract</code> feignContract：<code i="596">SpringMvcContract</code></font></p>
</li>
<li>
<p><font o="1033"><code i="597">Feign.Builder</code> feignBuilder：<code i="598">HystrixFeign.Builder</code></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1034">Spring Cloud Netflix </font><font o="1034">默认情况下</font><em><font o="1034">不</font></em><font o="1034">提供以下bean，但是仍然从应用程序上下文中查找这些类型的bean以创建feign客户端：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Logger.Level</code></p>
</li>
<li>
<p><code>Retryer</code></p>
</li>
<li>
<p><code>ErrorDecoder</code></p>
</li>
<li>
<p><code>Request.Options</code></p>
</li>
<li>
<p><code>Collection&lt;RequestInterceptor&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1035">创建一个类型的bean并将其放置在<code i="599">@FeignClient</code>配置（例如上面的<code i="600">FooConfiguration</code>）中）允许您覆盖所描述的每个bean。</font><font o="1036">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class FooConfiguration {
    @Bean
    public Contract feignContract() {
        return new feign.Contract.Default();
    }

    @Bean
    public BasicAuthRequestInterceptor basicAuthRequestInterceptor() {
        return new BasicAuthRequestInterceptor("user", "password");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1037">将<code i="601">SpringMvcContract</code>替换为<code i="602">feign.Contract.Default</code>，并将<code i="603">RequestInterceptor</code>添加到<code i="604">RequestInterceptor</code>的集合中。</font></p>
</div>
<div class="paragraph">
<p><font o="1038">可以在<code i="605">@EnableFeignClients</code>属性<code i="606">defaultConfiguration</code>中以与上述类似的方式指定默认配置。</font><font o="1039">不同之处在于，此配置将适用于</font><em><font o="1039">所有</font></em><font o="1039">假客户端。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-hystrix"><font o="1040">Feign Hystrix支持</font></h3>
<div class="paragraph">
<p><font o="1041">如果Hystrix在类路径上，默认情况下Feign将使用断路器包装所有方法。</font><font o="1042">还可以返回<code i="607">com.netflix.hystrix.HystrixCommand</code>。</font><font o="1043">这允许您使用无效模式（调用<code i="608">.toObservable()</code>或<code i="609">.observe()</code>或异步使用（调用<code i="610">.queue()</code>））。</font></p>
</div>
<div class="paragraph">
<p><font o="1044">要禁用Hystrix支持Feign，请设置<code i="611">feign.hystrix.enabled=false</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="1045">要在每个客户端基础上禁用Hystrix支持，使用“prototype”范围创建一个vanilla <code i="612">Feign.Builder</code>，例如：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class FooConfiguration {
    @Bean
	@Scope("prototype")
	public Feign.Builder feignBuilder() {
		return Feign.builder();
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-hystrix-fallback"><font o="1046">Feign Hystrix回退</font></h3>
<div class="paragraph">
<p><font o="1047">Hystrix支持回退的概念：当电路打开或出现错误时执行的默认代码路径。</font><font o="1048">要为给定的<code i="613">@FeignClient</code>启用回退，请将<code i="614">fallback</code>属性设置为实现回退的类名。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@FeignClient(name = "hello", fallback = HystrixClientFallback.class)
protected interface HystrixClient {
    @RequestMapping(method = RequestMethod.GET, value = "/hello")
    Hello iFailSometimes();
}

static class HystrixClientFallback implements HystrixClient {
    @Override
    public Hello iFailSometimes() {
        return new Hello("fallback");
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1049">警告</font></div>
</td>
<td class="content"><font o="1050">
在Feign中执行回退以及如何Hystrix回退工作有一个局限性。</font><font o="1051">当前返回<code i="615">com.netflix.hystrix.HystrixCommand</code>和<code i="616">rx.Observable</code>的方法目前不支持回退。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-inheritance"><font o="1052">Feign继承支持</font></h3>
<div class="paragraph">
<p><font o="1053">Feign通过单继承接口支持样板apis。</font><font o="1054">这样就可以将常用操作分成方便的基本界面。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1055">UserService.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface UserService {

    @RequestMapping(method = RequestMethod.GET, value ="/users/{id}")
    User getUser(@PathVariable("id") long id);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><font o="1056">UserResource.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@RestController
public class UserResource implements UserService {

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><font o="1057">UserClient.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">package project.user;

@FeignClient("users")
public interface UserClient extends UserService {

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1058">注意</font></div>
</td>
<td class="content"><font o="1059">
通常不建议在服务器和客户端之间共享接口。</font><font o="1060">它引入紧耦合，实际上并不适用于当前形式的Spring MVC（方法参数映射不被继承）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_feign_request_response_compression"><font o="1061">Feign请求/响应压缩</font></h3>
<div class="paragraph">
<p><font o="1062">您可以考虑启用针对您的Feign请求的请求或响应GZIP压缩。</font><font o="1063">您可以通过启用其中一个属性来执行此操作：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">feign.compression.request.enabled=true
feign.compression.response.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1064">Feign请求压缩为您提供与您为Web服务器设置的设置相似的设置：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">feign.compression.request.enabled=true
feign.compression.request.mime-types=text/xml,application/xml,application/json
feign.compression.request.min-request-size=2048</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1065">这些属性可以让您对压缩介质类型和最小请求阈值长度有选择性。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_feign_logging"><font o="1066">Feign日志记录</font></h3>
<div class="paragraph">
<p><font o="1067">为每个创建的Feign客户端创建一个记录器。</font><font o="1068">默认情况下，记录器的名称是用于创建Feign客户端的接口的完整类名。</font><font o="1069">Feign日志记录仅响应<code i="617">DEBUG</code>级别。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1070">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">logging.level.project.user.UserClient: DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1071">您可以为每个客户端配置的<code i="618">Logger.Level</code>对象告诉Feign记录多少。</font><font o="1072">选择是：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1073"><code i="619">NONE</code>，无记录（</font><strong><font o="1073">DEFAULT</font></strong><font o="1073">）。</font></p>
</li>
<li>
<p><font o="1074"><code i="620">BASIC</code>，只记录请求方法和URL以及响应状态代码和执行时间。</font></p>
</li>
<li>
<p><font o="1075"><code i="621">HEADERS</code>，记录基本信息以及请求和响应标头。</font></p>
</li>
<li>
<p><font o="1076"><code i="622">FULL</code>，记录请求和响应的头文件，正文和元数据。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1077">例如，以下将<code i="623">Logger.Level</code>设置为<code i="624">FULL</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
public class FooConfiguration {
    @Bean
    Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_configuration_archaius"><font o="1078">外部配置：Archaius</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="javascript:;"><font></font></a><font o="1079">Netflix客户端配置库是</font><a href="javascript:;"><font o="1079">Archaius</font></a><font o="1079">。</font><font o="1080">它是所有Netflix OSS组件用于配置的库。</font><font o="1081">Archaius是</font><a href="javascript:;"><font o="1081">Apache Commons配置</font></a><font o="1081">项目的</font><a href="javascript:;"><font o="1081">扩展</font></a><font o="1081">。</font><font o="1082">它允许通过轮询源进行更改或将源更改推送到客户端来进行配置更新。</font><font o="1083">Archaius使用Dynamic &lt;Type&gt; Property类作为属性的句柄。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1084">Archaius示例</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">class ArchaiusTest {
    DynamicStringProperty myprop = DynamicPropertyFactory
            .getInstance()
            .getStringProperty("my.prop");

    void doSomething() {
        OtherClass.someMethod(myprop.get());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1085">Archaius具有自己的一组配置文件和加载优先级。</font><font o="1086">Spring应用程序通常不应直接使用Archaius，但本地仍然需要配置Netflix工具。</font><font o="1087">Spring Cloud有一个Spring环境桥，所以Archaius可以从Spring环境读取属性。</font><font o="1088">这允许Spring Boot项目使用正常的配置工具链，同时允许他们在文档中大部分配置Netflix工具。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_router_and_filter_zuul"><font o="1089">路由器和过滤器：Zuul</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1090">路由在微服务体系结构的一个组成部分。</font><font o="1091">例如，<code i="625">/</code>可以映射到您的Web应用程序，<code i="626">/api/users</code>映射到用户服务，<code i="627">/api/shop</code>映射到商店服务。</font><a href="javascript:;"><font o="1092">Zuul</font></a><font o="1092">是Netflix的基于JVM的路由器和服务器端负载均衡器。</font></p>
</div>
<div class="paragraph">
<p><a href="javascript:;"><font o="1093">Netflix使用Zuul</font></a><font o="1093">以下内容：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1094">认证</font></p>
</li>
<li>
<p><font o="1095">洞察</font></p>
</li>
<li>
<p><font o="1096">压力测试</font></p>
</li>
<li>
<p><font o="1097">金丝雀测试</font></p>
</li>
<li>
<p><font o="1098">动态路由</font></p>
</li>
<li>
<p><font o="1099">服务迁移</font></p>
</li>
<li>
<p><font o="1100">负载脱落</font></p>
</li>
<li>
<p><font o="1101">安全</font></p>
</li>
<li>
<p><font o="1102">静态响应处理</font></p>
</li>
<li>
<p><font o="1103">主动/主动流量管理</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1104">Zuul的规则引擎允许基本上以任何JVM语言编写规则和过滤器，内置对Java和Groovy的支持。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1105">注意</font></div>
</td>
<td class="content"><font o="1106">
配置属性<code i="628">zuul.max.host.connections</code>已被两个新属性<code i="629">zuul.host.maxTotalConnections</code>和<code i="630">zuul.host.maxPerRouteConnections</code>替换，分别默认为200和20。
</font></td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="netflix-zuul-reverse-proxy"><font o="1107">嵌入Zuul反向代理</font></h3>
<div class="paragraph">
<p><font o="1108">Spring Cloud已经创建了一个嵌入式Zuul代理，以简化UI应用程序想要代理对一个或多个后端服务的呼叫的非常常见的用例的开发。</font><font o="1109">此功能对于用户界面对其所需的后端服务进行代理是有用的，避免了对所有后端独立管理CORS和验证问题的需求。</font></p>
</div>
<div class="paragraph">
<p><font o="1110">要启用它，请使用<code i="631">@EnableZuulProxy</code>注释Spring Boot主类，并将本地调用转发到相应的服务。</font><font o="1111">按照惯例，具有ID“用户”的服务将接收来自位于<code i="632">/users</code>（具有前缀stripped）的代理的请求。</font><font o="1112">代理使用Ribbon来定位要通过发现转发的实例，并且所有请求都以hystrix命令执行，所以故障将显示在Hystrix指标中，一旦电路打开，代理将不会尝试联系服务。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1113">注意</font></div>
</td>
<td class="content"><font o="1114">
Zuul启动器不包括发现客户端，因此对于基于服务ID的路由，您还需要在类路径中提供其中一个路由（例如Eureka）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1115">要跳过自动添加的服务，请将<code i="633">zuul.ignored-services</code>设置为服务标识模式列表。</font><font o="1116">如果一个服务匹配一个被忽略的模式，而且包含在明确配置的路由映射中，那么它将被无符号。</font><font o="1117">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1118">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  ignoredServices: '*'
  routes:
    users: /myusers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1119">在此示例中，</font><strong><font o="1119">除</font></strong><font o="1119"> “用户” </font><strong><font o="1119">之外</font></strong><font o="1119">，所有服务都被忽略</font><font o="1119">。</font></p>
</div>
<div class="paragraph">
<p><font o="1120">要扩充或更改代理路由，可以添加如下所示的外部配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1121">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    users: /myusers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1122">这意味着对“/ myusers”的http呼叫转发到“用户”服务（例如“/ myusers / 101”转发到“/ 101”）。</font></p>
</div>
<div class="paragraph">
<p><font o="1123">要获得对路由的更细粒度的控制，您可以独立地指定路径和serviceId：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1124">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      serviceId: users_service</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1125">这意味着对“/ myusers”的http呼叫转发到“users_service”服务。</font><font o="1126">路由必须有一个“路径”，可以指定为蚂蚁样式模式，所以“/ myusers / *”只匹配一个级别，但“/ myusers / **”分层匹配。</font></p>
</div>
<div class="paragraph">
<p><font o="1127">后端的位置可以被指定为“serviceId”（用于发现的服务）或“url”（对于物理位置），例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1128">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      url: http://example.com/users_service</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1129">这些简单的URL路由不会被执行为<code i="634">HystrixCommand</code>，也不能使用Ribbon对多个URL进行负载平衡。</font><font o="1130">为此，请指定service-route并为serviceId配置Ribbon客户端（目前需要在Ribbon中禁用Eureka支持：详见</font><a href="#spring-cloud-ribbon-without-eureka"><font o="1130">上文</font></a><font o="1130">），例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1131">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">zuul:
  routes:
    users:
      path: /myusers/**
      serviceId: users

ribbon:
  eureka:
    enabled: false

users:
  ribbon:
    listOfServers: example.com,google.com</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1132">您可以使用regexmapper在serviceId和路由之间提供约定。</font><font o="1133">它使用名为group的正则表达式从serviceId中提取变量并将它们注入到路由模式中。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1134">ApplicationConfiguration.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
public PatternServiceRouteMapper serviceRouteMapper() {
    return new PatternServiceRouteMapper(
        "(?&lt;name&gt;^.+)-(?&lt;version&gt;v.+$)",
        "${version}/${name}");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1135">这意味着serviceId“myusers-v1”将被映射到路由“/ v1 / myusers / **”。</font><font o="1136">任何正则表达式都被接受，但所有命名组都必须存在于servicePattern和routePattern中。</font><font o="1137">如果servicePattern与serviceId不匹配，则使用默认行为。</font><font o="1138">在上面的示例中，serviceId“myusers”将被映射到路由“/ myusers / **”（检测不到版本）此功能默认禁用，仅适用于已发现的服务。</font></p>
</div>
<div class="paragraph">
<p><font o="1139">要为所有映射添加前缀，请将<code i="635">zuul.prefix</code>设置为一个值，例如<code i="636">/api</code>。</font><font o="1140">默认情况下，转发请求之前，从请求中删除代理前缀（使用<code i="637">zuul.stripPrefix=false</code>切换此行为）。</font><font o="1141">您还可以关闭从各路线剥离服务特定的前缀，例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1142">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      stripPrefix: false</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1143">在本示例中，对“/ myusers / 101”的请求将转发到“/ myusers / 101”上的“users”服务。</font></p>
</div>
<div class="paragraph">
<p><font o="1144"><code i="638">zuul.routes</code>条目实际上绑定到类型为<code i="639">ZuulProperties</code>的对象。</font><font o="1145">如果您查看该对象的属性，您将看到它还具有“可重试”标志。</font><font o="1146">将该标志设置为“true”使Ribbon客户端自动重试失败的请求（如果需要，可以使用Ribbon客户端配置修改重试操作的参数）。</font></p>
</div>
<div class="paragraph">
<p><font o="1147">默认情况下，将<code i="640">X-Forwarded-Host</code>标头添加到转发的请求中。</font><font o="1148">要关闭set <code i="641">zuul.addProxyHeaders = false</code>。</font><font o="1149">默认情况下，前缀路径被删除，对后端的请求会拾取一个标题“X-Forwarded-Prefix”（上述示例中的“/ myusers”）。</font></p>
</div>
<div class="paragraph">
<p><font o="1150">如果您设置默认路由（“/”），例如<code i="643">zuul.route.home:
/</code>将路由所有流量（即“/ **”）到“home”服务，则具有<code i="642">@EnableZuulProxy</code>的应用程序可以充当独立服务器。</font></p>
</div>
<div class="paragraph">
<p><font o="1151">如果需要更细粒度的忽略，可以指定要忽略的特定模式。</font><font o="1152">在路由位置处理开始时评估这些模式，这意味着前缀应包含在模式中以保证匹配。</font><font o="1153">忽略的模式跨越所有服务，并取代任何其他路由规范。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1154">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  ignoredPatterns: /**/admin/**
  routes:
    users: /myusers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1155">这意味着诸如“/ myusers / 101”的所有呼叫将被转发到“用户”服务上的“/ 101”。</font><font o="1156">但是包含“/ admin /”的呼叫将无法解决。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_cookies_and_sensitive_headers"><font o="1157">Cookie和敏感标题</font></h3>
<div class="paragraph">
<p><font o="1158">在同一个系统中的服务之间共享标题是可行的，但是您可能不希望敏感标头泄漏到外部服务器的下游。</font><font o="1159">您可以在路由配置中指定被忽略头文件列表。</font><font o="1160">Cookies起着特殊的作用，因为它们在浏览器中具有明确的语义，并且它们总是被视为敏感的。</font><font o="1161">如果代理的消费者是浏览器，则下游服务的cookie也会导致用户出现问题，因为它们都被混淆（所有下游服务看起来都是来自同一个地方）。</font></p>
</div>
<div class="paragraph">
<p><font o="1162">如果您对服务的设计非常谨慎，例如，如果只有一个下游服务设置了Cookie，那么您可能可以让他们从后台一直到调用者。</font><font o="1163">此外，如果您的代理设置Cookie，并且所有后端服务都是同一系统的一部分，那么简单地共享它们就可以自然（例如使用Spring Session将它们链接到一些共享状态）。</font><font o="1164">除此之外，由下游服务设置的任何Cookie可能对呼叫者来说都不是很有用，因此建议您将（至少）“Set-Cookie”和“Cookie”设置为不属于您的域名。</font><font o="1165">即使</font><strong><font o="1165">是</font></strong><font o="1165">属于您域名</font><font o="1165">的路线</font><font o="1165">，请尝试仔细考虑允许Cookie在代理之间流动的含义。</font></p>
</div>
<div class="paragraph">
<p><font o="1166">灵敏头可以配置为每个路由的逗号分隔列表，例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1167">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      sensitiveHeaders: Cookie,Set-Cookie,Authorization
      url: https://downstream</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1168">也可以通过设置<code i="644">zuul.sensitiveHeaders</code>来全局设置敏感标题。</font><font o="1169">如果在路由上设置了<code i="645">sensitiveHeaders</code>，这将覆盖全局<code i="646">sensitiveHeaders</code>设置。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1170">注意</font></div>
</td>
<td class="content"><font o="1171">
这是<code i="647">sensitiveHeaders</code>的默认值，因此您不需要设置它，除非您希望它不同。</font><font o="1172">注意这是Spring Cloud Netflix 1.1中的新功能（在1.0中，用户无法控制标题，所有Cookie都在两个方向上流动）。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1173">除了每个路由的敏感标头，您还可以为与下游服务交互期间应该丢弃（请求和响应）的值设置全局值<code i="648">zuul.ignoredHeaders</code>。</font><font o="1174">默认情况下，如果Spring安全性不在类路径上，则它们是空的，否则它们被初始化为Spring安全性所指定的一组众所周知的“安全”头（例如涉及缓存）。</font><font o="1175">在这种情况下的假设是下游服务可能也添加这些头，我们希望代理的值。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_the_routes_endpoint"><font o="1176">路线端点</font></h3>
<div class="paragraph">
<p><font o="1177">如果您使用Spring Boot Actuator使用<code i="649">@EnableZuulProxy</code>，则将启用（默认情况下）另一个端点，通过HTTP可用作<code i="650">/routes</code>。</font><font o="1178">到此端点的GET将返回映射路由的列表。</font><font o="1179">POST将强制刷新现有路由（例如，如果服务目录中有更改）。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1180">注意</font></div>
</td>
<td class="content"><font o="1181">
路由应自动响应服务目录中的更改，但POST到/路由是强制更改立即发生的一种方式。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_strangulation_patterns_and_local_forwards"><font o="1182">扼杀模式和本地Forwards</font></h3>
<div class="paragraph">
<p><font o="1183">迁移现有应用程序或API时的常见模式是“扼杀”旧端点，用不同的实现慢慢替换它们。</font><font o="1184">Zuul代理是一个有用的工具，因为您可以使用它来处理来自旧端点的客户端的所有流量，但将一些请求重定向到新端点。</font></p>
</div>
<div class="paragraph">
<p><font o="1185">示例配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1186">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    first:
      path: /first/**
      url: http://first.example.com
    second:
      path: /second/**
      url: forward:/second
    third:
      path: /third/**
      url: forward:/3rd
    legacy:
      path: /**
      url: http://legacy.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1187">在这个例子中，我们扼杀了“遗留”应用程序，该应用程序映射到所有与其他模式不匹配的请求。</font><font o="1188">已将<code i="651">/first/**</code>中的路径提取到带有外部URL的新服务中。</font><font o="1189">而<code i="652">/second/**</code>中的路径是forwared，因此可以在本地进行处理，例如正常Spring <code i="653">@RequestMapping</code>。</font><font o="1190"><code i="654">/third/**</code>中的路径也被转发，但使用不同的前缀（即<code i="655">/third/foo</code>转发到<code i="656">/3rd/foo</code>）。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1191">注意</font></div>
</td>
<td class="content"><font o="1192">
被忽略的模式并不完全被忽略，它们只是不被代理处理（因此它们也被有效地转发到本地）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_uploading_files_through_zuul"><font o="1193">通过Zuul上传文件</font></h3>
<div class="paragraph">
<p><font o="1194">如果您<code i="657">@EnableZuulProxy</code>您可以使用代理路径上传文件，只要文件很小就可以使用。</font><font o="1195">对于大文件，有一个替代路径绕过“/ zuul / *”中的Spring <code i="658">DispatcherServlet</code>（以避免多部分处理）。</font><font o="1196">也就是说，如果<code i="659">zuul.routes.customers=/customers/**</code>则可以将大文件发送到“/ zuul / customers / *”。</font><font o="1197">servlet路径通过<code i="660">zuul.servletPath</code>进行外部化。</font><font o="1198">如果代理路由引导您通过Ribbon负载均衡器，例如，超大文件也将需要提升超时设置</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1199">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds: 60000
ribbon:
  ConnectTimeout: 3000
  ReadTimeout: 60000</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1200">请注意，要使用大型文件进行流式传输，您需要在请求中使用分块编码（某些浏览器默认情况下不会执行）。</font><font o="1201">例如在命令行：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ curl -v -H "Transfer-Encoding: chunked" \
    -F "<a href="email-protection.html" class="__cf_email__" data-cfemail="a2c4cbcec79fe2cfdbcec3d0c5c78ccbd1cd">[email&#160;protected]</a>" localhost:9999/zuul/simple/file</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plain_embedded_zuul"><font o="1202">普通嵌入Zuul</font></h3>
<div class="paragraph">
<p><font o="1203">如果您使用<code i="661">@EnableZuulServer</code>（而不是<code i="662">@EnableZuulProxy</code>），您也可以选择性地运行Zuul服务器而不进行代理，或选择性地切换代理平台的部分。</font><font o="1204">您添加到类型为<code i="663">ZuulFilter</code>的应用程序的任何bean将自动安装，与<code i="664">@EnableZuulProxy</code>一样，但不会自动添加任何代理过滤器。</font></p>
</div>
<div class="paragraph">
<p><font o="1205">在这种情况下，仍然通过配置“zuul.routes。*”来指定进入Zuul服务器的路由，但是没有服务发现，没有代理，所以“serviceId”和“url”设置将被忽略。</font><font o="1206">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1207">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml"> zuul:
  routes:
    api: /api/**</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1208">将“/ api / **”中的所有路径映射到Zuul过滤器链。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_disable_zuul_filters"><font o="1209">禁用Zuul筛选器</font></h3>
<div class="paragraph">
<p><font o="1210">Spring Cloud Zuul在代理和服务器模式下默认启用了多个<code i="665">ZuulFilter</code> bean。</font><font o="1211">有关</font><font o="1211">启用的可能过滤器，</font><font o="1211">请参阅</font><a href="javascript:;"><font o="1211">zuul过滤器包</font></a><font o="1211">。</font><font o="1212">如果要禁用它，只需设置<code i="666">zuul.&lt;SimpleClassName&gt;.&lt;filterType&gt;.disable=true</code>。</font><font o="1213">按照惯例，<code i="667">filters</code>之后的包是Zuul过滤器类型。</font><font o="1214">例如，禁用<code i="668">org.springframework.cloud.netflix.zuul.filters.post.SendResponseFilter</code>设置<code i="669">zuul.SendResponseFilter.post.disable=true</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_polyglot_support_with_sidecar"><font o="1215">Polyglot支持与Sidecar</font></h3>
<div class="paragraph">
<p><font o="1216">你有没有非jvm的语言你想要利用Eureka，Ribbon和配置服务器？</font><font o="1217">Spring Cloud Netflix Sidecar的灵感来自于
 </font><a href="javascript:;"><font o="1217">Netflix Prana</font></a><font o="1217">。</font><font o="1218">它包含一个简单的http api来获取给定服务的所有实例（即主机和端口）。</font><font o="1219">您还可以通过从Eureka获取其路由条目的嵌入式Zuul代理来代理服务调用。</font><font o="1220">可以通过主机查找或通过Zuul代理访问Spring Cloud Config服务器。</font><font o="1221">非jvm应用程序应该执行健康检查，以便Sidecar可以向应用程序启动或关闭时向eureka报告。</font></p>
</div>
<div class="paragraph">
<p><font o="1222">要启用Sidecar，请使用<code i="670">@EnableSidecar</code>创建Spring Boot应用程序。</font><font o="1223">此注释包括<code i="671">@EnableCircuitBreaker</code>，<code i="672">@EnableDiscoveryClient</code>和<code i="673">@EnableZuulProxy</code>。</font><font o="1224">在与非jvm应用程序相同的主机上运行生成的应用程序。</font></p>
</div>
<div class="paragraph">
<p><font o="1225">配置侧车将<code i="674">sidecar.port</code>和<code i="675">sidecar.health-uri</code>添加到<code i="676">application.yml</code>。</font><font o="1226"><code i="677">sidecar.port</code>属性是非jvm应用程序正在侦听的端口。</font><font o="1227">这是因为Sidecar可以使用Eureka正确注册该应用程序。</font><font o="1228"><code i="678">sidecar.health-uri</code>是一个可以在非jvm应用程序上访问的uri，它模仿Spring Boot健康指标。</font><font o="1229">它应该返回一个json文档，如下所示：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1230">健康-URI文档</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-json" data-lang="json">{
  "status":"UP"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1231">以下是Sidecar应用程序的application.yml示例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1232">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">server:
  port: 5678
spring:
  application:
    name: sidecar

sidecar:
  port: 8000
  health-uri: http://localhost:8000/health.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1233"><code i="679">DiscoveryClient.getInstances()</code>方法的api为<code i="680">/hosts/{serviceId}</code>。</font><font o="1234">以下是针对不同主机返回两个实例的<code i="681">/hosts/customers</code>的示例响应。</font><font o="1235">这个api可以通过<code i="682"><a href="javascript:;" class="bare">http://localhost:5678/hosts/{serviceId}</a></code>访问非jvm应用程序（如果sidecar在端口5678）。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="1236">/主机/客户</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-json" data-lang="json">[
    {
        "host": "myhost",
        "port": 9000,
        "uri": "http://myhost:9000",
        "serviceId": "CUSTOMERS",
        "secure": false
    },
    {
        "host": "myhost2",
        "port": 9000,
        "uri": "http://myhost2:9000",
        "serviceId": "CUSTOMERS",
        "secure": false
    }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1237">Zuul代理自动将eureka中已知的每个服务的路由添加到<code i="683">/&lt;serviceId&gt;</code>，因此客户服务可在<code i="684">/customers</code>获得。</font><font o="1238">非jvm应用程序可以通过<code i="685"><a href="javascript:;" class="bare">http://localhost:5678/customers</a></code>访问客户服务（假设侧面正在侦听端口5678）。</font></p>
</div>
<div class="paragraph">
<p><font o="1239">如果配置服务器注册了Eureka，则非jvm应用程序可以通过Zuul代理访问它。</font><font o="1240">如果ConfigServer的serviceId为<code i="686">configserver</code>，Sidecar为5678端口，则可以在
 </font><a href="javascript:;" class="bare"><font o="1240">http：// localhost：5678 / configserver</font></a></p>
</div>
<div class="paragraph">
<p><font o="1241">非jvm应用程序可以利用Config Server返回YAML文档的功能。</font><font o="1242">例如，调用</font><a href="javascript:;" class="bare"><font o="1242">http://sidecar.local.spring.io:5678/configserver/default-master.yml</font></a><font o="1242"> 
可能会导致一个YAML文档，如下所示</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
  password: password
info:
  description: Spring Cloud Samples
  url: https://github.com/spring-cloud-samples</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="netflix-rxjava-springmvc"><font o="1243">RxJava与Spring MVC</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1244">Spring Cloud Netflix包括</font><a href="javascript:;"><font o="1244">RxJava</font></a><font o="1244">。</font></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><font o="1245">RxJava是</font><a href="javascript:;"><font o="1245">Reactive Extensions</font></a><font o="1245">的Java VM实现</font><font o="1245">：用于通过使用observable序列来构建异步和基于事件的程序的库。</font></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><font o="1246">Spring Cloud Netflix支持从Spring MVC控制器返回<code i="687">rx.Single</code>对象。</font><font o="1247">它还支持对</font><a href="javascript:;"><font o="1247">服务器发送事件（SSE）</font></a><font o="1247">使用<code i="688">rx.Observable</code>对象</font><font o="1247">。</font><font o="1248">如果您的内部API已经使用RxJava构建（参见</font><a href="#spring-cloud-feign-hystrix"><font o="1248">Feign Hystrix支持</font></a><font o="1248">示例），</font><font o="1248">这可能非常方便</font><font o="1248">。</font></p>
</div>
<div class="paragraph">
<p><font o="1249">以下是使用<code i="689">rx.Single</code>的一些示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@RequestMapping(method = RequestMethod.GET, value = "/single")
public Single&lt;String&gt; single() {
    return Single.just("single value");
}

@RequestMapping(method = RequestMethod.GET, value = "/singleWithResponse")
public ResponseEntity&lt;Single&lt;String&gt;&gt; singleWithResponse() {
    return new ResponseEntity&lt;&gt;(Single.just("single value"),
            HttpStatus.NOT_FOUND);
}

@RequestMapping(method = RequestMethod.GET, value = "/singleCreatedWithResponse")
public Single&lt;ResponseEntity&lt;String&gt;&gt; singleOuterWithResponse() {
    return Single.just(new ResponseEntity&lt;&gt;("single value", HttpStatus.CREATED));
}

@RequestMapping(method = RequestMethod.GET, value = "/throw")
public Single&lt;Object&gt; error() {
    return Single.error(new RuntimeException("Unexpected"));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1250">如果您有<code i="690">Observable</code>而不是单个，则可以使用<code i="691">.toSingle()</code>或<code i="692">.toList().toSingle()</code>。</font><font o="1251">这里有些例子：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@RequestMapping(method = RequestMethod.GET, value = "/single")
public Single&lt;String&gt; single() {
    return Observable.just("single value").toSingle();
}

@RequestMapping(method = RequestMethod.GET, value = "/multiple")
public Single&lt;List&lt;String&gt;&gt; multiple() {
    return Observable.just("multiple", "values").toList().toSingle();
}

@RequestMapping(method = RequestMethod.GET, value = "/responseWithObservable")
public ResponseEntity&lt;Single&lt;String&gt;&gt; responseWithObservable() {

    Observable&lt;String&gt; observable = Observable.just("single value");
    HttpHeaders headers = new HttpHeaders();
    headers.setContentType(APPLICATION_JSON_UTF8);
    return new ResponseEntity&lt;&gt;(observable.toSingle(), headers, HttpStatus.CREATED);
}

@RequestMapping(method = RequestMethod.GET, value = "/timeout")
public Observable&lt;String&gt; timeout() {
    return Observable.timer(1, TimeUnit.MINUTES).map(new Func1&lt;Long, String&gt;() {
        @Override
        public String call(Long aLong) {
            return "single value";
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1252">如果您有流式端点和客户端，SSE可以是一个选项。</font><font o="1253">要将<code i="693">rx.Observable</code>转换为Spring <code i="694">SseEmitter</code>，请使用<code i="695">RxResponse.sse()</code>。</font><font o="1254">这里有些例子：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@RequestMapping(method = RequestMethod.GET, value = "/sse")
public SseEmitter single() {
    return RxResponse.sse(Observable.just("single value"));
}

@RequestMapping(method = RequestMethod.GET, value = "/messages")
public SseEmitter messages() {
    return RxResponse.sse(Observable.just("message 1", "message 2", "message 3"));
}

@RequestMapping(method = RequestMethod.GET, value = "/events")
public SseEmitter event() {
    return RxResponse.sse(APPLICATION_JSON_UTF8, Observable.just(
            new EventDto("Spring io", getDate(2016, 5, 19)),
            new EventDto("SpringOnePlatform", getDate(2016, 8, 1))
    ));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="netflix-metrics"><font o="1255">指标：Spectator，Servo和Atlas</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1256">当一起使用时，Spectator / Servo和Atlas提供了近实时操作洞察平台。</font></p>
</div>
<div class="paragraph">
<p><font o="1257">Spectator和Servo是Netflix的指标收集库。</font><font o="1258">Atlas是用于管理维度时间序列数据的Netflix指标后端。</font></p>
</div>
<div class="paragraph">
<p><font o="1259">Servo为Netflix服务了几年，仍然可以使用，但逐渐被淘汰出来，赞成Spectator，它只适用于Java 8. Spring Cloud Netflix为两者提供了支持，但Java鼓励使用基于8的应用程序来使用Spectator。</font></p>
</div>
<div class="sect2">
<h3 id="_dimensional_vs_hierarchical_metrics"><font o="1260">维度与层次度量</font></h3>
<div class="paragraph">
<p><font o="1261">Spring Boot Actuator指标是层次结构，指标只能由名称分隔。</font><font o="1262">这些名称通常遵循将密钥/值属性对（维）嵌入到以句点分隔的名称中的命名约定。</font><font o="1263">考虑以下两个端点（root和star-star）的指标：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-json" data-lang="json">{
    "counter.status.200.root": 20,
    "counter.status.400.root": 3,
    "counter.status.200.star-star": 5,
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1264">第一个指标给出了每单位时间内针对根端点的成功请求的归一化计数。</font><font o="1265">但是如果系统有20个端点，并且想要获得针对所有端点的成功请求计数呢？</font><font o="1266">一些分层度量后端将允许您指定一个通配符，例如<code i="696">counter.status.200.<strong></strong></code> </font><strong><font o="1266">，它将读取所有20个指标并聚合结果。</font><font o="1267">或者，您可以提供<code i="697">HandlerInterceptorAdapter</code>拦截并记录所有成功请求的<code i="698">counter.status.200.all</code>等指标，而不考虑端点，但现在您必须写入20 + 1个不同的指标。</font><font o="1268">类似地，如果您想知道服务中所有端点成功请求的总数，您可以指定一个通配符，例如<code i="699">counter.status.2</code></font></strong><font o="1268"> <code i="700">.*</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="1269">即使在分级度量后端的通配符支持的情况下，命名一致性也是困难的。</font><font o="1270">具体来说，这些标签在名称字符串中的位置可能会随着时间而滑落，从而导致查询错 </font><font o="1271">例如，假设我们为上述HTTP方法添加了一个额外的维度。</font><font o="1272">那么<code i="701">counter.status.200.root</code>成为<code i="702">counter.status.200.method.get.root</code>等等。我们的<code i="703">counter.status.200.*</code>突然不再具有相同的语义。</font><font o="1273">此外，如果新的维度在整个代码库中不均匀地应用，某些查询可能会变得不可能。</font><font o="1274">这可以很快失控。</font></p>
</div>
<div class="paragraph">
<p><font o="1275">Netflix指标被标记（又称维度）。</font><font o="1276">每个指标都有一个名称，但是这个单一的命名度量可以包含多个统计信息和“标签”键/值对，这允许更多的查询灵活性。</font><font o="1277">实际上统计本身就是记录在一个特殊的标签上。</font></p>
</div>
<div class="paragraph">
<p><font o="1278">使用Netflix Servo或Spectator记录，上述根端点的计时器包含每个状态码的4个统计信息，其中计数统计信息与Spring Boot Actuator计数器相同。</font><font o="1279">如果到目前为止，我们遇到了HTTP 200和400，将有8个可用数据点：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-json" data-lang="json">{
    "root(status=200,stastic=count)": 20,
    "root(status=200,stastic=max)": 0.7265630630000001,
    "root(status=200,stastic=totalOfSquares)": 0.04759702862580789,
    "root(status=200,stastic=totalTime)": 0.2093076914666667,
    "root(status=400,stastic=count)": 1,
    "root(status=400,stastic=max)": 0,
    "root(status=400,stastic=totalOfSquares)": 0,
    "root(status=400,stastic=totalTime)": 0,
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_default_metrics_collection"><font o="1280">默认度量集合</font></h3>
<div class="paragraph">
<p><font o="1281">没有任何额外的依赖或配置，基于Spring Cloud的服务将自动配置Servo <code i="704">MonitorRegistry</code>，并开始收集每个Spring MVC请求的指标。</font><font o="1282">默认情况下，将为每个MVC请求记录名称为<code i="705">rest</code>的Servo定时器，其中标记为：</font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font o="1283">HTTP方法</font></p>
</li>
<li>
<p><font o="1284">HTTP状态（例如200,400,500）</font></p>
</li>
<li>
<p><font o="1285">URI（如果URI为空，则为“root”），为Atlas</font></p>
</li>
<li>
<p><font o="1286">异常类名称，如果请求处理程序抛出异常</font></p>
</li>
<li>
<p><font o="1287">如果在请求上设置了匹配<code i="706">netflix.metrics.rest.callerHeader</code>的密钥的请求头，则呼叫者。</font><font o="1288"><code i="707">netflix.metrics.rest.callerHeader</code>没有默认键。</font><font o="1289">如果您希望收集来电者信息，则必须将其添加到应用程序属性中。</font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font o="1290">设置<code i="708">netflix.metrics.rest.metricName</code>属性可将度量值的名称从<code i="709">rest</code>更改为您提供的名称。</font></p>
</div>
<div class="paragraph">
<p><font o="1291">如果Spring AOP已启用，并且<code i="710">org.aspectj:aspectjweaver</code>存在于您的运行时类路径上，则Spring Cloud还将收集每个使用<code i="711">RestTemplate</code>进行的客户端调用的指标。</font><font o="1292">将为每个MVC请求记录名称为<code i="712">restclient</code>的Servo定时器，其标记为：</font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font o="1293">HTTP方法</font></p>
</li>
<li>
<p><font o="1294">HTTP状态（例如200,400,500），如果响应返回为null，则为“CLIENT_ERROR”;如果在<code i="714">RestTemplate</code>方法执行期间发生<code i="713">IOException</code>，则为“IO_ERROR”</font></p>
</li>
<li>
<p><font o="1295">为Atlas消毒的URI</font></p>
</li>
<li>
<p><font o="1296">客户名称</font></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="netflix-metrics-spectator"><font o="1297">指标集：Spectator</font></h3>
<div class="paragraph">
<p><font o="1298">要启用Spectator指标，请包括<code i="715">spring-boot-starter-spectator</code>的依赖关系：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-spectator&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1299">在Spectator说明中，仪表是一个命名，打字和标记的配置，一个度量表示某个时间点给定仪表的值。</font><font o="1300">Spectator米由注册表创建和控制，注册表目前有几个不同的实现。</font><font o="1301">Spectator提供4米类型：计数器，计时器，量规和分配摘要。</font></p>
</div>
<div class="paragraph">
<p><font o="1302">Spring Cloud Spectator集成为您配置可注入的<code i="716">com.netflix.spectator.api.Registry</code>实例。</font><font o="1303">具体来说，它配置一个<code i="717">ServoRegistry</code>实例，以统一REST度量标准的集合，并在Atlas API下将指标导出到Atlas后端。</font><font o="1304">实际上，这意味着您的代码可能会使用Servo显示器和Spectator米的混合，并且两者都将被Spring Boot Actuator <code i="718">MetricReader</code>实例占用，并且都会发送到Atlas后端。</font></p>
</div>
<div class="sect3">
<h4 id="_spectator_counter"><font o="1305">Spectator柜台</font></h4>
<div class="paragraph">
<p><font o="1306">计数器用于测量某些事件发生的速率。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// create a counter with a name and a set of tags
Counter counter = registry.counter("counterName", "tagKey1", "tagValue1", ...);
counter.increment(); // increment when an event occurs
counter.increment(10); // increment by a discrete amount</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1307">计数器记录单个时间归一化统计量。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_spectator_timer"><font o="1308">Spectator计时器</font></h4>
<div class="paragraph">
<p><font o="1309">一个计时器用于测量一些事件需要多长时间。</font><font o="1310">Spring Cloud自动记录Spring MVC请求和有条件<code i="719">RestTemplate</code>请求的定时器，稍后可以用于创建仪表板，以获取请求相关的指标，如延迟：</font></p>
</div>
<div class="paragraph">
<div class="title"><font o="1311">请求延迟</font></div>
<p><font o="1312">image :: RequestLatency.png []</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// create a timer with a name and a set of tags
Timer timer = registry.timer("timerName", "tagKey1", "tagValue1", ...);

// execute an operation and time it at the same time
T result = timer.record(() -&gt; fooReturnsT());

// alternatively, if you must manually record the time
Long start = System.nanoTime();
T result = fooReturnsT();
timer.record(System.nanoTime() - start, TimeUnit.NANOSECONDS);</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1313">计时器同时记录4个统计信息：count，max，totalOfSquares和totalTime。</font><font o="1314">如果您在每次记录时间时在计数器上调用了一次<code i="720">increment()</code>一次，计数统计量将始终与计数器提供的单个归一化值相匹配，因此对于单次操作，不需要单独计数和分时。</font></p>
</div>
<div class="paragraph">
<p><font o="1315">对于</font><a href="javascript:;"><font o="1315">长时间运行的操作</font></a><font o="1315">，Spectator提供了一个特殊的<code i="721">LongTaskTimer</code>。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_spectator_gauge"><font o="1316">Spectator量规</font></h4>
<div class="paragraph">
<p><font o="1317">量规用于确定一些当前值，如队列的大小或处于运行状态的线程数。</font><font o="1318">由于仪表被采样，它们不提供关于这些值在样品之间如何波动的信息。</font></p>
</div>
<div class="paragraph">
<p><font o="1319">仪器的正常使用包括在初始化中使用标识符注册仪表，对要采样的对象的引用，以及基于对象获取或计算数值的功能。</font><font o="1320">对对象的引用被单独传递，并且Spectator注册表将保持对该对象的弱引用。</font><font o="1321">如果对象是垃圾回收，则Spectator将自动删除注册。</font><font o="1322">见</font><a href="javascript:;"><font o="1322">注</font></a><font o="1322"> Spectator是关于潜在的内存泄漏的文件中，如果这个API被滥用。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// the registry will automatically sample this gauge periodically
registry.gauge("gaugeName", pool, Pool::numberOfRunningThreads);

// manually sample a value in code at periodic intervals -- last resort!
registry.gauge("gaugeName", Arrays.asList("tagKey1", "tagValue1", ...), 1000);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spectator_distribution_summaries"><font o="1323">Spectator分发摘要</font></h4>
<div class="paragraph">
<p><font o="1324">分发摘要用于跟踪事件的分布情况。</font><font o="1325">它类似于一个计时器，但更普遍的是，大小不一定是一段时间。</font><font o="1326">例如，分发摘要可用于测量服务器的请求的有效载荷大小。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// the registry will automatically sample this gauge periodically
DistributionSummary ds = registry.distributionSummary("dsName", "tagKey1", "tagValue1", ...);
ds.record(request.sizeInBytes());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="netflix-metrics-servo"><font o="1327">指标集：Servo</font></h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1328">警告</font></div>
</td>
<td class="content"><font o="1329">
如果您的代码在Java 8上编译，请使用Spectator而不是Servo，因为Spectator注定要从长远来完全替换Servo。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1330">在Servo语言中，监视器是一个命名，键入和标记的配置，而指标表示给定监视器在某个时间点的值。</font><font o="1331">Servo显示器在逻辑上相当于Spectator米。</font><font o="1332">Servo监视器由<code i="722">MonitorRegistry</code>创建和控制。</font><font o="1333">尽管有上述警告，Servo确实拥有</font><font o="1333">比Spectator有米</font><font o="1333">的</font><a href="javascript:;"><font o="1333">更广泛</font></a><font o="1333">的监视器选项。</font></p>
</div>
<div class="paragraph">
<p><font o="1334">Spring Cloud集成为您配置可注入的<code i="723">com.netflix.servo.MonitorRegistry</code>实例。</font><font o="1335">在Servo中创建了相应的<code i="724">Monitor</code>类型后，记录数据的过程完全类似于Spectator。</font></p>
</div>
<div class="sect3">
<h4 id="_creating_servo_monitors"><font o="1336">创建Servo显示器</font></h4>
<div class="paragraph">
<p><font o="1337">如果您使用Spring Cloud提供的Servo <code i="725">MonitorRegistry</code>实例（具体来说是<code i="726">DefaultMonitorRegistry</code>的实例），则Servo为检索</font><a href="javascript:;"><font o="1337">计数器</font></a><font o="1337">和</font><a href="javascript:;"><font o="1337">计时器</font></a><font o="1337">提供便利类</font><font o="1337">。</font><font o="1338">这些便利类确保每个唯一的名称和标签组合只注册一个<code i="727">Monitor</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="1339">要在Servo中手动创建监视器类型，特别是对于不提供方便方法的异域监视器类型，通过提供<code i="728">MonitorConfig</code>实例来实例化适当的类型：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">MonitorConfig config = MonitorConfig.builder("timerName").withTag("tagKey1", "tagValue1").build();

// somewhere we should cache this Monitor by MonitorConfig
Timer timer = new BasicTimer(config);
monitorRegistry.register(timer);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="netflix-metrics-atlas"><font o="1340">指标后端：Atlas</font></h3>
<div class="paragraph">
<p><font o="1341">Atlas由Netflix开发，用于管理尺寸时间序列数据，以实现近实时操作洞察。</font><font o="1342">Atlas具有内存数据存储功能，可以非常快速地收集和报告大量的指标。</font></p>
</div>
<div class="paragraph">
<p><font o="1343">Atlas捕获操作情报。</font><font o="1344">而商业智能是收集的数据，用于分析一段时间内的趋势，操作情报提供了系统中目前发生的情况。</font></p>
</div>
<div class="paragraph">
<p><font o="1345">Spring Cloud提供了一个<code i="729">spring-cloud-starter-atlas</code>，它具有您需要的所有依赖项。</font><font o="1346">然后，使用<code i="730">@EnableAtlas</code>注释您的Spring Boot应用程序，并为运行中的Atlas服务器提供<code i="731">netflix.atlas.uri</code>属性的位置。</font></p>
</div>
<div class="sect3">
<h4 id="_global_tags"><font o="1347">全球标签</font></h4>
<div class="paragraph">
<p><font o="1348">您可以通过Spring Cloud向发送到Atlas后端的每个度量标准添加标签。</font><font o="1349">全局标签可用于按应用程序名称，环境，区域等分隔度量。</font></p>
</div>
<div class="paragraph">
<p><font o="1350">实现<code i="732">AtlasTagProvider</code>的每个bean将贡献全局标签列表：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
AtlasTagProvider atlasCommonTags(
    @Value("${spring.application.name}") String appName) {
  return () -&gt; Collections.singletonMap("app", appName);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_atlas"><font o="1351">使用Atlas</font></h4>
<div class="paragraph">
<p><font o="1352">引导内存独立的Atlas实例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-bash" data-lang="bash">$ curl -LO https://github.com/Netflix/atlas/releases/download/v1.4.2/atlas-1.4.2-standalone.jar
$ java -jar atlas-1.4.2-standalone.jar</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1353">提示</font></div>
</td>
<td class="content"><font o="1354">
运行在r3.2xlarge（61GB RAM）上的Atlas独立节点可以在给定的6小时窗口内处理每分钟大约200万个度量值。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1355">一旦运行并收集了少量指标，请通过在Atlas服务器上列出代码来验证您的设置是否正确：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-bash" data-lang="bash">$ curl http://ATLAS/api/v1/tags</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1356">提示</font></div>
</td>
<td class="content"><font o="1357">
在针对您的服务执行多个请求后，您可以通过在浏览器中粘贴以下URL来收集关于每个请求的请求延迟的一些非常基本的信息：<code i="733"><a href="javascript:;" class="bare">http://ATLAS/api/v1/graph?q=name,rest,:eq,:avg</a></code>
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1358">Atlas wiki包含</font><font o="1358">各种场景</font><a href="javascript:;"><font o="1358">样本查询</font></a><font o="1358">的汇编。</font></p>
</div>
<div class="paragraph">
<p><font o="1359">确保</font><font o="1359">使用</font><a href="javascript:;"><font o="1359">双指数平滑</font></a><font o="1359">来查看</font><a href="javascript:;"><font o="1359">警报原理</font></a><font o="1359">和文档，</font><font o="1359">以生成动态警报阈值。</font><a href="javascript:;"><font></font></a><font></font></p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_spring_cloud_stream" class="sect0">Spring Cloud Stream</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><font o="1361">本节将详细介绍如何使用Spring Cloud Stream。</font><font o="1362">它涵盖了创建和运行流应用程序等主题。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introducing_spring_cloud_stream"><font o="1363">介绍Spring Cloud Stream</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1364">Spring Cloud Stream是构建消息驱动的微服务应用程序的框架。</font><font o="1365">Spring Cloud Stream基于Spring Boot建立独立的生产级Spring应用程序，并使用Spring Integration提供与消息代理的连接。</font><font o="1366">它提供了来自几家供应商的中间件的意见配置，介绍了持久发布订阅语义，消费者组和分区的概念。</font></p>
</div>
<div class="paragraph">
<p><font o="1367">您可以将<code i="734">@EnableBinding</code>注释添加到应用程序中，以便立即连接到消息代理，并且可以将<code i="735">@StreamListener</code>添加到方法中，以使其接收流处理事件。</font><font o="1368">以下是接收外部消息的简单接收器应用程序。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
public class StreamApplication {

  public static void main(String[] args) {
    SpringApplication.run(StreamApplication.class, args);
  }
}

@EnableBinding(Sink.class)
public class TimerSource {

  ...

  @StreamListener(Sink.INPUT)
  public void processVote(Vote vote) {
      votingService.recordVote(vote);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1369"><code i="736">@EnableBinding</code>注释需要一个或多个接口作为参数（在这种情况下，参数是单个<code i="737">Sink</code>接口）。</font><font o="1370">接口声明输入和/或输出通道。</font><font o="1371">Spring Cloud Stream提供了接口<code i="738">Source</code>，<code i="739">Sink</code>和<code i="740">Processor</code>; </font><font o="1372">您还可以定义自己的界面。</font></p>
</div>
<div class="paragraph">
<p><font o="1373">以下是<code i="741">Source</code>接口的定义：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Sink {
  String INPUT = "input";

  @Input(Sink.INPUT)
  SubscribableChannel input();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1374"><code i="742">@Input</code>注释标识</font><em><font o="1374">输入通道</font></em><font o="1374">，通过该</font><em><font o="1374">输入通道</font></em><font o="1374">接收到的消息进入应用程序; </font><font o="1375"><code i="743">@Output</code>注释标识一个</font><em><font o="1375">输出通道</font></em><font o="1375">，发布的消息将通过该</font><em><font o="1375">通道</font></em><font o="1375">离开应用程序。</font><font o="1376"><code i="744">@Input</code>和<code i="745">@Output</code>注释可以使用频道名称作为参数; </font><font o="1377">如果未提供名称，将使用注释方法的名称。</font></p>
</div>
<div class="paragraph">
<p><font o="1378">Spring Cloud Stream将为您创建一个界面的实现。</font><font o="1379">您可以在应用程序中通过自动连接来使用它，如下面的测试用例示例。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(classes = StreamApplication.class)
@WebAppConfiguration
@DirtiesContext
public class StreamApplicationTests {

  @Autowired
  private Sink sink;

  @Test
  public void contextLoads() {
    assertNotNull(this.sink.input());
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_main_concepts"><font o="1380">主要概念</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1381">Spring Cloud Stream提供了一些简化了消息驱动的微服务应用程序编写的抽象和原语。</font><font o="1382">本节概述了以下内容：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1383">Spring Cloud Stream的应用模式</font></p>
</li>
<li>
<p><font o="1384">Binder抽象</font></p>
</li>
<li>
<p><font o="1385">持续的发布 - 订阅支持</font></p>
</li>
<li>
<p><font o="1386">消费者群体支持</font></p>
</li>
<li>
<p><font o="1387">分区支持</font></p>
</li>
<li>
<p><font o="1388">一个可插拔的Binder API</font></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_application_model"><font o="1389">应用模型</font></h3>
<div class="paragraph">
<p><font o="1390">一个Spring Cloud Stream应用程序由一个中间件中立的核心组成。</font><font o="1391">应用程序</font><font o="1391">通过Spring Cloud Stream注入到其中的</font><font o="1391">输入和输出</font><em><font o="1391">通道</font></em><font o="1391">与外部世界进行通信</font><font o="1391">。</font><font o="1392">渠道通过中间件特定的Binder实现连接到外部经纪人。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/SCSt-with-binder.png" alt="SCSt与粘合剂" width="300">
</div>
<div class="title"><font o="1393">图4. Spring Cloud Stream应用程序</font></div>
</div>
<div class="sect3">
<h4 id="_fat_jar"><font o="1394">胖JAR</font></h4>
<div class="paragraph">
<p><font o="1395">Spring Cloud Stream应用程序可以在IDE中以独立模式运行，用于测试。</font><font o="1396">要在生产中运行Spring Cloud Stream应用程序，您可以使用为Maven或Gradle提供的标准Spring Boot工具创建可执行文件（或“胖”）JAR。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_binder_abstraction"><font o="1397">Binder抽象</font></h3>
<div class="paragraph">
<p><font o="1398">Spring Cloud Stream为</font><a href="javascript:;"><font o="1398">Kafka</font></a><font o="1398">，</font><a href="javascript:;"><font o="1398">Rabbit MQ</font></a><font o="1398">，</font><a href="javascript:;"><font o="1398">Redis</font></a><font o="1398">和</font><a href="javascript:;"><font o="1398">Gemfire</font></a><font o="1398">提供Binder </font><a href="javascript:;"><font o="1398">实现</font></a><font o="1398">。</font><font o="1399">Spring Cloud Stream还包括一个</font><a href="javascript:;"><font o="1399">TestSupportBinder</font></a><font o="1399">，它保留了</font><font o="1399">一个</font><a href="javascript:;"><font o="1399">未修改</font></a><font o="1399">的通道，以便测试可以直接和可靠地与通道进行交互。</font><font o="1400">您可以使用可扩展API来编写自己的Binder。</font></p>
</div>
<div class="paragraph">
<p><font o="1401">Spring Cloud Stream使用Spring Boot进行配置，Binder抽象使得Spring Cloud Stream应用程序可以灵活地连接到中间件。</font><font o="1402">例如，部署者可以在运行时动态选择通道连接到的目的地（例如，Kafka主题或RabbitMQ交换机）。</font><font o="1403">可以通过外部配置属性和Spring Boot（包括应用程序参数，环境变量和<code i="746">application.yml</code>或<code i="747">application.properties</code>文件）支持的任何形式提供此类配置。</font><font o="1404">在</font><a href="#_introducing_spring_cloud_stream"><font o="1404">介绍Spring Cloud Stream</font></a><font o="1404">部分</font><font o="1404">的接收器示例</font><font o="1404">中，将应用程序属性<code i="748">spring.cloud.stream.bindings.input.destination</code>设置为<code i="749">raw-sensor-data</code>将使其从<code i="750">raw-sensor-data</code> Kafka主题或从绑定到<code i="751">raw-sensor-data</code> RabbitMQ交换。</font></p>
</div>
<div class="paragraph">
<p><font o="1405">Spring Cloud Stream自动检测并使用类路径中找到的绑定。</font><font o="1406">您可以使用相同的代码轻松使用不同类型的中间件：在构建时只包含不同的绑定器。</font><font o="1407">对于更复杂的用例，您还可以在应用程序中打包多个绑定器，并在运行时选择绑定器，甚至是否为不同的通道使用不同的绑定器。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_persistent_publish_subscribe_support"><font o="1408">持续发布 - 订阅支持</font></h3>
<div class="paragraph">
<p><font o="1409">应用之间的通信遵循发布订阅模式，其中通过共享主题广播数据。</font><font o="1410">这可以在下图中看出，它显示了一组交互式Spring Cloud Stream应用程序的典型部署。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/SCSt-sensors.png" alt="SCSt传感器" width="300">
</div>
<div class="title"><font o="1411">图5. Spring Cloud Stream Publish-Subscribe</font></div>
</div>
<div class="paragraph">
<p><font o="1412">传感器向HTTP端点报告的数据将发送到名为<code i="752">raw-sensor-data</code>的公共目标。</font><font o="1413">从目的地，它由微服务应用程序独立处理，该应用程序计算时间窗口平均值，以及另一个将原始数据导入HDFS的微服务应用程序。</font><font o="1414">为了处理数据，两个应用程序在运行时将主题声明为它们的输入。</font></p>
</div>
<div class="paragraph">
<p><font o="1415">发布订阅通信模型降低了生产者和消费者的复杂性，并允许将新应用程序添加到拓扑中，而不会中断现有流。</font><font o="1416">例如，在平均计算应用程序的下游，您可以添加一个计算显示和监视的最高温度值的应用程序。</font><font o="1417">然后，您可以添加另一个解释相同的故障检测平均流程的应用程序。</font><font o="1418">通过共享主题而不是点对点队列进行所有通信可以减少微服务之间的耦合。</font></p>
</div>
<div class="paragraph">
<p><font o="1419">虽然发布订阅消息传递的概念不是新的，但是Spring Cloud Stream需要采取额外的步骤，使其成为其应用模型的有意义的选择。</font><font o="1420">通过使用本地中间件支持，Spring Cloud Stream还简化了跨不同平台使用发布订阅模型。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="consumer-groups"><font o="1421">消费群体</font></h3>
<div class="paragraph">
<p><font o="1422">虽然发布订阅模型可以轻松地通过共享主题连接应用程序，但通过创建给定应用程序的多个实例来扩展的能力同样重要。</font><font o="1423">当这样做时，应用程序的不同实例被放置在竞争的消费者关系中，其中只有一个实例预期处理给定消息。</font></p>
</div>
<div class="paragraph">
<p><font o="1424">Spring Cloud Stream通过</font><em><font o="1424">消费者群体</font></em><font o="1424">的概念来模拟这种行为</font><font o="1424">。</font><font o="1425">（Spring Cloud Stream消费者组与Kafka消费者组相似并受到启发）。每个使用者绑定可以使用<code i="753">spring.cloud.stream.bindings.input.group</code>属性来指定组名称。</font><font o="1426">对于下图所示的消费者，此属性将设置为<code i="754">spring.cloud.stream.bindings.input.group=hdfsWrite</code>或<code i="755">spring.cloud.stream.bindings.input.group=average</code>。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/SCSt-groups.png" alt="SCSt组" width="300">
</div>
<div class="title"><font o="1427">图6. Spring Cloud Stream消费者群体</font></div>
</div>
<div class="paragraph">
<p><font o="1428">订阅给定目标的所有组都会收到已发布数据的副本，但每个组中只有一个成员从该目的地接收给定的消息。</font><font o="1429">默认情况下，当未指定组时，Spring Cloud Stream将应用程序分配给与所有其他消费者组发布 - 订阅关系的匿名且独立的单个成员消费者组。</font></p>
</div>
<div class="sect3">
<h4 id="durability"><font o="1430">耐久力</font></h4>
<div class="paragraph">
<p><font o="1431">与Spring Cloud Stream的舆论应用模式一致，消费者群体订阅是</font><em><font o="1431">持久的</font></em><font o="1431">。</font><font o="1432">也就是说，绑定实现确保组预订是持久的，一旦已经创建了一个组的至少一个订阅，即使组中的所有应用程序都被停止，组也将接收消息。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1433">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1434">匿名订阅本质上是不耐用的。</font><font o="1435">对于某些绑定实现（例如，RabbitMQ），可以具有非持久组的订阅。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1436">通常，当将应用绑定到给定目的地时，最好始终指定消费者组。</font><font o="1437">在扩展Spring Cloud Stream应用程序时，必须为其每个输入绑定指定使用者组。</font><font o="1438">这样可以防止应用程序的实例收到重复的消息（除非需要这种行为，这是不寻常的）。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="partitioning"><font o="1439">分区支持</font></h3>
<div class="paragraph">
<p><font o="1440">Spring Cloud Stream提供对</font><font o="1440">给定应用程序的多个实例之间</font><font o="1440">的</font><em><font o="1440">分区</font></em><font o="1440">数据的</font><font o="1440">支持</font><font o="1440">。</font><font o="1441">在分区场景中，物理通信介质（例如，代理主题）被视为被构造成多个分区。</font><font o="1442">一个或多个生产者应用程序实例将数据发送到多个消费者应用程序实例，并确保由共同特征标识的数据由相同的消费者实例处理。</font></p>
</div>
<div class="paragraph">
<p><font o="1443">Spring Cloud Stream提供了统一方式实现分区处理用例的通用抽象。</font><font o="1444">因此，无论代理本身是否自然分区（例如，Kafka）（例如，RabbitMQ），分区都可以使用。</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/SCSt-partitioning.png" alt="SCSt分区" width="300">
</div>
<div class="title"><font o="1445">图7. Spring Cloud Stream分区</font></div>
</div>
<div class="paragraph">
<p><font o="1446">分区是状态处理中的一个关键概念，无论是性能还是一致性原因，它都是批评性的，以确保所有相关数据一起处理。</font><font o="1447">例如，在时间平均计算示例中，重要的是所有给定传感器的所有测量都由相同的应用实例进行处理。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1448">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1449">要设置分区处理方案，您必须同时配置数据生成和数据消耗结束。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programming_model"><font o="1450">编程模型</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1451">本节介绍Spring Cloud Stream的编程模型。</font><font o="1452">Spring Cloud Stream提供了许多预定义的注释，用于声明绑定的输入和输出通道以及如何收听频道。</font></p>
</div>
<div class="sect2">
<h3 id="_declaring_and_binding_channels"><font o="1453">声明和绑定频道</font></h3>
<div class="sect3">
<h4 id="_triggering_binding_via_code_enablebinding_code"><font o="1454">触发绑定<code i="756">@EnableBinding</code></font></h4>
<div class="paragraph">
<p><font o="1455">您可以将Spring应用程序转换为Spring Cloud Stream应用程序，将<code i="757">@EnableBinding</code>注释应用于应用程序的配置类之一。</font><font o="1456"><code i="758">@EnableBinding</code>注释本身使用<code i="759">@Configuration</code>进行元注释，并触发Spring Cloud Stream基础架构的配置：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">...
@Import(...)
@Configuration
@EnableIntegration
public @interface EnableBinding {
    ...
    Class&lt;?&gt;[] value() default {};
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1457"><code i="760">@EnableBinding</code>注释可以作为参数的一个或多个接口类，其中包含表示可绑定组件（通常是消息通道）的方法。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1458">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1459">在Spring Cloud Stream 1.0中，唯一支持的可绑定组件是Spring消息传递<code i="761">MessageChannel</code>及其扩展名<code i="762">SubscribableChannel</code>和<code i="763">PollableChannel</code>。</font><font o="1460">未来版本应该使用相同的机制将此支持扩展到其他类型的组件。</font><font o="1461">在本文档中，我们将继续参考渠道。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="__code_input_code_and_code_output_code"><font o="1462"><code i="764">@Input</code>和<code i="765">@Output</code></font></h4>
<div class="paragraph">
<p><font o="1463">Spring Cloud Stream应用程序可以在接口中定义任意数量的输入和输出通道为<code i="766">@Input</code>和<code i="767">@Output</code>方法：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Barista {

    @Input
    SubscribableChannel orders();

    @Output
    MessageChannel hotDrinks();

    @Output
    MessageChannel coldDrinks();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1464">使用此接口作为<code i="768">@EnableBinding</code>的参数将分别触发三个绑定通道，分别命名为<code i="769">orders</code>，<code i="770">hotDrinks</code>和<code i="771">coldDrinks</code>。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableBinding(Barista.class)
public class CafeConfiguration {

   ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_channel_names"><font o="1465">自定义频道名称</font></h5>
<div class="paragraph">
<p><font o="1466">您可以使用<code i="772">@Input</code>和<code i="773">@Output</code>注释指定频道的自定义频道名称，如以下示例所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Barista {
    ...
    @Input("inboundOrders")
    SubscribableChannel orders();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1467">在这个例子中，创建的绑定通道将被命名为<code i="774">inboundOrders</code>。</font></p>
</div>
</div>
<div class="sect4">
<h5 id="__code_source_code_code_sink_code_and_code_processor_code"><font o="1468"><code i="775">Source</code>，<code i="776">Sink</code>和<code i="777">Processor</code></font></h5>
<div class="paragraph">
<p><font o="1469">为了方便寻址最常见的用例，涉及输入通道，输出通道或两者，Spring Cloud Stream提供了三个预定义的开箱即用的接口。</font></p>
</div>
<div class="paragraph">
<p><font o="1470"><code i="778">Source</code>可用于具有单个出站通道的应用程序。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Source {

  String OUTPUT = "output";

  @Output(Source.OUTPUT)
  MessageChannel output();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1471"><code i="779">Sink</code>可用于具有单个入站通道的应用程序。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Sink {

  String INPUT = "input";

  @Input(Sink.INPUT)
  SubscribableChannel input();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1472"><code i="780">Processor</code>可用于具有入站通道和出站通道的应用程序。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Processor extends Source, Sink {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1473">对于任何这些接口，Spring Cloud Stream不提供特殊处理; </font><font o="1474">它们只是开箱即用。</font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_bound_channels"><font o="1475">访问绑定通道</font></h4>
<div class="sect4">
<h5 id="_injecting_the_bound_interfaces"><font o="1476">注入绑定界面</font></h5>
<div class="paragraph">
<p><font o="1477">对于每个绑定接口，Spring Cloud Stream将生成一个实现该接口的bean。</font><font o="1478">调用其中一个bean的<code i="781">@Input</code>注释或<code i="782">@Output</code>注释方法将返回相关的绑定通道。</font></p>
</div>
<div class="paragraph">
<p><font o="1479">以下示例中的bean在调用其<code i="783">hello</code>方法时在输出通道上发送消息。</font><font o="1480">它在注入的<code i="785">Source</code> bean上调用<code i="784">output()</code>来检索目标通道。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Component
public class SendingBean {

    private Source source;

    @Autowired
    public SendingBean(Source source) {
        this.source = source;
    }

    public void sayHello(String name) {
         source.output().send(MessageBuilder.withPayload(body).build());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_injecting_channels_directly"><font o="1481">直接注入渠道</font></h5>
<div class="paragraph">
<p><font o="1482">绑定通道也可以直接注入：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Component
public class SendingBean {

    private MessageChannel output;

    @Autowired
    public SendingBean(MessageChannel output) {
        this.output = output;
    }

    public void sayHello(String name) {
         output.send(MessageBuilder.withPayload(body).build());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1483">如果在声明注释上定制了通道的名称，则应使用该名称而不是方法名称。</font><font o="1484">给出以下声明：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface CustomSource {
    ...
    @Output("customOutput")
    MessageChannel output();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1485">通道将被注入，如下例所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Component
public class SendingBean {

    @Autowired
    private MessageChannel output;

    @Autowired @Qualifier("customOutput")
    public SendingBean(MessageChannel output) {
        this.output = output;
    }

    public void sayHello(String name) {
         customOutput.send(MessageBuilder.withPayload(body).build());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_producing_and_consuming_messages"><font o="1486">生产和消费消息</font></h4>
<div class="paragraph">
<p><font o="1487">您可以使用Spring Integration注释或Spring Cloud Stream的<code i="786">@StreamListener</code>注释编写Spring Cloud Stream应用程序。</font><font o="1488"><code i="787">@StreamListener</code>注释在其他Spring消息传递注释（例如<code i="788">@MessageMapping</code>，<code i="789">@JmsListener</code>，<code i="790">@RabbitListener</code>等）之后建模，但添加了内容类型管理和类型强制功能。</font></p>
</div>
<div class="sect4">
<h5 id="_native_spring_integration_support"><font o="1489">本地Spring Integration支持</font></h5>
<div class="paragraph">
<p><font o="1490">因为Spring Cloud Stream基于Spring Integration，Stream完全继承了Integration的基础和基础设施以及组件本身。</font><font o="1491">例如，您可以将<code i="791">Source</code>的输出通道附加到<code i="792">MessageSource</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableBinding(Source.class)
public class TimerSource {

  @Value("${format}")
  private String format;

  @Bean
  @InboundChannelAdapter(value = Source.OUTPUT, poller = @Poller(fixedDelay = "${fixedDelay}", maxMessagesPerPoll = "1"))
  public MessageSource&lt;String&gt; timerMessageSource() {
    return () -&gt; new GenericMessage&lt;&gt;(new SimpleDateFormat(format).format(new Date()));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1492">或者您可以在变压器中使用处理器的通道：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableBinding(Processor.class)
public class TransformProcessor {
  @Transformer(inputChannel = Processor.INPUT, outputChannel = Processor.OUTPUT)
  public Object transform(String message) {
    return message.toUpper();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_streamlistener_for_automatic_content_type_handling"><font o="1493">使用@StreamListener进行自动内容类型处理</font></h5>
<div class="paragraph">
<p><font o="1494">在Spring Integration支持之外，Spring Cloud Stream提供自己的<code i="793">@StreamListener</code>注释，在其他Spring消息传递注释（例如<code i="794">@MessageMapping</code>，<code i="795">@JmsListener</code>，<code i="796">@RabbitListener</code>等）之后建模。 ）。</font><font o="1495"><code i="797">@StreamListener</code>注释提供了一种更简单的处理入站邮件的模型，特别是在处理涉及内容类型管理和类型强制的用例时。</font></p>
</div>
<div class="paragraph">
<p><font o="1496">Spring Cloud Stream提供了一种可扩展的<code i="798">MessageConverter</code>机制，用于通过绑定的通道处理数据转换，在这种情况下，将派生到使用<code i="799">@StreamListener</code>注释的方法。</font><font o="1497">以下是处理外部<code i="800">Vote</code>事件的应用程序的示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableBinding(Sink.class)
public class VoteHandler {

  @Autowired
  VotingService votingService;

  @StreamListener(Sink.INPUT)
  public void handle(Vote vote) {
    votingService.record(vote);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1498">当考虑具有<code i="804">String</code>有效载荷和<code i="805">contentType</code>标题<code i="806">application/json</code>的入站<code i="803">Message</code>时，可以看出<code i="801">@StreamListener</code>和Spring Integration <code i="802">@ServiceActivator</code>之间的区别。</font><font o="1499">在<code i="807">@StreamListener</code>的情况下，<code i="808">MessageConverter</code>机制将使用<code i="809">contentType</code>标头将<code i="810">String</code>有效载荷解析为<code i="811">Vote</code>对象。</font></p>
</div>
<div class="paragraph">
<p><font o="1500">与其他Spring消息传递方法一样，方法参数可以用<code i="812">@Payload</code>，<code i="813">@Headers</code>和<code i="814">@Header</code>注释。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1501">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1502">对于返回数据的方法，必须使用<code i="815">@SendTo</code>注释来指定方法返回的数据的输出绑定目的地：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableBinding(Processor.class)
public class TransformProcessor {

  @Autowired
  VotingService votingService;

  @StreamListener(Processor.INPUT)
  @SendTo(Processor.OUTPUT)
  public VoteResult handle(Vote vote) {
    return votingService.record(vote);
  }
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1503">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1504">在RabbitMQ的情况下，内容类型头可以由外部应用程序设置。</font><font o="1505">Spring Cloud Stream支持它们作为扩展内部协议的一部分，用于任何类型的传输（包括通常不支持头文件的传输（例如Kafka））。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aggregation"><font o="1506">聚合</font></h4>
<div class="paragraph">
<p><font o="1507">Spring Cloud Stream支持将多个应用程序聚合在一起，直接连接其输入和输出通道，并避免通过代理交换消息的额外成本。</font><font o="1508">从版本1.0的Spring Cloud Stream开始，仅对以下类型的应用程序支持聚合：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><font o="1509">来源</font></em><font o="1509"> - 具有名为<code i="816">output</code>的单个输出通道的应用程序，通常具有类型为<code i="817">org.springframework.cloud.stream.messaging.Source</code>的单个绑定</font></p>
</li>
<li>
<p><em><font o="1510">接收器</font></em><font o="1510"> - 具有名为<code i="818">input</code>的单个输入通道的应用程序，通常具有类型为<code i="819">org.springframework.cloud.stream.messaging.Sink</code>的单个绑定</font></p>
</li>
<li>
<p><em><font o="1511">处理器</font></em><font o="1511"> - 具有名为<code i="820">input</code>的单个输入通道和名为<code i="821">output</code>的单个输出通道的应用程序，通常具有类型为<code i="822">org.springframework.cloud.stream.messaging.Processor</code>的单个绑定。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1512">它们可以通过创建一系列互连的应用程序来聚合在一起，其中序列中的元素的输出通道连接到下一个元素的输入通道（如果存在）。</font><font o="1513">序列可以从</font><em><font o="1513">源</font></em><font o="1513">或</font><em><font o="1513">处理器开始</font></em><font o="1513">，它可以包含任意数量的</font><em><font o="1513">处理器</font></em><font o="1513">，并且必须以</font><em><font o="1513">处理器</font></em><font o="1513">或</font><em><font o="1513">接收器</font></em><font o="1513">结束</font><font o="1513">。</font></p>
</div>
<div class="paragraph">
<p><font o="1514">根据起始和结束元素的性质，序列可以具有一个或多个可绑定的信道，如下所示：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1515">如果序列从源头开始并以sink结束，则应用程序之间的所有通信都是直接的，并且不会绑定任何通道</font></p>
</li>
<li>
<p><font o="1516">如果序列以处理器开始，则其输入通道将成为聚合的<code i="823">input</code>通道，并将相应地进行绑定</font></p>
</li>
<li>
<p><font o="1517">如果序列以处理器结束，则其输出通道将成为聚合的<code i="824">output</code>通道，并将相应地进行绑定</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1518">使用<code i="825">AggregateApplicationBuilder</code>实用程序类执行聚合，如以下示例所示。</font><font o="1519">我们考虑一个项目，我们有源，处理器和汇点，可以在项目中定义，或者可以包含在项目的依赖之一中。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableBinding(Sink.class)
public class SinkApplication {

	private static Logger logger = LoggerFactory.getLogger(SinkModuleDefinition.class);

	@ServiceActivator(inputChannel=Sink.INPUT)
	public void loggerSink(Object payload) {
		logger.info("Received: " + payload);
	}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableBinding(Processor.class)
public class ProcessorApplication {

	@Transformer
	public String loggerSink(String payload) {
		return payload.toUpperCase();
	}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableBinding(Source.class)
public class SourceApplication {

	@Bean
	@InboundChannelAdapter(value = Source.OUTPUT)
	public String timerMessageSource() {
		return new SimpleDateFormat().format(new Date());
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1520">每个配置可以用于运行一个单独的组件，但在这种情况下，它们可以聚合在一起，如下所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
public class SampleAggregateApplication {

	public static void main(String[] args) {
		new AggregateApplicationBuilder()
			.from(SourceApplication.class).args("--fixedDelay=5000")
			.via(ProcessorApplication.class)
			.to(SinkApplication.class).args("--debug=true").run(args);
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1521">该序列的起始组件作为<code i="826">from()</code>方法的参数提供。</font><font o="1522">序列的结尾部分作为<code i="827">to()</code>方法的参数提供。</font><font o="1523">中间处理器作为<code i="828">via()</code>方法的参数提供。</font><font o="1524">同一类型的多个处理器可以一起链接（例如，用于具有不同配置的流水线转换）。</font><font o="1525">对于每个组件，构建器可以为Spring Boot配置提供运行时参数。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_rxjava_support"><font o="1526">RxJava支持</font></h4>
<div class="paragraph">
<p><font o="1527">Spring Cloud Stream通过<code i="830">spring-cloud-stream-rxjava</code>中提供的<code i="829">RxJavaProcessor</code>提供对基于RxJava的处理器的支持。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface RxJavaProcessor&lt;I, O&gt; {
	Observable&lt;O&gt; process(Observable&lt;I&gt; input);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1528"><code i="831">RxJavaProcessor</code>的实现将接收<code i="832">Observable</code>作为表示入站消息有效载荷流的输入。</font><font o="1529">启动时会调用<code i="833">process</code>方法设置数据流。</font></p>
</div>
<div class="paragraph">
<p><font o="1530">您可以使用基于RxJava的处理器，并使用<code i="834">@EnableRxJavaProcessor</code>注释在处理器应用程序中使用它们。</font><font o="1531"><code i="835">@EnableRxJavaProcessor</code>使用<code i="836">@EnableBinding(Processor.class)</code>进行元注释，并创建<code i="837">Processor</code>绑定。</font><font o="1532">以下是基于RxJava的处理器的示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableRxJavaProcessor
public class RxJavaTransformer {

	private static Logger logger = LoggerFactory.getLogger(RxJavaTransformer.class);

	@Bean
	public RxJavaProcessor&lt;String,String&gt; processor() {
		return inputStream -&gt; inputStream.map(data -&gt; {
			logger.info("Got data = " + data);
			return data;
		})
		.buffer(5)
		.map(data -&gt; String.valueOf(avg(data)));
	}

	private static Double avg(List&lt;String&gt; data) {
		double sum = 0;
		double count = 0;
		for(String d : data) {
			count++;
			sum += Double.valueOf(d);
		}
		return sum/count;
	}
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1533">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1534">在实现RxJava处理器时，处理异常是处理流程的一部分。</font><font o="1535">未捕获的异常将被RxJava视为错误，并将导致<code i="838">Observable</code>完成，中断流。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binders">Binders</h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1537">Spring Cloud Stream提供了一个Binder抽象，用于连接到外部中间件的物理目标。</font><font o="1538">本节提供有关Binder SPI，其主要组件和实现特定详细信息背后的主要概念的信息。</font></p>
</div>
<div class="sect2">
<h3 id="_producers_and_consumers"><font o="1539">生产者和消费者</font></h3>
<div class="imageblock">
<div class="content">
<img src="static/picture/producers-consumers.png" alt="生产者消费者" width="300">
</div>
<div class="title"><font o="1540">图8.生产者和消费者</font></div>
</div>
<div class="paragraph">
<p><font o="1541">甲</font><em><font o="1541">生产者</font></em><font o="1541">是将消息发送到信道的任何组分。</font><font o="1542">该通道可以通过该代理的Binder实现绑定到外部消息代理。</font><font o="1543">当调用<code i="839">bindProducer()</code>方法时，第一个参数是代理中目标的名称，第二个参数是生产者将发送消息的本地通道实例，第三个参数包含属性（如分区键表达式）在为该通道创建的适配器中使用。</font></p>
</div>
<div class="paragraph">
<p><font o="1544">甲</font><em><font o="1544">消费者</font></em><font o="1544">的是，从一个信道接收的消息的任何组分。</font><font o="1545">与生产者一样，消费者的频道可以绑定到外部消息代理。</font><font o="1546">当调用<code i="840">bindConsumer()</code>方法时，第一个参数是目标名称，第二个参数提供消费者逻辑组的名称。</font><font o="1547">由给定目的地的消费者绑定表示的每个组接收生产者发送到该目的地的每个消息的副本（即，发布 - 订阅语义）。</font><font o="1548">如果有多个使用相同组名称的消费者实例绑定，那么消息将在这些消费者实例之间进行负载平衡，以便生产者发送的每个消息仅由每个组中的单个消费者实例消耗（即排队语义）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_binder_spi">Binder SPI</h3>
<div class="paragraph">
<p><font o="1550">Binder SPI由许多接口组成，即开即用的实用程序类和发现策略，可提供连接到外部中间件的可插拔机制。</font></p>
</div>
<div class="paragraph">
<p><font o="1551">SPI的关键点是<code i="841">Binder</code>接口，这是将输入和输出连接到外部中间件的策略。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Binder&lt;T, C extends ConsumerProperties, P extends ProducerProperties&gt; {
	Binding&lt;T&gt; bindConsumer(String name, String group, T inboundBindTarget, C consumerProperties);

	Binding&lt;T&gt; bindProducer(String name, T outboundBindTarget, P producerProperties);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1552">界面参数化，提供多个扩展点：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1553">输入和输出绑定目标 - 从版本1.0开始只支持<code i="842">MessageChannel</code>，但这是打算在将来用作扩展点;</font></p>
</li>
<li>
<p><font o="1554">扩展的消费者和生产者属性 - 允许特定的Binder实现来添加可以以类型安全的方式支持的补充属性。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1555">典型的绑定实现包括以下内容</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1556">一个实现<code i="843">Binder</code>接口的类;</font></p>
</li>
<li>
<p><font o="1557">一个Spring <code i="844">@Configuration</code>类，与中间件连接基础架构一起创建上述类型的bean;</font></p>
</li>
<li>
<p><font o="1558">在类路径中找到的包含一个或多个绑定器定义的<code i="845">META-INF/spring.binders</code>文件，例如</font></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>kafka:\
org.springframework.cloud.stream.binder.kafka.config.KafkaBinderConfiguration</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_binder_detection"><font o="1559">Binder检测</font></h3>
<div class="paragraph">
<p><font o="1560">Spring Cloud Stream依赖于Binder SPI的实现来执行将通道连接到消息代理的任务。</font><font o="1561">每个Binder实现通常连接到一种类型的消息系统。</font><font o="1562">Spring Cloud Stream开箱即用，为Kafka，RabbitMQ和Redis提供绑定。</font></p>
</div>
<div class="sect3">
<h4 id="_classpath_detection"><font o="1563">类路径检测</font></h4>
<div class="paragraph">
<p><font o="1564">默认情况下，Spring Cloud Stream依赖于Spring Boot的自动配置来配置绑定过程。</font><font o="1565">如果在类路径中找到单个Binder实现，则Spring Cloud Stream将自动使用。</font><font o="1566">例如，一个旨在仅绑定到RabbitMQ的Spring Cloud Stream项目可以简单地添加以下依赖关系：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-stream-binder-rabbit&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multiple-binders"><font o="1567">Classpath上有多个Binders</font></h3>
<div class="paragraph">
<p><font o="1568">当类路径中存在多个绑定器时，应用程序必须指明每个通道绑定将使用哪个绑定器。</font><font o="1569">每个binder配置包含一个<code i="846">META-INF/spring.binders</code>，它是一个简单的属性文件：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>rabbit:\
org.springframework.cloud.stream.binder.rabbit.config.RabbitServiceAutoConfiguration</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1570">对于其他提供的绑定实现（例如Kafka），存在类似的文件，并且预期自定义绑定实现也可以提供它们。</font><font o="1571">键代表binder实现的标识名，而该值是以逗号分隔的配置类列表，每个配置类都包含唯一一个类型为<code i="847">org.springframework.cloud.stream.binder.Binder</code>的bean定义。</font></p>
</div>
<div class="paragraph">
<p><font o="1572">可以通过在每个通道绑定上配置绑定器，使用<code i="848">spring.cloud.stream.defaultBinder</code>属性（例如，<code i="849">spring.cloud.stream.defaultBinder=rabbit</code>）或单独执行Binder选择。</font><font o="1573">例如，从Kafka读取并写入RabbitMQ的处理器应用程序可以指定以下配置：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">spring.cloud.stream.bindings.input.binder=kafka
spring.cloud.stream.bindings.output.binder=rabbit</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multiple-systems"><font o="1574">连接到多个系统</font></h3>
<div class="paragraph">
<p><font o="1575">默认情况下，绑定器共享应用程序的Spring Boot自动配置，以便创建类路径中找到的每个绑定器的一个实例。</font><font o="1576">如果您的应用程序连接到同一类型的多个代理，则可以指定多个绑定器配置，每个具有不同的环境设置。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1577">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1578">打开显式绑定器配置将完全禁用默认绑定器配置过程。</font><font o="1579">如果这样做，所有使用的绑定器都必须包含在配置中。</font><font o="1580">打算透明使用Spring Cloud Stream的框架可能会创建可以通过名称引用的绑定器配置，但不会影响默认的绑定器配置。</font><font o="1581">为此，绑定器配置可能将其<code i="850">defaultCandidate</code>标志设置为false，例如<code i="851">spring.cloud.stream.binders.&lt;configurationName&gt;.defaultCandidate=false</code>。</font><font o="1582">这表示将独立于默认binder配置过程存在的配置。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1583">例如，这是连接到两个RabbitMQ代理实例的处理器应用程序的典型配置：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yml" data-lang="yml">spring:
  cloud:
    stream:
      bindings:
        input:
          destination: foo
          binder: rabbit1
        output:
          destination: bar
          binder: rabbit2
      binders:
        rabbit1:
          type: rabbit
          environment:
            spring:
              rabbitmq:
                host: &lt;host1&gt;
        rabbit2:
          type: rabbit
          environment:
            spring:
              rabbitmq:
                host: &lt;host2&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_binder_configuration_properties"><font o="1584">Binder配置属性</font></h3>
<div class="paragraph">
<p><font o="1585">创建自定义绑定器配置时，以下属性可用。</font><font o="1586">它们必须以<code i="852">spring.cloud.stream.binders.&lt;configurationName&gt;</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1587">类型</font></dt>
<dd>
<p><font o="1588">粘合剂类型。</font><font o="1589">它通常引用在类路径中找到的绑定器之一，特别是<code i="853">META-INF/spring.binders</code>文件中的键。</font></p>
<div class="paragraph">
<p><font o="1590">默认情况下，它具有与配置名称相同的值。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1591">inheritEnvironment</font></dt>
<dd>
<p><font o="1592">配置是否会继承应用程序本身的环境。</font></p>
<div class="paragraph">
<p><font o="1593">默认<code i="854">true</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1594">环境</font></dt>
<dd>
<p><font o="1595">一组可用于自定义绑定环境的属性的根。</font><font o="1596">配置此配置后，创建绑定器的上下文不是应用程序上下文的子级。</font><font o="1597">这允许粘合剂组分和应用组分之间的完全分离。</font></p>
<div class="paragraph">
<p><font o="1598">默认<code i="855">empty</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1599">defaultCandidate</font></dt>
<dd>
<p><font o="1600">粘合剂配置是否被认为是默认的粘合剂的候选者，或者仅在明确引用时才能使用。</font><font o="1601">这允许添加binder配置，而不会干扰默认处理。</font></p>
<div class="paragraph">
<p><font o="1602">默认<code i="856">true</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_implementation_strategies"><font o="1603">实施策略</font></h3>
<div class="paragraph">
<p><font o="1604">本节详细介绍了Kafka和Rabbit MQ的绑定实施策略，将Spring Cloud Stream概念映射到中间件概念上的任务。</font></p>
</div>
<div class="sect3">
<h4 id="_kafka_binder">Kafka Binder</h4>
<div class="imageblock">
<div class="content">
<img src="static/picture/kafka-binder.png" alt="卡夫卡粘合剂" width="300">
</div>
<div class="title"><font o="1606">图9. Kafka Binder</font></div>
</div>
<div class="paragraph">
<p><font o="1607">Kafka Binder实现将目的地映射到Kafka主题。</font><font o="1608">消费群体直接映射到相同的Kafka概念。</font><font o="1609">Spring Cloud Stream不使用高级消费者，而是为简单的消费者实现类似的概念。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_rabbitmq_binder"><font o="1610">RabbitMQ Binder</font></h4>
<div class="imageblock">
<div class="content">
<img src="static/picture/rabbit-binder.png" alt="兔粘合剂" width="300">
</div>
<div class="title"><font o="1611">图10. RabbitMQ Binder</font></div>
</div>
<div class="paragraph">
<p><font o="1612">RabbitMQ Binder实现将目标映射到<code i="857">TopicExchange</code>。</font><font o="1613">对于每个消费群体，<code i="858">Queue</code>将被绑定到<code i="859">TopicExchange</code>。</font><font o="1614">绑定的每个消费者实例将触发为其组的<code i="861">Queue</code>创建相应的RabbitMQ <code i="860">Consumer</code>实例。</font></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_options"><font o="1615">配置选项</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1616">Spring Cloud Stream支持常规配置选项以及绑定和绑定器的配置。</font><font o="1617">一些绑定器允许额外的绑定属性来支持中间件特定的功能。</font></p>
</div>
<div class="paragraph">
<p><font o="1618">可以通过Spring Boot支持的任何机制向Spring Cloud Stream应用程序提供配置选项。</font><font o="1619">这包括应用程序参数，环境变量和YAML或.properties文件。</font></p>
</div>
<div class="sect2">
<h3 id="_spring_cloud_stream_properties">Spring Cloud Stream Properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1621">spring.cloud.stream.instanceCount</font></dt>
<dd>
<p><font o="1622">应用程序部署实例的数量。</font><font o="1623">必须设置分区，如果使用Kafka。</font></p>
<div class="paragraph">
<p><font o="1624">默认值：<code i="862">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1625">spring.cloud.stream.instanceIndex</font></dt>
<dd>
<p><font o="1626">应用程序的实例索引：从<code i="863">0</code>到<code i="864">instanceCount</code> -1的数字。</font><font o="1627">用于分区和使用Kafka。</font><font o="1628">在Cloud Foundry中自动设置以匹配应用程序的实例索引。</font></p>
</dd>
<dt class="hdlist1"><font o="1629">spring.cloud.stream.dynamicDestinations</font></dt>
<dd>
<p><font o="1630">可以动态绑定的目标列表（例如，在动态路由方案中）。</font><font o="1631">如果设置，只能列出目的地。</font></p>
<div class="paragraph">
<p><font o="1632">默认值：空（允许任何目的地绑定）。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1633">spring.cloud.stream.defaultBinder</font></dt>
<dd>
<p><font o="1634">如果配置了多个绑定器，则使用默认的binder。</font><a href="#multiple-binders"><font o="1635">在Classpath上</font></a><font o="1635">查看</font><a href="#multiple-binders"><font o="1635">多个Binders</font></a><font o="1635">。</font></p>
<div class="paragraph">
<p><font o="1636">默认值：空。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1637">spring.cloud.stream.overrideCloudConnectors</font></dt>
<dd>
<p><font o="1638">此属性仅适用于<code i="865">cloud</code>配置文件激活且Spring Cloud连接器随应用程序一起提供。</font><font o="1639">如果属性为false（默认值），绑定器将检测适合的绑定服务（例如，RabbitMQ绑定器在Cloud Foundry中绑定的RabbitMQ服务），并将使用它来创建连接（通常通过Spring Cloud连接器）。</font><font o="1640">当设置为true时，此属性指示绑定器完全忽略绑定的服务，并依赖Spring Boot属性（例如依赖于RabbitMQ绑定器环境中提供的<code i="866">spring.rabbitmq.*</code>属性）。</font><a href="#multiple-systems"><font o="1641">当连接到多个系统时</font></a><font o="1641">，此属性的典型用法将嵌套在定制环境</font><a href="#multiple-systems"><font o="1641">中</font></a><font o="1641">。</font></p>
<div class="paragraph">
<p><font o="1642">默认值：false。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="binding-properties"><font o="1643">绑定Properties</font></h3>
<div class="paragraph">
<p><font o="1644">绑定属性使用格式<code i="867">spring.cloud.stream.bindings.&lt;channelName&gt;.&lt;property&gt;=&lt;value&gt;</code>提供。</font><font o="1645"><code i="868">&lt;channelName&gt;</code>表示正在配置的通道的名称（例如<code i="870">Source</code>的<code i="869">output</code>）。</font></p>
</div>
<div class="paragraph">
<p><font o="1646">在下面的内容中，我们指出我们在哪里省略了<code i="871">spring.cloud.stream.bindings.&lt;channelName&gt;.</code>前缀，并且只关注属性名称，同时理解前缀将包含在运行时。</font></p>
</div>
<div class="sect3">
<h4 id="_properties_for_use_of_spring_cloud_stream"><font o="1647">Properties使用Spring Cloud Stream</font></h4>
<div class="paragraph">
<p><font o="1648">以下绑定属性可用于输入和输出绑定，并且必须以<code i="872">spring.cloud.stream.bindings.&lt;channelName&gt;.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1649">目的地</font></dt>
<dd>
<p><font o="1650">绑定中间件上的通道的目标目标（例如，RabbitMQ交换机或Kafka主题）。</font><font o="1651">如果通道绑定为消费者，则可以将其绑定到多个目标，并且目标名称可以指定为逗号分隔的字符串值。</font><font o="1652">如果未设置，则使用通道名称。</font></p>
</dd>
<dt class="hdlist1"><font o="1653">组</font></dt>
<dd>
<p><font o="1654">渠道的消费群体。</font><font o="1655">仅适用于入站绑定。</font><font o="1656">参见</font><a href="#consumer-groups"><font o="1656">消费者群体</font></a><font o="1656">。</font></p>
<div class="paragraph">
<p><font o="1657">默认值：null（表示匿名消费者）。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1658">内容类型</font></dt>
<dd>
<p><font o="1659">频道的内容类型。</font><font o="1660">//参见</font><a href="#content type management"><font o="1660">[内容类型管理]</font></a><font o="1660">。</font></p>
<div class="paragraph">
<p><font o="1661">默认值：null（以便不执行类型强制）。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1662">粘合剂</font></dt>
<dd>
<p><font o="1663">这种绑定使用的粘合剂。</font><font o="1664">有关详细信息，请参阅</font><a href="#multiple-binders"><font o="1664">Classpath上的Multiple Binders</font></a><font o="1664">。</font></p>
<div class="paragraph">
<p><font o="1665">默认值：null（默认的binder将被使用，如果存在）。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_consumer_properties"><font o="1666">消费者物业</font></h4>
<div class="paragraph">
<p><font o="1667">以下绑定属性仅适用于输入绑定，并且必须以<code i="873">spring.cloud.stream.bindings.&lt;channelName&gt;.consumer.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1668">并发</font></dt>
<dd>
<p><font o="1669">入站消费者的并发性。</font></p>
<div class="paragraph">
<p><font o="1670">默认值：<code i="874">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1671">分区</font></dt>
<dd>
<p><font o="1672">消费者是否从分区生产者接收数据。</font></p>
<div class="paragraph">
<p><font o="1673">默认值：<code i="875">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1674">headerMode</font></dt>
<dd>
<p><font o="1675">设置为<code i="876">raw</code>时，禁用输入头标题解析。</font><font o="1676">仅适用于不支持消息头的消息中间件，并且需要头部嵌入。</font><font o="1677">入站数据来自外部Spring Cloud Stream应用程序时很有用。</font></p>
<div class="paragraph">
<p><font o="1678">默认值：<code i="877">embeddedHeaders</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1679">maxAttempts</font></dt>
<dd>
<p><font o="1680">重新处理入站邮件的尝试次数。</font></p>
<div class="paragraph">
<p><font o="1681">默认值：<code i="878">3</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1682">backOffInitialInterval</font></dt>
<dd>
<p><font o="1683">退避初始间隔重试。</font></p>
<div class="paragraph">
<p><font o="1684">默认值：<code i="879">1000</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1685">backOffMaxInterval</font></dt>
<dd>
<p><font o="1686">最大回退间隔。</font></p>
<div class="paragraph">
<p><font o="1687">默认值：<code i="880">10000</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1688">backOffMultiplier</font></dt>
<dd>
<p><font o="1689">退避倍数。</font></p>
<div class="paragraph">
<p><font o="1690">默认值：<code i="881">2.0</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_producer_properties"><font o="1691">制作人Properties</font></h4>
<div class="paragraph">
<p><font o="1692">以下绑定属性仅适用于输出绑定，并且必须以<code i="882">spring.cloud.stream.bindings.&lt;channelName&gt;.producer.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1693">partitionKeyExpression</font></dt>
<dd>
<p><font o="1694">一个确定如何分配出站数据的SpEL表达式。</font><font o="1695">如果设置，或者如果设置了<code i="883">partitionKeyExtractorClass</code>，则该通道上的出站数据将被分区，并且<code i="884">partitionCount</code>必须设置为大于1的值才能生效。</font><font o="1696">这两个选项是相互排斥的。</font><font o="1697">请参阅</font><a href="#partitioning"><font o="1697">分区支持</font></a><font o="1697">。</font></p>
<div class="paragraph">
<p><font o="1698">默认值：null。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1699">partitionKeyExtractorClass</font></dt>
<dd>
<p><font o="1700">一个<code i="885">PartitionKeyExtractorStrategy</code>实现。</font><font o="1701">如果设置，或者如果设置了<code i="886">partitionKeyExpression</code>，则该通道上的出站数据将被分区，并且<code i="887">partitionCount</code>必须设置为大于1的值才能生效。</font><font o="1702">这两个选项是相互排斥的。</font><font o="1703">请参阅</font><a href="#partitioning"><font o="1703">分区支持</font></a><font o="1703">。</font></p>
<div class="paragraph">
<p><font o="1704">默认值：null。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1705">partitionSelectorClass</font></dt>
<dd>
<p><font o="1706">一个<code i="888">PartitionSelectorStrategy</code>实现。</font><font o="1707">与<code i="889">partitionSelectorExpression</code>相互排斥。</font><font o="1708">如果没有设置，则分区将被选为<code i="890">hashCode(key) % partitionCount</code>，其中<code i="891">key</code>通过<code i="892">partitionKeyExpression</code>或<code i="893">partitionKeyExtractorClass</code>计算。</font></p>
<div class="paragraph">
<p><font o="1709">默认值：null。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1710">partitionSelectorExpression</font></dt>
<dd>
<p><font o="1711">用于自定义分区选择的SpEL表达式。</font><font o="1712">与<code i="894">partitionSelectorClass</code>相互排斥。</font><font o="1713">如果没有设置，则分区将被选择为<code i="895">hashCode(key) % partitionCount</code>，其中<code i="896">key</code>通过<code i="897">partitionKeyExpression</code>或<code i="898">partitionKeyExtractorClass</code>计算。</font></p>
<div class="paragraph">
<p><font o="1714">默认值：null。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1715">partitionCount</font></dt>
<dd>
<p><font o="1716">如果启用分区，则数据的目标分区数。</font><font o="1717">如果生产者被分区，则必须设置为大于1的值。</font><font o="1718">在Kafka，解释为提示; </font><font o="1719">而是使用更大的和目标主题的分区计数。</font></p>
<div class="paragraph">
<p><font o="1720">默认值：<code i="899">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1721">requiredGroups</font></dt>
<dd>
<p><font o="1722">生成者必须确保消息传递的组合的逗号分隔列表，即使它们在创建之后启动（例如，通过在RabbitMQ中预先创建持久队列）。</font></p>
</dd>
<dt class="hdlist1"><font o="1723">headerMode</font></dt>
<dd>
<p><font o="1724">设置为<code i="900">raw</code>时，禁用输出上的标题嵌入。</font><font o="1725">仅适用于不支持消息头的消息中间件，并且需要头部嵌入。</font><font o="1726">在非Spring Cloud Stream应用程序生成数据时很有用。</font></p>
<div class="paragraph">
<p><font o="1727">默认值：<code i="901">embeddedHeaders</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="binder-specific-configuration"><font o="1728">Binder  - 具体配置</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1729">以下binder，consumer和producer属性特定于binder实现。</font></p>
</div>
<div class="sect2">
<h3 id="_rabbit_specific_settings"><font o="1730">Rabbit-Specific设定</font></h3>
<div class="sect3">
<h4 id="_rabbitmq_binder_properties"><font o="1731">RabbitMQ Binder Properties</font></h4>
<div class="paragraph">
<p><font o="1732">默认情况下，RabbitMQ绑定使用Spring Boot的<code i="902">ConnectionFactory</code>，因此它支持RabbitMQ的所有Spring Boot配置选项。</font><font o="1733">（有关参考，请参阅</font><a href="javascript:;"><font o="1733">Spring Boot文档</font></a><font o="1733">。）RabbitMQ配置选项使用<code i="903">spring.rabbitmq</code>前缀。</font></p>
</div>
<div class="paragraph">
<p><font o="1734">除了Spring Boot选项之外，RabbitMQ binder还支持以下属性：</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1735">spring.cloud.stream.rabbit.binder.adminAddresses</font></dt>
<dd>
<p><font o="1736">RabbitMQ管理插件网址的逗号分隔列表。</font><font o="1737">仅在<code i="904">nodes</code>包含多个条目时使用。</font><font o="1738">此列表中的每个条目必须在<code i="905">spring.rabbitmq.addresses</code>中具有相应的条目。</font></p>
<div class="paragraph">
<p><font o="1739">默认值：空。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1740">spring.cloud.stream.rabbit.binder.nodes</font></dt>
<dd>
<p><font o="1741">RabbitMQ节点名称的逗号分隔列表。</font><font o="1742">当多个条目用于查找队列所在的服务器地址时。</font><font o="1743">此列表中的每个条目必须在<code i="906">spring.rabbitmq.addresses</code>中具有相应的条目。</font></p>
<div class="paragraph">
<p><font o="1744">默认值：空。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1745">spring.cloud.stream.rabbit.binder.compressionLevel</font></dt>
<dd>
<p><font o="1746">压缩绑定的压缩级别。</font><font o="1747">见<code i="907">java.util.zip.Deflater</code>。</font></p>
<div class="paragraph">
<p><font o="1748">默认值：<code i="908">1</code>（BEST_LEVEL）。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rabbitmq_consumer_properties"><font o="1749">RabbitMQ消费者Properties</font></h4>
<div class="paragraph">
<p><font o="1750">以下属性仅适用于Rabbit用户，必须以<code i="909">spring.cloud.stream.rabbit.bindings.&lt;channelName&gt;.consumer.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1751">acknowledgeMode</font></dt>
<dd>
<p><font o="1752">确认模式。</font></p>
<div class="paragraph">
<p><font o="1753">默认值：<code i="910">AUTO</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1754">autoBindDlq</font></dt>
<dd>
<p><font o="1755">是否自动声明DLQ并将其绑定到绑定器DLX。</font></p>
<div class="paragraph">
<p><font o="1756">默认值：<code i="911">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1757">durableSubscription</font></dt>
<dd>
<p><font o="1758">订阅是否应该耐用。</font><font o="1759">仅当<code i="912">group</code>也被设置时才有效。</font></p>
<div class="paragraph">
<p><font o="1760">默认值：<code i="913">true</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1761">maxConcurrency</font></dt>
<dd>
<p><font o="1762">默认值：<code i="914">1</code>。</font></p>
</dd>
<dt class="hdlist1"><font o="1763">预取</font></dt>
<dd>
<p><font o="1764">预取计数。</font></p>
<div class="paragraph">
<p><font o="1765">默认值：<code i="915">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1766">字首</font></dt>
<dd>
<p><font o="1767">要添加到<code i="916">destination</code>和队列名称的前缀。</font></p>
<div class="paragraph">
<p><font o="1768">默认值：“”。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1769">recoveryInterval</font></dt>
<dd>
<p><font o="1770">连接恢复尝试之间的间隔，以毫秒为单位。</font></p>
<div class="paragraph">
<p><font o="1771">默认值：<code i="917">5000</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1772">requeueRejected</font></dt>
<dd>
<p><font o="1773">是否应重新发送送货失败。</font></p>
<div class="paragraph">
<p><font o="1774">默认值：<code i="918">true</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1775">requestHeaderPatterns</font></dt>
<dd>
<p><font o="1776">要传输的请求头。</font></p>
<div class="paragraph">
<p><font o="1777">默认值：<code i="919">[STANDARD_REQUEST_HEADERS,'*']</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1778">replyHeaderPatterns</font></dt>
<dd>
<p><font o="1779">要运输的回复标题</font></p>
<div class="paragraph">
<p><font o="1780">默认值：<code i="920">[STANDARD_REPLY_HEADERS,'*']</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1781">republishToDlq</font></dt>
<dd>
<p><font o="1782">默认情况下，尝试重试后失败的消息将被拒绝。</font><font o="1783">如果配置了死信队列（DLQ），则RabbitMQ会将失败的消息（未更改）路由到DLQ。</font><font o="1784">如果设置为<code i="921">true</code>，则总线将重新发布带有附加头的DLQ的失败消息，包括最终故障原因的异常消息和堆栈跟踪。</font></p>
</dd>
<dt class="hdlist1"><font o="1785">交易</font></dt>
<dd>
<p><font o="1786">是否使用交易渠道。</font></p>
<div class="paragraph">
<p><font o="1787">默认值：<code i="922">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1788">txSize</font></dt>
<dd>
<p><font o="1789">阿克斯之间的交付次数。</font></p>
<div class="paragraph">
<p><font o="1790">默认值：<code i="923">1</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rabbit_producer_properties"><font o="1791">Rabbit生产者Properties</font></h4>
<div class="paragraph">
<p><font o="1792">以下属性仅适用于Rabbit生产者，必须以<code i="924">spring.cloud.stream.rabbit.bindings.&lt;channelName&gt;.producer.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1793">autoBindDlq</font></dt>
<dd>
<p><font o="1794">是否自动声明DLQ并将其绑定到绑定器DLX。</font></p>
<div class="paragraph">
<p><font o="1795">默认值：<code i="925">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1796">batchingEnabled</font></dt>
<dd>
<p><font o="1797">是否启用生产者的消息批处理。</font></p>
<div class="paragraph">
<p><font o="1798">默认值：<code i="926">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1799">BATCHSIZE</font></dt>
<dd>
<p><font o="1800">批量启动时要缓冲的消息数。</font></p>
<div class="paragraph">
<p><font o="1801">默认值：<code i="927">100</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1802">batchBufferLimit</font></dt>
<dd>
<p><font o="1803">默认值：<code i="928">10000</code>。</font></p>
</dd>
<dt class="hdlist1"><font o="1804">batchTimeout</font></dt>
<dd>
<p><font o="1805">默认值：<code i="929">5000</code>。</font></p>
</dd>
<dt class="hdlist1"><font o="1806">压缩</font></dt>
<dd>
<p><font o="1807">发送时是否应压缩数据。</font></p>
<div class="paragraph">
<p><font o="1808">默认值：<code i="930">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1809">deliveryMode</font></dt>
<dd>
<p><font o="1810">交货方式。</font></p>
<div class="paragraph">
<p><font o="1811">默认值：<code i="931">PERSISTENT</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1812">字首</font></dt>
<dd>
<p><font o="1813">要添加到<code i="932">destination</code>交换机名称的前缀。</font></p>
<div class="paragraph">
<p><font o="1814">默认值：“”。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1815">requestHeaderPatterns</font></dt>
<dd>
<p><font o="1816">要传输的请求头。</font></p>
<div class="paragraph">
<p><font o="1817">默认值：<code i="933">[STANDARD_REQUEST_HEADERS,'*']</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1818">replyHeaderPatterns</font></dt>
<dd>
<p><font o="1819">要运输的回复标题</font></p>
<div class="paragraph">
<p><font o="1820">默认值：<code i="934">[STANDARD_REPLY_HEADERS,'*']</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_specific_settings"><font o="1821">Kafka  - 具体设置</font></h3>
<div class="sect3">
<h4 id="_kafka_binder_properties">Kafka Binder Properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1823">spring.cloud.stream.kafka.binder.brokers</font></dt>
<dd>
<p><font o="1824">Kafka活页夹连接到的经纪人列表。</font></p>
<div class="paragraph">
<p><font o="1825">默认值：<code i="935">localhost</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1826">spring.cloud.stream.kafka.binder.defaultBrokerPort</font></dt>
<dd>
<p><font o="1827"><code i="936">brokers</code>允许有或没有端口信息指定的主机（例如，<code i="937">host1,host2:port2</code>）。</font><font o="1828">当在代理列表中没有配置端口时，这将设置默认端口。</font></p>
<div class="paragraph">
<p><font o="1829">默认值：<code i="938">9092</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1830">spring.cloud.stream.kafka.binder.zkNodes</font></dt>
<dd>
<p><font o="1831">可以连接Kafka绑定器的ZooKeeper节点列表。</font></p>
<div class="paragraph">
<p><font o="1832">默认值：<code i="939">localhost</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1833">spring.cloud.stream.kafka.binder.defaultZkPort</font></dt>
<dd>
<p><font o="1834"><code i="940">zkNodes</code>允许有或没有端口信息指定的主机（例如<code i="941">host1,host2:port2</code>）。</font><font o="1835">当在节点列表中没有配置端口时，这将设置默认端口。</font></p>
<div class="paragraph">
<p><font o="1836">默认值：<code i="942">2181</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1837">spring.cloud.stream.kafka.binder.headers</font></dt>
<dd>
<p><font o="1838">将由活页夹传送的自定义标题列表。</font></p>
<div class="paragraph">
<p><font o="1839">默认值：空。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1840">spring.cloud.stream.kafka.binder.offsetUpdateTimeWindow</font></dt>
<dd>
<p><font o="1841">以毫秒为单位的频率（以毫秒为单位）保存偏移量。</font><font o="1842"><code i="943">0</code>忽略。</font></p>
<div class="paragraph">
<p><font o="1843">默认值：<code i="944">10000</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1844">spring.cloud.stream.kafka.binder.offsetUpdateCount</font></dt>
<dd>
<p><font o="1845">频率，更新次数，哪些消耗的偏移量会持续存在。</font><font o="1846"><code i="945">0</code>忽略。</font><font o="1847">与<code i="946">offsetUpdateTimeWindow</code>相互排斥。</font></p>
<div class="paragraph">
<p><font o="1848">默认值：<code i="947">0</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1849">spring.cloud.stream.kafka.binder.requiredAcks</font></dt>
<dd>
<p><font o="1850">经纪人所需的acks数量。</font></p>
<div class="paragraph">
<p><font o="1851">默认值：<code i="948">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1852">spring.cloud.stream.kafka.binder.minPartitionCount</font></dt>
<dd>
<p><font o="1853">只有设置<code i="949">autoCreateTopics</code>或<code i="950">autoAddPartitions</code>才有效。</font><font o="1854">绑定器在其生成/消耗数据的主题上配置的全局最小分区数。</font><font o="1855">它可以由生产者的<code i="951">partitionCount</code>设置或制造商的<code i="952">instanceCount</code> * <code i="953">concurrency</code>设置的值替代（如果更大）。</font></p>
<div class="paragraph">
<p><font o="1856">默认值：<code i="954">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1857">spring.cloud.stream.kafka.binder.replicationFactor</font></dt>
<dd>
<p><font o="1858">如果<code i="955">autoCreateTopics</code>处于活动状态，则自动创建主题的复制因子。</font></p>
<div class="paragraph">
<p><font o="1859">默认值：<code i="956">1</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1860">spring.cloud.stream.kafka.binder.autoCreateTopics</font></dt>
<dd>
<p><font o="1861">如果设置为<code i="957">true</code>，则活页夹将自动创建新主题。</font><font o="1862">如果设置为<code i="958">false</code>，则绑定器将依赖于已配置的主题。</font><font o="1863">在后一种情况下，如果主题不存在，则绑定器将无法启动。</font><font o="1864">值得注意的是，此设置与代理的<code i="959">auto.topic.create.enable</code>设置无关，并不影响它：如果服务器设置为自动创建主题，则可以将其创建为元数据检索请求的一部分，并使用默认代理设置。</font></p>
<div class="paragraph">
<p><font o="1865">默认值：<code i="960">true</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1866">spring.cloud.stream.kafka.binder.autoAddPartitions</font></dt>
<dd>
<p><font o="1867">如果设置为<code i="961">true</code>，则绑定器将根据需要创建新的分区。</font><font o="1868">如果设置为<code i="962">false</code>，则绑定器将依赖于已配置的主题的分区大小。</font><font o="1869">如果目标主题的分区计数小于预期值，则绑定器将无法启动。</font></p>
<div class="paragraph">
<p><font o="1870">默认值：<code i="963">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1871">spring.cloud.stream.kafka.binder.socketBufferSize</font></dt>
<dd>
<p><font o="1872">Kafka消费者使用的套接字缓冲区的大小（以字节为单位）。</font></p>
<div class="paragraph">
<p><font o="1873">默认值：<code i="964">2097152</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_consumer_properties"><font o="1874">Kafka消费者Properties</font></h4>
<div class="paragraph">
<p><font o="1875">以下属性仅适用于Kafka消费者，必须以<code i="965">spring.cloud.stream.kafka.bindings.&lt;channelName&gt;.consumer.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1876">autoCommitOffset</font></dt>
<dd>
<p><font o="1877">是否在处理邮件时自动提交偏移量。</font><font o="1878">如果设置为<code i="966">false</code>，则在消息头中将有一个<code i="967">Acknowledgment</code>头可用于延迟确认。</font></p>
<div class="paragraph">
<p><font o="1879">默认值：<code i="968">true</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1880">autoCommitOnError</font></dt>
<dd>
<p><font o="1881">只有<code i="969">autoCommitOffset</code>设置为<code i="970">true</code>才有效。</font><font o="1882">如果设置为<code i="971">false</code>，它会禁止导致错误的消息的自动提交，并且仅针对成功的消息进行提交，允许流在上次成功处理的消息中自动重播，以防持续发生故障。</font><font o="1883">如果设置为<code i="972">true</code>，它将始终自动提交（如果启用了自动提交）。</font><font o="1884">如果没有设置（默认），它实际上具有与<code i="973">enableDlq</code>相同的值，如果它们发送到DLQ，则自动提交错误消息，否则不提交错误消息。</font></p>
<div class="paragraph">
<p><font o="1885">默认值：未设置。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1886">recoveryInterval</font></dt>
<dd>
<p><font o="1887">连接恢复尝试之间的间隔，以毫秒为单位。</font></p>
<div class="paragraph">
<p><font o="1888">默认值：<code i="974">5000</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1889">resetOffsets</font></dt>
<dd>
<p><font o="1890">是否将消费者的偏移量重置为<code i="975">startOffset</code>提供的值。</font></p>
<div class="paragraph">
<p><font o="1891">默认值：<code i="976">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1892">开始偏移</font></dt>
<dd>
<p><font o="1893">新组的起始偏移量，或<code i="977">resetOffsets</code>为<code i="978">true</code>时。</font><font o="1894">允许的值：<code i="979">earliest</code>，<code i="980">latest</code>。</font></p>
<div class="paragraph">
<p><font o="1895">默认值：null（相当于<code i="981">earliest</code>）。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1896">enableDlq</font></dt>
<dd>
<p><font o="1897">当设置为true时，它将为消费者发送启用DLQ行为。</font><font o="1898">导致错误的消息将转发到名为<code i="982">error.&lt;destination&gt;.&lt;group&gt;</code>的主题。</font><font o="1899">对于错误数量相对较小并且重播整个原始主题可能太麻烦的情况，这为更常见的Kafka重播场景提供了替代选项。</font></p>
<div class="paragraph">
<p><font o="1900">默认值：<code i="983">false</code>。</font></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_producer_properties"><font o="1901">Kafka生产者Properties</font></h4>
<div class="paragraph">
<p><font o="1902">以下属性仅适用于Kafka生产者，并且必须以<code i="984">spring.cloud.stream.kafka.bindings.&lt;channelName&gt;.producer.</code>为前缀。</font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font o="1903">缓冲区大小</font></dt>
<dd>
<p><font o="1904">上限（以字节为单位），Kafka生产者将在发送之前尝试批量的数据量。</font></p>
<div class="paragraph">
<p><font o="1905">默认值：<code i="985">16384</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1906">同步</font></dt>
<dd>
<p><font o="1907">生产者是否是同步的</font></p>
<div class="paragraph">
<p><font o="1908">默认值：<code i="986">false</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1909">batchTimeout</font></dt>
<dd>
<p><font o="1910">生产者在发送之前等待多长时间，以便允许更多消息在同一批次中累积。</font><font o="1911">（通常，生产者根本不等待，并且简单地发送在先前发送进行中累积的所有消息。）非零值可能会以延迟为代价增加吞吐量。</font></p>
<div class="paragraph">
<p><font o="1912">默认值：<code i="987">0</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1913">maxRequestSize</font></dt>
<dd>
<p><font o="1914">消息发送请求的最大大小。</font></p>
<div class="paragraph">
<p><font o="1915">默认值：<code i="988">1048576</code>。</font></p>
</div>
</dd>
<dt class="hdlist1"><font o="1916">组态</font></dt>
<dd>
<p><font o="1917">使用包含通用Kafka生产者属性的键/值对映射。</font></p>
<div class="paragraph">
<p><font o="1918">默认值：空地图。</font></p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contenttypemanagement"><font o="1919">内容类型和转换</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="1920">要允许您传播有关所生成消息的内容类型的信息，Spring Cloud Stream默认情况下会将<code i="989">contentType</code>标头附加到出站消息。</font><font o="1921">对于不直接支持头文件的中间件，Spring Cloud Stream提供了自己将出站邮件自动包装在自己的信封中的机制。</font><font o="1922">对于支持头文件的中间件，Spring Cloud Stream应用程序可以从非Spring Cloud Stream应用程序接收具有给定内容类型的消息。</font></p>
</div>
<div class="paragraph">
<p><font o="1923">Spring Cloud Stream可以通过两种方式处理基于此信息的消息：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="1924">通过其入站和出站渠道的<code i="990">contentType</code>设置</font></p>
</li>
<li>
<p><font o="1925">通过对使用<code i="991">@StreamListener</code>注释的方法执行的参数映射</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1926">Spring Cloud Stream允许您使用绑定的<code i="992">content-type</code>属性声明式配置输入和输出的类型转换。</font><font o="1927">请注意，一般类型转换也可以通过在应用程序中使用变压器轻松实现。</font><font o="1928">目前，Spring Cloud Stream本机支持流中常用的以下类型转换：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><font></font></strong><font o="1929">来自/从</font><strong><font o="1929">POJO的</font></strong><strong><font o="1929">JSON</font></strong><strong><font></font></strong></p>
</li>
<li>
<p><strong><font o="1930">JSON</font></strong><font o="1930"> /从</font><a href="javascript:;"><font o="1930">org.springframework.tuple.Tuple</font></a></p>
</li>
<li>
<p><strong><font o="1931">对象</font></strong><font o="1931">到/来自</font><strong><font o="1931">byte []</font></strong><font o="1931">：用于远程传输的原始字节序列化，应用程序发出的字节，或使用Java序列化转换为字节（要求对象为Serializable）</font></p>
</li>
<li>
<p><strong><font o="1932">字符串</font></strong><font o="1932">到/来自</font><strong><font o="1932">byte []</font></strong></p>
</li>
<li>
<p><strong><font o="1933">对象</font></strong><font o="1933">到</font><strong><font o="1933">纯文本</font></strong><font o="1933">（调用对象的</font><em><font o="1933">toString（）</font></em><font o="1933">方法）</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="1934">其中</font><em><font o="1934">JSON</font></em><font o="1934">表示包含</font><em><font o="1934">JSON</font></em><font o="1934">的字节数组或字符串有效负载。</font><font o="1935">目前，对象可以从JSON字节数组或字符串转换。</font><font o="1936">转换为JSON总是产生一个String。</font></p>
</div>
<div class="sect2">
<h3 id="mime-types"><font o="1937">MIME类型</font></h3>
<div class="paragraph">
<p><font o="1938"><code i="993">content-type</code>值被解析为媒体类型，例如<code i="994">application/json</code>或<code i="995">text/plain;charset=UTF-8</code>。</font><font o="1939">MIME类型对于指示如何转换为String或byte []内容特别有用。</font><font o="1940">Spring Cloud Stream还使用MIME类型格式来表示Java类型，使用具有<code i="997">type</code>参数的一般类型<code i="996">application/x-java-object</code>。</font><font o="1941">例如，可以将<code i="998">application/x-java-object;type=java.util.Map</code>或<code i="999">application/x-java-object;type=com.bar.Foo</code>设置为输入绑定的<code i="1000">content-type</code>属性。</font><font o="1942">此外，Spring Cloud Stream提供自定义MIME类型，特别是<code i="1001">application/x-spring-tuple</code>来指定元组。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="mime-types-and-java-types"><font o="1943">MIME类型和Java类型</font></h3>
<div class="paragraph">
<p><font o="1944">开箱即用的类型转换Spring Cloud Stream总结如下表：</font></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font o="1945">来源有效载荷</font></th>
<th class="tableblock halign-left valign-top"><font o="1946">目标有效载荷</font></th>
<th class="tableblock halign-left valign-top"><font o="1947">内容类型标题</font></th>
<th class="tableblock halign-left valign-top"><font o="1948">内容类型</font></th>
<th class="tableblock halign-left valign-top"><font o="1949">注释</font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">JSON String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/json</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Tuple</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">JSON String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="1950">JSON是为Tuple量身定制的</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">String (toString())</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">text/plain, java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">byte[] (java.io serialized)</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/x-java-serialized-object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">JSON byte[] or String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/json (or none)</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/x-java-object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">byte[] or String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Serializable</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/x-java-serialized-object</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/x-java-object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">JSON byte[] or String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Tuple</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/json (or none)</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/x-spring-tuple</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">text/plain, java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="1951">将应用在content-type头中指定的任何Charset</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application/octet-stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="1952">将应用在content-type头中指定的任何Charset</font></p></td>
</tr>
</tbody>
</table>
<div id="NOTE" class="paragraph">
<p><font o="1953">转换适用于需要类型转换的有效内容。</font><font o="1954">例如，如果一个模块生成一个带有outputType = application / json的XML字符串，则该有效负载将不会从XML转换为JSON。</font><font o="1955">这是因为模块输出通道的有效载荷已经是一个字符串，所以在运行时不会使用任何转换。</font></p>
</div>
<div id="TIP" class="paragraph">
<p><font o="1956">虽然输入和输出通道都支持转换，但特别推荐将其用于转发出站消息。</font><font o="1957">对于入站邮件的转换，特别是当目标是POJO时，<code i="1002">@StreamListener</code>支持将自动执行转换。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="__code_streamlistener_code_and_message_conversion"><font o="1958"><code i="1003">@StreamListener</code>和讯息转换</font></h3>
<div class="paragraph">
<p><font o="1959"><code i="1004">@StreamListener</code>注释提供了一种方便的方式来转换传入的消息，而不需要指定输入通道的内容类型。</font><font o="1960">在使用<code i="1005">@StreamListener</code>注释的方法的调度过程中，如果参数需要，将自动应用转换。</font></p>
</div>
<div class="paragraph">
<p><font o="1961">例如，让我们考虑一个带有<code i="1006">{"greeting":"Hello, world"}</code>的String内容的消息，并且在输入通道上接收到<code i="1008">application/json</code>的<code i="1008">application/json</code>标题。</font><font o="1962">让我们考虑接收它的以下应用程序：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public class GreetingMessage {

  String greeting;

  public String getGreeting() {
    return greeting;
  }

  public void setGreeting(String greeting) {
    this.greeting = greeting;
  }
}

@EnableBinding(Sink.class)
@EnableAutoConfiguration
public static class GreetingSink {

		@StreamListener(Sink.INPUT)
		public void receive(Greeting greeting) {
			// handle Greeting
		}
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="1963">该方法的参数将自动填充包含JSON字符串的未编组形式的POJO。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inter_application_communication"><font o="1964">应用间通信</font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_connecting_multiple_application_instances"><font o="1965">连接多个应用程序实例</font></h3>
<div class="paragraph">
<p><font o="1966">虽然Spring Cloud Stream可以使个人Spring Boot应用程序轻松连接到邮件系统，但Spring Cloud Stream的典型场景是创建多应用程序管道，其中微服务应用程序将数据发送给彼此。</font><font o="1967">您可以通过将相邻应用程序的输入和输出目标相关联来实现此场景。</font></p>
</div>
<div class="paragraph">
<p><font o="1968">假设设计要求时间源应用程序将数据发送到日志接收应用程序，则可以在两个应用程序中使用名为<code i="1009">ticktock</code>的公用目标来进行绑定。</font></p>
</div>
<div class="paragraph">
<p><font o="1969">时间源将设置以下属性：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">spring.cloud.stream.bindings.output.destination=ticktock</pre>
</div>
</div>
<div class="paragraph">
<p><font o="1970">日志接收器将设置以下属性：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">spring.cloud.stream.bindings.input.destination=ticktock</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_instance_index_and_instance_count"><font o="1971">实例索引和实例计数</font></h3>
<div class="paragraph">
<p><font o="1972">当扩展Spring Cloud Stream应用程序时，每个实例都可以接收有关同一应用程序的其他实例数量以及自己的实例索引的信息。</font><font o="1973">Spring Cloud Stream通过<code i="1010">spring.cloud.stream.instanceCount</code>和<code i="1011">spring.cloud.stream.instanceIndex</code>属性执行此操作。</font><font o="1974">例如，如果HDFS宿应用程序有三个实例，则所有三个实例将<code i="1012">spring.cloud.stream.instanceCount</code>设置为<code i="1013">3</code>，并且各个应用程序将<code i="1014">spring.cloud.stream.instanceIndex</code>设置为<code i="1015">0</code>，<code i="1016">1</code>和<code i="1017">2</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="1975">当通过Spring Cloud数据流部署Spring Cloud Stream应用程序时，这些属性将自动配置; </font><font o="1976">当独立启动Spring Cloud Stream应用程序时，必须正确设置这些属性。</font><font o="1977">默认情况下，<code i="1018">spring.cloud.stream.instanceCount</code>为<code i="1019">1</code>，<code i="1020">spring.cloud.stream.instanceIndex</code>为<code i="1021">0</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="1978">在放大的情况下，正确配置这两个属性对于解决分区行为（见下文）一般很重要，并且某些绑定器（例如，Kafka绑定器）始终需要两个属性，以确保该数据在多个消费者实例之间正确分割。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_partitioning"><font o="1979">分区</font></h3>
<div class="sect3">
<h4 id="_configuring_output_bindings_for_partitioning"><font o="1980">配置输出绑定进行分区</font></h4>
<div class="paragraph">
<p><font o="1981">输出绑定配置为通过设置其唯一的一个<code i="1022">partitionKeyExpression</code>或<code i="1023">partitionKeyExtractorClass</code>属性以及其<code i="1024">partitionCount</code>属性来发送分区数据。</font><font o="1982">例如，以下是一个有效和典型的配置：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">spring.cloud.stream.bindings.output.producer.partitionKeyExpression=payload.id
spring.cloud.stream.bindings.output.producer.partitionCount=5</pre>
</div>
</div>
<div class="paragraph">
<p><font o="1983">基于上述示例配置，使用以下逻辑将数据发送到目标分区。</font></p>
</div>
<div class="paragraph">
<p><font o="1984">根据<code i="1025">partitionKeyExpression</code>，为发送到分区输出通道的每个消息计算分区密钥的值。</font><font o="1985"><code i="1026">partitionKeyExpression</code>是一个Spel表达式，根据出站消息进行评估，以提取分区密钥。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1986">提示</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1987">如果SpEL表达式不足以满足您的需要，您可以通过将属性<code i="1027">partitionKeyExtractorClass</code>设置为实现<code i="1028">org.springframework.cloud.stream.binder.PartitionKeyExtractorStrategy</code>接口的类来计算分区键值。</font><font o="1988">虽然Spel表达式通常足够，但更复杂的情况可能会使用自定义实现策略。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="1989">一旦计算了消息密钥，分区选择过程将确定目标分区为<code i="1029">0</code>和<code i="1030">partitionCount - 1</code>之间的值。</font><font o="1990">在大多数情况下，默认计算基于公式<code i="1031">key.hashCode() % partitionCount</code>。</font><font o="1991">这可以通过将绑定表达式设置为针对密钥（通过<code i="1032">partitionSelectorExpression</code>属性）进行评估）或通过设置<code i="1033">org.springframework.cloud.stream.binder.PartitionSelectorStrategy</code>实现（通过<code i="1034">partitionSelectorClass</code>属性）来进行自定义。</font></p>
</div>
<div class="paragraph">
<p><font o="1992">可以为更高级的场景配置其他属性，如以下部分所述。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="1993">注意</font></div>
</td>
<td class="content">
<div class="paragraph">
<p><font o="1994">Kafka绑定器将使用<code i="1035">partitionCount</code>设置作为提示，以创建具有给定分区计数的主题（与<code i="1036">minPartitionCount</code>结合，最大值为所使用的值）。</font><font o="1995">配置绑定器的<code i="1037">minPartitionCount</code>和应用程序的<code i="1038">partitionCount</code>时要小心，因为将使用较大的值。</font><font o="1996">如果主题已经存在较小的分区计数，并且<code i="1039">autoAddPartitions</code>被禁用（默认值），则绑定器将无法启动。</font><font o="1997">如果一个主题已经存在较小的分区计数，并启用了<code i="1040">autoAddPartitions</code>，则新的分区将被添加。</font><font o="1998">如果一个主题已经存在的分区数量大于（<code i="1041">minPartitionCount</code>和<code i="1042">partitionCount</code>）的最大值，则会使用现有的分区计数。</font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_configuring_input_bindings_for_partitioning"><font o="1999">配置输入绑定进行分区</font></h5>
<div class="paragraph">
<p><font o="2000">输入绑定被配置为通过在应用程序本身设置其<code i="1043">partitioned</code>属性以及<code i="1044">instanceIndex</code>和<code i="1045">instanceCount</code>属性来接收分区数据，如以下示例所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">spring.cloud.stream.bindings.input.consumer.partitioned=true
spring.cloud.stream.instanceIndex=3
spring.cloud.stream.instanceCount=5</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2001"><code i="1046">instanceCount</code>值表示数据需要分区的应用实例的总数，<code i="1047">instanceIndex</code>必须是<code i="1048">0</code>和<code i="1049">instanceCount - 1</code>之间的多个实例之间的唯一值。</font><font o="2002">实例索引帮助每个应用程序实例识别从其接收数据的唯一分区（或在分区集合的Kafka的情况下）。</font><font o="2003">重要的是正确设置两个值，以确保所有数据都被使用，并且应用程序实例接收到互斥数据集。</font></p>
</div>
<div class="paragraph">
<p><font o="2004">虽然使用多个实例进行分区数据处理的场景可能会在独立情况下进行复杂化，但是通过将输入和输出值正确填充并依赖于运行时基础架构，Spring Cloud数据流可以显着简化流程，提供有关实例索引和实例计数的信息。</font></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing"><font o="2005">测试</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2006">Spring Cloud Stream提供对测试您的微服务应用程序的支持，而无需连接到消息系统。</font><font o="2007">您可以使用<code i="1050">TestSupportBinder</code>来做到这一点。</font><font o="2008">这对于您的微服务单元测试尤其有用。</font></p>
</div>
<div class="paragraph">
<p><font o="2009"><code i="1051">TestSupportBinder</code>允许用户与绑定的频道进行交互，并检查应用程序发送和接收的消息</font></p>
</div>
<div class="paragraph">
<p><font o="2010">对于出站消息通道，<code i="1052">TestSupportBinder</code>注册单个订户，并将应用程序发出的消息保留在<code i="1053">MessageCollector</code>中。</font><font o="2011">它们可以在测试过程中被检索，并对它们做出断言。</font></p>
</div>
<div class="paragraph">
<p><font o="2012">用户还可以将消息发送到入站消息通道，以便消费者应用程序可以使用消息。</font><font o="2013">以下示例显示了如何在处理器上测试输入和输出通道。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(classes = ExampleTest.MyProcessor.class)
@IntegrationTest({"server.port=-1"})
@DirtiesContext
public class ExampleTest {

  @Autowired
  private Processor processor;

  @Autowired
  private BinderFactory&lt;MessageChannel&gt; binderFactory;

  @Autowired
  private MessageCollector messageCollector;

  @Test
  @SuppressWarnings("unchecked")
  public void testWiring() {
    Message&lt;String&gt; message = new GenericMessage&lt;&gt;("hello");
    processor.input().send(message);
    Message&lt;String&gt; received = (Message&lt;String&gt;) messageCollector.forChannel(processor.output()).poll();
    assertThat(received.getPayload(), equalTo("hello world"));
  }


  @SpringBootApplication
  @EnableBinding(Processor.class)
  public static class MyProcessor {

    @Autowired
    private Processor channels;

    @Transformer(inputChannel = Processor.INPUT, outputChannel = Processor.OUTPUT)
    public String transform(String in) {
      return in + " world";
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2014">在上面的示例中，我们正在创建一个具有输入和输出通道的应用程序，通过<code i="1054">Processor</code>界面绑定。</font><font o="2015">绑定的接口被注入测试，所以我们可以访问这两个通道。</font><font o="2016">我们在输入通道上发送消息，我们使用Spring Cloud Stream测试支持提供的<code i="1055">MessageCollector</code>来捕获消息已经发送到输出通道。</font><font o="2017">收到消息后，我们可以验证组件是否正常工作。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_health_indicator_3"><font o="2018">健康指标</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2019">Spring Cloud Stream为粘合剂提供健康指标。</font><font o="2020">它以<code i="1056">binders</code>的名义注册，可以通过设置<code i="1057">management.health.binders.enabled</code>属性启用或禁用。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_samples"><font o="2021">样品</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2022">对于Spring Cloud Stream样本，请参考</font><font o="2022">GitHub上</font><font o="2022">的</font><a href="javascript:;"><font o="2022">spring-cloud-stream-samples</font></a><font o="2022">库。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><font o="2023">入门</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2024">要开始创建Spring Cloud Stream应用程序，请访问</font><a href="javascript:;"><font o="2024">Spring Initializr</font></a><font o="2024">并创建一个名为“GreetingSource”的新Maven项目。</font><font o="2025">选择Spring Boot版本1.3.4 SNAPSHOT，并搜索或勾选Stream Kafka的复选框（我们将使用Kafka进行消息传递）。</font></p>
</div>
<div class="paragraph">
<p><font o="2026">接下来，在与<code i="1059">GreetingSourceApplication</code>类相同的包中创建一个新类<code i="1058">GreetingSource</code>。</font><font o="2027">给它以下代码：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">import org.springframework.cloud.stream.annotation.EnableBinding;
import org.springframework.cloud.stream.messaging.Source;
import org.springframework.integration.annotation.InboundChannelAdapter;

@EnableBinding(Source.class)
public class GreetingSource {

    @InboundChannelAdapter(Source.OUTPUT)
    public String greet() {
        return "hello world " + System.currentTimeMillis();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2028"><code i="1060">@EnableBinding</code>注释是什么触发了Spring Integration基础架构组件的创建。</font><font o="2029">具体来说，它将创建一个Kafka连接工厂，一个Kafka出站通道适配器，并在Source界面中定义消息通道：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">public interface Source {

  String OUTPUT = "output";

  @Output(Source.OUTPUT)
  MessageChannel output();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2030">自动配置还创建一个默认轮询器，以便每秒调用<code i="1061">greet()</code>方法一次。</font><font o="2031">标准的Spring Integration <code i="1062">@InboundChannelAdapter</code>注释使用返回值作为消息的有效内容向源的输出通道发送消息。</font></p>
</div>
<div class="paragraph">
<p><font o="2032">要测试驱动此设置，请运行Kafka消息代理。</font><font o="2033">一个简单的方法是使用Docker镜像：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code># On OS X
$ docker run -p 2181:2181 -p 9092:9092 --env ADVERTISED_HOST=`docker-machine ip \`docker-machine active\`` --env ADVERTISED_PORT=9092 spotify/kafka

# On Linux
$ docker run -p 2181:2181 -p 9092:9092 --env ADVERTISED_HOST=localhost --env ADVERTISED_PORT=9092 spotify/kafka</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2034">构建应用程序：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">./mvnw clean package</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2035">消费者应用程序以类似的方式进行编码。</font><font o="2036">返回Initializr并创建另一个名为LoggingSink的项目。</font><font o="2037">然后在与类<code i="1064">LoggingSinkApplication</code>相同的包中创建一个新类<code i="1063">LoggingSink</code>，并使用以下代码：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">import org.springframework.cloud.stream.annotation.EnableBinding;
import org.springframework.cloud.stream.annotation.StreamListener;
import org.springframework.cloud.stream.messaging.Sink;

@EnableBinding(Sink.class)
public class LoggingSink {

    @StreamListener(Sink.INPUT)
    public void log(String message) {
        System.out.println(message);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2038">构建应用程序：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">./mvnw clean package</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2039">要将GreetingSource应用程序连接到LoggingSink应用程序，每个应用程序必须共享相同的目标名称。</font><font o="2040">启动这两个应用程序如下所示，您将看到消费者应用程序打印“hello world”和时间戳到控制台：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>cd GreetingSource
java -jar target/GreetingSource-0.0.1-SNAPSHOT.jar --spring.cloud.stream.bindings.output.destination=mydest

cd LoggingSink
java -jar target/LoggingSink-0.0.1-SNAPSHOT.jar --server.port=8090 --spring.cloud.stream.bindings.input.destination=mydest</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2041">（不同的服务器端口可以防止两个应用程序中用于维护Spring Boot Actuator端点的HTTP端口的冲突。）</font></p>
</div>
<div class="paragraph">
<p><font o="2042">LoggingSink应用程序的输出将如下所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>[           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8090 (http)
[           main] com.example.LoggingSinkApplication       : Started LoggingSinkApplication in 6.828 seconds (JVM running for 7.371)
hello world 1458595076731
hello world 1458595077732
hello world 1458595078733
hello world 1458595079734
hello world 1458595080735</code></pre>
</div>
</div>
</div>
</div>
<h1 id="_spring_cloud_bus" class="sect0">Spring Cloud Bus</h1>
<div class="openblock partintro">
<div class="content"><font o="2044">
Spring Cloud Bus将分布式系统的节点与轻量级消息代理链接。</font><font o="2045">这可以用于广播状态更改（例如配置更改）或其他管理指令。</font><font o="2046">一个关键的想法是，总线就像一个分布式执行器，用于扩展的Spring Boot应用程序，但也可以用作应用程序之间的通信通道。</font><font o="2047">目前唯一的实现是使用AMQP代理作为传输，但是相同的基本功能集（还有一些取决于传输）在其他传输的路线图上。
</font></div>
</div>
<div class="sect1">
<h2 id="_quick_start_2"><font o="2048">快速开始</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2049">Spring Cloud Bus的工作原理是添加Spring Boot自动配置，如果它在类路径中检测到自身。</font><font o="2050">所有您需要做的是启用总线是将<code i="1065">spring-cloud-starter-bus-amqp</code>或<code i="1066">spring-cloud-starter-bus-kafka</code>添加到您的依赖关系管理中，Spring Cloud负责其余部分。</font><font o="2051">确保代理（RabbitMQ或Kafka）可用和配置：在本地主机上运行您不应该做任何事情，但如果您远程运行使用Spring Cloud连接器或Spring Boot约定来定义经纪人凭证，例如Rabbit</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2052">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  rabbitmq:
    host: mybroker.com
    port: 5672
    username: user
    password: secret</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2053">总线当前支持向所有节点发送消息，用于特定服务的所有节点（由Eureka定义）。</font><font o="2054">未来可能会添加更多的选择器标准（即，仅数据中心Y中的服务X节点等）。</font><font o="2055"><code i="1067">/bus/*</code>执行器命名空间下还有一些http端点。</font><font o="2056">目前有两个实施。</font><font o="2057">第一个<code i="1068">/bus/env</code>发送密钥/值对来更新每个节点的Spring环境。</font><font o="2058">第二个<code i="1069">/bus/refresh</code>将重新加载每个应用程序的配置，就好像他们在<code i="1070">/refresh</code>端点上都被ping过。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2059">注意</font></div>
</td>
<td class="content"><font o="2060">
总线启动器覆盖Rabbit和Kafka，因为这是两个最常见的实现，但Spring Cloud Stream非常灵活，绑定将与<code i="1071">spring-cloud-bus</code>结合使用。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_addressing_an_instance"><font o="2061">处理实例</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2062">HTTP端点接受“目的地”参数，例如“/ bus / refresh？destination = customers：9000”，其中目的地是<code i="1072">ApplicationContext</code> ID。</font><font o="2063">如果ID由总线上的一个实例拥有，那么它将处理消息，所有其他实例将忽略它。</font><font o="2064">默认情况下，Spring Boot将<code i="1073">ContextIdApplicationContextInitializer</code>中的ID设置为<code i="1074">spring.application.name</code>，活动配置文件和<code i="1075">server.port</code>的组合。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_addressing_all_instances_of_a_service"><font o="2065">寻址服务的所有实例</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2066">“destination”参数用于Spring <code i="1076">PathMatcher</code>（路径分隔符为冒号<code i="1077">:</code>）以确定实例是否处理该消息。</font><font o="2067">使用上面的示例，“/ bus / refresh？destination = customers：**”将针对“客户”服务的所有实例，而不管配置文件和端口设置为<code i="1078">ApplicationContext</code> ID。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_context_id_must_be_unique"><font o="2068">应用程序上下文ID必须是唯一的</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2069">总线尝试消除事件两次处理，一次从原来的<code i="1079">ApplicationEvent</code>和一次从队列中。</font><font o="2070">为此，它会检查发送应用程序上下文id，以重新显示当前的应用程序上下文ID。</font><font o="2071">如果服务的多个实例具有相同的应用程序上下文id，则不会处理事件。</font><font o="2072">在本地机器上运行，每个服务将在不同的端口上，这将是应用程序上下文ID的一部分。</font><font o="2073">Cloud Foundry提供了区分的索引。</font><font o="2074">为了确保应用程序上下文id是唯一的，请将<code i="1080">spring.application.index</code>设置为每个服务实例唯一的值。</font><font o="2075">例如，在lattice中，在application.properties中设置<code i="1081">spring.application.index=${INSTANCE_INDEX}</code>（如果使用configserver，请设置bootstrap.properties）。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_message_broker"><font o="2076">自定义Message Broker</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2077">Spring Cloud Bus使用
 </font><a href="javascript:;"><font o="2077">Spring Cloud Stream</font></a><font o="2077">广播消息，以便获取消息流，只需要在类路径中包含您选择的binder实现。</font><font o="2078">有专门为AMQP（RabbitMQ）和Kafka（<code i="1082">spring-cloud-starter-bus-[amqp,kafka]</code>）的总线方便的启动器。</font><font o="2079">一般来说，Spring Cloud Stream依赖于Spring Boot配置中间件的自动配置约定，因此例如可以使用<code i="1083">spring.rabbitmq.*</code>配置属性更改AMQP代理地址。</font><font o="2080">Spring Cloud Bus在<code i="1084">spring.cloud.bus.*</code>中具有少量本机配置属性（例如，<code i="1085">spring.cloud.bus.destination</code>是使用外部中间件的主题的名称）。</font><font o="2081">通常，默认值就足够了。</font></p>
</div>
<div class="paragraph">
<p><font o="2082">要更多地了解如何自定义消息代理设置，请参阅Spring Cloud Stream文档。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_bus_events"><font o="2083">追踪Bus Events</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2084">可以通过设置<code i="1087">spring.cloud.bus.trace.enabled=true</code>来跟踪总线事件（<code i="1086">RemoteApplicationEvent</code>的子类）。</font><font o="2085">如果这样做，那么Spring Boot <code i="1088">TraceRepository</code>（如果存在）将显示每个服务实例发送的所有事件和所有的ack。</font><font o="2086">示例（来自<code i="1089">/trace</code>端点）：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-json" data-lang="json">{
  "timestamp": "2015-11-26T10:24:44.411+0000",
  "info": {
    "signal": "spring.cloud.bus.ack",
    "type": "RefreshRemoteApplicationEvent",
    "id": "c4d374b7-58ea-4928-a312-31984def293b",
    "origin": "stores:8081",
    "destination": "*:**"
  }
  },
  {
  "timestamp": "2015-11-26T10:24:41.864+0000",
  "info": {
    "signal": "spring.cloud.bus.sent",
    "type": "RefreshRemoteApplicationEvent",
    "id": "c4d374b7-58ea-4928-a312-31984def293b",
    "origin": "customers:9000",
    "destination": "*:**"
  }
  },
  {
  "timestamp": "2015-11-26T10:24:41.862+0000",
  "info": {
    "signal": "spring.cloud.bus.ack",
    "type": "RefreshRemoteApplicationEvent",
    "id": "c4d374b7-58ea-4928-a312-31984def293b",
    "origin": "customers:9000",
    "destination": "*:**"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2087">这个迹象表明<code i="1090">RefreshRemoteApplicationEvent</code>已从<code i="1091">customers:9000</code>广播发送到所有服务，并已被<code i="1092">customers:9000</code>和<code i="1093">stores:8081</code>收到（确认）。</font></p>
</div>
<div class="paragraph">
<p><font o="2088">为了处理信号，您可以向您的应用添加<code i="1095">AckRemoteApplicationEvent</code>和<code i="1096">SentApplicationEvent</code>类型的<code i="1094">@EventListener</code>（并启用跟踪）。</font><font o="2089">或者您可以利用<code i="1097">TraceRepository</code>并从中挖掘数据。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2090">注意</font></div>
</td>
<td class="content"><font o="2091">
任何总线应用程序都可以跟踪ack，但有时在一个可以对数据进行更复杂查询的中央服务器中执行此操作是有用的。</font><font o="2092">或者将其转发到专门的跟踪服务。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_broadcasting_your_own_events"><font o="2093">广播自己的Events</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2094">总线可以携带任何类型为<code i="1098">RemoteApplicationEvent</code>的事件，但默认传输是JSON，并且解串器需要知道哪些类型将提前使用。</font><font o="2095">要注册一个新的类型，它需要在<code i="1099">org.springframework.cloud.bus.event</code>的子包中。</font><font o="2096">您可以在自定义类上使用<code i="1100">@JsonTypeName</code>，也可以使用默认策略来使用类的简单名称。</font><font o="2097">请注意，生产者和消费者都需要访问类定义。</font></p>
</div>
</div>
</div>
<h1 id="_spring_cloud_sleuth" class="sect0">Spring Cloud Sleuth</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><font o="2099">Adrian Cole，Spencer Gibb，Marcin Grzejszczak，Dave Syer</font></p>
</div>
<div class="paragraph">
<p><strong><font o="2100">Brixton.BUILD，快照</font></strong></p>
</div>
<div class="paragraph">
<p><font o="2101">Spring Cloud Sleuth为</font><a href="javascript:;"><font o="2101">Spring Cloud</font></a><font o="2101">实现分布式跟踪解决方案</font><font o="2101">。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terminology"><font o="2102">术语</font></h3>
<div class="paragraph">
<p><font o="2103">Spring Cloud Sleuth借用</font><a href="javascript:;"><font o="2103">Dapper的</font></a><font o="2103">术语。</font></p>
</div>
<div class="paragraph">
<p><strong><font o="2104">跨度：</font></strong><font o="2104">工作的基本单位。</font><font o="2105">例如，发送RPC是一个新的跨度，以及向RPC发送响应。</font><font o="2106">跨度由跨度的唯一64位ID标识，跨度是其中一部分的跟踪的另一个64位ID。</font><font o="2107">跨度还具有其他数据，例如描述，时间戳记事件，键值注释（标签），导致它们的跨度的ID以及进程ID（通常是IP地址）。</font></p>
</div>
<div class="paragraph">
<p><font o="2108">跨距开始和停止，他们跟踪他们的时间信息。</font><font o="2109">创建跨度后，必须在将来的某个时刻停止。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2110">提示</font></div>
</td>
<td class="content"><font o="2111">
启动跟踪的初始范围称为<code i="1101">root span</code>。</font><font o="2112">该跨度的跨度id的值等于跟踪ID。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong><font o="2113">Trace：</font></strong><font o="2113">一组spans形成一个树状结构。</font><font o="2114">例如，如果您正在运行分布式大数据存储，则可能会由put请求形成跟踪。</font></p>
</div>
<div class="paragraph">
<p><strong><font o="2115">注释：</font></strong><font o="2115">用于及时记录事件的存在。</font><font o="2116">用于定义请求的开始和停止的一些核心注释是：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><font o="2117">cs</font></strong><font o="2117"> - 客户端发送 - 客户端已经发出请求。</font><font o="2118">此注释描绘了跨度的开始。</font></p>
</li>
<li>
<p><strong><font o="2119">sr</font></strong><font o="2119"> - 服务器接收 - 服务器端得到请求，并将开始处理它。</font><font o="2120">如果从此时间戳中减去cs时间戳，则会收到网络延迟。</font></p>
</li>
<li>
<p><strong><font o="2121">ss</font></strong><font o="2121"> - 服务器发送 - 在完成请求处理后（响应发送回客户端时）注释。</font><font o="2122">如果从此时间戳中减去sr时间戳，则会收到服务器端处理请求所需的时间。</font></p>
</li>
<li>
<p><strong><font o="2123">cr</font></strong><font o="2123"> - 客户端接收 - 表示跨度的结束。</font><font o="2124">客户端已成功接收到服务器端的响应。</font><font o="2125">如果从此时间戳中减去cs时间戳，则会收到客户端从服务器接收响应所需的整个时间。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2126">可视化系统中的</font><strong><font o="2126">跨度</font></strong><font o="2126">和</font><strong><font o="2126">跟踪</font></strong><font o="2126">将与Zipkin注释一起查看：</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/trace-id.png" alt="跟踪信息传播">
</div>
</div>
<div class="paragraph">
<p><font o="2127">一个音符的每个颜色表示跨度（7 spans  - 从</font><strong><font o="2127">A</font></strong><font o="2127">到</font><strong><font o="2127">G</font></strong><font o="2127">）。</font><font o="2128">如果您在笔记中有这样的信息：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>Trace Id = X
Span Id = D
Client Sent</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2129">这意味着，目前的跨度</font><strong><font o="2129">跟踪-ID</font></strong><font o="2129">设置为</font><strong><font o="2129">X</font></strong><font o="2129">，</font><strong><font o="2129">跨度-ID</font></strong><font o="2129">设置为</font><strong><font o="2129">ð</font></strong><font o="2129">。</font><font o="2130">它也发出了
 </font><strong><font o="2130">客户端发送的</font></strong><font o="2130">事件。</font></p>
</div>
<div class="paragraph">
<p><font o="2131">这样，spans的父/子关系的可视化将如下所示：</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/parents.png" alt="父子关系">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_purpose"><font o="2132">目的</font></h3>
<div class="paragraph">
<p><font o="2133">在以下部分中，将考虑上述图像中的示例。</font></p>
</div>
<div class="sect3">
<h4 id="_distributed_tracing_with_zipkin"><font o="2134">分布式跟踪Zipkin</font></h4>
<div class="paragraph">
<p><font o="2135">共有</font><strong><font o="2135">7个spans</font></strong><font o="2135">。</font><font o="2136">如果你去Zipkin中的痕迹，你将在第二个轨迹中看到这个数字：</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/zipkin-traces.png" alt="痕迹">
</div>
</div>
<div class="paragraph">
<p><font o="2137">但是，如果你选择一个特定的跟踪，那么你会看到</font><strong><font o="2137">4 spans</font></strong><font o="2137">：</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/zipkin-ui.png" alt="跟踪信息传播">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2138">注意</font></div>
</td>
<td class="content"><font o="2139">
当选择特定的跟踪时，您将看到合并的spans。</font><font o="2140">这意味着如果发送到服务器接收和服务器发送/接收客户端和客户端发送注释的spans发送到Zipkin，那么它们将被显示为单个跨度。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="2141">为什么在这种情况下7和4 spans之间有区别？</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2142">2 spans来自<code i="1102">http:/start</code>跨度。</font><font o="2143">它具有服务器接收（SR）和服务器发送（SS）注释。</font></p>
</li>
<li>
<p><font o="2144">2 spans来自<code i="1103">service1</code>到<code i="1104">service2</code>到<code i="1105">http:/foo</code>端点的RPC呼叫。</font><font o="2145">它在<code i="1106">service1</code>方面具有客户端发送（CS）和客户端接收（CR）注释。</font><font o="2146">它还在<code i="1107">service2</code>侧具有服务器接收（SR）和服务器发送（SS）注释。</font><font o="2147">在物理上有2 spans，但它们形成与RPC调用相关的1个逻辑跨度。</font></p>
</li>
<li>
<p><font o="2148">2 spans来自<code i="1108">service2</code>到<code i="1109">service3</code>到<code i="1110">http:/bar</code>端点的RPC呼叫。</font><font o="2149">它在<code i="1111">service2</code>方面具有客户端发送（CS）和客户端接收（CR）注释。</font><font o="2150">它还在<code i="1112">service3</code>端上具有服务器接收（SR）和服务器发送（SS）注释。</font><font o="2151">在物理上有2 spans，但它们形成与RPC调用相关的1个逻辑跨度。</font></p>
</li>
<li>
<p><font o="2152">2 spans来自<code i="1113">service2</code>到<code i="1114">service4</code>到<code i="1115">http:/baz</code>端点的RPC呼叫。</font><font o="2153">它在<code i="1116">service2</code>方面具有客户端发送（CS）和客户端接收（CR）注释。</font><font o="2154">它还在<code i="1117">service4</code>方面具有服务器接收（SR）和服务器发送（SS）注释。</font><font o="2155">在物理上有2 spans，但它们形成与RPC调用相关的1个逻辑跨度。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2156">因此，如果我们算上物理spans我们有</font><strong><font o="2156">1</font></strong><font o="2156">从<code i="1118">http:/start</code> </font><strong><font o="2156">2</font></strong><font o="2156">从<code i="1119">service1</code>调用<code i="1120">service2</code> </font><strong><font o="2156">2</font></strong><font o="2156">形式<code i="1121">service2</code>调用<code i="1122">service3</code>和</font><strong><font o="2156">2</font></strong><font o="2156">从<code i="1123">service2</code>调用<code i="1124">service4</code>。</font><font o="2157">共</font><strong><font o="2157">7个</font></strong><font o="2157"> spans。</font></p>
</div>
<div class="paragraph">
<p><font o="2158">逻辑上，我们看到</font><strong><font o="2158">Total Spans的信息：4</font></strong><font o="2158">，因为我们有</font><strong><font o="2158">1个</font></strong><font o="2158">跨度与传入请求相关的<code i="1125">service1</code>和</font><strong><font o="2158">3</font></strong><font o="2158"> spans与RPC调用相关。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_visualizing_errors"><font o="2159">可视化错误</font></h4>
<div class="paragraph">
<p><font o="2160">Zipkin允许您可视化跟踪中的错误。</font><font o="2161">当抛出异常并且未被捕获时，我们在Zipkin可以正确着色的跨度上设置适当的标签。</font><font o="2162">您可以在痕迹列表中看到一条是红色的痕迹。</font><font o="2163">这是因为抛出了一个异常。</font></p>
</div>
<div class="paragraph">
<p><font o="2164">如果您点击该轨迹，您将看到类似的图片</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/zipkin-error-traces.png" alt="错误跟踪">
</div>
</div>
<div class="paragraph">
<p><font o="2165">然后，如果您点击其中一个spans，您将看到以下内容</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/zipkin-error-trace-screenshot.png" alt="错误跟踪信息传播">
</div>
</div>
<div class="paragraph">
<p><font o="2166">你可以看到，你可以很容易的看到错误的原因和整个stacktrace相关的。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_live_examples"><font o="2167">实例</font></h4>
<div class="imageblock">
<div class="content">
<a class="image" href="javascript:;"><img src="static/picture/pws.png" alt="Zipkin部署在Pivotal Web Services上" width="150" height="74"></a>
</div>
<div class="title"><font o="2168">点击Pivotal Web Services图标即可实时查看！点击Pivotal Web Services图标直播！</font></div>
</div>
<div class="paragraph">
<p><font o="2169">Zipkin中的依赖图将如下所示：</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/dependencies.png" alt="依赖">
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="javascript:;"><img src="static/picture/pws.png" alt="Zipkin部署在Pivotal Web Services上" width="150" height="74"></a>
</div>
<div class="title"><font o="2170">点击Pivotal Web Services图标即可实时查看！点击Pivotal Web Services图标直播！</font></div>
</div>
</div>
<div class="sect3">
<h4 id="_log_correlation"><font o="2171">对数相关</font></h4>
<div class="paragraph">
<p><font o="2172">当通过跟踪id等于例如<code i="1126">2485ec27856c56f4</code>的这四个应用程序的日志进行打印时，可以得到以下内容：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>service1.log:2016-02-26 11:15:47.561  INFO [service1,2485ec27856c56f4,2485ec27856c56f4,true] 68058 --- [nio-8081-exec-1] i.s.c.sleuth.docs.service1.Application   : Hello from service1. Calling service2
service2.log:2016-02-26 11:15:47.710  INFO [service2,2485ec27856c56f4,9aa10ee6fbde75fa,true] 68059 --- [nio-8082-exec-1] i.s.c.sleuth.docs.service2.Application   : Hello from service2. Calling service3 and then service4
service3.log:2016-02-26 11:15:47.895  INFO [service3,2485ec27856c56f4,1210be13194bfe5,true] 68060 --- [nio-8083-exec-1] i.s.c.sleuth.docs.service3.Application   : Hello from service3
service2.log:2016-02-26 11:15:47.924  INFO [service2,2485ec27856c56f4,9aa10ee6fbde75fa,true] 68059 --- [nio-8082-exec-1] i.s.c.sleuth.docs.service2.Application   : Got response from service3 [Hello from service3]
service4.log:2016-02-26 11:15:48.134  INFO [service4,2485ec27856c56f4,1b1845262ffba49d,true] 68061 --- [nio-8084-exec-1] i.s.c.sleuth.docs.service4.Application   : Hello from service4
service2.log:2016-02-26 11:15:48.156  INFO [service2,2485ec27856c56f4,9aa10ee6fbde75fa,true] 68059 --- [nio-8082-exec-1] i.s.c.sleuth.docs.service2.Application   : Got response from service4 [Hello from service4]
service1.log:2016-02-26 11:15:48.182  INFO [service1,2485ec27856c56f4,2485ec27856c56f4,true] 68058 --- [nio-8081-exec-1] i.s.c.sleuth.docs.service1.Application   : Got response from service2 [Hello from service2, response from service3 [Hello from service3] and from service4 [Hello from service4]]</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2173">如果你使用像一个日志聚合工具</font><a href="javascript:;"><font o="2173">Kibana</font></a><font o="2173">，
 </font><a href="javascript:;"><font o="2173">Splunk的</font></a><font o="2173">等您可以订购所发生的事件。</font><font o="2174">基巴纳的例子如下所示：</font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="static/picture/kibana.png" alt="记录与Kibana的相关性">
</div>
</div>
<div class="paragraph">
<p><font o="2175">如果你想使用</font><a href="javascript:;"><font o="2175">Logstash，</font></a><font o="2175">这里是</font><a href="javascript:;"><font o="2175">Logstash</font></a><font o="2175">的Grok模式：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>filter {
       # pattern matching logback pattern
       grok {
              match =&gt; { "message" =&gt; "%{TIMESTAMP_ISO8601:timestamp}\s+%{LOGLEVEL:severity}\s+\[%{DATA:service},%{DATA:trace},%{DATA:span},%{DATA:exportable}\]\s+%{DATA:pid}---\s+\[%{DATA:thread}\]\s+%{DATA:class}\s+:\s+%{GREEDYDATA:rest}" }
       }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2176">注意</font></div>
</td>
<td class="content"><font o="2177">
如果您想将Grok与Cloud Foundry的日志一起使用，则必须使用此模式：
</font></td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>filter {
       # pattern matching logback pattern
       grok {
              match =&gt; { "message" =&gt; "(?m)OUT\s+%{TIMESTAMP_ISO8601:timestamp}\s+%{LOGLEVEL:severity}\s+\[%{DATA:service},%{DATA:trace},%{DATA:span},%{DATA:exportable}\]\s+%{DATA:pid}---\s+\[%{DATA:thread}\]\s+%{DATA:class}\s+:\s+%{GREEDYDATA:rest}" }
       }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_json_logback_with_logstash"><font o="2178">使用Logstash进行JSON回溯</font></h5>
<div class="paragraph">
<p><font o="2179">通常，您不希望将日志存储在文本文件中，而不是将Logstash可以立即选择的JSON文件中存储。</font><font o="2180">为了做到这一点，你必须做以下（为了可读性，我们传递依赖关系在<code i="1127">groupId:artifactId:version</code>符号。</font></p>
</div>
<div class="paragraph">
<p><strong><font o="2181">依赖关系设置</font></strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2182">确保Logback位于类路径（<code i="1128">ch.qos.logback:logback-core</code>）</font></p>
</li>
<li>
<p><font o="2183">添加Logstash Logback编码 - 版本<code i="1129">4.6</code>的示例：<code i="1130">net.logstash.logback:logstash-logback-encoder:4.6</code></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><font o="2184">回读设置</font></strong></p>
</div>
<div class="paragraph">
<p><font o="2185">您可以在下面找到一个Logback配置（名为</font><a href="javascript:;"><font o="2185">logback-spring.xml</font></a><font o="2185">）</font><a href="javascript:;"><font o="2185">的示例</font></a><font o="2185">：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2186">将来自应用程序的信息以JSON格式记录到<code i="1131">build/${spring.application.name}.json</code>文件中</font></p>
</li>
<li>
<p><font o="2187">已经评论了两个额外的追加者 - 控制台和标准日志文件</font></p>
</li>
<li>
<p><font o="2188">具有与上一节所述相同的记录模式</font></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml"></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2189">注意</font></div>
</td>
<td class="content"><font o="2190">
如果您使用自定义<code i="1132">logback-spring.xml</code>，则必须传递<code i="1134">bootstrap</code> <code i="1133">spring.application.name</code>而不是<code i="1135">application</code>属性文件。</font><font o="2191">否则您的自定义logback文件将不会正确读取该属性。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_to_the_project"><font o="2192">添加到项目中</font></h3>
<div class="sect3">
<h4 id="_only_sleuth_log_correlation"><font o="2193">只有Sleuth（对数相关）</font></h4>
<div class="paragraph">
<p><font o="2194">如果您只想从Spring Cloud Sleuth中获利，而Zipkin集成只需将<code i="1136">spring-cloud-starter-sleuth</code>模块添加到您的项目中即可。</font></p>
</div>
<div class="listingblock primary">
<div class="title"><font o="2195">Maven的</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt; <b class="conum">(1)</b>
      &lt;dependencies&gt;
          &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
              &lt;version&gt;Brixton.RELEASE&lt;/version&gt;
              &lt;type&gt;pom&lt;/type&gt;
              &lt;scope&gt;import&lt;/scope&gt;
          &lt;/dependency&gt;
      &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependency&gt; <b class="conum">(2)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2196">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2197">将依赖关系添加到<code i="1137">spring-cloud-starter-sleuth</code></font></p>
</li>
</ol>
</div>
<div class="listingblock secondary">
<div class="title"><font o="2198">摇篮</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-groovy" data-lang="groovy">dependencyManagement { <b class="conum">(1)</b>
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:Brixton.RELEASE"
    }
}

dependencies { <b class="conum">(2)</b>
    compile "org.springframework.cloud:spring-cloud-starter-sleuth"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2199">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2200">将依赖关系添加到<code i="1138">spring-cloud-starter-sleuth</code></font></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_sleuth_with_zipkin_via_http"><font o="2201">通过HTTP访问Zipkin</font></h4>
<div class="paragraph">
<p><font o="2202">如果你想要Sleuth和Zipkin只需添加<code i="1139">spring-cloud-starter-zipkin</code>依赖关系。</font></p>
</div>
<div class="listingblock primary">
<div class="title"><font o="2203">Maven的</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt; <b class="conum">(1)</b>
      &lt;dependencies&gt;
          &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
              &lt;version&gt;Brixton.RELEASE&lt;/version&gt;
              &lt;type&gt;pom&lt;/type&gt;
              &lt;scope&gt;import&lt;/scope&gt;
          &lt;/dependency&gt;
      &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependency&gt; <b class="conum">(2)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2204">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2205">将依赖关系添加到<code i="1140">spring-cloud-starter-zipkin</code></font></p>
</li>
</ol>
</div>
<div class="listingblock secondary">
<div class="title"><font o="2206">摇篮</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-groovy" data-lang="groovy">dependencyManagement { <b class="conum">(1)</b>
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:Brixton.RELEASE"
    }
}

dependencies { <b class="conum">(2)</b>
    compile "org.springframework.cloud:spring-cloud-starter-zipkin"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2207">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2208">将依赖关系添加到<code i="1141">spring-cloud-starter-zipkin</code></font></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_sleuth_with_zipkin_via_spring_cloud_stream"><font o="2209">通过Spring Cloud Stream的Zipkin</font></h4>
<div class="paragraph">
<p><font o="2210">如果你想要Sleuth和Zipkin只需添加<code i="1142">spring-cloud-sleuth-stream</code>依赖项。</font></p>
</div>
<div class="listingblock primary">
<div class="title"><font o="2211">Maven的</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt; <b class="conum">(1)</b>
      &lt;dependencies&gt;
          &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
              &lt;version&gt;Brixton.RELEASE&lt;/version&gt;
              &lt;type&gt;pom&lt;/type&gt;
              &lt;scope&gt;import&lt;/scope&gt;
          &lt;/dependency&gt;
      &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependency&gt; <b class="conum">(2)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-sleuth-stream&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt; <b class="conum">(3)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- EXAMPLE FOR RABBIT BINDING --&gt;
&lt;dependency&gt; <b class="conum">(4)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-stream-binder-rabbit&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2212">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2213">将依赖关系添加到<code i="1143">spring-cloud-sleuth-stream</code></font></p>
</li>
<li>
<p><font o="2214">将依赖关系添加到<code i="1144">spring-cloud-starter-sleuth</code>  - 这样将依赖所有依赖关系将被下载</font></p>
</li>
<li>
<p><font o="2215">添加一个绑定器（例如Rabbit binder）来告诉Spring Cloud Stream它应该绑定到什么</font></p>
</li>
</ol>
</div>
<div class="listingblock secondary">
<div class="title"><font o="2216">摇篮</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-groovy" data-lang="groovy">dependencyManagement { <b class="conum">(1)</b>
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:Brixton.RELEASE"
    }
}

dependencies {
    compile "org.springframework.cloud:spring-cloud-sleuth-stream" <b class="conum">(2)</b>
    compile "org.springframework.cloud:spring-cloud-starter-sleuth" <b class="conum">(3)</b>
    // Example for Rabbit binding
    compile "org.springframework.cloud:spring-cloud-stream-binder-rabbit" <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2217">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2218">将依赖关系添加到<code i="1145">spring-cloud-sleuth-stream</code></font></p>
</li>
<li>
<p><font o="2219">将依赖关系添加到<code i="1146">spring-cloud-starter-sleuth</code>  - 这样就可以下载所有依赖关系</font></p>
</li>
<li>
<p><font o="2220">添加一个绑定器（例如Rabbit binder）来告诉Spring Cloud Stream它应该绑定到什么</font></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_spring_cloud_sleuth_stream_zipkin_collector"><font o="2221">Spring Cloud Sleuth流Zipkin收藏家</font></h4>
<div class="paragraph">
<p><font o="2222">如果要启动Spring Cloud Sleuth Stream Zipkin收藏夹，只需添加<code i="1147">spring-cloud-sleuth-zipkin-stream</code>依赖关系即可</font></p>
</div>
<div class="listingblock primary">
<div class="title"><font o="2223">Maven的</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt; <b class="conum">(1)</b>
      &lt;dependencies&gt;
          &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
              &lt;version&gt;Brixton.RELEASE&lt;/version&gt;
              &lt;type&gt;pom&lt;/type&gt;
              &lt;scope&gt;import&lt;/scope&gt;
          &lt;/dependency&gt;
      &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependency&gt; <b class="conum">(2)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-sleuth-zipkin-stream&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt; <b class="conum">(3)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- EXAMPLE FOR RABBIT BINDING --&gt;
&lt;dependency&gt; <b class="conum">(4)</b>
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-stream-binder-rabbit&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2224">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2225">将依赖关系添加到<code i="1148">spring-cloud-sleuth-zipkin-stream</code></font></p>
</li>
<li>
<p><font o="2226">将依赖关系添加到<code i="1149">spring-cloud-starter-sleuth</code>  - 这样就可以下载所有依赖关系</font></p>
</li>
<li>
<p><font o="2227">添加一个绑定器（例如Rabbit binder）来告诉Spring Cloud Stream它应该绑定到什么</font></p>
</li>
</ol>
</div>
<div class="listingblock secondary">
<div class="title"><font o="2228">摇篮</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-groovy" data-lang="groovy">dependencyManagement { <b class="conum">(1)</b>
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:Brixton.RELEASE"
    }
}

dependencies {
    compile "org.springframework.cloud:spring-cloud-sleuth-zipkin-stream" <b class="conum">(2)</b>
    compile "org.springframework.cloud:spring-cloud-starter-sleuth" <b class="conum">(3)</b>
    // Example for Rabbit binding
    compile "org.springframework.cloud:spring-cloud-stream-binder-rabbit" <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><font o="2229">为了不自己选择版本，如果您通过Spring BOM添加依赖关系管理，则会更好</font></p>
</li>
<li>
<p><font o="2230">将依赖关系添加到<code i="1150">spring-cloud-sleuth-zipkin-stream</code></font></p>
</li>
<li>
<p><font o="2231">将依赖关系添加到<code i="1151">spring-cloud-starter-sleuth</code>中，这样就可以下载所有依赖关系</font></p>
</li>
<li>
<p><font o="2232">添加一个绑定器（例如Rabbit binder）来告诉Spring Cloud Stream它应该绑定到什么</font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font o="2233">然后使用<code i="1152">@EnableZipkinStreamServer</code>注释来标注你的主类：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java"></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><font o="2234">额外的资源</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><font o="2235">Marcin Grzejszczak谈论Spring Cloud Sleuth和Zipkin</font></strong></p>
</div>

<div class="paragraph">
<p><a href="javascript:;"><font o="2236">点击此处查看视频</font></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features_2"><font o="2237">特征</font></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><font o="2238">将跟踪和跨度添加到Slf4J MDC，以便您可以从日志聚合器中的给定跟踪或跨度中提取所有日志。</font><font o="2239">示例日志：</font></p>
<div class="listingblock">
<div class="content">
<pre class="notranslate">2016-02-02 15:30:57.902  INFO [bar,6bfd228dc00d216b,6bfd228dc00d216b,false] 23030 --- [nio-8081-exec-3] ...
2016-02-02 15:30:58.372 ERROR [bar,6bfd228dc00d216b,6bfd228dc00d216b,false] 23030 --- [nio-8081-exec-3] ...
2016-02-02 15:31:01.936  INFO [bar,46ab0d418373cbc9,46ab0d418373cbc9,false] 23030 --- [nio-8081-exec-4] ...</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2240">注意MDC中的<code i="1153">[appname,traceId,spanId,exportable]</code>条目：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><font o="2241">spanId</font></strong><font o="2241"> - 发生特定操作的ID</font></p>
</li>
<li>
<p><strong><font o="2242">appname</font></strong><font o="2242"> - 记录跨度的应用程序的名称</font></p>
</li>
<li>
<p><strong><font o="2243">traceId</font></strong><font o="2243"> - 包含跨度的延迟图的ID</font></p>
</li>
<li>
<p><strong><font o="2244">导出</font></strong><font o="2244"> -日志是否应该被导出到Zipkin与否。</font><font o="2245">你什么时候希望跨度不能出口？</font><font o="2246">在这种情况下，您希望在Span中包装一些操作，并将其写入日志。</font></p>
</li>
</ul>
</div>
</li>
<li>
<p><font o="2247">对共同的分布式跟踪数据模型提供抽象：trace，spans（形成DAG），注释，键值注释。</font><font o="2248">松散地基于HTrace，但Zipkin（Dapper）兼容。</font></p>
</li>
<li>
<p><font o="2249">Sleuth记录定时信息以辅助延迟分析。</font><font o="2250">使用窃贼，您可以精确定位应用程序中的延迟原因。</font><font o="2251">Sleuth被写入不会记录太多，并且不会导致您的生产应用程序崩溃。</font></p>
<div class="ulist">
<ul>
<li>
<p><font o="2252">传播有关您的呼叫图表带内的结构数据，其余的是带外。</font></p>
</li>
<li>
<p><font o="2253">包括有意见的层次测试，如HTTP</font></p>
</li>
<li>
<p><font o="2254">包括采样策略来管理卷</font></p>
</li>
<li>
<p><font o="2255">可以向Zipkin系统报告查询和可视化</font></p>
</li>
</ul>
</div>
</li>
<li>
<p><font o="2256">来自Spring应用程序（servlet过滤器，异步终结点，休息模板，调度操作，消息通道，zuul过滤器，假客户端）的仪器通用入口和出口点。</font></p>
</li>
<li>
<p><font o="2257">Sleuth包括在http或消息传递边界上加入跟踪的默认逻辑。</font><font o="2258">例如，http传播通过Zipkin兼容的请求标头工作。</font><font o="2259">该传播逻辑是通过<code i="1154">SpanInjector</code>和<code i="1155">SpanExtractor</code>实现来定义和定制的。</font></p>
</li>
<li>
<p><font o="2260">提供接受/删除spans的简单指标。</font></p>
</li>
<li>
<p><font o="2261">如果<code i="1156">spring-cloud-sleuth-zipkin</code>，则应用程序将生成并收集Zipkin兼容的跟踪。</font><font o="2262">默认情况下，它通过HTTP将其发送到本地主机（端口9411）上的Zipkin服务器。</font><font o="2263">使用<code i="1157">spring.zipkin.baseUrl</code>配置服务的位置。</font></p>
</li>
<li>
<p><font o="2264">如果<code i="1158">spring-cloud-sleuth-stream</code>，则应用程序将通过</font><a href="javascript:;"><font o="2264">Spring Cloud Stream</font></a><font o="2264">生成和收集跟踪</font><font o="2264">。</font><font o="2265">您的应用程序自动成为通过您的代理商发送的跟踪消息的生成者（例如RabbitMQ，Apache Kafka，Redis））。</font></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2266">重要</font></div>
</td>
<td class="content"><font o="2267">
如果使用Zipkin或Stream，请使用<code i="1159">spring.sleuth.sampler.percentage</code>（默认为0.1，即10％）配置spans的百分比。</font><strong><font o="2268">否则你可能认为Sleuth不工作，因为它省略了一些spans。</font></strong>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2269">注意</font></div>
</td>
<td class="content"><font o="2270">
始终设置SLF4J MDC，并且Logback用户将立即按照上述示例查看日志中的跟踪和跨度ID。</font><font o="2271">其他日志记录系统必须配置自己的格式化程序以获得相同的结果。</font><font o="2272">默认值为<code i="1160">logging.pattern.level</code>设置为<code i="1161">%clr(%5p) %clr([${spring.application.name:},%X{X-B3-TraceId:-},%X{X-B3-SpanId:-},%X{X-Span-Export:-}]){yellow}</code>（这是对于回溯用户的Spring Boot功能）。
</font><strong><font o="2273">这意味着如果您不使用SLF4J，则不会自动应用此模式</font></strong><font o="2273">。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sampling"><font o="2274">采样</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2275">在分布式跟踪中，数据量可能非常高，因此抽样可能很重要（您通常不需要导出所有spans以获得正在发生的情况）。</font><font o="2276">Spring Cloud Sleuth具有<code i="1162">Sampler</code>策略，您可以实现该策略来控制采样算法。</font><font o="2277">采样器不会停止生成跨度（相关）ids，但是它们确实阻止了附加和导出的标签和事件。</font><font o="2278">默认情况下，您将获得一个策略，如果跨度已经处于活动状态，则会继续跟踪，但新策略始终被标记为不可导出。</font><font o="2279">如果您的所有应用程序都使用此采样器运行，您将看到日志中的跟踪，但不会在任何远程存储中。</font><font o="2280">对于测试，默认值通常是足够的，如果您仅使用日志（例如使用ELK聚合器），则可能是您需要的。</font><font o="2281">如果要将span数据导出到Zipkin或Spring Cloud Stream，还有一个<code i="1163">AlwaysSampler</code>导出所有内容，<code i="1164">PercentageBasedSampler</code>对spans的固定分数进行采样。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2282">注意</font></div>
</td>
<td class="content"><font o="2283">
如果您使用<code i="1166">spring-cloud-sleuth-zipkin</code>或<code i="1167">spring-cloud-sleuth-stream</code>，则<code i="1165">PercentageBasedSampler</code>是默认值。</font><font o="2284">您可以使用<code i="1168">spring.sleuth.sampler.percentage</code>配置导出。</font><font o="2285">通过的值需要从<code i="1169">0.0</code>到<code i="1170">1.0</code>的双倍，所以不是百分比。</font><font o="2286">为了向后兼容性原因，我们不会更改属性名称。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="2287">可以通过创建一个bean定义来安装采样器，例如：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
public Sampler defaultSampler() {
    return new AlwaysSampler();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instrumentation"><font o="2288">仪表</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2289">Spring Cloud Sleuth自动设置您的所有Spring应用程序，因此您不必执行任何操作即可激活。</font><font o="2290">根据可用的堆栈，例如对于我们使用<code i="1171">Filter</code>的servlet Web应用程序和Spring Integration我们使用<code i="1172">ChannelInterceptors</code>，可以使用各种技术添加仪器。</font></p>
</div>
<div class="paragraph">
<p><font o="2291">您可以自定义span标签中使用的键。</font><font o="2292">为了限制跨度数据量，默认情况下，HTTP请求只会被标记为少量的元数据，如状态码，主机和URL。</font><font o="2293">您可以通过配置<code i="1173">spring.sleuth.keys.http.headers</code>（头名称列表）来添加请求头。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2294">注意</font></div>
</td>
<td class="content"><font o="2295">
请记住，如果存在<code i="1174">Sampler</code>允许标签（默认情况下没有，所以没有配置某些东西就不会意外收集太多数据的危险），则只会收集和导出标签。
</font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2296">注意</font></div>
</td>
<td class="content"><font o="2297">
目前，Spring Cloud Sleuth中的工具是渴望的 - 这意味着我们正在积极地尝试在线程之间传递跟踪上下文。</font><font o="2298">即使在没有将数据导出到跟踪系统的情况下，也会捕获定时事件。</font><font o="2299">这种做法在将来可能会改变为在这件事上懒惰。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_span_lifecycle"><font o="2300">跨度生命周期</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2301">您可以通过org.springframework.cloud.sleuth.Tracer接口在Span上执行</font><strong><font o="2301">以下</font></strong><font o="2301">操作：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#creating-and-closing-spans"><font o="2302">开始</font></a><font o="2302"> - 当您启动一个span时，它的名称被分配，并且记录开始时间戳。</font></p>
</li>
<li>
<p><a href="#creating-and-closing-spans"><font o="2303">关闭</font></a><font o="2303"> - 跨度完成（记录跨度的结束时间），如果跨度可</font><strong><font o="2303">导出，</font></strong><font o="2303">则它将有资格收集到Zipkin。</font><font o="2304">该跨度也从当前线程中移除。</font></p>
</li>
<li>
<p><a href="#continuing-spans"><font o="2305">继续</font></a><font o="2305"> - 将创建一个新的跨度实例，而它将是它继续的一个副本。</font></p>
</li>
<li>
<p><a href="#continuing-spans"><font o="2306">分离</font></a><font o="2306"> - 跨度不会停止或关闭。</font><font o="2307">它只从当前线程中删除。</font></p>
</li>
<li>
<p><a href="#creating-spans-with-explicit-parent"><font o="2308">使用显式父项创建</font></a><font o="2308"> - 您可以创建一个新的跨度，并为其设置一个显式父级</font></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2309">提示</font></div>
</td>
<td class="content"><font o="2310">
Spring为您创建了<code i="1175">Tracer</code>的实例。</font><font o="2311">为了使用它，你需要的只是自动连接它。
</font></td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="creating-and-closing-spans"><font o="2312">创建和关闭spans</font></h3>
<div class="paragraph">
<p><font o="2313">您可以使用</font><strong><font o="2313">Tracer</font></strong><font o="2313">界面</font><font o="2313">手动创建spans </font><font o="2313">。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// Start a span. If there was a span present in this thread it will become
// the `newSpan`'s parent.
Span newSpan = this.tracer.createSpan("calculateTax");
try {
    // ...
    // You can tag a span
    this.tracer.addTag("taxValue", taxValue);
    // ...
    // You can log an event on a span
    newSpan.logEvent("taxCalculated");
} finally {
    // Once done remember to close the span. This will allow collecting
    // the span to send it to Zipkin
    this.tracer.close(newSpan);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2314">在这个例子中，我们可以看到如何创建一个新的跨度实例。</font><font o="2315">假设这个线程中已经存在跨度，那么它将成为该跨度的父代。</font></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2316">重要</font></div>
</td>
<td class="content"><font o="2317">
创建跨度后始终清洁！</font><font o="2318">如果要将其发送到Zipkin，请不要忘记关闭跨度。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="continuing-spans"><font o="2319">继续spans</font></h3>
<div class="paragraph">
<p><font o="2320">有时你不想创建一个新的跨度，但你想继续。</font><font o="2321">这种情况的例子可能是（当然这取决于用例）：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><font o="2322">AOP</font></strong><font o="2322"> - 如果在达到方面之前已经创建了一个跨度，则可能不想创建一个新的跨度。</font></p>
</li>
<li>
<p><strong><font o="2323">Hystrix</font></strong><font o="2323"> - 执行Hystrix命令很可能是当前处理的逻辑部分。</font><font o="2324">实际上，它只是一个技术实现细节，你不一定要反映在跟踪中作为一个单独的存在。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2325">持续的跨度实例等于它继续的范围：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">Span continuedSpan = this.tracer.continueSpan(spanToContinue);
assertThat(continuedSpan).isEqualTo(spanToContinue);</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2326">要继续跨度，您可以使用</font><strong><font o="2326">Tracer</font></strong><font o="2326">界面。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// let's assume that we're in a thread Y and we've received
// the `initialSpan` from thread X
Span continuedSpan = this.tracer.continueSpan(initialSpan);
try {
    // ...
    // You can tag a span
    this.tracer.addTag("taxValue", taxValue);
    // ...
    // You can log an event on a span
    continuedSpan.logEvent("taxCalculated");
} finally {
    // Once done remember to detach the span. That way you'll
    // safely remove it from the current thread without closing it
    this.tracer.detach(continuedSpan);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2327">重要</font></div>
</td>
<td class="content"><font o="2328">
创建跨度后始终清洁！</font><font o="2329">如果在一个线程（例如线程X）中开始了某些工作，并且正在等待其他线程（例如Y，Z）完成，请不要忘记分离跨距。</font><font o="2330">那么线程Y，Z中的spans在工作结束时应该被分离。</font><font o="2331">当收集结果时，螺纹X中的跨度应该被关闭。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="creating-spans-with-explicit-parent"><font o="2332">用明确的父代创建spans</font></h3>
<div class="paragraph">
<p><font o="2333">您可能想要开始一个新的跨度，并提供该跨度的显式父级。</font><font o="2334">假设跨度的父项在一个线程中，并且要在另一个线程中启动一个新的跨度。</font><font o="2335"><code i="1177">Tracer</code>接口的<code i="1176">startSpan</code>方法是您要查找的方法。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">// let's assume that we're in a thread Y and we've received
// the `initialSpan` from thread X. `initialSpan` will be the parent
// of the `newSpan`
Span newSpan = this.tracer.createSpan("calculateCommission", initialSpan);
try {
    // ...
    // You can tag a span
    this.tracer.addTag("commissionValue", commissionValue);
    // ...
    // You can log an event on a span
    newSpan.logEvent("commissionCalculated");
} finally {
    // Once done remember to close the span. This will allow collecting
    // the span to send it to Zipkin. The tags and events set on the
    // newSpan will not be present on the parent
    this.tracer.close(newSpan);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2336">重要</font></div>
</td>
<td class="content"><font o="2337">
创建这样一个跨度后，记得关闭它。</font><font o="2338">否则，您将在您的日志中看到很多警告，其中有一个事实，即您在当前线程中存在一个跨度，而不是您要关闭的线程。</font><font o="2339">更糟糕的是，您的spans不会正确关闭，因此不会收集到Zipkin。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_naming_spans"><font o="2340">命名spans</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2341">选择一个跨度名称不是一件小事。</font><font o="2342">跨度名称应描述操作名称。</font><font o="2343">名称应该是低基数（例如不包括标识符）。</font></p>
</div>
<div class="paragraph">
<p><font o="2344">由于有很多仪器仪表在一些跨度名称将是人为的：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2345"><code i="1178">controller-method-name</code>当控制器收到方法名称<code i="1179">conrollerMethodName</code></font></p>
</li>
<li>
<p><font o="2346"><code i="1180">async</code>通过封装<code i="1181">Callable</code>和<code i="1182">Runnable</code>完成异步操作。</font></p>
</li>
<li>
<p><font o="2347"><code i="1183">@Scheduled</code>注释方法将返回类的简单名称。</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2348">幸运的是，对于异步处理，您可以提供明确的命名。</font></p>
</div>
<div class="sect2">
<h3 id="__spanname_annotation"><font o="2349">@SpanName注释</font></h3>
<div class="paragraph">
<p><font o="2350">您可以通过<code i="1184">@SpanName</code>注释明确指定该跨度。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpanName("calculateTax")
class TaxCountingRunnable implements Runnable {

    @Override public void run() {
        // perform logic
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2351">在这种情况下，以下列方式处理时：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">Runnable runnable = new TraceRunnable(tracer, spanNamer, new TaxCountingRunnable());
Future&lt;?&gt; future = executorService.submit(runnable);
// ... some additional logic ...
future.get();</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2352">该范围将命名为<code i="1185">calculateTax</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_tostring_method"><font o="2353">toString（）方法</font></h3>
<div class="paragraph">
<p><font o="2354">为<code i="1186">Runnable</code>或<code i="1187">Callable</code>创建单独的课程很少见。</font><font o="2355">通常，创建这些类的匿名实例。</font><font o="2356">如果没有<code i="1188">@SpanName</code>注释，我们将检查该类是否具有<code i="1189">toString()</code>方法的自定义实现。</font></p>
</div>
<div class="paragraph">
<p><font o="2357">所以执行这样的代码：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">Runnable runnable = new TraceRunnable(tracer, spanNamer, new Runnable() {
    @Override public void run() {
        // perform logic
    }

    @Override public String toString() {
        return "calculateTax";
    }
});
Future&lt;?&gt; future = executorService.submit(runnable);
// ... some additional logic ...
future.get();</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2358">将导致创建一个名为<code i="1190">calculateTax</code>的跨度。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizations"><font o="2359">自定义</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2360">感谢<code i="1191">SpanInjector</code>和<code i="1192">SpanExtractor</code>，您可以自定义spans的创建和传播方式。</font></p>
</div>
<div class="paragraph">
<p><font o="2361">目前有两种在进程之间传递跟踪信息的内置方式：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2362">通过Spring Integration</font></p>
</li>
<li>
<p><font o="2363">通过HTTP</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2364">从Zipkin兼容（B3）头（<code i="1193">Message</code>或HTTP头）中提取范围，以启动或加入现有跟踪。</font><font o="2365">跟踪信息被注入到任何出站请求中，所以下一跳可以提取它们。</font></p>
</div>
<div class="sect2">
<h3 id="_spring_integration">Spring Integration</h3>
<div class="paragraph">
<p><font o="2367">对于Spring Integration，这些是负责从<code i="1194">Message</code>创建跨度并使用跟踪信息填写<code i="1195">MessageBuilder</code>的bean。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
public SpanExtractor&lt;Message&gt; messagingSpanExtractor() {
    ...
}

@Bean
public SpanInjector&lt;MessageBuilder&gt; messagingSpanInjector() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2368">您可以通过提供自己的实现并通过在bean定义中添加<code i="1196">@Primary</code>注释来覆盖它们。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_http"><font o="2369">HTTP</font></h3>
<div class="paragraph">
<p><font o="2370">对于HTTP，这些是负责从<code i="1197">HttpServletRequest</code>创建跨度的bean。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
public SpanExtractor&lt;HttpServletRequest&gt; httpServletRequestSpanExtractor() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2371">您可以通过提供自己的实现并通过在bean定义中添加<code i="1198">@Primary</code>注释来覆盖它们。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_example"><font o="2372">例</font></h3>
<div class="paragraph">
<p><font o="2373">我们假设，而不是标准的Zipkin兼容的跟踪HTTP头名称</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2374">for trace id  -  <code i="1199">correlationId</code></font></p>
</li>
<li>
<p><font o="2375">for span id  -  <code i="1200">mySpanId</code></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2376">这是一个<code i="1201">SpanExtractor</code>的例子</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">static class CustomHttpServletRequestSpanExtractor
        implements SpanExtractor&lt;HttpServletRequest&gt; {

    @Override
    public Span joinTrace(HttpServletRequest carrier) {
        long traceId = Span.hexToId(carrier.getHeader("correlationId"));
        long spanId = Span.hexToId(carrier.getHeader("mySpanId"));
        // extract all necessary headers
        Span.SpanBuilder builder = Span.builder().traceId(traceId).spanId(spanId);
        // build rest of the Span
        return builder.build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2377">你可以这样注册：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
@Primary
SpanExtractor&lt;HttpServletRequest&gt; customHttpServletRequestSpanExtractor() {
    return new CustomHttpServletRequestSpanExtractor();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2378">出于安全考虑，Spring Cloud Sleuth不会将跟踪/跨度相关的标头添加到Http响应。</font><font o="2379">如果您需要标题，那么将标题注入Http响应的自定义<code i="1202">SpanInjector</code>，并且可以使用以下方法添加一个使用此标签的Servlet过滤器：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">static class CustomHttpServletResponseSpanInjector
        implements SpanInjector&lt;HttpServletResponse&gt; {

    @Override
    public void inject(Span span, HttpServletResponse carrier) {
        carrier.addHeader(Span.TRACE_ID_NAME, span.traceIdString());
        carrier.addHeader(Span.SPAN_ID_NAME, Span.idToHex(span.getSpanId()));
    }
}

static class HttpResponseInjectingTraceFilter extends GenericFilterBean {

    private final Tracer tracer;
    private final SpanInjector&lt;HttpServletResponse&gt; spanInjector;

    public HttpResponseInjectingTraceFilter(Tracer tracer, SpanInjector&lt;HttpServletResponse&gt; spanInjector) {
        this.tracer = tracer;
        this.spanInjector = spanInjector;
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletResponse response = (HttpServletResponse) servletResponse;
        Span currentSpan = this.tracer.getCurrentSpan();
        this.spanInjector.inject(currentSpan, response);
        filterChain.doFilter(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2380">你可以这样注册：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
SpanInjector&lt;HttpServletResponse&gt; customHttpServletResponseSpanInjector() {
    return new CustomHttpServletResponseSpanInjector();
}

@Bean
HttpResponseInjectingTraceFilter responseInjectingTraceFilter(Tracer tracer) {
    return new HttpResponseInjectingTraceFilter(tracer, customHttpServletResponseSpanInjector());
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_sa_tag_in_zipkin"><font o="2381">Zipkin中的自定义SA标签</font></h3>
<div class="paragraph">
<p><font o="2382">有时你想创建一个手动的Span，它会将一个呼叫打包到一个没有被检测到的外部服务。</font><font o="2383">您可以做的是创建一个包含<code i="1203">peer.service</code>标签的跨度，其中包含要调用的服务的值。</font><font o="2384">下面你可以看到一个调用Redis的例子，它被包装在这样一个跨度里。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">org.springframework.cloud.sleuth.Span newSpan = tracer.createSpan("redis");
try {
    newSpan.tag("redis.op", "get");
    newSpan.tag("lc", "redis");
    newSpan.logEvent(org.springframework.cloud.sleuth.Span.CLIENT_SEND);
    // call redis service e.g
    // return (SomeObj) redisTemplate.opsForHash().get("MYHASH", someObjKey);
} finally {
    newSpan.tag("peer.service", "redisService");
    newSpan.tag("peer.ipv4", "1.2.3.4");
    newSpan.tag("peer.port", "1234");
    newSpan.logEvent(org.springframework.cloud.sleuth.Span.CLIENT_RECV);
    tracer.close(newSpan);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2385">重要</font></div>
</td>
<td class="content"><font o="2386">
请记住不要添加<code i="1204">peer.service</code>标签和<code i="1205">SA</code>标签！</font><font o="2387">您只需添加<code i="1206">peer.service</code>。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_custom_service_name"><font o="2388">自定义服务名称</font></h3>
<div class="paragraph">
<p><font o="2389">默认情况下，Sleuth假设当您将跨度发送到Zipkin时，您希望跨度的服务名称等于<code i="1207">spring.application.name</code>值。</font><font o="2390">这并不总是这样。</font><font o="2391">在某些情况下，您希望为应用程序中的所有spans显式提供不同的服务名称。</font><font o="2392">要实现这一点，只需将以下属性传递给应用程序即可覆盖该值（<code i="1208">foo</code>服务名称的示例）：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring.zipkin.service.name: foo</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_span_data_as_messages"><font o="2393">Span Data作为消息</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2394">可以积累和在发送跨度数据
 </font><a href="javascript:;"><font o="2394">Spring Cloud Stream</font></a><font o="2394">通过包括<code i="1209">spring-cloud-sleuth-stream</code>罐作为依赖，以及加入信道Binder实现（例如<code i="1210">spring-cloud-starter-stream-rabbit</code>为RabbitMQ的或<code i="1211">spring-cloud-starter-stream-kafka</code>为Kafka）。</font><font o="2395">这将自动将您的应用程序转换为有效载荷类型为<code i="1212">Spans</code>的邮件的生成者。</font></p>
</div>
<div class="sect2">
<h3 id="_zipkin_consumer"><font o="2396">Zipkin消费者</font></h3>
<div class="paragraph">
<p><font o="2397">有一个特殊的便利注释来设置Span数据的消息使用者，并将其推入Zipkin <code i="1213">SpanStore</code>。</font><font o="2398">这个应用程序</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableZipkinStreamServer
public class Consumer {
	public static void main(String[] args) {
		SpringApplication.run(Consumer.class, args);
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2399">将通过Spring Cloud Stream <code i="1214">Binder</code>（例如包括RabbitMQ的<code i="1215">spring-cloud-starter-stream-rabbit</code>）以及Redis和Kafka的类似起始者）收听您提供的任何传输的Span数据。</font><font o="2400">如果添加以下UI依赖关系</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-xml" data-lang="xml">&lt;groupId&gt;io.zipkin.java&lt;/groupId&gt;
&lt;artifactId&gt;zipkin-autoconfigure-ui&lt;/artifactId&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2401">然后，您将有一个</font><a href="javascript:;"><font o="2401">Zipkin服务器</font></a><font o="2401">，</font><font o="2401">您的应用程序
 </font><font o="2401">在端口9411上承载UI和API。</font></p>
</div>
<div class="paragraph">
<p><font o="2402">默认的<code i="1216">SpanStore</code>是内存中的（适用于演示，快速入门）。</font><font o="2403">对于更强大的解决方案，您可以将MySQL和<code i="1217">spring-boot-starter-jdbc</code>添加到类路径中，并通过配置启用JDBC <code i="1218">SpanStore</code>，例如：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  rabbitmq:
    host: ${RABBIT_HOST:localhost}
  datasource:
    schema: classpath:/mysql.sql
    url: jdbc:mysql://${MYSQL_HOST:localhost}/test
    username: root
    password: root
# Switch this on to create the schema on startup:
    initialize: true
    continueOnError: true
  sleuth:
    enabled: false
zipkin:
  storage:
    type: mysql</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2404">注意</font></div>
</td>
<td class="content"><font o="2405">
<code i="1219">@EnableZipkinStreamServer</code>也用<code i="1220">@EnableZipkinServer</code>注释，所以该过程还将公开标准的Zipkin服务器端点，用于通过HTTP收集spans，并在Zipkin Web UI中进行查询。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_custom_consumer"><font o="2406">定制消费者</font></h3>
<div class="paragraph">
<p><font o="2407">也可以使用<code i="1221">spring-cloud-sleuth-stream</code>并绑定到<code i="1222">SleuthSink</code>来轻松实现自定义消费者。</font><font o="2408">例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableBinding(SleuthSink.class)
@SpringBootApplication(exclude = SleuthStreamAutoConfiguration.class)
@MessageEndpoint
public class Consumer {

    @ServiceActivator(inputChannel = SleuthSink.INPUT)
    public void sink(Spans input) throws Exception {
        // ... process spans
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2409">注意</font></div>
</td>
<td class="content"><font o="2410">
上面的示例消费者应用程序明确排除了<code i="1223">SleuthStreamAutoConfiguration</code>，因此它不会向其自己发送消息，但这是可选的（您可能希望将消息跟踪到消费者应用程序中）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_metrics"><font o="2411">度量</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2412">目前Spring Cloud Sleuth注册了与spans相关的简单指标。</font><font o="2413">它使用</font><a href="javascript:;"><font o="2413">Spring Boot的指标支持</font></a><font o="2413"> 
来计算接受和删除的数量spans。</font><font o="2414">每次发送到Zipkin时，接受的spans的数量将增加。</font><font o="2415">如果出现错误，则删除的数量spans将会增加。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integrations"><font o="2416">集成</font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_runnable_and_callable"><font o="2417">可运行和可调用</font></h3>
<div class="paragraph">
<p><font o="2418">如果你在<code i="1224">Runnable</code>或<code i="1225">Callable</code>中包含逻辑，就可以将这些类包装在他们的Sleuth代表中。</font></p>
</div>
<div class="paragraph">
<p><font o="2419"><code i="1226">Runnable</code>的示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">Runnable runnable = new Runnable() {
    @Override
    public void run() {
        // do some work
    }

    @Override
    public String toString() {
        return "spanNameFromToStringMethod";
    }
};
// Manual `TraceRunnable` creation with explicit "calculateTax" Span name
Runnable traceRunnable = new TraceRunnable(tracer, spanNamer, runnable, "calculateTax");
// Wrapping `Runnable` with `Tracer`. The Span name will be taken either from the
// `@SpanName` annotation or from `toString` method
Runnable traceRunnableFromTracer = tracer.wrap(runnable);</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2420"><code i="1227">Callable</code>的示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">Callable&lt;String&gt; callable = new Callable&lt;String&gt;() {
    @Override
    public String call() throws Exception {
        return someLogic();
    }

    @Override
    public String toString() {
        return "spanNameFromToStringMethod";
    }
};
// Manual `TraceCallable` creation with explicit "calculateTax" Span name
Callable&lt;String&gt; traceCallable = new TraceCallable&lt;&gt;(tracer, spanNamer, callable, "calculateTax");
// Wrapping `Callable` with `Tracer`. The Span name will be taken either from the
// `@SpanName` annotation or from `toString` method
Callable&lt;String&gt; traceCallableFromTracer = tracer.wrap(callable);</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2421">这样，您将确保为每次执行创建并关闭新的跨度。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_hystrix">Hystrix</h3>
<div class="sect3">
<h4 id="_custom_concurrency_strategy"><font o="2423">自定义并发策略</font></h4>
<div class="paragraph">
<p><font o="2424">我们正在注册一个</font><a href="javascript:;"><code>HystrixConcurrencyStrategy</code></a><font o="2424">
将所有<code i="1228">Callable</code>实例包装到他们的Sleuth代表中的定制 -  <code i="1229">TraceCallable</code>。</font><font o="2425">该策略要么开始还是继续一个跨度，这取决于调用Hystrix命令之前跟踪是否已经进行的事实。</font><font o="2426">要禁用自定义Hystrix并发策略，将<code i="1230">spring.sleuth.hystrix.strategy.enabled</code>设置为<code i="1231">false</code>。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_manual_command_setting"><font o="2427">手动命令设置</font></h4>
<div class="paragraph">
<p><font o="2428">假设你有以下<code i="1232">HystrixCommand</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">HystrixCommand&lt;String&gt; hystrixCommand = new HystrixCommand&lt;String&gt;(setter) {
    @Override
    protected String run() throws Exception {
        return someLogic();
    }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2429">为了传递跟踪信息，您必须在<code i="1233">HystrixCommand</code>的<code i="1234">TraceCommand</code>的Sleuth版本中包装相同的逻辑：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">TraceCommand&lt;String&gt; traceCommand = new TraceCommand&lt;String&gt;(tracer, traceKeys, setter) {
    @Override
    public String doRun() throws Exception {
        return someLogic();
    }
};</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rxjava"><font o="2430">RxJava</font></h3>
<div class="paragraph">
<p><font o="2431">我们正在注册</font><a href="javascript:;"><code>RxJavaSchedulersHook</code></a><font o="2431">
将所有<code i="1235">Action0</code>实例包装到他们的Sleuth代表中的定制 -  <code i="1236">TraceAction</code>。</font><font o="2432">钩子起动或继续一个跨度取决于跟踪在Action被安排之前是否已经进行的事实。</font><font o="2433">要禁用自定义RxJavaSchedulersHook设置<code i="1237">spring.sleuth.rxjava.schedulers.hook.enabled</code>为<code i="1238">false</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="2434">您可以定义线程名称的正则表达式列表，您不需要创建Span。</font><font o="2435">只需在<code i="1239">spring.sleuth.rxjava.schedulers.ignoredthreads</code>属性中提供逗号分隔的正则表达式列表。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_http_integration"><font o="2436">HTTP集成</font></h3>
<div class="paragraph">
<p><font o="2437">可以通过提供值等于<code i="1241">false</code>的<code i="1240">spring.sleuth.web.enabled</code>属性来禁用此部分的功能。</font></p>
</div>
<div class="sect3">
<h4 id="_http_filter"><font o="2438">HTTP过滤器</font></h4>
<div class="paragraph">
<p><font o="2439">通过<code i="1242">TraceFilter</code>所有采样的进入请求都会创建一个跨度。</font><font o="2440">该Span的名称是<code i="1243">http:</code> +发送请求的路径。</font><font o="2441">例如，如果请求已发送到<code i="1244">/foo/bar</code>，则该名称将为<code i="1245">http:/foo/bar</code>。</font><font o="2442">您可以通过<code i="1246">spring.sleuth.web.skipPattern</code>属性配置要跳过的URI。</font><font o="2443">如果您在类路径上有<code i="1247">ManagementServerProperties</code>，那么其值<code i="1248">contextPath</code>将附加到提供的跳过模式。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_handlerinterceptor"><font o="2444">的HandlerInterceptor</font></h4>
<div class="paragraph">
<p><font o="2445">由于我们希望跨度名称是精确的，我们使用<code i="1249">TraceHandlerInterceptor</code>来包装现有的<code i="1250">HandlerInterceptor</code>，或直接添加到现有的<code i="1251">HandlerInterceptors</code>列表中。</font><font o="2446"><code i="1252">TraceHandlerInterceptor</code>向给定的<code i="1253">HttpServletRequest</code>添加了一个特殊请求属性。</font><font o="2447">如果<code i="1254">TraceFilter</code>没有看到此属性集，它将创建一个“后备”跨度，这是在服务器端创建的一个额外的跨度，以便在UI中正确显示跟踪。</font><font o="2448">看到最有可能意味着有一个缺失的仪器。</font><font o="2449">在这种情况下，请在Spring Cloud Sleuth中提出问题。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_async_servlet_support"><font o="2450">异步Servlet支持</font></h4>
<div class="paragraph">
<p><font o="2451">如果您的控制器返回<code i="1255">Callable</code>或<code i="1256">WebAsyncTask</code> Spring Cloud Sleuth将继续现有的跨度，而不是创建一个新的跨度。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_client_integration"><font o="2452">HTTP客户端集成</font></h3>
<div class="sect3">
<h4 id="_synchronous_rest_template"><font o="2453">同步休息模板</font></h4>
<div class="paragraph">
<p><font o="2454">我们正在注入一个<code i="1257">RestTemplate</code>拦截器，确保所有跟踪信息都传递给请求。</font><font o="2455">每次呼叫都会创建一个新的Span。</font><font o="2456">收到回应后关闭。</font><font o="2457">为了阻止同步的<code i="1258">RestTemplate</code>功能，只需将<code i="1259">spring.sleuth.web.client.enabled</code>设置为<code i="1260">false</code>。</font></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2458">重要</font></div>
</td>
<td class="content"><font o="2459">
您必须注册<code i="1261">RestTemplate</code>作为一个bean，以便拦截器将被注入。</font><font o="2460">如果您创建一个<code i="1263">new</code>关键字的<code i="1262">RestTemplate</code>实例，那么该工具将无法正常工作。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_rest_template"><font o="2461">异步休息模板</font></h4>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2462">重要</font></div>
</td>
<td class="content"><font o="2463">
<code i="1264">AsyncRestTemplate</code> bean的跟踪版本是为您开箱即用的。</font><font o="2464">如果你有你自己的bean，你必须把它包装成一个<code i="1265">TraceAsyncRestTemplate</code>表示。</font><font o="2465">最好的解决方案是只定制<code i="1266">ClientHttpRequestFactory</code>和/或<code i="1267">AsyncClientHttpRequestFactory</code>。
</font><strong><font o="2466">如果您有自己的<code i="1268">AsyncRestTemplate</code>，并且不要包装，您的电话将不会被追踪</font></strong><font o="2466">。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="2467">定制仪器设置为在发送和接收请求时创建和关闭跨度。</font><font o="2468">您可以通过注册您的bean来自定义<code i="1269">ClientHttpRequestFactory</code>和<code i="1270">AsyncClientHttpRequestFactory</code>。</font><font o="2469">记住使用跟踪兼容的实现（例如，不要忘记在<code i="1272">TraceAsyncListenableTaskExecutor</code>中包装<code i="1271">ThreadPoolTaskScheduler</code>）。</font><font o="2470">自定义请求工厂示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@EnableAutoConfiguration
@Configuration
public static class TestConfiguration {

    @Bean
    ClientHttpRequestFactory mySyncClientFactory() {
        return new MySyncClientHttpRequestFactory();
    }

    @Bean
    AsyncClientHttpRequestFactory myAsyncClientFactory() {
        return new MyAsyncClientHttpRequestFactory();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2471">将<code i="1273">AsyncRestTemplate</code>功能集<code i="1274">spring.sleuth.web.async.client.enabled</code>封锁为<code i="1275">false</code>。</font><font o="2472">禁用<code i="1276">TraceAsyncClientHttpRequestFactoryWrapper</code>设置<code i="1277">spring.sleuth.web.async.client.factory.enabled</code>设置为<code i="1278">false</code>。</font><font o="2473">如果您不想将<code i="1279">AsyncRestClient</code> <code i="1280">spring.sleuth.web.async.client.template.enabled</code>设为<code i="1281">false</code>。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_feign">Feign</h3>
<div class="paragraph">
<p><font o="2475">默认情况下，Spring Cloud Sleuth通过<code i="1282">TraceFeignClientAutoConfiguration</code>提供与feign的集成。</font><font o="2476">您可以通过将<code i="1283">spring.sleuth.feign.enabled</code>设置为false来完全禁用它。</font><font o="2477">如果这样做，那么不会发生Feign相关的仪器。</font></p>
</div>
<div class="paragraph">
<p><font o="2478">Feign仪器的一部分是通过<code i="1284">FeignBeanPostProcessor</code>完成的。</font><font o="2479">您可以通过提供<code i="1285">spring.sleuth.feign.processor.enabled</code>等于<code i="1286">false</code>来禁用它。</font><font o="2480">如果您这样设置，那么Spring Cloud Sleuth将不会调整您的任何自定义Feign组件。</font><font o="2481">然而，所有默认的工具仍然存在。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_asynchronous_communication"><font o="2482">异步通信</font></h3>
<div class="sect3">
<h4 id="__async_annotated_methods"><font o="2483">@Async注释方法</font></h4>
<div class="paragraph">
<p><font o="2484">在Spring Cloud Sleuth中，我们正在检测异步相关的组件，以便跟踪信息在线程之间传递。</font><font o="2485">您可以通过将<code i="1287">spring.sleuth.async.enabled</code>的值设置为<code i="1288">false</code>来禁用此行为。</font></p>
</div>
<div class="paragraph">
<p><font o="2486">如果您使用<code i="1289">@Async</code>注释方法，那么我们将自动创建一个具有以下特征的新Span：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2487">Span名称将是注释方法名称</font></p>
</li>
<li>
<p><font o="2488">Span将被该方法的类名称和方法名称标记</font></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="__scheduled_annotated_methods"><font o="2489">@Scheduled注释方法</font></h4>
<div class="paragraph">
<p><font o="2490">在Spring Cloud Sleuth中，我们正在调试计划的方法执行，以便跟踪信息在线程之间传递。</font><font o="2491">您可以通过将<code i="1290">spring.sleuth.scheduled.enabled</code>的值设置为<code i="1291">false</code>来禁用此行为。</font></p>
</div>
<div class="paragraph">
<p><font o="2492">如果您使用<code i="1292">@Scheduled</code>注释方法，那么我们将自动创建一个具有以下特征的新Span：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2493">Span名称将是注释方法名称</font></p>
</li>
<li>
<p><font o="2494">Span将被该方法的类名称和方法名称标记</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2495">如果要跳过某些<code i="1293">@Scheduled</code>注释类的Span创建，您可以使用与<code i="1295">@Scheduled</code>注释类的完全限定名称匹配的正则表达式来设置<code i="1294">spring.sleuth.scheduled.skipPattern</code>。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2496">提示</font></div>
</td>
<td class="content"><font o="2497">
如果您一起使用<code i="1296">spring-cloud-sleuth-stream</code>和<code i="1297">spring-cloud-netflix-hystrix-stream</code>，则会为每个Hystrix指标创建Span，并发送到Zipkin。</font><font o="2498">这可能是恼人的。</font><font o="2499">您可以设置<code i="1298">spring.sleuth.scheduled.skipPattern=org.springframework.cloud.netflix.hystrix.stream.HystrixStreamTask</code>
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_executor_executorservice_and_scheduledexecutorservice"><font o="2500">Executor，ExecutorService和ScheduledExecutorService</font></h4>
<div class="paragraph">
<p><font o="2501">我们提供<code i="1299">LazyTraceExecutor</code>，<code i="1300">TraceableExecutorService</code>和<code i="1301">TraceableScheduledExecutorService</code>。</font><font o="2502">每次提交，调用或调度新任务时，这些实现都将创建Spans。</font></p>
</div>
<div class="paragraph">
<p><font o="2503">在这里，您可以看到一个使用<code i="1303">CompletableFuture</code>使用<code i="1302">TraceableExecutorService</code>传递跟踪信息的示例：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">CompletableFuture&lt;Long&gt; completableFuture = CompletableFuture.supplyAsync(() -&gt; {
    // perform some logic
    return 1_000_000L;
}, new TraceableExecutorService(executorService,
        // 'calculateTax' explicitly names the span - this param is optional
        tracer, traceKeys, spanNamer, "calculateTax"));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_messaging"><font o="2504">消息</font></h3>
<div class="paragraph">
<p><font o="2505">Spring Cloud Sleuth与</font><a href="javascript:;"><font o="2505">Spring Integration</font></a><font o="2505">集成</font><font o="2505">。</font><font o="2506">它创建spans发布和订阅事件。</font><font o="2507">要禁用Spring Integration检测，请将​​<code i="1304">spring.sleuth.integration.enabled</code>设置为false。</font></p>
</div>
<div class="paragraph">
<p><font o="2508">Spring Cloud Sleuth直到版本1.0.4在使用消息传递时发送无效的跟踪头。</font><font o="2509">那些标头实际上与HTTP中发送的那些标头（它们包含一个<code i="1305">-</code>）的名称相同。</font><font o="2510">为了在1.0.4中向后兼容，我们开始发送有效和无效的头文件。</font><font o="2511">请升级到1.0.4，因为在Spring Cloud Sleuth 1.1中，我们将删除对已弃用头的支持。</font></p>
</div>
<div class="paragraph">
<p><font o="2512">自1.0.4以来，您可以提供<code i="1306">spring.sleuth.integration.patterns</code>模式，以明确提供要包括的跟踪通道名称。</font><font o="2513">默认情况下，所有通道都包含在内。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_zuul">Zuul</h3>
<div class="paragraph">
<p><font o="2515">我们正在注册Zuul过滤器以传播跟踪信息（请求标头丰富了跟踪数据）。</font><font o="2516">要禁用Zuul支持，请将<code i="1307">spring.sleuth.zuul.enabled</code>属性设置为<code i="1308">false</code>。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_examples"><font o="2517">运行示例</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2518">您可以在</font><a href="javascript:;"><font o="2518">Pivotal Web Services</font></a><font o="2518">中找到部署的运行示例</font><font o="2518">。</font><font o="2519">在以下链接中查看它们：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javascript:;"><font o="2520">Zipkin在样品中提交的应用程序到顶部</font></a></p>
</li>
<li>
<p><a href="javascript:;"><font o="2521">Zipkin为啤酒厂在PWS</font></a><font o="2521">，其</font><a href="javascript:;"><font o="2521">Github代码</font></a></p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_spring_cloud_consul" class="sect0">Spring Cloud Consul</h1>
<div class="openblock partintro">
<div class="content"><font o="2523">
该项目通过自动配置并绑定到Spring环境和其他Spring编程模型成语，为Spring Boot应用程序提供Consul集成。</font><font o="2524">通过几个简单的注释，您可以快速启用和配置应用程序中的常见模式，并使用基于Consul的组件构建大型分布式系统。</font><font o="2525">提供的模式包括服务发现，控制总线和配置。</font><font o="2526">智能路由（Zuul）和客户端负载平衡（Ribbon），断路器（Hystrix）通过与Spring Cloud Netflix集成提供。
</font></div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-install"><font o="2527">安装Consul</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2528">请参阅</font><a href="javascript:;"><font o="2528">安装文档</font></a><font o="2528">获取有关如何安装Consul指令。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-agent"><font o="2529">Consul代理</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2530">所有Spring Cloud Consul应用程序必须可以使用Consul代理客户端。</font><font o="2531">默认情况下，代理客户端预计位于<code i="1309">localhost:8500</code>。</font><font o="2532">有关</font><font o="2532">如何启动代理客户端以及如何连接到Consul代理服务器的群集的</font><font o="2532">详细信息，请参阅</font><a href="javascript:;"><font o="2532">代理文档</font></a><font o="2532">。</font><font o="2533">对于开发，安装consul后，您可以使用以下命令启动Consul代理：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">./src/main/bash/local_run_consul.sh</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2534">这将启动端口8500上的服务器模式的代理，其中ui可以在</font><a href="javascript:;" class="bare"><font o="2534">http：// localhost：8500上找到</font></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-discovery"><font o="2535">服务发现与Consul</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2536">服务发现是基于微服务架构的关键原则之一。</font><font o="2537">尝试配置每个客户端或某种形式的约定可能非常困难，可以非常脆弱。</font><font o="2538">Consul通过</font><a href="javascript:;"><font o="2538">HTTP API</font></a><font o="2538">和</font><a href="javascript:;"><font o="2538">DNS</font></a><font o="2538">提供服务发现服务</font><font o="2538">。</font><font o="2539">Spring Cloud Consul利用HTTP API进行服务注册和发现。</font><font o="2540">这不妨碍非Spring Cloud应用程序利用DNS界面。</font><font o="2541">Consul代理服务器在</font><font o="2541">通过</font><a href="javascript:;"><font o="2541">八卦协议进行通信</font></a><font o="2541">的</font><a href="javascript:;"><font o="2541">群集中</font></a><font o="2541">运行，</font><font o="2541">并使用</font><a href="javascript:;"><font o="2541">筏式协议协议</font></a><font o="2541">。</font><a href="javascript:;"><font></font></a><font></font><a href="javascript:;"><font></font></a><font></font></p>
</div>
<div class="sect2">
<h3 id="_registering_with_consul"><font o="2542">注册Consul</font></h3>
<div class="paragraph">
<p><font o="2543">当客户端注册Consul时，它提供有关自身的元数据，例如主机和端口，ID，名称和标签。</font><font o="2544">默认情况下会创建</font><font o="2544">一个HTTP </font><a href="javascript:;"><font o="2544">检查</font></a><font o="2544">，Consul每10秒点击一次<code i="1310">/health</code>端点。</font><font o="2545">如果健康检查失败，则服务实例被标记为关键。</font></p>
</div>
<div class="paragraph">
<p><font o="2546">示例Consul客户端：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableDiscoveryClient
@RestController
public class Application {

    @RequestMapping("/")
    public String home() {
        return "Hello world";
    }

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2547">（即完全正常的Spring Boot应用程序）。</font><font o="2548">如果Consul客户端位于<code i="1311">localhost:8500</code>以外的位置，则需要配置来定位客户端。</font><font o="2549">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2550">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      host: localhost
      port: 8500</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2551">警告</font></div>
</td>
<td class="content"><font o="2552">
如果您使用</font><a href="#spring-cloud-consul-config"><font o="2552">Spring Cloud Consul配置</font></a><font o="2552">，上述值将需要放置在<code i="1312">bootstrap.yml</code>而不是<code i="1313">application.yml</code>中。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="2553">来自<code i="1314">Environment</code>的默认服务名称，实例ID和端口分别为<code i="1315">${spring.application.name}</code>，Spring上下文ID和<code i="1316">${server.port}</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="2554"><code i="1317">@EnableDiscoveryClient</code>将应用程序设为Consul“服务”（即注册自己）和“客户端”（即可以查询Consul查找其他服务）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_http_health_check"><font o="2555">HTTP健康检查</font></h3>
<div class="paragraph">
<p><font o="2556">Consul实例的运行状况检查默认为“/ health”，这是Spring Boot Actuator应用程序中有用端点的默认位置。</font><font o="2557">如果您使用非默认上下文路径或servlet路径（例如<code i="1318">server.servletPath=/foo</code>）或管理端点路径（例如<code i="1319">management.contextPath=/admin</code>），则需要更改这些，即使是执行程序应用程序。</font><font o="2558">也可以配置Consul用于检查运行状况端点的间隔。</font><font o="2559">“10s”和“1m”分别表示10秒和1分钟。</font><font o="2560">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2561">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      discovery:
        healthCheckPath: ${management.contextPath}/health
        healthCheckInterval: 15s</pre>
</div>
</div>
<div class="sect3">
<h4 id="_metadata_and_consul_tags"><font o="2562">元数据和Consul标签</font></h4>
<div class="paragraph">
<p><font o="2563">Consul尚未支持服务元数据。</font><font o="2564">Spring Cloud的<code i="1320">ServiceInstance</code>有一个<code i="1321">Map&lt;String, String&gt; metadata</code>字段。</font><font o="2565">Spring Cloud Consul使用Consul标签来近似元数据，直到Consul正式支持元数据。</font><font o="2566">具有<code i="1322">key=value</code>形式的标签将被分割并分别用作<code i="1323">Map</code>键和值。</font><font o="2567">没有相等<code i="1324">=</code>符号的标签将被用作键和值两者。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2568">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      discovery:
        tags: foo=bar, baz</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2569">上述配置将导致<code i="1325">foo→bar</code>和<code i="1326">baz→baz</code>的地图。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_making_the_consul_instance_id_unique"><font o="2570">使Consul实例ID唯一</font></h4>
<div class="paragraph">
<p><font o="2571">默认情况下，使用等于其Spring应用程序上下文ID的ID注册consul实例。</font><font o="2572">缺省情况下，Spring应用上下文ID为<code i="1327">${spring.application.name}:comma,separated,profiles:${server.port}</code>。</font><font o="2573">在大多数情况下，这将允许一个服务的多个实例在一台机器上运行。</font><font o="2574">如果需要进一步的唯一性，使用Spring Cloud，您可以通过在<code i="1328">spring.cloud.consul.discovery.instanceId</code>中提供唯一的标识来覆盖此。</font><font o="2575">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2576">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      discovery:
        instanceId: ${spring.application.name}:${spring.application.instance_id:${random.value}}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2577">使用这个元数据和在localhost上部署的多个服务实例，随机值将在那里进行，以使实例是唯一的。</font><font o="2578">在Cloudfoundry中，<code i="1329">spring.application.instance_id</code>将在Spring Boot Actuator应用程序中自动填充，因此不需要随机值。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_discoveryclient"><font o="2579">使用DiscoveryClient</font></h3>
<div class="paragraph">
<p><font o="2580">Spring Cloud支持</font><a href="javascript:;"><font o="2580">Feign</font></a><font o="2580">（REST客户端构建器），还支持</font><a href="javascript:;"><font o="2580">Spring <code i="1330">RestTemplate</code></font></a><font o="2580">使用逻辑服务名称而不是物理URL。</font></p>
</div>
<div class="paragraph">
<p><font o="2581">您还可以使用<code i="1331">org.springframework.cloud.client.discovery.DiscoveryClient</code>，它为Netflix不具体的发现客户端提供简单的API，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances("STORES");
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri();
    }
    return null;
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-config"><font o="2582">具有Consul的分布式配置</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2583">Consul提供了</font><font o="2583">存储配置和其他元数据</font><font o="2583">的</font><a href="javascript:;"><font o="2583">密钥/值存储</font></a><font o="2583">。</font><font o="2584">Spring Cloud Consul配置是</font><a href="javascript:;"><font o="2584">配置服务器和客户端</font></a><font o="2584">的替代方案</font><font o="2584">。</font><font o="2585">在特殊的“引导”阶段，配置被加载到Spring环境中。</font><font o="2586">默认情况下，配置存储在<code i="1332">/config</code>文件夹中。</font><font o="2587">根据应用程序的名称和模拟解析属性的Spring Cloud Config顺序的活动配置文件，创建多个<code i="1333">PropertySource</code>实例。</font><font o="2588">例如，名为“testApp”的应用程序和“dev”配置文件将创建以下属性源：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/testApp,dev/
config/testApp/
config/application,dev/
config/application/</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2589">最具体的物业来源位于顶部，底部最不具体。</font><font o="2590">Properties是<code i="1334">config/application</code>文件夹适用于使用consul配置的所有应用程序。</font><font o="2591"><code i="1335">config/testApp</code>文件夹中的Properties仅适用于名为“testApp”的服务实例。</font></p>
</div>
<div class="paragraph">
<p><font o="2592">配置当前在应用程序启动时被读取。</font><font o="2593">发送HTTP POST到<code i="1336">/refresh</code>将导致重新加载配置。</font><font o="2594">观看关键价值商店（Consul支持））目前不可能，但将来将是此项目的补充。</font></p>
</div>
<div class="sect2">
<h3 id="_how_to_activate"><font o="2595">如何激活</font></h3>
<div class="paragraph">
<p><font o="2596">包括对<code i="1337">org.springframework.cloud:spring-cloud-consul-config</code>的依赖将启用将配置Spring Cloud Consul配置的自动配置。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_customizing"><font o="2597">定制</font></h3>
<div class="paragraph">
<p><font o="2598">Consul可以使用以下属性自定义配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2599">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      config:
        enabled: true
        prefix: configuration
        defaultContext: apps
        profileSeparator: '::'</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2600"><code i="1338">enabled</code>将此值设置为“false”将禁用Consul配置</font></p>
</li>
<li>
<p><font o="2601"><code i="1339">prefix</code>设置配置值的基本文件夹</font></p>
</li>
<li>
<p><font o="2602"><code i="1340">defaultContext</code>设置所有应用程序使用的文件夹名称</font></p>
</li>
<li>
<p><font o="2603"><code i="1341">profileSeparator</code>设置用于使用配置文件在属性源中分隔配置文件名称的分隔符的值</font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-config-format"><font o="2604">YAML或Properties配置</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2605">与单个键/值对相反，以YAML或Properties格式存储一组属性可能更为方便。</font><font o="2606">将<code i="1342">spring.cloud.consul.config.format</code>属性设置为<code i="1343">YAML</code>或<code i="1344">PROPERTIES</code>。</font><font o="2607">例如使用YAML：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2608">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      config:
        format: YAML</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2609">必须在consul中的相应<code i="1345">data</code>键中设置YAML。</font><font o="2610">使用键上面的默认值将如下所示：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/testApp,dev/data
config/testApp/data
config/application,dev/data
config/application/data</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2611">您可以将YAML文档存储在上述任何键中。</font></p>
</div>
<div class="paragraph">
<p><font o="2612">您可以使用<code i="1346">spring.cloud.consul.config.data-key</code>更改数据密钥。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-config-git2consul"><font o="2613">git2consul与配置</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2614">git2consul是一个Consul社区项目，将文件从git存储库加载到各个密钥到Consul。</font><font o="2615">默认情况下，密钥的名称是文件的名称。</font><font o="2616">分别支持文件扩展名为<code i="1347">.yml</code>和<code i="1348">.properties</code>的YAML和Properties文件。</font><font o="2617">将<code i="1349">spring.cloud.consul.config.format</code>属性设置为<code i="1350">FILES</code>。</font><font o="2618">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2619">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    consul:
      config:
        format: FILES</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2620">给定<code i="1351">/config</code>中的以下密钥，<code i="1352">development</code>配置文件和应用程序名称<code i="1353">foo</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">.gitignore
application.yml
bar.properties
foo-development.properties
foo-production.yml
foo.properties
master.ref</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2621">将创建以下属性来源：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/foo-development.properties
config/foo.properties
config/application.yml</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2622">每个密钥的值需要是一个格式正确的YAML或Properties文件。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-failfast"><font o="2623">快速失败</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2624">在某些情况下（如本地开发或某些测试场景）可能不方便，如果consul不可用于配置，则不会失败。</font><font o="2625">在<code i="1355">bootstrap.yml</code>中设置<code i="1354">spring.cloud.consul.config.failFast=false</code>将导致配置模块记录一个警告，而不是抛出异常。</font><font o="2626">这将允许应用程序继续正常启动。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-retry"><font o="2627">Consul重试</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2628">如果您希望consul代理程序在您的应用程序启动时可能偶尔不可用，可以要求它在失败后继续尝试。</font><font o="2629">您需要在您的类路径中添加<code i="1356">spring-retry</code>和<code i="1357">spring-boot-starter-aop</code>。</font><font o="2630">默认行为是重试6次，初始退避间隔为1000ms，指数乘数为1.1，用于后续退避。</font><font o="2631">您可以使用<code i="1358">spring.cloud.consul.retry.*</code>配置属性配置这些属性（和其他）。</font><font o="2632">这适用于Spring Cloud Consul配置和发现注册。</font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2633">提示</font></div>
</td>
<td class="content"><font o="2634">
要完全控制重试，请使用id为“consulRetryInterceptor”添加<code i="1360">RetryOperationsInterceptor</code>类型的<code i="1359">@Bean</code>。</font><font o="2635">Spring重试有一个<code i="1361">RetryInterceptorBuilder</code>可以轻松创建一个。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-bus"><font o="2636">Spring Cloud Bus与Consul</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2637">稍后发行。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-hystrix"><font o="2638">断路器与Hystrix</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2639">应用程序可以使用Spring Cloud Netflix项目提供的Hystrix断路器，将此启动器包含在项目pom.xml：<code i="1362">spring-cloud-starter-hystrix</code>中。</font><font o="2640">Hystrix不依赖于Netflix Discovery Client。</font><font o="2641"><code i="1363">@EnableHystrix</code>注释应放置在配置类（通常是主类）上。</font><font o="2642">那么方法可以用<code i="1364">@HystrixCommand</code>注释来被断路器保护。</font><font o="2643">有关</font><font o="2643">详细信息，</font><font o="2643">请参阅</font><a href="javascript:;"><font o="2643">文档</font></a><font o="2643">。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-turbine"><font o="2644">使用Turbine和Consul Hystrix指标聚合</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2645">Turbine（由Spring Cloud Netflix项目提供），聚合多个实例Hystrix指标流，因此仪表板可以显示聚合视图。</font><font o="2646">Turbine使用<code i="1365">DiscoveryClient</code>界面查找相关实例。</font><font o="2647">要使用Spring Cloud与Spring Cloud Consul的Turbine配置Turbine应用程序，类似于以下示例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2648">的pom.xml</font></div>
<div class="content">
<pre class="notranslate">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-netflix-turbine&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2649">请注意，Turbine依赖不是起始者。</font><font o="2650">涡轮启动器包括对Netflix Eureka的支持。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2651">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring.application.name: turbine
applications: consulhystrixclient
turbine:
  aggregator:
    clusterConfig: ${applications}
  appConfig: ${applications}</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2652"><code i="1366">clusterConfig</code>和<code i="1367">appConfig</code>部分必须匹配，因此将逗号分隔的服务ID列表放在单独的配置属性中是有用的。</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2653">Turbine。java的</font></div>
<div class="content">
<pre class="notranslate">@EnableTurbine
@EnableDiscoveryClient
@SpringBootApplication
public class Turbine {
    public static void main(String[] args) {
        SpringApplication.run(DemoturbinecommonsApplication.class, args);
    }
}</pre>
</div>
</div>
</div>
</div>
<h1 id="_spring_cloud_zookeeper" class="sect0">Spring Cloud Zookeeper</h1>
<div class="openblock partintro">
<div class="content"><font o="2655">
该项目通过自动配置为Spring Boot应用程序提供Zookeeper集成，并绑定到Spring环境和其他Spring编程模型成语。</font><font o="2656">通过几个简单的注释，您可以快速启用和配置应用程序中的常见模式，并使用基于Zookeeper的组件构建大型分布式系统。</font><font o="2657">提供的模式包括服务发现和配置。</font><font o="2658">智能路由（Zuul）和客户端负载平衡（Ribbon），断路器（Hystrix）通过与Spring Cloud Netflix集成提供。
</font></div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-install"><font o="2659">安装Zookeeper</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2660">请参阅</font><a href="javascript:;"><font o="2660">安装文档</font></a><font o="2660">获取有关如何安装Zookeeper指令。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-discovery"><font o="2661">服务发现与Zookeeper</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2662">服务发现是基于微服务架构的关键原则之一。</font><font o="2663">尝试配置每个客户端或某种形式的约定可能非常困难，可以非常脆弱。</font><a href="javascript:;"><font o="2664">策展人</font></a><font o="2664">（一个用于Zookeeper的java库）通过</font><a href="javascript:;"><font o="2664">服务发现扩展</font></a><font o="2664">提供服务发现服务</font><font o="2664">。</font><font o="2665">Spring Cloud Zookeeper利用此扩展功能进行服务注册和发现。</font></p>
</div>
<div class="sect2">
<h3 id="_how_to_activate_2"><font o="2666">如何激活</font></h3>
<div class="paragraph">
<p><font o="2667">包括对<code i="1368">org.springframework.cloud:spring-cloud-starter-zookeeper-discovery</code>的依赖将启用自动配置，从而设置Spring Cloud Zookeeper发现。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_with_zookeeper"><font o="2668">注册Zookeeper</font></h3>
<div class="paragraph">
<p><font o="2669">当客户端注册Zookeeper时，它提供有关自身的元数据，如主机和端口，ID和名称。</font></p>
</div>
<div class="paragraph">
<p><font o="2670">示例Zookeeper客户端：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableDiscoveryClient
@RestController
public class Application {

    @RequestMapping("/")
    public String home() {
        return "Hello world";
    }

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2671">（即完全正常的Spring Boot应用程序）。</font><font o="2672">如果Zookeeper位于<code i="1369">localhost:2181</code>以外的地方，则需要配置来定位服务器。</font><font o="2673">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2674">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    zookeeper:
      connect-string: localhost:2181</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2675">警告</font></div>
</td>
<td class="content"><font o="2676">
如果您使用</font><a href="#spring-cloud-zookeeper-config"><font o="2676">Spring Cloud Zookeeper配置</font></a><font o="2676">，上述值将需要放置在<code i="1370">bootstrap.yml</code>而不是<code i="1371">application.yml</code>中。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="2677">来自<code i="1372">Environment</code>的默认服务名称，实例ID和端口分别为<code i="1373">${spring.application.name}</code>，Spring上下文ID和<code i="1374">${server.port}</code>。</font></p>
</div>
<div class="paragraph">
<p><font o="2678"><code i="1375">@EnableDiscoveryClient</code>将应用程序同时进入Zookeeper“服务”（即注册自己）和“客户端”（即可以查询Zookeeper查找其他服务）。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_discoveryclient_2"><font o="2679">使用DiscoveryClient</font></h3>
<div class="paragraph">
<p><font o="2680">Spring Cloud支持</font><a href="javascript:;"><font o="2680">Feign</font></a><font o="2680">（REST客户端构建器），还支持</font><a href="javascript:;"><font o="2680">Spring <code i="1376">RestTemplate</code></font></a><font o="2680">使用逻辑服务名称而不是物理URL。</font></p>
</div>
<div class="paragraph">
<p><font o="2681">您还可以使用<code i="1377">org.springframework.cloud.client.discovery.DiscoveryClient</code>，它为Netflix特有的发现客户端提供了一个简单的API，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances("STORES");
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri().toString();
    }
    return null;
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-dependencies"><font o="2682">Zookeeper依赖关系</font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_using_the_zookeeper_dependencies"><font o="2683">使用Zookeeper依赖关系</font></h3>
<div class="paragraph">
<p><font o="2684">Spring Cloud Zookeeper使您可以将应用程序的依赖关系提供给属性。</font><font o="2685">作为依赖关系，您可以了解Zookeeper中注册的其他应用程序，您可以通过</font><a href="javascript:;"><font o="2685">Feign</font></a><font o="2685">（REST客户端构建器）以及</font><a href="javascript:;"><font o="2685">Spring <code i="1378">RestTemplate</code></font></a><font o="2685">呼叫</font><font o="2685">。</font></p>
</div>
<div class="paragraph">
<p><font o="2686">您还可以从Zookeeper依赖关系观察者功能中受益，这些功能可让您控制和监视依赖关系的状态，并决定如何处理。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_activate_zookeeper_dependencies"><font o="2687">如何激活Zookeeper依赖关系</font></h3>
<div class="ulist">
<ul>
<li>
<p><font o="2688">包括对<code i="1379">org.springframework.cloud:spring-cloud-starter-zookeeper-discovery</code>的依赖将启用自动配置，这将自动设置Spring Cloud Zookeeper依赖关系。</font></p>
</li>
<li>
<p><font o="2689">如果您必须正确设置<code i="1380">spring.cloud.zookeeper.dependencies</code>部分 - 请查看后续部分了解更多详细信息，然后该功能处于活动状态</font></p>
</li>
<li>
<p><font o="2690">即使您在属性中提供依赖关系，也可以关闭依赖关系。</font><font o="2691">只需将属性<code i="1381">spring.cloud.zookeeper.dependency.enabled</code>设置为false（默认为<code i="1382">true</code>）。</font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_zookeeper_dependencies"><font o="2692">设置Zookeeper依赖关系</font></h3>
<div class="paragraph">
<p><font o="2693">我们来仔细看一下依赖关系表示的例子：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2694">application.yml</font></div>
<div class="content">
<pre class="notranslate">spring.application.name: yourServiceName
spring.cloud.zookeeper:
  dependencies:
    newsletter:
      path: /path/where/newsletter/has/registered/in/zookeeper
      loadBalancerType: ROUND_ROBIN
      contentTypeTemplate: application/vnd.newsletter.$version+json
      version: v1
      headers:
        header1:
            - value1
        header2:
            - value2
      required: false
      stubs: org.springframework:foo:stubs
    mailing:
      path: /path/where/mailing/has/registered/in/zookeeper
      loadBalancerType: ROUND_ROBIN
      contentTypeTemplate: application/vnd.mailing.$version+json
      version: v1
      required: true</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2695">现在让我们一个接一个地遍历依赖的每个部分。</font><font o="2696">根属性名称为<code i="1383">spring.cloud.zookeeper.dependencies</code>。</font></p>
</div>
<div class="sect3">
<h4 id="_aliases"><font o="2697">别名</font></h4>
<div class="paragraph">
<p><font o="2698">在根属性下面，由于Ribbon的限制，必须通过别名来表示每个依赖关系（应用程序ID必须放在URL中，因此您不能传递任何复杂的路径，如/ foo / bar / name ）。</font><font o="2699">别名将是您将使用的名称，而不是<code i="1384">DiscoveryClient</code>，<code i="1385">Feign</code>或<code i="1386">RestTemplate</code>的serviceId。</font></p>
</div>
<div class="paragraph">
<p><font o="2700">在上述例子中，别名是<code i="1387">newsletter</code>和<code i="1388">mailing</code>。</font><font o="2701">Feign使用<code i="1389">newsletter</code>的示例将是：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">@FeignClient("newsletter")
public interface NewsletterService {
        @RequestMapping(method = RequestMethod.GET, value = "/newsletter")
        String getNewsletters();
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_path"><font o="2702">路径</font></h4>
<div class="paragraph">
<p><font o="2703">代表<code i="1390">path</code> yaml属性。</font></p>
</div>
<div class="paragraph">
<p><font o="2704">Path是依赖关系在Zookeeper下注册的路径。</font><font o="2705">像Ribbon之前提交的URL，因此此路径不符合其要求。</font><font o="2706">这就是为什么Spring Cloud Zookeeper将别名映射到正确的路径。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_load_balancer_type"><font o="2707">负载平衡器类型</font></h4>
<div class="paragraph">
<p><font o="2708">代表<code i="1391">loadBalancerType</code> yaml属性。</font></p>
</div>
<div class="paragraph">
<p><font o="2709">如果您知道在调用此特定依赖关系时必须应用什么样的负载平衡策略，那么您可以在yaml文件中提供它，并将自动应用。</font><font o="2710">您可以选择以下负载平衡策略之一</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2711">STICKY  - 一旦选择了该实例将始终被调用</font></p>
</li>
<li>
<p><font o="2712">随机 - 随机选择一个实例</font></p>
</li>
<li>
<p><font o="2713">ROUND_ROBIN  - 一遍又一遍地迭代实例</font></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_content_type_template_and_version"><font o="2714">Content-Type模板和版本</font></h4>
<div class="paragraph">
<p><font o="2715">代表<code i="1392">contentTypeTemplate</code>和<code i="1393">version</code> yaml属性。</font></p>
</div>
<div class="paragraph">
<p><font o="2716">如果您通过<code i="1394">Content-Type</code>标题版本您的api，那么您不想将此标题添加到您的每个请求中。</font><font o="2717">另外如果你想调用一个新版本的API，你不想漫游你的代码，以增加API版本。</font><font o="2718">这就是为什么你可以提供<code i="1395">contentTypeTemplate</code>特殊的<code i="1396">$version</code>占位符。</font><font o="2719">该占位符将由<code i="1397">version</code> yaml属性的值填充。</font><font o="2720">我们来看一个例子。</font></p>
</div>
<div class="paragraph">
<p><font o="2721">拥有以下<code i="1398">contentTypeTemplate</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">application/vnd.newsletter.$version+json</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2722">和以下<code i="1399">version</code>：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">v1</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2723">将导致为每个请求设置<code i="1400">Content-Type</code>标题：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">application/vnd.newsletter.v1+json</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_default_headers"><font o="2724">默认标题</font></h4>
<div class="paragraph">
<p><font o="2725">在yaml中代表<code i="1401">headers</code>地图</font></p>
</div>
<div class="paragraph">
<p><font o="2726">有时每次调用依赖关系都需要设置一些默认标头。</font><font o="2727">为了不在代码中这样做，您可以在yaml文件中设置它们。</font><font o="2728">拥有以下<code i="1402">headers</code>部分：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">headers:
    Accept:
        - text/html
        - application/xhtml+xml
    Cache-Control:
        - no-cache</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2729">结果在您的HTTP请求中添加适当的值列表的<code i="1403">Accept</code>和<code i="1404">Cache-Control</code>标头。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_obligatory_dependencies"><font o="2730">强制依赖</font></h4>
<div class="paragraph">
<p><font o="2731">代表yaml中的<code i="1405">required</code>属性</font></p>
</div>
<div class="paragraph">
<p><font o="2732">如果您的一个依赖关系在应用程序启动时需要启动并运行，则可以在yaml文件中设置<code i="1406">required: true</code>属性。</font></p>
</div>
<div class="paragraph">
<p><font o="2733">如果您的应用程序无法在引导期间本地化所需的依赖关系，则会引发异常，并且Spring上下文将无法设置。</font><font o="2734">换句话说，如果Zookeeper中没有注册所需的依赖关系，您的应用程序将无法启动。</font></p>
</div>
<div class="paragraph">
<p><font o="2735">您可以在以下部分阅读更多有关Spring Cloud Zookeeper存在检查器的信息。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_stubs"><font o="2736">存根</font></h4>
<div class="paragraph">
<p><font o="2737">您可以为包含依赖关系的存根的JAR提供冒号分隔路径。</font><font o="2738">例</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>stubs: org.springframework:foo:stubs</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2739">意味着对于特定的依赖关系可以在下面找到：</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2740">groupId：<code i="1407">org.springframework</code></font></p>
</li>
<li>
<p><font o="2741">artifactId：<code i="1408">foo</code></font></p>
</li>
<li>
<p><font o="2742">分类器：<code i="1409">stubs</code>  - 这是默认值</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2743">这实际上等于</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>stubs: org.springframework:foo</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2744">因为<code i="1410">stubs</code>是默认分类器。</font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_spring_cloud_zookeeper_dependencies"><font o="2745">配置Spring Cloud Zookeeper依赖关系</font></h3>
<div class="paragraph">
<p><font o="2746">有一些属性可以设置为启用/禁用Zookeeper依赖关系功能的部分。</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2747"><code i="1411">spring.cloud.zookeeper.dependencies</code>  - 如果您不设置此属性，则不会从Zookeeper依赖关系中受益</font></p>
</li>
<li>
<p><font o="2748"><code i="1412">spring.cloud.zookeeper.dependency.ribbon.enabled</code>（默认情况下启用） -  Ribbon需要显式的全局配置或特定的依赖关系。</font><font o="2749">通过打开此属性，运行时负载平衡策略解决是可能的，您可以从Zookeeper依赖关系的<code i="1413">loadBalancerType</code>部分获利。</font><font o="2750">需要此属性的配置具有<code i="1414">LoadBalancerClient</code>的实现，该代理委托给下一个子弹中的<code i="1415">ILoadBalancer</code></font></p>
</li>
<li>
<p><font o="2751"><code i="1416">spring.cloud.zookeeper.dependency.ribbon.loadbalancer</code>（默认情况下启用） - 感谢这个属性，自定义<code i="1417">ILoadBalancer</code>知道传递给Ribbon的URI部分实际上可能是必须被解析为Zookeeper。</font><font o="2752">没有此属性，您将无法在嵌套路径下注册应用程序。</font></p>
</li>
<li>
<p><font o="2753"><code i="1418">spring.cloud.zookeeper.dependency.headers.enabled</code>（默认情况下启用） - 此属性注册这样一个<code i="1419">RibbonClient</code>，将自动添加适当的头文件和内容类型，其中包含依赖关系配置中显示的版本。</font><font o="2754">没有这两个参数的设置将不会运行。</font></p>
</li>
<li>
<p><font o="2755"><code i="1420">spring.cloud.zookeeper.dependency.resttemplate.enabled</code>（默认情况下启用） - 启用时将修改<code i="1421">@LoadBalanced</code>注释的<code i="1422">RestTemplate</code>的请求标头，以便它在依赖关系配置中传递具有版本集的标题和内容类型。</font><font o="2756">Wihtout这两个参数的设置将无法运行。</font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-dependency-watcher"><font o="2757">Spring Cloud Zookeeper依赖关系观察者</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2758">依赖关系观察器机制允许您将侦听器注册到依赖关系中。</font><font o="2759">该功能实际上是<code i="1423">Observator</code>模式的实现。</font><font o="2760">当依赖关系改变其状态（UP或DOWN）时，可以应用一些自定义逻辑。</font></p>
</div>
<div class="sect2">
<h3 id="_how_to_activate_3"><font o="2761">如何激活</font></h3>
<div class="paragraph">
<p><font o="2762">Spring Cloud Zookeeper依赖关系功能需要启用从依赖关系观察器机制中获利。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_a_listener"><font o="2763">注册听众</font></h3>
<div class="paragraph">
<p><font o="2764">为了注册一个监听器，你必须实现一个接口<code i="1424">org.springframework.cloud.zookeeper.discovery.watcher.DependencyWatcherListener</code>并将其注册为一个bean。</font><font o="2765">该界面为您提供了一种方法：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">    void stateChanged(String dependencyName, DependencyState newState);</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2766">如果要为特定的依赖关系注册一个侦听器，则<code i="1425">dependencyName</code>将是您具体实现的鉴别器。</font><font o="2767"><code i="1426">newState</code>将为您提供有关您的依赖关系是否已更改为<code i="1427">CONNECTED</code>或<code i="1428">DISCONNECTED</code>的信息。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_presence_checker"><font o="2768">存在检查</font></h3>
<div class="paragraph">
<p><font o="2769">绑定与依赖关系观察器是称为存在检查器的功能。</font><font o="2770">它允许您在启动应用程序时提供自定义行为，以根据您的依赖关系的状态作出反应。</font></p>
</div>
<div class="paragraph">
<p><font o="2771">抽象<code i="1429">org.springframework.cloud.zookeeper.discovery.watcher.presence.DependencyPresenceOnStartupVerifier</code>类的默认实现是<code i="1430">org.springframework.cloud.zookeeper.discovery.watcher.presence.DefaultDependencyPresenceOnStartupVerifier</code>，其工作方式如下。</font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2772">如果依赖关系标记为我们<code i="1431">required</code>，并且不在Zookeeper中，则在引导时，您的应用程序将抛出异​​常并关闭</font></p>
</li>
<li>
<p><font o="2773">如果依赖关系不是<code i="1432">required</code>，<code i="1433">org.springframework.cloud.zookeeper.discovery.watcher.presence.LogMissingDependencyChecker</code>将在<code i="1434">WARN</code>级别上记录该应用程序</font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font o="2774">功能可以被覆盖，因为<code i="1435">DefaultDependencyPresenceOnStartupVerifier</code>只有在没有<code i="1436">DependencyPresenceOnStartupVerifier</code>的bean时被注册。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-config"><font o="2775">分布式配置与Zookeeper</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2776">Zookeeper提供了一个</font><a href="javascript:;"><font o="2776">分层命名空间</font></a><font o="2776">，允许客户端存储任意数据，如配置数据。</font><font o="2777">Spring Cloud Zookeeper Config是</font><a href="javascript:;"><font o="2777">Config Server和Client</font></a><font o="2777">的替代方案</font><font o="2777">。</font><font o="2778">在特殊的“引导”阶段，配置被加载到Spring环境中。</font><font o="2779">默认情况下，配置存储在<code i="1437">/config</code>命名空间中。</font><font o="2780">根据应用程序的名称和模拟解析属性的Spring Cloud Config顺序的活动配置文件创建多个<code i="1438">PropertySource</code>实例。</font><font o="2781">例如，名为“testApp”的应用程序和“dev”配置文件将创建以下属性源：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">config/testApp,dev
config/testApp
config/application,dev
config/application</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2782">最具体的物业来源位于顶部，底部最不具体。</font><font o="2783">Properties是<code i="1439">config/application</code>命名空间适用于使用zookeeper进行配置的所有应用程序。</font><font o="2784"><code i="1440">config/testApp</code>命名空间中的Properties仅适用于名为“testApp”的服务实例。</font></p>
</div>
<div class="paragraph">
<p><font o="2785">配置当前在应用程序启动时被读取。</font><font o="2786">发送HTTP POST到<code i="1441">/refresh</code>将导致重新加载配置。</font><font o="2787">观察配置命名空间（其中Zookeeper支持））目前尚未实现，但将来将成为此项目的补充。</font></p>
</div>
<div class="sect2">
<h3 id="_how_to_activate_4"><font o="2788">如何激活</font></h3>
<div class="paragraph">
<p><font o="2789">包括对<code i="1442">org.springframework.cloud:spring-cloud-starter-zookeeper-config</code>的依赖将启用将自动配置Spring Cloud Zookeeper配置的自动配置。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_2"><font o="2790">定制</font></h3>
<div class="paragraph">
<p><font o="2791">Zookeeper可以使用以下属性自定义配置：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2792">bootstrap.yml</font></div>
<div class="content">
<pre class="notranslate">spring:
  cloud:
    zookeeper:
      config:
        enabled: true
        root: configuration
        defaultContext: apps
        profileSeparator: '::'</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><font o="2793"><code i="1443">enabled</code>将此值设置为“false”将禁用Zookeeper配置</font></p>
</li>
<li>
<p><font o="2794"><code i="1444">root</code>设置配置值的基本命名空间</font></p>
</li>
<li>
<p><font o="2795"><code i="1445">defaultContext</code>设置所有应用程序使用的名称</font></p>
</li>
<li>
<p><font o="2796"><code i="1446">profileSeparator</code>设置用于使用配置文件在属性源中分隔配置文件名称的分隔符的值</font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_spring_boot_cloud_cli" class="sect0">Spring Boot Cloud CLI</h1>
<div class="openblock partintro">
<div class="content"><font o="2798">
Spring Boot CLI </font><font o="2798">为</font><a href="javascript:;"><font o="2798">Spring Cloud</font></a><font o="2798">提供</font><a href="javascript:;"><font o="2798">Spring启动</font></a><font o="2798">命令行功能</font><font o="2798">。</font><font o="2799">您可以编写运行Spring Cloud组件应用程序（例如<code i="1447">@EnableEurekaServer</code>）的Groovy脚本。</font><font o="2800">您还可以轻松地进行加密和解密等操作，以支持具有秘密配置值的Spring Cloud Config客户端。</font><font o="2801">使用Launcher CLI，您可以从命令行一次性启动Eureka，Zipkin，Config Server等服务（在开发时非常有用）。
</font><a href="javascript:;"><font></font></a><font></font></div>
</div>
<div class="sect1">
<h2 id="_installation"><font o="2802">安装</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2803">要安装，请确保您具有
 </font><a href="javascript:;"><font o="2803">Spring Boot CLI</font></a><font o="2803"> 
（1.4.1或更好）：</font></p>
</div>
<div class="literalblock">
<div class="content">
<pre class="notranslate">$ spring version
Spring CLI v1.4.1.RELEASE</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2804">例如SDKMan用户</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>$ sdk install springboot 1.4.1.RELEASE
$ sdk use springboot 1.4.1.RELEASE</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2805">并安装Spring Cloud插件</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>$ mvn install
$ spring install org.springframework.cloud:spring-cloud-cli:1.2.3.BUILD-SNAPSHOT</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2806">重要</font></div>
</td>
<td class="content">
<strong><font o="2807">先决条件：</font></strong><font o="2807">要使用加密和解密功能，您需要在JVM中安装全面的JCE（默认情况下不存在）。</font><font o="2808">您可以从Oracle下载“Java加密扩展（JCE）无限强度管理策略文件”，并按照安装说明（实际上将JRE lib / security目录中的2个策略文件替换为您下载的文件）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_spring_cloud_services_in_development"><font o="2809">在开发中运行Spring Cloud服务</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2810">Launcher CLI可以用于从命令行运行像Eureka，Config Server等常用服务。</font><font o="2811">列出您可以执行的可用服务<code i="1448">spring cloud --list</code>，并启动<code i="1449">spring cloud</code>的一组默认服务。</font><font o="2812">要选择要部署的服务，只需在命令行中列出它们，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring cloud eureka configserver h2 kafka zipkin</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2813">支持的可部署的摘要：</font></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font o="2814">服务</font></th>
<th class="tableblock halign-left valign-top"><font o="2815">名称</font></th>
<th class="tableblock halign-left valign-top"><font o="2816">地址</font></th>
<th class="tableblock halign-left valign-top"><font o="2817">描述</font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Eureka Server</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:8761</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2818">Eureka服务器进行服务注册和发现。</font><font o="2819">所有其他服务默认显示在其目录中。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">configserver</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Config Server</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:8888</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2820">Spring Cloud Config服务器以“本机”配置文件运行，并从本地目录./launcher提供配置</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">H2 Database</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:9095</a> (console), jdbc:h2:tcp://localhost:9096/{data}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2821">关系数据库服务。</font><font o="2822">连接时使用文件路径<code i="1450">{data}</code>（例如<code i="1451">./target/test</code>）。</font><font o="2823">请记住，您可以添加<code i="1452">;MODE=MYSQL</code>或<code i="1453">;MODE=POSTGRESQL</code>以连接其​​他服务器类型的兼容性。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">kafka</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Kafka Broker</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:9091</a> (actuator endpoints), localhost:9092</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">hystrixdashboard</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Hystrix Dashboard</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:7979</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2824">任何声明Hystrix断路器的Spring Cloud应用程式都会在<code i="1454">/hystrix.stream</code>发布指标。</font><font o="2825">将该地址键入信息中心，以便可视化所有指标，</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">dataflow</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Dataflow Server</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:9393</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2826">Spring Cloud数据流服务器，用户名为/ admin-ui。</font><font o="2827">将Dataflow shell以根路径连接到目标。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zipkin</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">Zipkin Server</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:9411</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2828">Zipkin具有用于可视化跟踪的UI的服务器。</font><font o="2829">存储器将数据跨越内存并通过JSON数据的HTTP POST接受。</font></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font o="2830">可以使用具有相同名称的本地YAML文件（在当前工作目录或名为“config”或<code i="1455">~/.spring-cloud</code>的子目录）中配置这些应用程序。</font><font o="2831">例如，在<code i="1456">configserver.yml</code>中，您可能需要执行此操作来查找后端的本地git存储库：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2832">configserver.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  profiles:
    active: git
  cloud:
    config:
      server:
        git:
          uri: file://${user.home}/dev/demo/config-repo</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_adding_additional_applications"><font o="2833">添加其他应用程序</font></h3>
<div class="paragraph">
<p><font o="2834">其他应用程序可以添加到<code i="1457">./config/cloud.yml</code>（不是<code i="1458">./config.yml</code>，因为这将替换默认值），例如</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2835">配置/ cloud.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    launcher:
      deployables:
        source:
          coordinates: maven://com.example:source:0.0.1-SNAPSHOT
          port: 7000
        sink:
          coordinates: maven://com.example:sink:0.0.1-SNAPSHOT
          port: 7001</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2836">列出应用程式时：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code>$ spring cloud --list
source sink configserver dataflow eureka h2 hystrixdashboard kafka zipkin</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2837">（注意列表开头附加的应用程序）。</font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_groovy_scripts_and_running_applications"><font o="2838">编写Groovy脚本并运行应用程序</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2839">Spring Cloud CLI支持大部分Spring Cloud声明性功能，例如<code i="1459">@Enable*</code>注解类。</font><font o="2840">例如，这是一个功能齐全的Eureka服务器</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2841">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-groovy" data-lang="groovy">@EnableEurekaServer
class Eureka {}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2842">你可以从这样的命令行运行它</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring run app.groovy</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2843">要包括额外的依赖关系，通常只需添加适当的特征启用注释即可，例如<code i="1460">@EnableConfigServer</code>，<code i="1461">@EnableOAuth2Sso</code>或<code i="1462">@EnableEurekaClient</code>。</font><font o="2844">要手动包含一个依赖关系，您可以使用<code i="1463">@Grab</code>特殊的“Spring Boot”短格式工件坐标，即仅使用工件ID（不需要组或版本信息），例如设置客户端应用程序在AMQP上收听来自Spring CLoud总线的管理事件：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2845">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-groovy" data-lang="groovy">@Grab('spring-cloud-starter-bus-amqp')
@RestController
class Service {
  @RequestMapping('/')
  def home() { [message: 'Hello'] }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_encryption_and_decryption_3"><font o="2846">加密和解密</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2847">Spring Cloud CLI附带一个“encrypt”和“decrypt”命令。</font><font o="2848">两个接受以指定为强制“ - ”的键的相同形式的参数，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring encrypt mysecret --key foo
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
$ spring decrypt --key foo 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
mysecret</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2849">要在文件中使用密钥（例如，用于encyption的RSA公钥），使用“@”键入键值，并提供文件路径，例如</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring encrypt mysecret --key @${HOME}/.ssh/id_rsa.pub
AQAjPgt3eFZQXwt8tsHAVv/QHiY5sI2dRcR+...</pre>
</div>
</div>
</div>
</div>
<h1 id="_spring_cloud_security" class="sect0">Spring Cloud Security</h1>
<div class="openblock partintro">
<div class="content"><font o="2851">
Spring Cloud Security提供了一组用于构建安全应用程序和服务的原语，最小化。</font><font o="2852">可以从外部（或集中）高度配置的声明式模型适用于通常使用中央契约管理服务的大型合作远程组件系统的实现。</font><font o="2853">在像Cloud Foundry这样的服务平台上也很容易使用。</font><font o="2854">基于Spring Boot和Spring安全性OAuth2，我们可以快速创建实现常见模式的系统，如单点登录，令牌中继和令牌交换。
</font></div>
</div>
<div class="sect1">
<h2 id="_quickstart"><font o="2855">快速开始</font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_oauth2_single_sign_on"><font o="2856">OAuth2单一登录</font></h3>
<div class="paragraph">
<p><font o="2857">这是一个拥有HTTP Basic身份验证和单个用户帐户的Spring Cloud“Hello World”应用程序：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2858">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Grab('spring-boot-starter-security')
@Controller
class Application {

  @RequestMapping('/')
  String home() {
    'Hello World'
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2859">您可以使用<code i="1464">spring run app.groovy</code>运行它，并观察日志的密码（用户名为“用户”）。</font><font o="2860">到目前为止，这只是Spring Boot应用程序的默认设置。</font></p>
</div>
<div class="paragraph">
<p><font o="2861">这是一个使用OAuth2 SSO的Spring Cloud应用程式：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2862">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Controller
@EnableOAuth2Sso
class Application {

  @RequestMapping('/')
  String home() {
    'Hello World'
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2863">指出不同？</font><font o="2864">这个应用程序的行为实际上与之前的一样，因为它不知道它是OAuth2的信誉。</font></p>
</div>
<div class="paragraph">
<p><font o="2865">您可以很容易地在github注册一个应用程序，所以如果你想要一个生产应用程序在你自己的域上尝试。</font><font o="2866">如果您很乐意在localhost：8080上测试，那么请在应用程序配置中设置这些属性：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2867">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  oauth2:
    client:
      clientId: bd1c0a783ccdd1c9b9e4
      clientSecret: 1a9030fbca47a5b2c28e92f19050bb77824b5ad1
      accessTokenUri: https://github.com/login/oauth/access_token
      userAuthorizationUri: https://github.com/login/oauth/authorize
      clientAuthenticationScheme: form
    resource:
      userInfoUri: https://api.github.com/user
      preferTokenInfo: false</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2868">运行上面的应用程序，它将重定向到github进行授权。</font><font o="2869">如果您已经登录github，您甚至不会注意到它已经通过身份验证。</font><font o="2870">只有您的应用程序在8080端口上运行，这些凭据才会起作用。</font></p>
</div>
<div class="paragraph">
<p><font o="2871">要限制客户端在获取访问令牌时要求的范围，您可以设置<code i="1465">spring.oauth2.client.scope</code>（逗号分隔或YAML中的数组）。</font><font o="2872">默认情况下，作用域为空，由授权服务器确定默认值是什么，通常取决于客户端注册中的设置。</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2873">注意</font></div>
</td>
<td class="content"><font o="2874">
上面的例子都是Groovy脚本。</font><font o="2875">如果要在Java（或Groovy）中编写相同的代码，则需要将Spring安全性OAuth2添加到类路径中（例如，请参阅</font><a href="javascript:;"><font o="2875">此处</font></a><font o="2875">的
 </font><a href="javascript:;"><font o="2875">示例</font></a><font o="2875">）。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_oauth2_protected_resource"><font o="2876">OAuth2受保护资源</font></h3>
<div class="paragraph">
<p><font o="2877">您要使用OAuth2令牌保护API资源？</font><font o="2878">这是一个简单的例子（与上面的客户端配对）：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2879">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Grab('spring-cloud-starter-security')
@RestController
@EnableResourceServer
class Application {

  @RequestMapping('/')
  def home() {
    [message: 'Hello World']
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2880">和</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2881">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">spring:
  oauth2:
    resource:
      userInfoUri: https://api.github.com/user
      preferTokenInfo: false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_detail"><font o="2882">更多详情</font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_single_sign_on"><font o="2883">单点登录</font></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2884">注意</font></div>
</td>
<td class="content"><font o="2885">
所有的OAuth2 SSO和资源服务器功能在版本1.3中移动到Spring Boot。</font><font o="2886">您可以在</font><a href="javascript:;"><font o="2886">Spring Boot用户指南</font></a><font o="2886">中查找文档
 </font><font o="2886">。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_token_relay"><font o="2887">令牌中继</font></h3>
<div class="paragraph">
<p><font o="2888">令牌中继是OAuth2消费者充当客户端，并将传入令牌转发到外发资源请求。</font><font o="2889">消费者可以是纯客户端（如SSO应用程序）或资源服务器。</font></p>
</div>
<div class="sect3">
<h4 id="_client_token_relay"><font o="2890">客户端令牌中继</font></h4>
<div class="paragraph">
<p><font o="2891">如果您的应用是面向OAuth2客户端的用户（即宣布<code i="1466">@EnableOAuth2Sso</code>或<code i="1467">@EnableOAuth2Client</code>）），那么它的请求范围为Spring Boot的<code i="1468">OAuth2ClientContext</code>。</font><font o="2892">您可以从此上下文和自动连线<code i="1470">OAuth2ProtectedResourceDetails</code>创建自己的<code i="1469">OAuth2RestTemplate</code>，然后上下文将始终向下转发访问令牌，如果过期则自动刷新访问令牌。</font><font o="2893">（这些是Spring安全性和Spring Boot的功能。）</font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2894">注意</font></div>
</td>
<td class="content"><font o="2895">
如果您使用<code i="1472">client_credentials</code>令牌，Spring Boot（1.4.1）不会自动创建<code i="1471">OAuth2ProtectedResourceDetails</code>。</font><font o="2896">在这种情况下，您需要创建自己的<code i="1473">ClientCredentialsResourceDetails</code>并使用<code i="1474">@ConfigurationProperties("security.oauth2.client")</code>进行配置。
</font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_client_token_relay_in_zuul_proxy"><font o="2897">Zuul代理服务器中的客户端令牌中继</font></h4>
<div class="paragraph">
<p><font o="2898">如果您的应用程序还有
 </font><a href="javascript:;"><font o="2898">Spring Cloud Zuul</font></a><font o="2898">嵌入式反向代理（使用<code i="1475">@EnableZuulProxy</code>），那么您可以要求它将OAuth2访问令牌转发到其代理的服务。</font><font o="2899">因此，上述的SSO应用程序可以简单地增强：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2900">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Controller
@EnableOAuth2Sso
@EnableZuulProxy
class Application {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2901">并且（除了记录用户并抓取令牌之外）还将认证令牌向下游传递到<code i="1476">/proxy/*</code>服务。</font><font o="2902">如果这些服务是使用<code i="1477">@EnableResourceServer</code>实现的，那么他们将在正确的头中获取一个有效的令牌。</font></p>
</div>
<div class="paragraph">
<p><font o="2903">它是如何工作的？</font><font o="2904"><code i="1478">@EnableOAuth2Sso</code>注释引入<code i="1479">spring-cloud-starter-security</code>（您可以在传统应用程序中手动执行），并反过来触发一个<code i="1480">ZuulFilter</code>的自动配置，该自定义本身被激活，因为Zuul在classpath（via <code i="1481">@EnableZuulProxy</code>）。</font><font o="2905">该
 </font><a href="javascript:;"><font o="2905">过滤器</font></a><font o="2905"> 
仅从当前已认证的用户提取访问令牌，并将其放入下游请求的请求头中。</font></p>
</div>
</div>
<div class="sect3">
<h4 id="_resource_server_token_relay"><font o="2906">资源服务器令牌中继</font></h4>
<div class="paragraph">
<p><font o="2907">如果您的应用程序有<code i="1482">@EnableResourceServer</code>，则可能需要将传入令牌下载到其他服务。</font><font o="2908">如果您使用<code i="1483">RestTemplate</code>联系下游服务，那么这只是如何使用正确的上下文创建模板的问题。</font></p>
</div>
<div class="paragraph">
<p><font o="2909">如果您的服务使用<code i="1484">UserInfoTokenServices</code>来验证传入令牌（即使用<code i="1485">security.oauth2.user-info-uri</code>配置），则可以使用自动连线<code i="1487">OAuth2ClientContext</code>创建<code i="1486">OAuth2RestTemplate</code>（将由身份验证过程之前它遇到后端代码）。</font><font o="2910">等价（使用Spring Boot 1.4），您可以在配置中注入<code i="1488">UserInfoRestTemplateFactory</code>并抓取其<code i="1489">OAuth2RestTemplate</code>。</font><font o="2911">例如：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2912">MyConfiguration.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Bean
public OAuth2RestTemplate restTemplate(UserInfoRestTemplateFactory factory) {
    return factory.getUserInfoRestTemplate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2913">然后，这个休息模板将具有认证过滤器使用的相同的<code i="1490">OAuth2ClientContext</code>（请求范围），因此您可以使用它来发送具有相同访问令牌的请求。</font></p>
</div>
<div class="paragraph">
<p><font o="2914">如果您的应用没有使用<code i="1491">UserInfoTokenServices</code>，但仍然是客户端（即声明<code i="1492">@EnableOAuth2Client</code>或<code i="1493">@EnableOAuth2Sso</code>），则使用Spring安全云任何<code i="1494">OAuth2RestOperations</code>，用户从<code i="1495">@Autowired</code> <code i="1496">@OAuth2Context</code>也会转发令牌。</font><font o="2915">此功能默认实现为MVC处理程序拦截器，因此它仅适用于Spring MVC。</font><font o="2916">如果您不使用MVC，可以使用包含<code i="1497">AccessTokenContextRelay</code>的自定义过滤器或AOP拦截器来提供相同的功能。</font></p>
</div>
<div class="paragraph">
<p><font o="2917">以下是一个基本示例，显示了使用其他地方创建的自动连线休息模板（“foo.com”是一个资源服务器，接受与周围应用程序相同的令牌）：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2918">MyController.java</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Autowired
private OAuth2RestOperations restTemplate;

@RequestMapping("/relay")
public String relay() {
    ResponseEntity&lt;String&gt; response =
      restTemplate.getForEntity("https://foo.com/bar", String.class);
    return "Success! (" + response.getBody() + ")";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2919">如果您不想转发令牌（这是一个有效的选择，因为您可能想要像自己一样，而不是向您发送令牌的客户端），那么您只需要创建自己的<code i="1498">OAuth2Context</code>的自动装配默认值。</font></p>
</div>
<div class="paragraph">
<p><font o="2920">Feign客户端也会选择一个拦截器，使用<code i="1499">OAuth2ClientContext</code>，如果它是可用的，那么他们还应该在<code i="1500">RestTemplate</code>将要执行的令牌中继。</font></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_authentication_downstream_of_a_zuul_proxy"><font o="2921">配置Zuul代理下游的认证</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2922">您可以通过<code i="1502">proxy.auth.*</code>设置控制<code i="1501">@EnableZuulProxy</code>下游的授权行为。</font><font o="2923">例：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2924">application.yml</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-yaml" data-lang="yaml">proxy:
  auth:
    routes:
      customers: oauth2
      stores: passthru
      recommendations: none</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2925">在此示例中，“客户”服务获取OAuth2令牌中继，“存储”服务获取传递（授权头只是通过下游），“建议”服务已删除其授权头。</font><font o="2926">如果有令牌可用，则默认行为是执行令牌中继，否则为passthru。</font></p>
</div>
<div class="paragraph">
<p><font o="2927">有关</font><font o="2927">详细信息，</font><font o="2927">请参阅
 </font><a href="javascript:;"><font o="2927">
ProxyAuthenticationProperties</font></a><font o="2927">。</font></p>
</div>
</div>
</div>
<h1 id="_spring_cloud_for_cloud_foundry" class="sect0">Spring Cloud for Cloud Foundry</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><font o="2929">Cloudfoundry的Spring Cloud可以轻松</font><font o="2929">在</font><a href="javascript:;"><font o="2929">Cloud Foundry</font></a><font o="2929">（平台即服务）</font><font o="2929">中运行
 </font><a href="javascript:;"><font o="2929">Spring Cloud</font></a><font o="2929">应用程序
 </font><font o="2929">。</font><font o="2930">Cloud Foundry有一个“服务”的概念，它是“绑定”到应用程序的中间件，本质上为其提供包含凭据的环境变量（例如，用于服务的位置和用户名）。</font><a href="javascript:;"><font></font></a><font></font></p>
</div>
<div class="paragraph">
<p><font o="2931"><code i="1503">spring-cloud-cloudfoundry-web</code>项目为Cloud Foundry中的webapps的一些增强功能提供了基本支持：自动绑定到单点登录服务，并可选择启用粘性路由进行发现。</font></p>
</div>
<div class="paragraph">
<p><font o="2932"><code i="1504">spring-cloud-cloudfoundry-discovery</code>项目提供Spring Cloud Commons <code i="1505">DiscoveryClient</code>的实施，所以您可以<code i="1506">@EnableDiscoveryClient</code>并将您的凭证提供为<code i="1507">spring.cloud.cloudfoundry.discovery.[email,password]</code>，然后可以直接使用<code i="1508">DiscoveryClient</code>或通过<code i="1509">LoadBalancerClient</code>（如果您没有连接到</font><a href="javascript:;"><font o="2932">Pivotal Web Services，</font></a><font o="2932">则也为<code i="1510">*.url</code>
 </font><font o="2932">）。</font></p>
</div>
<div class="paragraph">
<p><font o="2933">第一次使用它时，发现客户端可能很慢，因为它必须从Cloud Foundry获取访问令牌。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discovery"><font o="2934">发现</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2935">以下是Cloud Foundry发现的Spring Cloud应用程式：</font></p>
</div>
<div class="listingblock">
<div class="title"><font o="2936">app.groovy</font></div>
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Grab('org.springframework.cloud:spring-cloud-cloudfoundry')
@RestController
@EnableDiscoveryClient
class Application {

  @Autowired
  DiscoveryClient client

  @RequestMapping('/')
  String home() {
    'Hello from ' + client.getLocalServiceInstance()
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2937">如果您运行它没有任何服务绑定：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="notranslate">$ spring jar app.jar app.groovy
$ cf push -p app.jar</pre>
</div>
</div>
<div class="paragraph">
<p><font o="2938">它将在主页中显示其应用程序名称。</font></p>
</div>
<div class="paragraph">
<p><font o="2939"><code i="1511">DiscoveryClient</code>可以列出空间中的所有应用程序，这些应用程序根据身份验证的凭据，其中的空间默认为客户端运行的空间（如果有的话）。</font><font o="2940">如果组织和空间都不配置，则它们将根据Cloud Foundry中的用户配置文件进行默认。</font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_single_sign_on_2"><font o="2941">单点登录</font></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title"><font o="2942">注意</font></div>
</td>
<td class="content"><font o="2943">
所有的OAuth2 SSO和资源服务器功能在版本1.3中移动到Spring Boot。</font><font o="2944">您可以在</font><a href="javascript:;"><font o="2944">Spring Boot用户指南</font></a><font o="2944">中查找文档
 </font><font o="2944">。
</font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font o="2945">该项目提供从CloudFoundry服务凭据到Spring Boot功能的自动绑定。</font><font o="2946">如果您有一个称为“sso”的CloudFoundry服务，例如，凭借包含“client_id”，“client_secret”和“auth_domain”的凭据，它将自动绑定到您启用的Spring OAuth2客户端<code i="1512">@EnableOAuth2Sso</code>（来自Spring Boot）。</font><font o="2947">可以使用<code i="1513">spring.oauth2.sso.serviceId</code>参数化服务的名称。</font></p>
</div>
</div>
</div>
<h1 id="_spring_cloud_cluster" class="sect0"><font o="2948">Spring Cloud集群</font></h1>
<div class="openblock partintro">
<div class="content"><font o="2949">
Spring Cloud集群提供了一组用于将“集群”功能构建到分布式系统中的原语。</font><font o="2950">例如领导选举，集群状态的一致存储，全局锁和一次性令牌。
</font></div>
</div>
<div class="sect1">
<h2 id="_leader_election"><font o="2951">Leader选举</font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font o="2952">Leader选举允许应用程序与其他应用程序一起通过第三方系统协调集群领导。</font><font o="2953">目前，我们提供与<code i="1514">zookeeper</code>，<code i="1515">hazelcast</code>和<code i="1516">etcd</code>的集成。</font></p>
</div>
<div class="paragraph">
<p><font o="2954">从用户的角度来看，选举通过接口<code i="1517">org.springframework.cloud.cluster.leader.Candidate</code>和<code i="1518">org.springframework.cloud.cluster.leader.Context</code>工作。</font><font o="2955"><code i="1519">Candidate</code>包含访问领导层的<code i="1520">role</code>和<code i="1521">id</code>，并且还有方法<code i="1522">onGranted</code>和<code i="1523">onRevoked</code>。</font><font o="2956">如果更改默认<code i="1524">Candidate</code>实现，这些回调方法很有用。</font></p>
</div>
<div class="paragraph">
<p><font o="2957">Leader选举是自动配置的，如果从类路径中找到<code i="1525">spring-cloud-cluster-autoconfigure</code>和<code i="1526">spring-cloud-cluster-hazelcast</code>，<code i="1527">spring-cloud-cluster-zookeeper</code>或<code i="1528">spring-cloud-cluster-etcd</code> jars。</font><font o="2958">如果发现两个罐子都是使用这两个系统创建的。</font><font o="2959">有关</font><font o="2959">创建的bean的更多信息</font><font o="2959">，</font><font o="2959">请参见</font><a href="#spring-cloud-cluster-leaderelection-zookeeper"><font o="2959">Zookeeper</font></a><font o="2959">，
 </font><a href="#spring-cloud-cluster-leaderelection-hazelcast"><font o="2959">Hazelcast</font></a><font o="2959">和
 </font><a href="#spring-cloud-cluster-leaderelection-etcd"><font o="2959">Etcd部分</font></a><font o="2959">。</font></p>
</div>
<div class="paragraph">
<p><font o="2960" class="">从自动配置创建的默认<code i="1529">Candidate</code>是<code i="1530">org.springframework.cloud.cluster.leader.DefaultCandidate</code>，目前只有日志被许可和撤销事件。</font></p>
</div>
<div class="paragraph">
<p><font o="2961">如果需要禁用所有与引导相关的自动配置，则可以将<code i="1531">spring.cloud.cluster.leader.enabled</code>设置为false，即使在类路径上存在jar也可以进行手动配置。</font><font o="2962">Properties <code i="1532">spring.cloud.cluster.leader.id</code>和<code i="1533">spring.cloud.cluster.leader.role</code>可用于设置默认标识符和角色。</font></p>
</div>
<div class="paragraph">
<p><font o="2963" class="">如果您有兴趣简单地获得授权和撤销事件的通知，则一个选项是将事件侦听器附加到Spring ApplicationContext中。</font><font o="2964" class="">Events <code i="1534">OnGrantedEvent</code>和<code i="1535">OnRevokedEvent</code>作为Spring事件对象发送。</font></p>
</div>
<div class="paragraph">
<p><font o="2965">只需创建自己的事件侦听器类：</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">class MyEventListener implements ApplicationListener&lt;AbstractLeaderEvent&gt; {

  @Override
  public void onApplicationEvent(AbstractLeaderEvent event) {
    // do something with OnGrantedEvent or OnRevokedEvent
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2966">然后将其创建为一个bean。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">@Configuration
static class Config {
  @Bean
  public MyEventListener myEventListener() {
    return new MyEventListener();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font o="2967">对于简单的日志事件，您还可以使用实用程序类<code i="1536">LoggingListener</code>，这样可以轻松配置。</font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight notranslate"><code class="language-java" data-lang="java">import org.springframework.cloud.cluster.leader.event.LoggingListener;

@Configuration
static class Config {
  @Bean
  public LoggingListener loggingListener() {
    return new LoggingListener("info");
  }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-cluster-leaderelection-zookeeper">Zookeeper</h3>
<div class="paragraph">
<p><font o="2969">zookeeper的<code i="1537">Candidate</code>实现使用bean名称<code i="1538">zookeeperLeaderCandidate</code>创建，可以用于覆盖在自动配置期间创建的一个。</font></p>
</div>
<div class="paragraph">
<p><font o="2970">可以使用属性<code i="1539">spring.cloud.cluster.zookeeper.leader.enabled</code>明确禁用基于Zookeeper的选举。</font></p>
</div>
<div class="paragraph">
<p><font o="2971">其他属性<code i="1540">spring.cloud.cluster.zookeeper.namespace</code>和<code i="1541">spring.cloud.cluster.zookeeper.connect</code>可用于设置zookeeper基本命名空间路径和连接字符串。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-cluster-leaderelection-hazelcast">Hazelcast</h3>
<div class="paragraph">
<p><font o="2973"><code i="1542">Candidate</code>使用bean名称<code i="1543">hazelcastLeaderCandidate</code>创建了hazelcast的实现，该名称可以用于覆盖自动配置过程中创建的一个。</font></p>
</div>
<div class="paragraph">
<p><font o="2974">可以使用属性<code i="1544">spring.cloud.cluster.hazelcast.leader.enabled</code>显式禁用基于Hazelcast的选举。</font><font o="2975">如果要为Hazelcast实例提供基于xml的配置，则使用属性<code i="1545">spring.cloud.cluster.hazelcast.config-location</code>来告诉Hazelcast xml配置文件的位置。</font><font o="2976"><code i="1546">config-location</code>是普通的Spring<code i="1547">Resource</code>。</font></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-cluster-leaderelection-etcd">Etcd</h3>
<div class="paragraph">
<p><font o="2978">使用bean名称<code i="1549">etcdLeaderCandidate</code>创建了用于etcd的<code i="1548">Candidate</code>实现，可以用它来覆盖在自动配置过程中创建的一个。</font></p>
</div>
<div class="paragraph">
<p><font o="2979">可以使用属性<code i="1550">spring.cloud.cluster.etcd.leader.enabled</code>明确禁用基于Etcd的选举。</font></p>
</div>
<div class="paragraph">
<p><font o="2980">可以使用属性<code i="1551">spring.cloud.cluster.etcd.connect</code>指定多个etcd集群uris</font></p>
</div>
</div>
</div>
</div>
<h1 id="_appendix_compendium_of_configuration_properties" class="sect0"><font o="2981">附录：配置纲要Properties</font></h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font o="2982">名称</font></th>
<th class="tableblock halign-left valign-top"><font o="2983">默认</font></th>
<th class="tableblock halign-left valign-top"><font o="2984">描述</font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.fail-on-error</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2985">标记说，如果存在加密或解密错误，进程将失败。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.key</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2986">对称密钥。</font><font o="2987">作为一个更强大的替代方案，考虑使用密钥库。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.key-store.alias</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2988">商店中的钥匙别名</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.key-store.location</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2989">密钥存储文件的位置，例如classpath：/keystore.jks。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.key-store.password</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2990">锁定密钥库的密码。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.key-store.secret</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2991">秘密保护密钥（默认为密码相同）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.rsa.algorithm</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2992">使用RSA算法（DEFAULT或OEAP）。</font><font o="2993">一旦设置不改变它（或现有的密码将不可解密）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.rsa.salt</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">deadbeef</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2994">Salt用于加密密文的随机秘密。</font><font o="2995">一旦设置不改变它（或现有的密码将不可解密）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">encrypt.rsa.strong</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="2996">标志表示应该在内部使用“强”AES加密。</font><font o="2997">如果为真，则将GCM算法应用于AES加密字节。</font><font o="2998">默认值为false（在这种情况下使用“标准”CBC代替）。</font><font o="2999">一旦设置不改变它（或现有的密码将不可解密）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.bus.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.bus.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.bus.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.consul.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.consul.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.consul.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.features.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.features.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.features.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.pause.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.pause.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.pause.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.refresh.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.refresh.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.refresh.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.pause-endpoint.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.pause-endpoint.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.pause-endpoint.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.resume-endpoint.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.resume-endpoint.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.resume-endpoint.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.restart.timeout</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.resume.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.resume.id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">endpoints.resume.sensitive</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.allow-redirects</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3000">指示服务器是否可以将客户端请求重定向到备份服务器/集群。</font><font o="3001">如果设置为false，服务器将直接处理请求，如果设置为true，则可能会向客户端发送HTTP重定向，并具有新的服务器位置。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.availability-zones</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3002">获取此实例所在区域的可用性区域列表（用于AWS数据中心）。
</font></p><p class="tableblock"><font o="3003"> 更改在运行时在registryFetchIntervalSeconds指定的下一个注册表提取周期中有效。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.backup-registry-impl</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3004">获取执行BackupRegistry的实现的名称，以便仅在eureka客户端启动时首次将注册表信息作为回退选项提取。
</font></p><p class="tableblock"><font o="3005"> 对于需要额外的弹性的注册表信息的应用程序可能需要这一点，而无法运行它们。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.cache-refresh-executor-exponential-back-off-bound</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3006">缓存刷新执行者指数退出相关属性。</font><font o="3007">在发生超时序列的情况下，它是重试延迟的最大乘数值。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.cache-refresh-executor-thread-pool-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3008">cacheRefreshExecutor初始化的线程池大小</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.client-data-accept</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3009">EurekaAccept客户端数据接受名称</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.decoder-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3010">这是一个瞬态配置，一旦最新的编解码器稳定，可以删除（因为只有一个）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.disable-delta</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3011">指示eureka客户端是否应该禁用提取delta，而应该诉诸于获取完整的注册表信息。
</font></p><p class="tableblock"><font o="3012"> 请注意，增量获取可以极大地减少流量，因为尤利卡服务器的更改速率通常远低于提取速率。
</font></p><p class="tableblock"><font o="3013"> 更改在运行时在registryFetchIntervalSeconds指定的下一个注册表提取周期中有效</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.dollar-replacement</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">_-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3014">在eureka服务器的序列化/反序列化信息期间，获取Dollar符号&lt;code&gt; $ &lt;/ code&gt;的替换字符串。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3015">标记以指示启用Eureka客户端。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.encoder-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3016">这是一个瞬态配置，一旦最新的编解码器稳定，可以删除（因为只有一个）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.escape-char-replacement</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">__</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3017">在eureka服务器的序列化/反序列化信息期间获取下划线符号&lt;code&gt; _ &lt;/ code&gt;的替换字符串。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-connection-idle-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3018">表示到eureka服务器的HTTP连接可以在关闭之前保持空闲状态的时间（以秒为单位）。
</font></p><p class="tableblock"><font o="3019"> 在AWS环境中，建议值为30秒或更短，因为防火墙在几分钟内清除连接信息，将连接挂在空中</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-connect-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3020">指示在连接到eureka服务器需要超时之前等待（以秒为单位）的时间。</font><font o="3021">请注意，客户端中的连接由org.apache.http.client.HttpClient汇集，此设置会影响实际的连接创建以及从池中获取连接的等待时间。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-dnsname</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3022">获取要查询的DNS名称以获取eureka服务器的列表。如果合同通过实现serviceUrls返回服务URL，则不需要此信息。
</font></p><p class="tableblock"><font o="3023"> 当useDnsForFetchingServiceUrls设置为true时，使用DNS机制，而eureka客户端希望DNS以某种方式配置，以便可以动态获取更改的eureka服务器。
</font></p><p class="tableblock"><font o="3024"> 更改在运行时有效。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-port</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3025">获取用于构建服务url的端口，以在eureka服务器列表来自DNS时联系eureka服务器。如果合同返回服务url eurekaServerServiceUrls（String），则不需要此信息。
</font></p><p class="tableblock"><font o="3026"> 当useDnsForFetchingServiceUrls设置为true时，使用DNS机制，而eureka客户端希望DNS以某种方式配置，以便可以动态获取更改的eureka服务器。
</font></p><p class="tableblock"><font o="3027"> 更改在运行时有效。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-read-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3028">指示从eureka服务器读取之前需要等待（秒）多久才能超时。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-total-connections</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3029">获取从eureka客户端到所有eureka服务器允许的总连接数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-total-connections-per-host</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3030">获取从eureka客户端到eureka服务器主机允许的总连接数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-server-urlcontext</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3031">获取用于构建服务网址的URL上下文，以便在eureka服务器列表来自DNS时联系eureka服务器。</font><font o="3032">如果合同从eurekaServerServiceUrls返回服务网址，则不需要此信息。
</font></p><p class="tableblock"><font o="3033">当useDnsForFetchingServiceUrls设置为true时，使用DNS机制，而eureka客户端希望DNS以某种方式配置，以便可以动态获取更改的eureka服务器。</font><font o="3034">更改在运行时有效。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.eureka-service-url-poll-interval-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3035">表示轮询对eureka服务器信息进行更改的频率（以秒为单位）。</font><font o="3036">可以添加或删除Eureka服务器，并且此设置控制尤里卡客户端应该知道的时间。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.fetch-registry</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3037">指示该客户端是否应从eureka服务器获取eureka注册表信息。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.fetch-remote-regions-registry</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3038">逗号分隔将获取eureka注册表信息的区域列表。</font><font o="3039">必须为availabilityZones返回的每个区域定义可用性区域。</font><font o="3040">否则，将导致发现客户端启动失败。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.filter-only-up-instances</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3041">指示是否在仅具有InstanceStatus UP状态的实例的过滤应用程序之后获取应用程序。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.g-zip-content</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3042">指示从服务器支持时，是否必须压缩从eureka服务器提取的内容。</font><font o="3043">来自eureka服务器的注册表信息被压缩以获得最佳的网络流量。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.heartbeat-executor-exponential-back-off-bound</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3044">心跳执行者指数回撤相关财产。</font><font o="3045">在发生超时序列的情况下，它是重试延迟的最大乘数值。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.heartbeat-executor-thread-pool-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3046">heartbeat执行器初始化的线程池大小</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.initial-instance-info-replication-interval-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3047">指示将实例信息复制到eureka服务器的开始时间（以秒为单位）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.instance-info-replication-interval-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3048">指示复制要复制到eureka服务器的实例更改的频率（以秒为单位）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.log-delta-diff</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3049">指示在注册表信息方面是否记录eureka服务器和eureka客户端之间的差异。
</font></p><p class="tableblock"><font o="3050">Eureka客户端尝试仅从欧莱雅服务器检索增量更改以最小化网络流量。</font><font o="3051">收到三角形后，eureka客户端将从服务器的信息进行协调，以验证它是否已经没有漏掉一些信息。</font><font o="3052">当客户端发生网络问题与服务器通信时，可能会发生调解失败。如果对帐失败，eureka客户端将获得完整的注册表信息。
</font></p><p class="tableblock"><font o="3053"> 在获取完整的注册表信息的同时，eureka客户端可以记录客户端和服务器之间的差异，并且此设置控制它。
</font></p><p class="tableblock"><font o="3054"> 更改在运行时在registryFetchIntervalSecondsr指定的下一个注册表提取周期中有效</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.on-demand-update-status-change</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3055">如果设置为true，则通过ApplicationInfoManager进行的本地状态更新将触发对远程eureka服务器的按需（但限速）注册/更新</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.prefer-same-zone-eureka</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3056">指示此实例是否应尝试在同一区域中使用尤里卡服务器延迟和/或其他原因。
</font></p><p class="tableblock"><font o="3057"> 理想情况下，eureka客户端配置为与同一区域中的服务器通信
</font></p><p class="tableblock"><font o="3058"> 更改在运行时在registryFetchIntervalSeconds指定的下一个注册表提取周期中有效</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.property-resolver</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.proxy-host</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3059">获取代理主机到eureka服务器（如果有的话）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.proxy-password</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3060">获取代理密码（如果有）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.proxy-port</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3061">获取代理端口到eureka服务器（如果有的话）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.proxy-user-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3062">获取代理用户名（如果有）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.region</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">us-east-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3063">获取此实例所在的区域（用于AWS数据中心）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.register-with-eureka</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3064">指示此实例是否应将其信息注册到eureka服务器以供其他人发现。
</font></p><p class="tableblock"><font o="3065"> 在某些情况下，您不希望发现实例，而您只想发现其他实例。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.registry-fetch-interval-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3066">指示从eureka服务器获取注册表信息的频率（以秒为单位）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.registry-refresh-single-vip-address</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3067">指示客户端是否只对单个VIP的注册表信息感兴趣。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.service-url</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3068">可用性区域映射到与eureka服务器通信的完全限定URL的列表。</font><font o="3069">每个值可以是单个URL或逗号分隔的替代位置列表。
</font></p><p class="tableblock"><font o="3070">通常，尤里卡服务器URL携带协议，主机，端口，上下文和版本信息（如果有的话）。</font><font o="3071">示例：</font><a href="javascript:;" class="bare"><font o="3071">http</font></a><font o="3071"> : </font><a href="javascript:;" class="bare"><font o="3071">//ec2-256-156-243-129.compute-1.amazonaws.com</font></a><font o="3071"> :
  </font><a href="javascript:;" class="bare"><font o="3071">7001/eureka/</font></a>
</p><p class="tableblock"><font o="3072"> 更改在运行时在eurekaServiceUrlPollIntervalSeconds指定的下一个服务网址刷新周期中有效。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.transport</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.client.use-dns-for-fetching-service-urls</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3073">指示eureka客户端是否应该使用DNS机制来获取要与之通信的eureka服务器列表。</font><font o="3074">当DNS名称更新为具有其他服务器时，该信息将在eureka客户端轮询该eurka​​ServiceUrlPollIntervalSeconds中指定的信息之后立即使用。
</font></p><p class="tableblock"><font o="3075"> 或者，服务urls可以返回serviceUrls，但用户应该实现自己的机制来返回更新的列表，以防发生更改。
</font></p><p class="tableblock"><font o="3076"> 更改在运行时有效。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.dashboard.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3077">标志以启用Eureka仪表板。</font><font o="3078">默认值为true。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.dashboard.path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3079">到Eureka仪表板（相对于servlet路径）的路径。</font><font o="3080">默认为“/”。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.a-sgname</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3081">获取与此实例关联的AWS自动缩放组名称。</font><font o="3082">该信息在AWS环境中专门用于在实例启动后自动将实例停止运行，并且已将其禁用。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.app-group-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3083">获取要在eureka中注册的应用程序组的名称。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.appname</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">unknown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3084">获取要在eureka注册的应用程序的名称。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.data-center-info</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3085">返回此实例部署的数据中心。</font><font o="3086">如果实例部署在AWS中，则此信息用于获取一些AWS特定实例信息。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.default-address-resolution-order</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.health-check-url</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3087">获取此实例的绝对运行状况检查页面URL。</font><font o="3088">如果运行状况检查页面驻留在与eureka通话的同一个实例中，用户可以提供healthCheckUrlPath，否则在实例是其他服务器的代理的情况下，用户可以提供完整的URL。</font><font o="3089">如果提供完整的URL，则优先。
</font></p><p class="tableblock"><font o="3090">&lt;p&gt;它通常用于根据实例的健康状况做出有根据的决策 - 例如，它可用于确定是否继续部署到整个场，或者停止部署而不会造成进一步的损坏。</font><font o="3091">完整的URL应遵循格式</font><a href="javascript:;" class="bare"><font o="3091">http：// $ {eureka.hostname}：7001 /</font></a><font o="3091">其中值$ {eureka.hostname}在运行时被替换。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.health-check-url-path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/health</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3092">获取此实例的相对运行状况检查URL路径。</font><font o="3093">然后，健康检查页面URL由主机名和通信类型构建，如securePort和nonSecurePort中指定的安全或不安全。
</font></p><p class="tableblock"><font o="3094"> 它通常用于根据实例的健康状况做出有根据的决策 - 例如，它可用于确定是否继续部署到整个场，或者停止部署而不会造成进一步的损坏。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.home-page-url</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3095">获取此实例的绝对主页URL。</font><font o="3096">如果主页位于与eureka通话的同一个实例中，用户可以提供homePageUrlPath，否则在实例是其他服务器的代理的情况下，用户可以提供完整的URL。</font><font o="3097">如果提供完整的URL，则优先。
</font></p><p class="tableblock"><font o="3098">它通常用于其他服务的信息目的，以将其用作着陆页。</font><font o="3099">完整的URL应遵循格式</font><a href="javascript:;" class="bare"><font o="3099">http：// $ {eureka.hostname}：7001 /</font></a><font o="3099"> 
 其中值$ {eureka.hostname}在运行时被替换。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.home-page-url-path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3100">获取此实例的相对主页URL路径。</font><font o="3101">然后，主页URL由hostName和通信类型构建 - 安全或不安全。
</font></p><p class="tableblock"><font o="3102"> 它通常用于其他服务的信息目的，以将其用作着陆页。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.host-info</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.hostname</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3103">如果可以在配置时确定主机名（否则将从操作系统原语中猜出）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.inet-utils</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.initial-status</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3104">初始状态为rmeote Eureka服务器注册。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.instance-enabled-onit</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3105">指示在eureka注册后，实例是否应该启用流量。</font><font o="3106">有时候，应用程序可能需要做一些预处理，才能准备好交通。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.instance-id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3107">获取要在eureka注册的此实例的唯一ID（在appName的范围内）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.ip-address</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3108">获取实例的IPAdress。</font><font o="3109">此信息仅用于学术目的，因为来自其他实例的通信主要发生在使用</font><font o="3109">{@link #getHostName（boolean）}中提供的信息。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.lease-expiration-duration-in-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3110">指示eureka服务器在接收到最后一个心跳之后等待的时间（秒），然后才能从此视图中删除此实例，并禁止此实例的流量。
</font></p><p class="tableblock"><font o="3111">将此值设置得太长可能意味着流量可以路由到实例，即使实例不存在。</font><font o="3112">设置此值太小可能意味着，由于临时网络故障，实例可能会被取消流量。此值将设置为至少高于leaseRenewalIntervalInSeconds中指定的值。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.lease-renewal-interval-in-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3113">指示eureka客户端需要向eureka服务器发送心跳以指示它仍然存在的频率（以秒为单位）。</font><font o="3114">如果在leaseExpirationDurationInSeconds中指定的时间段内未收到心跳线，则eureka服务器将从其视图中删除该实例，因此不允许此实例的流量。
</font></p><p class="tableblock"><font o="3115"> 请注意，如果该实例实现HealthCheckCallback，然后决定使其本身不可用，则该实例仍然可能无法访问流量。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.metadata-map</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3116">获取与此实例关联的元数据名称/值对。</font><font o="3117">该信息发送到eureka服务器，可以被其他实例使用。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.namespace</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3118">获取用于查找属性的命名空间。</font><font o="3119">忽略在Spring Cloud中。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.non-secure-port</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3120">获取实例应该接收流量的非安全端口。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.non-secure-port-enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3121">指示是否应启用非安全端口的流量。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.prefer-ip-address</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3122">标示说，当猜测主机名时，服务器的IP地址应该在操作系统报告的主机名中使用。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.secure-health-check-url</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3123">获取此实例的绝对安全运行状况检查页面URL。</font><font o="3124">如果健康检查页面驻留在与eureka通话的同一个实例中，用户可以提供secureHealthCheckUrl，否则在实例是其他服务器的代理的情况下，用户可以提供完整的URL。</font><font o="3125">如果提供完整的URL，则优先。
</font></p><p class="tableblock"><font o="3126">&lt;p&gt;它通常用于根据实例的健康状况做出有根据的决策 - 例如，它可用于确定是否继续部署到整个场，或者停止部署而不会造成进一步的损坏。</font><font o="3127">完整的URL应遵循格式</font><a href="javascript:;" class="bare"><font o="3127">http：// $ {eureka.hostname}：7001 /</font></a><font o="3127">其中值$ {eureka.hostname}在运行时被替换。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.secure-port</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3128">获取实例应该接收流量的安全端口。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.secure-port-enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3129">指示安全端口是否应启用流量。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.secure-virtual-host-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3130">获取为此实例定义的安全虚拟主机名。
</font></p><p class="tableblock"><font o="3131"> 这通常是其他实例通过使用安全虚拟主机名找到此实例的方式。这与完全限定域名相似，您的服务的用户将需要找到此实例。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.status-page-url</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3132">获取此实例的绝对状态页面URL路径。</font><font o="3133">如果状态页面驻留在与eureka通话的同一个实例中，用户可以提供statusPageUrlPath，否则在实例是其他服务器的代理的情况下，用户可以提供完整的URL。</font><font o="3134">如果提供完整的URL，则优先。
</font></p><p class="tableblock"><font o="3135">它通常用于其他服务的信息目的，以查找此实例的状态。</font><font o="3136">用户可以提供一个简单的HTML来指示实例的当前状态。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.status-page-url-path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3137">获取此实例的相对状态页面URL路径。</font><font o="3138">然后，状态页面URL由安全端口和非安全端口中指定的hostName和通信类型构建 - 安全或不安全。
</font></p><p class="tableblock"><font o="3139">它通常用于其他服务的信息目的，以查找此实例的状态。</font><font o="3140">用户可以提供一个简单的HTML来指示实例的当前状态。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.instance.virtual-host-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3141">获取为此实例定义的虚拟主机名。
</font></p><p class="tableblock"><font o="3142"> 这通常是其他实例通过使用虚拟主机名找到此实例的方式。这与完全限定域名相似，您的服务的用户将需要找到此实例。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.a-sgcache-expiry-timeout-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.a-sgquery-timeout-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.a-sgupdate-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.a-wsaccess-id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.a-wssecret-key</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.batch-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.binding-strategy</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.delta-retention-timer-interval-in-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.disable-delta</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.disable-delta-for-remote-regions</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.disable-transparent-fallback-to-other-region</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.e-ipbind-rebind-retries</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.e-ipbinding-retry-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.e-ipbinding-retry-interval-ms-when-unbound</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.enable-replicated-request-compression</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.enable-self-preservation</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.eviction-interval-timer-in-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.g-zip-content-from-remote-region</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.json-codec-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.list-auto-scaling-groups-role-name</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">ListAutoScalingGroups</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.log-identity-headers</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-elements-in-peer-replication-pool</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-elements-in-status-replication-pool</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-idle-thread-age-in-minutes-for-peer-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-idle-thread-in-minutes-age-for-status-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-threads-for-peer-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-threads-for-status-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.max-time-for-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.min-threads-for-peer-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.min-threads-for-status-replication</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.number-of-replication-retries</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-eureka-nodes-update-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-eureka-status-refresh-time-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-node-connect-timeout-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-node-connection-idle-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-node-read-timeout-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-node-total-connections</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.peer-node-total-connections-per-host</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.prime-aws-replica-connections</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.property-resolver</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.rate-limiter-burst-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.rate-limiter-enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.rate-limiter-full-fetch-average-rate</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.rate-limiter-privileged-clients</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.rate-limiter-registry-fetch-average-rate</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.rate-limiter-throttle-standard-clients</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.registry-sync-retries</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.registry-sync-retry-wait-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-app-whitelist</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-connect-timeout-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-connection-idle-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-fetch-thread-pool-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-read-timeout-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-registry-fetch-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-total-connections</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-total-connections-per-host</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-trust-store</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-trust-store-password</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">changeit</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-urls</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.remote-region-urls-with-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.renewal-percent-threshold</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0.85</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.renewal-threshold-update-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.response-cache-auto-expiration-in-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">180</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.response-cache-update-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.retention-time-in-msin-delta-queue</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.route53-bind-rebind-retries</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.route53-binding-retry-interval-ms</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.route53-domain-ttl</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.sync-when-timestamp-differs</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.use-read-only-response-cache</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.wait-time-in-ms-when-sync-empty</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">eureka.server.xml-codec-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">feign.compression.request.mime-types</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">[text/xml, application/xml, application/json]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3143">支持的MIME类型列表。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">feign.compression.request.min-request-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3144">最小阈值内容大小。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">health.config.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3145">标记以指示应安装配置服务器运行状况指示器。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">health.hystrix.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3146">标志着要安装hystrix健康指示器。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">netflix.atlas.batch-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">netflix.atlas.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">netflix.atlas.uri</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">proxy.auth.load-balanced</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">proxy.auth.routes</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3147">每个路由的认证策略。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.ack.destination-service</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3148">想要听ack的服务。</font><font o="3149">默认为null（表示所有服务）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.ack.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3150">标志关闭acks（默认打开）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.destination</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">springCloudBus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3151">邮件的Spring Cloud Stream目的地名称。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3152">标志表示总线已启用。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.env.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3153">标志关闭环境变化事件（默认为开）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.refresh.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3154">关闭刷新事件的标志（默认为开）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.bus.trace.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3155">打开acks跟踪的标志（默认关闭）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.cloudfoundry.discovery.email</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3156">验证用户的电子邮件地址。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.cloudfoundry.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3157">标记以指示启用发现。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.cloudfoundry.discovery.password</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3158">用户验证和获取令牌的密码。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.cloudfoundry.discovery.url</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">https://api.run.pivotal.io</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3159">Cloud Foundry API（云控制器）的URL。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.allow-override</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3160">标记以指示可以使用</font><font o="3160">{@link #isSystemPropertiesOverride（）systemPropertiesOverride}。</font><font o="3161">设置为false以防止用户意外更改默认值。</font><font o="3162">默认值为true。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3163">标记以指示启用配置服务器发现（配置服务器URL将通过发现查找）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.discovery.service-id</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">CONFIGSERVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3164">服务ID来定位配置服务器。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3165">标记说远程配置启用。</font><font o="3166">默认为true;</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.fail-fast</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3167">标记表示无法连接到服务器是致命的（默认为false）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.label</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3168">用于拉取远程配置属性的标签名称。</font><font o="3169">默认设置在服务器上（通常是基于git的服务器的“主”）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3170">用于获取远程属性的应用程序名称。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.override-none</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3171">标志表示当</font><font o="3171">{@link #setAllowOverride（boolean）allowOverride}为true时，外部属性应该采用最低优先级，并且不覆盖任何现有的属性源（包括本地配置文件）。</font><font o="3172">默认为false。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.override-system-properties</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3173">标记以指示外部属性应覆盖系统属性。</font><font o="3174">默认值为true。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.password</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3175">联系远程服务器时使用的密码（HTTP Basic）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.profile</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3176">获取远程配置时使用的默认配置文件（逗号分隔）。</font><font o="3177">默认为“默认”。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.retry.initial-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3178">初始重试间隔（以毫秒为单位）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3179">最大尝试次数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.retry.max-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3180">退避的最大间隔</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.retry.multiplier</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3181">下一个间隔的乘数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.uri</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock"><a href="javascript:;" class="bare">http://localhost:8888</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3182">远程服务器的URI（默认</font><a href="javascript:;" class="bare"><font o="3182">http：// localhost：8888</font></a><font o="3182">）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.config.username</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3183">联系远程服务器时使用的用户名（HTTP Basic）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.acl-token</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.data-key</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3184">如果格式为Format.PROPERTIES或Format.YAML，则使用以下字段查找配置的consul。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.default-context</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">application</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.fail-fast</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3185">在配置查找期间抛出异常，如果为true，否则为日志警告。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.format</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.profile-separator</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">,</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.watch.delay</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.watch.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.config.watch.wait-time</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.acl-token</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.catalog-services-watch-delay</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.catalog-services-watch-timeout</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3186">是否启用服务发现？</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.health-check-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3187">执行健康检查的频率（例如10s）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.health-check-path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/health</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3188">调用健康检查的备用服务器路径</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.health-check-timeout</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3189">健康检查超时（例如10s）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.health-check-url</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3190">自定义健康检查网址覆盖默认值</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.heartbeat-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.interval-ratio</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.ttl-unit</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.ttl-value</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.host-info</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.hostname</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3191">访问服务器时使用的主机名</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.instance-id</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3192">唯一的服务实例ID</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.ip-address</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3193">访问服务时使用的IP地址（还必须设置preferIpAddress才能使用）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.lifecycle.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.management-suffix</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3194">注册管理服务时使用后缀</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.management-tags</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3195">注册管理服务时使用的标签</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.port</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3196">端口注册服务（默认为侦听端口）</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.prefer-agent-address</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3197">我们将如何确定使用地址的来源</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.prefer-ip-address</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3198">在注册时使用ip地址而不是主机名</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.query-passing</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3199">将“pass”参数添加到/ v1 / health / service / serviceName。</font><font o="3200">这会将健康检查推送到服务器。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.register</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3201">在consul注册为一项服务。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.register-health-check</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3202">注册身体检查consul。</font><font o="3203">在开发服务期间有用。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.scheme</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3204">是否注册http或https服务</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.server-list-query-tags</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3205">服务器列表中要查询的serviceId的→标签的映射。</font><font o="3206">这允许通过单个标签过滤服务。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.service-name</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3207">服务名称</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.discovery.tags</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3208">注册服务时使用的标签</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3209">是否启用spring cloud consul</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.host</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3210">Consul代理主机名。</font><font o="3211">默认为“localhost”。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.port</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">8500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3212">Consul代理端口。</font><font o="3213">默认为'8500'。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.retry.initial-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3214">初始重试间隔（以毫秒为单位）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3215">最大尝试次数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.retry.max-interval</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3216">退避的最大间隔</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.consul.retry.multiplier</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3217">下一个间隔的乘数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.hypermedia.refresh.fixed-delay</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.hypermedia.refresh.initial-delay</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.inetutils.default-hostname</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3218">默认主机名。</font><font o="3219">用于发生错误的情况。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.inetutils.default-ip-address</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">127.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3220">默认ipaddress。</font><font o="3221">用于发生错误的情况。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.inetutils.ignored-interfaces</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3222">将被忽略的网络接口的Java正则表达式列表。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.inetutils.timeout-seconds</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3223">计算主机名的超时秒数。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.binders</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.bindings</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.consumer-defaults</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.default-binder</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.dynamic-destinations</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.ignore-unknown-properties</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.instance-count</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.instance-index</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.producer-defaults</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.addresses</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.admin-adresses</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.compression-level</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.nodes</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.password</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.ssl-properties-location</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.use-ssl</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.username</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.binder.vhost</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.stream.rabbit.bindings</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.default-health-endpoint</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3224">将检查以验证依赖关系是否存在的默认运行状况端点</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.dependencies</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3225">将别名映射到ZookeeperDependency。</font><font o="3226">从Ribbon角度看，别名实际上是serviceID，因为Ribbon不能在serviceID中接受嵌套结构</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.dependency-configurations</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.dependency-names</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.discovery.instance-host</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.discovery.metadata</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3227">获取与此实例关联的元数据名称/值对。</font><font o="3228">该信息被发送到动物管理员，可以被其他实例使用。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.discovery.root</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/services</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.discovery.uri-spec</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">{scheme}://{address}:{port}</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.cloud.zookeeper.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3229">将应用于所有Zookeeper依赖关系的路径的公共前缀</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.integration.poller.fixed-delay</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3230">修复默认轮询器的延迟。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.integration.poller.max-messages-per-poll</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3231">默认轮询器每轮询的最大消息。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.async.class-name-key</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3232">具有使用</font><font o="3232">{@code @Async} </font><font o="3232">注释的方法的类的简单名称，</font><font o="3232">从异步进程开始
</font></p><p class="tableblock"><font o="3233"> @see org.springframework.scheduling.annotation.Async</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.async.method-name-key</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3234">使用</font><font o="3234">{@code @Async}
 </font><font o="3234">注释的方法的名称</font></p><p class="tableblock"><font o="3235"> @see org.springframework.scheduling.annotation.Async</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.async.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3236">如果标题名称被添加为标签，则使用前缀。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.async.thread-name-key</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">thread</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3237">执行异步方法的线程的名称
</font></p><p class="tableblock"><font o="3238"> @see org.springframework.scheduling.annotation.Async</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.headers</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3239">额外的标题应该作为标签添加，如果它们存在。</font><font o="3240">如果头值是多值的，则标签值将是逗号分隔的单引号列表。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.host</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3241">URL或主机头的域部分。</font><font o="3242">示例：“mybucket.s3.amazonaws.com”。</font><font o="3243">用于过滤主机而不是ip地址。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.method</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3244">HTTP方法或动词，如“GET”或“POST”。</font><font o="3245">用于过滤http路由。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3246">绝对的http路径，没有任何查询参数。</font><font o="3247">示例：“/ objects / abcd-ff”。</font><font o="3248">用于过滤http路由，可以与zipkin v1一起移植。</font><font o="3249">在zipkin v1中，只支持等于过滤器。</font><font o="3250">删除查询参数使不同URI的数量减少。</font><font o="3251">例如，无论查询行中编码的签名参数如何，都可以查询相同的资源。</font><font o="3252">这不会降低HTTP单路由的基数。</font><font o="3253">例如，通常将路由表示为http URI模板，如“/ resource / {resource_id}”。</font><font o="3254">在只有等量查询可用的系统中，</font><font o="3254">如果实际请求是“/ resource / abcd-ff” </font><font o="3254">，则搜索
  </font><font o="3254">{@code http.uri = / resource}将不匹配。</font><font o="3255">历史记录：这通常在拉链中被表示为“http.uri”，但最常见的只是一条路。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3256">如果标题名称被添加为标签，则使用前缀。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.request-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.request.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3257">非空HTTP请求体的大小（以字节为单位）。</font><font o="3258">防爆。</font>"16384"</p><p class="tableblock"><font o="3260"> &lt;p&gt;大上传可能会超出限制或直接影响延迟。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.response-size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.response.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3261">非空HTTP响应体的大小（以字节为单位）。</font><font o="3262">防爆。</font>"16384"</p><p class="tableblock"><font o="3264"> &lt;p&gt;大量下载可能会超出限制或直接影响延迟。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.status-code</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.status_code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3265">当HTTP响应代码不在2xx范围内。</font><font o="3266">防爆。</font><font o="3267">“503”用于过滤错误状态。</font><font o="3268">2xx范围不会被记录，因为成功代码对延迟故障排除不那么有趣。</font><font o="3269">省略节省每个跨度至少20个字节。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.http.url</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">http.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3270">整个URL，包括方案，主机和查询参数（如果可用）。</font><font o="3271">防爆。</font><font o="3272">“https://mybucket.s3.amazonaws.com/objects/abcd-ff?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256...”结合</font><font o="3272">{@link #method }，您可以了解完全限定的请求行。</font><font o="3273">这是可选的，因为它可能包括私人数据或相当长的长度。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.hystrix.command-group</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">commandGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3274">命令组的名称 </font><font o="3275">Hystrix使用命令组密钥将诸如报告，警报，仪表板或团队/库所有权的命令分组在一起。
</font></p><p class="tableblock"><font o="3276"> @see com.netflix.hystrix.HystrixCommandGroupKey</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.hystrix.command-key</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">commandKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3277">命令键的名称 </font><font o="3278">描述给定命令的名称。</font><font o="3279">代表用于监视，断路器，指标发布，缓存和其他此类用途</font><font o="3279">的</font><font o="3279">{@link com.netflix.hystrix.HystrixCommand}的关键。
</font></p><p class="tableblock"><font o="3280"> @see com.netflix.hystrix.HystrixCommandKey</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.hystrix.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3281">如果标题名称被添加为标签，则使用前缀。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.hystrix.thread-pool-key</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">threadPoolKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3282">线程池密钥的名称。</font><font o="3283">线程池密钥表示</font><font o="3283">用于监视，指标发布，缓存和其他此类用途</font><font o="3283">的</font><font o="3283">{@link com.netflix.hystrix.HystrixThreadPool}。</font><font o="3284">甲</font><font o="3284">{@link com.netflix.hystrix.HystrixCommand}与单个相关的</font><font o="3284">{@link com.netflix.hystrix.HystrixThreadPool}如由检索</font><font o="3284">{@link com.netflix.hystrix.HystrixThreadPoolKey}注入它，或者它的默认值使用</font><font o="3284">{@link com.netflix.hystrix.HystrixCommandGroupKey}创建的创建它。
</font></p><p class="tableblock"><font o="3285"> @see com.netflix.hystrix.HystrixThreadPoolKey</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.message.headers</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3286">额外的标题应该作为标签添加，如果它们存在。</font><font o="3287">如果头值不是String，它将使用其toString（）方法转换为String。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.message.payload.size</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">message/payload-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3288">估计有效载荷的大小（如果有的话）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.message.payload.type</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">message/payload-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3289">有效载荷的类型。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.keys.message.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">message/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3290">如果标题名称被添加为标签，则使用前缀。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.metric.span.accepted-name</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">counter.span.accepted</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.metric.span.dropped-name</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">counter.span.dropped</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">spring.sleuth.sampler.percentage</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font o="3291">应采样的请求百分比。</font><font o="3292">例如1.0  -  100％的请求应该被抽样。</font><font o="3293">精度仅为全数（即不支持0.1％的痕迹）。</font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.add-proxy-headers</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.host.max-per-route-connections</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.host.max-total-connections</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.ignore-local-service</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.ignored-headers</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.ignored-patterns</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.ignored-services</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.remove-semicolon-content</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.retryable</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.routes</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.security_headers</p></td>
<td class="tableblock halign-left valign-top notranslate"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.servlet-path</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">/zuul</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.strip-prefix</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">zuul.trace-request-body</p></td>
<td class="tableblock halign-left valign-top notranslate"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<script data-cfasync="false" src="static/js/email-decode.min.js"></script><script type="text/javascript" name="springcloud">springcloud.cc({"original":{"2":"Table of Contents","3":"Features","4":"Cloud Native Applications","5":"{11/} Context: Application Context Services","6":"The Bootstrap Application Context","7":"Application Context Hierarchies","8":"Changing the Location of Bootstrap {16/}","9":"Overriding the Values of Remote {16/}","10":"Customizing the Bootstrap Configuration","11":"Customizing the Bootstrap Property Sources","12":"Environment Changes","13":"Refresh Scope","14":"Encryption and Decryption","15":"Endpoints","16":"{4/}: Common Abstractions","17":"@EnableDiscoveryClient","18":"ServiceRegistry","19":"{45/} RestTemplate as a Load Balancer Client","20":"Multiple RestTemplate objects","21":"Ignore Network Interfaces","23":"Quick Start","24":"Client Side Usage","25":"{7/} Server","26":"Environment Repository","27":"Health Indicator","28":"Security","29":"Encryption and Decryption","30":"Key Management","31":"Creating a Key Store for Testing","32":"Using Multiple Keys and Key Rotation","33":"Serving Encrypted {16/}","34":"Serving Alternative Formats","35":"Serving Plain Text","36":"Embedding the Config Server","37":"Push Notifications and {5/}","38":"{7/} Client","39":"Config First Bootstrap","40":"Discovery First Bootstrap","41":"Config Client Fail Fast","42":"Config Client Retry","43":"Locating Remote Configuration Resources","44":"Security","45":"{11/} Netflix","46":"Service Discovery: {42/} Clients","47":"Registering with {42/}","48":"Authenticating with the {42/} Server","49":"Status Page and Health Indicator","50":"Registering a Secure Application","51":"{42/}’s Health Checks","52":"{42/} Metadata for Instances and Clients","53":"Using the EurekaClient","54":"Alternatives to the native Netflix EurekaClient","55":"Why is it so Slow to Register a Service?","56":"Service Discovery: {42/} Server","57":"High Availability, Zones and Regions","58":"Standalone Mode","59":"Peer Awareness","60":"Prefer IP Address","61":"Circuit Breaker: {22/} Clients","62":"Propagating the Security Context or using {45/} Scopes","63":"Health Indicator","64":"{22/} Metrics Stream","65":"Circuit Breaker: {22/} Dashboard","67":"{12/} Stream","68":"Client Side Load Balancer: {41/}","69":"Customizing the {41/} Client","70":"Using {41/} with {42/}","71":"Example: How to Use {41/} Without {42/}","72":"Example: Disable {42/} use in {41/}","73":"Using the {41/} API Directly","74":"Declarative REST Client: {29/}","75":"Overriding {29/} Defaults","76":"{29/} {22/} Support","77":"{29/} {22/} Fallbacks","78":"{29/} Inheritance Support","79":"{29/} request/response compression","80":"{29/} logging","81":"External Configuration: {24/}","82":"Router and Filter: {39/}","83":"Embedded {39/} Reverse Proxy","84":"Cookies and Sensitive Headers","85":"The Routes Endpoint","86":"Strangulation Patterns and Local {13/}","87":"Uploading Files through {39/}","88":"Plain Embedded {39/}","89":"Disable {39/} Filters","90":"Polyglot support with Sidecar","91":"RxJava with {45/} MVC","92":"Metrics: {23/}, {37/}, and {31/}","93":"Dimensional vs. Hierarchical Metrics","94":"Default Metrics Collection","95":"Metrics Collection: {23/}","96":"Metrics Collection: {37/}","97":"Metrics Backend: {31/}","99":"Introducing {9/}","100":"Main Concepts","101":"Application Model","102":"The {32/} Abstraction","103":"Persistent Publish-Subscribe Support","104":"Consumer Groups","105":"Partitioning Support","106":"Programming Model","107":"Declaring and Binding Channels","109":"Producers and Consumers","111":"{32/} Detection","112":"Multiple {20/} on the Classpath","113":"Connecting to Multiple Systems","114":"{32/} configuration properties","115":"Implementation strategies","116":"Configuration Options","118":"Binding {16/}","119":"{32/}-Specific Configuration","120":"{28/} Settings","121":"{40/}-Specific Settings","122":"Content Type and Transformation","123":"MIME types","124":"MIME types and Java types","125":"{47/} and Message Conversion","126":"Inter-Application Communication","127":"Connecting Multiple Application Instances","128":"Instance Index and Instance Count","129":"Partitioning","130":"Testing","131":"Health Indicator","132":"Samples","133":"Getting Started","135":"Quick Start","136":"Addressing an Instance","137":"Addressing all instances of a service","138":"Application Context ID must be unique","139":"Customizing the Message Broker","140":"Tracing {26/}","141":"Broadcasting Your Own {34/}","143":"Terminology","144":"Purpose","145":"Adding to the project","146":"Additional resources","147":"Features","148":"Sampling","149":"Instrumentation","150":"Span lifecycle","151":"Creating and closing {30/}","152":"Continuing {30/}","153":"Creating {30/} with an explicit parent","154":"Naming {30/}","155":"@SpanName annotation","156":"toString() method","157":"Customizations","159":"HTTP","160":"Example","161":"Custom SA tag in {43/}","162":"Custom service name","163":"{19/} as Messages","164":"{43/} Consumer","165":"Custom Consumer","166":"Metrics","167":"Integrations","168":"Runnable and Callable","170":"RxJava","171":"HTTP integration","172":"HTTP client integration","174":"Asynchronous communication","175":"Messaging","177":"Running examples","179":"Install {36/}","180":"{36/} Agent","181":"Service Discovery with {36/}","182":"Registering with {36/}","183":"HTTP Health Check","184":"Using the DiscoveryClient","185":"Distributed Configuration with {36/}","186":"How to activate","187":"Customizing","188":"YAML or {16/} with Config","189":"git2consul with Config","190":"Fail Fast","191":"{36/} Retry","192":"{5/} with {36/}","193":"Circuit Breaker with {22/}","194":"{22/} metrics aggregation with {12/} and {36/}","196":"Install {18/}","197":"Service Discovery with {18/}","198":"How to activate","199":"Registering with {18/}","200":"Using the DiscoveryClient","201":"{18/} Dependencies","202":"Using the {18/} Dependencies","203":"How to activate {18/} Dependencies","204":"Setting up {18/} Dependencies","205":"Configuring {11/} {18/} Dependencies","206":"{11/} {18/} Dependency Watcher","207":"How to activate","208":"Registering a listener","209":"Presence Checker","210":"Distributed Configuration with {18/}","211":"How to activate","212":"Customizing","214":"Installation","215":"Running {11/} Services in Development","216":"Adding Additional Applications","217":"Writing Groovy Scripts and Running Applications","218":"Encryption and Decryption","220":"Quickstart","221":"OAuth2 Single Sign On","222":"OAuth2 Protected Resource","223":"More Detail","224":"Single Sign On","225":"Token Relay","226":"Configuring Authentication Downstream of a {39/} Proxy","228":"Discovery","229":"Single Sign On","230":"{11/} Cluster","231":"{33/} Election","235":"Appendix: Compendium of Configuration {16/}","236":"{11/} provides tools for developers to quickly build some of the common patterns in distributed systems (eg configuration management, service discovery, circuit breakers, intelligent routing, micro-proxy, control bus, one-time tokens, global locks, leadership election, distributed sessions, cluster state).","237":"Coordination of distributed systems leads to boiler plate patterns, and using {45/} Cloud developers can quickly stand up services and applications that implement those patterns.","238":"They will work well in any distributed environment, including the developer's own laptop, bare metal data centres, and managed platforms such as Cloud Foundry.","239":"Version: Brixton.BUILD-SNAPSHOT","240":"Features","241":"{11/} focuses on providing good out of box experience for typical use cases\nand extensibility mechanism to cover others.","242":"Distributed/versioned configuration","243":"Service registration and discovery","244":"Routing","245":"Service-to-service calls","246":"Load balancing","247":"Circuit Breakers","248":"Global locks","249":"Leadership election and cluster state","250":"Distributed messaging","251":"Cloud Native Applications","252":"Cloud Native is a style of application development that encourages easy adoption of best practices in the areas of continuous delivery and value-driven development.","253":"A related discipline is that of building 12-factor Apps in which development practices are aligned with delivery and operations goals, for instance by using declarative programming and management and monitoring.","254":"{11/} facilitates these styles of development in a number of specific ways and the starting point is a set of features that all components in a distributed system either need or need easy access to when required.","255":"Many of those features are covered by {15/} , which we build on in {11/}.","256":"Some more are delivered by {11/} as two libraries: {11/} Context and {4/}.","257":"{11/} Context provides utilities and special services for the {48/} of a {11/} application (bootstrap context, encryption, refresh scope and environment endpoints).","258":"{4/} is a set of abstractions and common classes used in different {11/} implementations (eg. {11/} Netflix vs. {11/} {36/}).","259":"If you are getting an exception due to \"Illegal key size\" and you are using Sun's JDK, you need to install the Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files.","260":"See the following links for more information:","261":"Java 6 JCE","262":"Java 7 JCE","263":"Java 8 JCE","264":"Extract files into JDK/jre/lib/security folder (whichever version of JRE/JDK x64/x86 you are using).","265":"Note","266":"{11/} is released under the non-restrictive Apache 2.0 license.","267":"If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at github .","268":"{11/} Context: Application Context Services","269":"{15/} has an opinionated view of how to build an application with {45/}: for instance it has conventional locations for common configuration file, and endpoints for common management and monitoring tasks.","270":"{11/} builds on top of that and adds a few features that probably all components in a system would use or occasionally need.","271":"The Bootstrap Application Context","272":"A {11/} application operates by creating a \"bootstrap\" context, which is a parent context for the main application.","273":"Out of the box it is responsible for loading configuration properties from the external sources, and also decrypting properties in the local external configuration files.","274":"The two contexts share an {49/} which is the source of external properties for any {45/} application.","275":"Bootstrap properties are added with high precedence, so they cannot be overridden by local configuration, by default.","276":"The bootstrap context uses a different convention for locating external configuration than the main application context, so instead of {50/} (or {51/}) you use {52/}, keeping the external configuration for bootstrap and main context nicely separate.","277":"Example:","278":"bootstrap.yml","279":"It is a good idea to set the {53/} (in\n{54/} or {55/}) if your application needs any\napplication-specific configuration from the server.","280":"You can disable the bootstrap process completely by setting\n{56/} (e.g. in System properties).","281":"Application Context Hierarchies","282":"If you build an application context from {57/} or {58/}, then the Bootstrap context is added as a parent to that context.","283":"It is a feature of {45/} that child contexts inherit property sources and profiles from their parent, so the \"main\" application context will contain additional property sources, compared to building the same context without {7/}.","284":"The additional property sources are:","285":"\"bootstrap\": an optional {59/} appears with high priority if any {60/} are found in the Bootstrap context, and they have non-empty properties.","286":"An example would be properties from the {7/} Server.","287":"See below for instructions on how to customize the contents of this property source.","288":"\"applicationConfig: [classpath:bootstrap.yml]\" (and friends if {45/} profiles are active).","289":"If you have a {61/} (or properties) then those properties are used to configure the Bootstrap context, and then they get added to the child context when its parent is set.","290":"They have lower precedence than the {62/} (or properties) and any other property sources that are added to the child as a normal part of the process of creating a {15/} application.","291":"See below for instructions on how to customize the contents of these property sources.","292":"Because of the ordering rules of property sources the \"bootstrap\"\nentries take precedence, but note that these do not contain any data\nfrom {63/}, which has very low precedence, but can be used\nto set defaults.","293":"You can extend the context hierarchy by simply setting the parent context of any {64/} you create, eg using its own interface, or with the {65/} convenience methods ({66/}, {67/} and {68/}).","294":"The bootstrap context will be the parent of the most senior ancestor that you create yourself.","295":"Every context in the hierarchy will have its own \"bootstrap\" property source (possibly empty) to avoid promoting values inadvertently from parents down to their descendants.","296":"Every context in the hierarchy can also (in principle) have a different {69/} and hence a different remote property source if there is a Config Server.","297":"Normal {45/} application context behaviour rules apply to property resolution: properties from a child context override those in the parent, by name and also by property source name (if the child has a property source with the same name as the parent, the one from the parent is not included in the child).","298":"Note that the {70/} allows you to share an {71/} amongst the whole hierarchy, but that is not the default.","299":"Thus, sibling contexts in particular do not need to have the same profiles or property sources, even though they will share common things with their parent.","300":"Changing the Location of Bootstrap {16/}","301":"The {72/} (or {73/}) location can be specified using {74/} (default \"bootstrap\") or {75/} (default empty), eg in System properties.","302":"Those properties behave like the {76/} variants with the same name, in fact they are used to set up the bootstrap {77/} by setting those properties in its {78/}.","303":"If there is an active profile (from {79/} or through the {80/} API in the context you are building) then properties in that profile will be loaded as well, just like in a regular {15/} app, eg from {81/} for a \"development\" profile.","304":"Overriding the Values of Remote {16/}","305":"The property sources that are added to you application by the bootstrap context are often \"remote\" (eg from a Config Server), and by default they cannot be overridden locally, except on the command line.","306":"If you want to allow your applications to override the remote properties with their own System properties or config files, the remote property source has to grant it permission by setting {82/} (it doesn't work to set this locally).","307":"Once that flag is set there are some finer grained settings to control the location of the remote properties in relation to System properties and the application's local configuration: {83/} to override with any local property source, and {84/} if only System properties and env vars should override the remote settings, but not the local config files.","308":"Customizing the Bootstrap Configuration","309":"The bootstrap context can be trained to do anything you like by adding entries to {85/} under the key {86/}.","310":"This is a comma-separated list of {45/} {87/} classes which will be used to create the context.","311":"Any beans that you want to be available to the main application context for autowiring can be created here, and also there is a special contract for {88/} of type {89/}.","312":"Classes can be marked with an {90/} if you want to control the startup sequence (the default order is \"last\").","313":"Warning","314":"Be careful when adding custom {91/} that the classes you add are not {92/} by mistake into your \"main\" application context, where they might not be needed.","315":"Use a separate package name for boot configuration classes that is not already covered by your {93/} or {94/} annotated configuration classes.","316":"The bootstrap process ends by injecting initializers into the main {95/} instance (ie the normal {15/} startup sequence, whether it is running as a standalone app or deployed in an application server).","317":"First a bootstrap context is created from the classes found in {96/} and then all {97/} of type {98/} are added to the main {99/} before it is started.","318":"Customizing the Bootstrap Property Sources","319":"The default property source for external configuration added by the bootstrap process is the Config Server, but you can add additional sources by adding beans of type {100/} to the bootstrap context (via {101/}).","320":"You could use this to insert additional properties from a different server, or from a database, for instance.","321":"As an example, consider the following trivial custom locator:","322":"The {102/} that is passed in is the one for the {103/} about to be created, ie the one that we are supplying additional property sources for.","323":"It will already have its normal {15/}-provided property sources, so you can use those to locate a property source specific to this {104/} (eg by keying it on the {105/}, as is done in the default Config Server property source locator).","324":"If you create a jar with this class in it and then add a\n{106/} containing:","325":"then the \"customProperty\" {107/} will show up in any\napplication that includes that jar on its classpath.","326":"Environment Changes","327":"The application will listen for an {108/} and react to the change in a couple of standard ways (additional {109/} can be added as {110/} by the user in the normal way).","328":"When an {111/} is observed it will have a list of key values that have changed, and the application will use those to:","329":"Re-bind any {112/} beans in the context","330":"Set the logger levels for any properties in {113/}","331":"Note that the Config Client does not by default poll for changes in the {114/}, and generally we would not recommend that approach for detecting changes (although you could set it up with a {115/} annotation).","332":"If you have a scaled-out client application then it is better to broadcast the {116/} to all the instances instead of having them polling for changes (eg using the {11/} Bus ).","333":"The {117/} covers a large class of refresh use cases, as long as you can actually make a change to the {118/} and publish the event (those APIs are public and part of core {45/}).","334":"You can verify the changes are bound to {119/} beans by visiting the {120/} endpoint (normal {3/} feature).","335":"For instance a {121/} can have its {122/} changed at runtime (the default {123/} created by {15/} is an {124/} bean) and grow capacity dynamically.","336":"Re-binding {125/} does not cover another large class of use cases, where you need more control over the refresh, and where you need a change to be atomic over the whole {126/}.","337":"To address those concerns we have {127/}.","338":"Refresh Scope","339":"A {45/} {128/} that is marked as {129/} will get special treatment when there is a configuration change.","340":"This addresses the problem of stateful beans that only get their configuration injected when they are initialized.","341":"For instance if a {130/} has open connections when the database URL is changed via the {131/}, we probably want the holders of those connections to be able to complete what they are doing.","342":"Then the next time someone borrows a connection from the pool he gets one with the new URL.","343":"Refresh scope beans are lazy proxies that initialize when they are used (ie when a method is called), and the scope acts as a cache of initialized values.","344":"To force a bean to re-initialize on the next method call you just need to invalidate its cache entry.","345":"The {132/} is a bean in the context and it has a public method {133/} to refresh all beans in the scope by clearing the target cache.","346":"There is also a {134/} method to refresh an individual bean by name.","347":"This functionality is exposed in the {135/} endpoint (over HTTP or JMX).","348":"Note","349":"{136/} works (technically) on an {137/} class, but it might lead to surprising behaviour: eg it does not mean that all the {138/} defined in that class are themselves {139/}.","350":"Specifically, anything that depends on those beans cannot rely on them being updated when a refresh is initiated, unless it is itself in {140/} (in which it will be rebuilt on a refresh and its dependencies re-injected, at which point they will be re-initialized from the refreshed {141/}).","351":"Encryption and Decryption","352":"{11/} has an {142/} pre-processor for decrypting property values locally.","353":"It follows the same rules as the Config Server, and has the same external configuration via {143/}.","354":"Thus you can use encrypted values in the form {144/} and as long as there is a valid key then they will be decrypted before the main application context gets the {145/}.","355":"To use the encryption features in an application you need to include {45/} Security RSA in your classpath (Maven co-ordinates \"org.springframework.security:spring-security-rsa\") and you also need the full strength JCE extensions in your JVM.","356":"If you are getting an exception due to \"Illegal key size\" and you are using Sun's JDK, you need to install the Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files.","357":"See the following links for more information:","358":"Java 6 JCE","359":"Java 7 JCE","360":"Java 8 JCE","361":"Extract files into JDK/jre/lib/security folder (whichever version of JRE/JDK x64/x86 you are using).","362":"Endpoints","363":"For a {3/} application there are some additional management endpoints:","364":"POST to {146/} to update the {147/} and rebind {148/} and log levels","365":"{149/} for re-loading the boot strap context and refreshing the {150/} beans","366":"{151/} for closing the {152/} and restarting it (disabled by default)","367":"{153/} and {154/} for calling the {155/} methods ({156/} and {157/} on the {158/})","368":"{4/}: Common Abstractions","369":"Patterns such as service discovery, load balancing and circuit breakers lend themselves to a common abstraction layer that can be consumed by all {11/} clients, independent of the implementation (e.g. discovery via {42/} or {36/}).","370":"@EnableDiscoveryClient","371":"Commons provides the {159/} annotation.","372":"This looks for implementations of the {160/} interface via {161/}.","373":"Implementations of Discovery Client will add a configuration class to {162/} under the {163/} key.","374":"Examples of {164/} implementations: are {11/} Netflix {42/} , {11/} {36/} Discovery and {11/} {18/} Discovery .","375":"By default, implementations of {165/} will auto-register the local {15/} server with the remote discovery server.","376":"This can be disabled by setting {166/} in {167/}.","377":"ServiceRegistry","378":"Commons now provides a {168/} interface which provides methods like {169/} and {170/} which allow you to provide custom registered services.","379":"{171/} is a marker interface.","380":"Service Registry Actuator Endpoint","381":"A {172/} actuator endpoint is provided by Commons.","382":"This endpoint relys on a {173/} bean in the {45/} Application Context.","383":"Calling {174/} via a GET will return the status of the {175/}.","384":"A POST to the same endpoint with a {176/} body will change the status of the current {177/} to the new value.","385":"Please see the documentation of the {178/} implementation you are using for the allowed values for updating the status and the values retured for the status.","386":"{45/} RestTemplate as a Load Balancer Client","387":"{179/} can be automatically configured to use ribbon.","388":"To create a load balanced {180/} create a {181/} {182/} and use the {183/} qualifier.","389":"Warning","390":"A {184/} bean is no longer created via auto configuration.","391":"It must be created by individual applications.","392":"The URI needs to use a virtual host name (ie. service name, not a host name).","393":"The {41/} client is used to create a full physical address.","394":"See RibbonAutoConfiguration for details of how the {185/} is set up.","395":"Retrying Failed Requests","396":"A load balanced {186/} can be configured to retry failed requests.","397":"By default this logic is disabled, you can enable it by setting {187/}.","398":"The load balanced {188/} will honor some of the {41/} configuration values related to retrying failed requests.","399":"The properties you can use are {189/}, {190/}, and {191/}.","400":"See the {41/} documentation for a description of what there properties do.","401":"Note","402":"\n{192/} in the above examples should be replaced with your {41/} client’s\nname.\n","403":"Multiple RestTemplate objects","404":"If you want a {193/} that is not load balanced, create a {194/} bean and inject it as normal.","405":"To access the load balanced {195/} qualifier when you create your {196/}.","406":"Important","407":"\nNotice the {197/} annotation on the plain {198/} declaration in the example below, to disambiguate the unqualified {199/} injection.\n","408":"Tip","409":"\nIf you see errors like {200/} try injecting {201/} instead or setting {202/}.\n","410":"Ignore Network Interfaces","411":"Sometimes it is useful to ignore certain named network interfaces so they can be excluded from Service Discovery registration (eg. running in a Docker container).","412":"A list of regular expressions can be set that will cause the desired network interfaces to be ignored.","413":"The following configuration will ignore the \"docker0\" interface and all interfaces that start with \"veth\".","414":"application.yml","415":"You can also force to use only specified network addresses using list of regular expressions:","416":"application.yml","417":"You can also force to use only site local addresses.","418":"See Inet4Address.html.isSiteLocalAddress() for more details what is site local address.","419":"application.yml","421":"{7/} provides server and client-side support for externalized configuration in a distributed system.","422":"With the Config Server you have a central place to manage external properties for applications across all environments.","423":"The concepts on both client and server map identically to the {45/} {203/} and {204/} abstractions, so they fit very well with {45/} applications, but can be used with any application running in any language.","424":"As an application moves through the deployment pipeline from dev to test and into production you can manage the configuration between those environments and be certain that applications have everything they need to run when they migrate.","425":"The default implementation of the server storage backend uses git so it easily supports labelled versions of configuration environments, as well as being accessible to a wide range of tooling for managing the content.","426":"It is easy to add alternative implementations and plug them in with {45/} configuration.","427":"Quick Start","428":"Start the server:","429":"The server is a {15/} application so you can run it from your IDE instead if you prefer (the main class is {205/}).","430":"Then try out a client:","431":"The default strategy for locating property sources is to clone a git repository (at {206/}) and use it to initialize a mini {207/}.","432":"The mini-application's {208/} is used to enumerate property sources and publish them via a JSON endpoint.","433":"The HTTP service has resources in the form:","434":"where the \"application\" is injected as the {209/} in the\n{210/} (i.e. what is normally \"application\" in a regular\n{15/} app), \"profile\" is an active profile (or comma-separated\nlist of properties), and \"label\" is an optional git label (defaults to\n\"master\".)","435":"{7/} Server pulls configuration for remote clients\nfrom a git repository (which must be provided):","436":"Client Side Usage","437":"To use these features in an application, just build it as a {45/} Boot application that depends on spring-cloud-config-client (eg see the test cases for the config-client, or the sample app).","438":"The most convenient way to add the dependency is via a {15/} starter {211/}.","439":"There is also a parent pom and BOM ({212/}) for Maven users and a {45/} IO version management properties file for Gradle and {45/} CLI users.","440":"Example Maven configuration:","441":"pom.xml","442":"Then you can create a standard {15/} application, like this simple HTTP server:","443":"When it runs it will pick up the external configuration from the default local config server on port 8888 if it is running.","444":"To modify the startup behaviour you can change the location of the config server using {213/} (like {214/} but for the bootstrap phase of an application context), eg","445":"The bootstrap properties will show up in the {215/} endpoint as a\nhigh-priority property source, e.g.","446":"(a property source called \"configService:<URL of remote\nrepository>/<file name>\" contains the property \"foo\" with value\n\"bar\" and is highest priority).","447":"Note","448":"\nthe URL in the property source name is the git repository not\nthe config server URL.\n","449":"{7/} Server","450":"The Server provides an HTTP, resource-based API for external configuration (name-value pairs, or equivalent YAML content).","451":"The server is easily embeddable in a {15/} application using the {216/} annotation.","452":"So this app is a config server:","453":"ConfigServer.java","454":"Like all {15/} apps it runs on port 8080 by default, but you can switch it to the conventional port 8888 in various ways.","455":"The easiest, which also sets a default configuration repository, is by launching it with {217/} (there is a {218/} in the Config Server jar).","456":"Another is to use your own {219/}, eg","457":"application.properties","458":"where {220/} is a git repository containing\nYAML and properties files.","459":"Note","460":"\nin Windows you need an extra \"/\" in the file URL if it is\nabsolute with a drive prefix, e.g. {221/}.\n","461":"Tip","462":"Here’s a recipe for creating the git repository in the example\nabove:","463":"Warning","464":"using the local filesystem for your git repository is intended for testing only.","465":"Use a server to host your configuration repositories in production.","466":"Warning","467":"the initial clone of your configuration repository will be quick and efficient if you only keep text files in it.","468":"If you start to store binary files, especially large ones, you may experience delays on the first request for configuration and/or out of memory errors in the server.","469":"Environment Repository","470":"Where do you want to store the configuration data for the Config Server?","471":"The strategy that governs this behaviour is the {222/}, serving {223/} objects.","472":"This {224/} is a shallow copy of the domain from the {45/} {225/} (including {226/} as the main feature).","473":"The {227/} resources are parametrized by three variables:","474":"{228/} maps to \"{1/}\" on the client side;","475":"{229/} maps to \"spring.profiles.active\" on the client (comma separated list);","476":"and","477":"{230/} which is a server side feature labelling a \"versioned\" set of config files.","478":"Repository implementations generally behave just like a {15/} application loading configuration files from a \"spring.config.name\" equal to the {231/} parameter, and \"spring.profiles.active\" equal to the {232/} parameter.","479":"Precedence rules for profiles are also the same as in a regular Boot application: active profiles take precedence over defaults, and if there are multiple profiles the last one wins (like adding entries to a {233/}).","480":"Example: a client application has this bootstrap configuration:","481":"bootstrap.yml","482":"(as usual with a {15/} application, these properties could also\nbe set as environment variables or command line arguments).","483":"If the repository is file-based, the server will create an {234/} from {235/} (shared between all clients), and {236/} (with {237/} taking precedence).","484":"If the YAML files have documents inside them that point to {45/} profiles, those are applied with higher precedence (in order of the profiles listed), and if there are profile-specific YAML (or properties) files these are also applied with higher precedence than the defaults.","485":"Higher precedence translates to a {238/} listed earlier in the {239/}.","486":"(These are the same rules as apply in a standalone {15/} application.)","487":"Git Backend","488":"The default implementation of {240/} uses a Git backend, which is very convenient for managing upgrades and physical environments, and also for auditing changes.","489":"To change the location of the repository you can set the \"spring.cloud.config.server.git.uri\" configuration property in the Config Server (eg in {241/}).","490":"If you set it with a {242/} prefix it should work from a local repository so you can get started quickly and easily without a server, but in that case the server operates directly on the local repository without cloning it (it doesn't matter if it's not bare because the Config Server never makes changes to the \"remote\" repository).","491":"To scale the Config Server up and make it highly available, you would need to have all instances of the server pointing to the same repository, so only a shared file system would work.","492":"Even in that case it is better to use the {243/} protocol for a shared filesystem repository, so that the server can clone it and use a local working copy as a cache.","493":"This repository implementation maps the {244/} parameter of the HTTP resource to a git label (commit id, branch name or tag).","494":"If the git branch or tag name contains a slash (\"/\") then the label in the HTTP URL should be specified with the special string \"(_)\" instead (to avoid ambiguity with other URL paths).","495":"Be careful with the brackets in the URL if you are using a command line client like curl (eg escape them from the shell with quotes '').","496":"Placeholders in Git URI","497":"{7/} Server supports a git repository URL with placeholders for the {245/} and {246/} (and {247/} if you need it, but remember that the label is applied as a git label anyway).","498":"So you can easily support a \"one repo per application\" policy using (for example):","499":"or a \"one repo per profile\" policy using a similar pattern but with\n{248/}.","500":"Pattern Matching and Multiple Repositories","501":"There is also support for more complex requirements with pattern matching on the application and profile name.","502":"The pattern format is a comma-separated list of {249/} names with wildcards (where a pattern beginning with a wildcard may need to be quoted).","503":"Example:","504":"If {250/} does not match any of the patterns, it will use the default uri defined under \"spring.cloud.config.server.git.uri\".","505":"In the above example, for the \"simple\" repository, the pattern is {251/} (ie it only matches one application named \"simple\" in all profiles).","506":"The \"local\" repository matches all application names beginning with \"local\" in all profiles (the {252/} suffix is added automatically to any pattern that doesn't have a profile matcher).","507":"Note","508":"the \"one-liner\" short cut used in the \"simple\" example above can only be used if the only property to be set is the URI.","509":"If you need to set anything else (credentials, pattern, etc.) you need to use the full form.","510":"The {253/} property in the repo is actually an array, so you can use a YAML array (or {254/}, {255/}, etc. suffixes in properties files) to bind to multiple patterns.","511":"You may need to do this if you are going to run apps with multiple profiles.","512":"Example:","513":"Note","514":"{11/} will guess that a pattern containing a profile that doesn't end in {256/} implies that you actually want to match a list of profiles starting with this pattern (so {257/} is a shortcut for {258/}).","515":"This is common where you need to run apps in the \"development\" profile locally but also the \"cloud\" profile remotely, for instance.","516":"Every repository can also optionally store config files in sub-directories, and patterns to search for those directories can be specified as {259/}.","517":"For example at the top level:","518":"In this example the server searches for config files in the top level\nand in the \"foo/\" sub-directory and also any sub-directory whose name\nbegins with \"bar\".","519":"By default the server clones remote repositories when configuration is first requested.","520":"The server can be configured to clone the repositories at startup.","521":"For example at the top level:","522":"In this example the server clones team-a's config-repo on startup before it accepts any requests.","523":"All other repositories will not be cloned until configuration from the repository is requested.","524":"To use HTTP basic authentication on the remote repository add the\n\"username\" and \"password\" properties separately (not in the URL),\ne.g.","525":"If you don't use HTTPS and user credentials, SSH should also work out of the box when you store keys in the default directories ({260/}) and the uri points to an SSH location, eg \" git@github.com :configuration/cloud-configuration\".","526":"The repository is accessed using JGit, so any documentation you find on that should be applicable.","527":"HTTPS proxy settings can be set in {261/} or in the same way as for any other JVM process via system properties ({262/} and {263/}).","528":"Tip","529":"\nIf you don’t know where your {264/} directory is us {265/} to manipulate the settings (e.g. {266/}).\n","530":"Placeholders in Git Search Paths","531":"{7/} Server also supports a search path with placeholders for the {267/} and {268/} (and {269/} if you need it).","532":"Example:","533":"searches the repository for files in the same name as the directory (as well as the top level).","534":"Wildcards are also valid in a search path with placeholders (any matching directory is included in the search).","535":"Version Control Backend Filesystem Use","536":"Warning","537":"With VCS based backends (git, svn) files are checked out or cloned to the local filesystem.","538":"By default they are put in the system temporary directory with a prefix of {270/}.","539":"On linux, for example it could be {271/}.","540":"Some operating systems routinely clean out temporary directories.","541":"This can lead to unexpected behaviour such as missing properties.","542":"To avoid this problem, change the directory Config Server uses, by setting {272/} or {273/} to a directory that does not reside in the system temp structure.","543":"File System Backend","544":"There is also a \"native\" profile in the Config Server that doesn't use Git, but just loads the config files from the local classpath or file system (any static URL you want to point to with \"spring.cloud.config.server.native.searchLocations\").","545":"To use the native profile just launch the Config Server with \"spring.profiles.active=native\".","546":"Note","547":"Remember to use the {274/} prefix for file resources (the default without a prefix is usually the classpath).","548":"Just as with any {15/} configuration you can embed {275/}-style environment placeholders, but remember that absolute paths in Windows require an extra \"/\", eg {276/}","549":"Warning","550":"The default value of the {277/} is identical to a local {15/} application (so {278/}).","551":"This does not expose the {279/} from the server to all clients because any property sources present in the server are removed before being sent to the client.","552":"Tip","553":"A filesystem backend is great for getting started quickly and for testing.","554":"To use it in production you need to be sure that the file system is reliable, and shared across all instances of the Config Server.","555":"The search locations can contain placeholders for {280/}, {281/} and {282/}.","556":"In this way you can segregate the directories in the path, and choose a strategy that makes sense for you (eg sub-directory per application, or sub-directory per profile).","557":"If you don't use placeholders in the search locations, this repository also appends the {283/} parameter of the HTTP resource to a suffix on the search path, so properties files are loaded from each search location and a subdirectory with the same name as the label (the labelled properties take precedence in the {45/} Environment).","558":"Thus the default behaviour with no placeholders is the same as adding a search location ending with {284/} is the same as {285/}","559":"Sharing Configuration With All Applications","560":"With file-based (ie git, svn and native) repositories, resources with file names in {286/} are shared between all client applications (so {287/}, {288/}, {289/} etc.).","561":"You can use resources with these file names to configure global defaults and have them overridden by application-specific files as necessary.","562":"The #_property_overrides[property overrides] feature can also be used\nfor setting global defaults, and with placeholders applications are\nallowed to override them locally.","563":"Tip","564":"With the \"native\" profile (local file system backend) it is recommended that you use an explicit search location that isn't part of the server's own configuration.","565":"Otherwise the {290/} resources in the default search locations are removed because they are part of the server.","566":"Property Overrides","567":"The Config Server has an \"overrides\" feature that allows the operator to provide configuration properties to all applications that cannot be accidentally changed by the application using the normal {15/} hooks.","568":"To declare overrides just add a map of name-value pairs to {291/}.","569":"For example","570":"will cause all applications that are config clients to read {292/} independent of their own configuration.","571":"(Of course an application can use the data in the Config Server in any way it likes, so overrides are not enforceable, but they do provide useful default behaviour if they are {7/} clients.)","572":"Tip","573":"Normal, {45/} environment placeholders with \"${}\" can be escaped (and resolved on the client) by using backslash (\"\\\") to escape the \"$\" or the \"{\", eg {293/} resolves to \"bar\" unless the app provides its own \"app.foo\".","574":"Note that in YAML you don't need to escape the backslash itself, but in properties files you do, when you configure the overrides on the server.","575":"You can change the priority of all overrides in the client to be more\nlike default values, allowing applications to supply their own values\nin environment variables or System properties, by setting the flag\n{294/} (default is false) in the\nremote repository.","576":"Health Indicator","577":"Config Server comes with a Health Indicator that checks if the configured {295/} is working.","578":"By default it asks the {296/} for an application named {297/}, the {298/} profile and the default label provided by the {299/} implementation.","579":"You can configure the Health Indicator to check more applications\nalong with custom profiles and custom labels, e.g.","580":"You can disable the Health Indicator by setting {300/}.","581":"Security","582":"You are free to secure your Config Server in any way that makes sense\nto you (from physical network security to OAuth2 bearer\ntokens), and {45/} Security and {15/} make it easy to do pretty\nmuch anything.","583":"To use the default {15/} configured HTTP Basic security, just include {45/} Security on the classpath (eg through {301/}).","584":"The default is a username of \"user\" and a randomly generated password, which isn't going to be very useful in practice, so we recommend you configure the password (via {302/}) and encrypt it (see below for instructions on how to do that).","585":"Encryption and Decryption","586":"Important","587":"Prerequisites: to use the encryption and decryption features you need the full-strength JCE installed in your JVM (it's not there by default).","588":"You can download the \"Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files\" from Oracle, and follow instructions for installation (essentially replace the 2 policy files in the JRE lib/security directory with the ones that you downloaded).","589":"If the remote property sources contain encrypted content (values starting with {303/}) they will be decrypted before sending to clients over HTTP.","590":"The main advantage of this set up is that the property values don't have to be in plain text when they are \"at rest\" (eg in a git repository).","591":"If a value cannot be decrypted it is removed from the property source and an additional property is added with the same key, but prefixed with \"invalid.\"","592":"and a value that means \"not applicable\" (usually \"<n/a>\").","593":"This is largely to prevent cipher text being used as a password and accidentally leaking.","594":"If you are setting up a remote config repository for config client\napplications it might contain an {304/} like this, for\ninstance:","595":"application.yml","596":"Encrypted values in a .properties file must not be wrapped in quotes, otherwise the value will not be decrypted:","597":"application.properties","598":"You can safely push this plain text to a shared git repository and the\nsecret password is protected.","599":"The server also exposes {305/} and {306/} endpoints (on the assumption that these will be secured and only accessed by authorized agents).","600":"If you are editing a remote config file you can use the Config Server to encrypt values by POSTing to the {307/} endpoint, eg","601":"The inverse operation is also available via {308/} (provided the server is\nconfigured with a symmetric key or a full key pair):","602":"Tip","603":"\nIf you are testing like this with curl, then use\n{309/} (instead of {310/}) or set an explicit {311/} to make sure curl encodes the data correctly when there\nare special characters ('+' is particularly tricky).\n","604":"Take the encrypted value and add the {312/} prefix before you put\nit in the YAML or properties file, and before you commit and push it\nto a remote, potentially insecure store.","605":"The {313/} and {314/} endpoints also both accept paths of the\nform {315/} which can be used to control cryptography\nper application (name) and profile when clients call into the main\nEnvironment resource.","606":"Note","607":"to control the cryptography in this granular way you must also provide a {316/} of type {317/} that creates a different encryptor per name and profiles.","608":"The one that is provided by default does not do this (so all encryptions use the same key).","609":"The {318/} command line client (with {11/} CLI extensions\ninstalled) can also be used to encrypt and decrypt, e.g.","610":"To use a key in a file (e.g. an RSA public key for encryption) prepend\nthe key value with \"@\" and provide the file path, e.g.","611":"The key argument is mandatory (despite having a {319/} prefix).","612":"Key Management","613":"The Config Server can use a symmetric (shared) key or an asymmetric one (RSA key pair).","614":"The asymmetric choice is superior in terms of security, but it is often more convenient to use a symmetric key since it is just a single property value to configure.","615":"To configure a symmetric key you just need to set {320/} to a\nsecret String (or use an enviroment variable {321/} to keep it\nout of plain text configuration files).","616":"To configure an asymmetric key you can either set the key as a PEM-encoded text value (in {322/}), or via a keystore (eg as created by the {323/} utility that comes with the JDK).","617":"The keystore properties are {324/} with {325/} equal to","618":"{326/} (a {327/} location),","619":"{328/} (to unlock the keystore) and","620":"{329/} (to identify which key in the store is to be\nused).","621":"The encryption is done with the public key, and a private key is needed for decryption.","622":"Thus in principle you can configure only the public key in the server if you only want to do encryption (and are prepared to decrypt the values yourself locally with the private key).","623":"In practice you might not want to do that because it spreads the key management process around all the clients, instead of concentrating it in the server.","624":"On the other hand it's a useful option if your config server really is relatively insecure and only a handful of clients need the encrypted properties.","625":"Creating a Key Store for Testing","626":"To create a keystore for testing you can do something like this:","627":"Put the {330/} file in the classpath (for instance) and then in\nyour {331/} for the Config Server:","628":"Using Multiple Keys and Key Rotation","629":"In addition to the {332/} prefix in encrypted property values, the Config Server looks for {333/} prefixes (zero or many) before the start of the (Base64 encoded) cipher text.","630":"The keys are passed to a {334/} which can do whatever logic it needs to locate a {335/} for the cipher.","631":"If you have configured a keystore ({336/}) the default locator will look for keys in the store with aliases as supplied by the \"key\" prefix, ie with a cipher text like this:","632":"the locator will look for a key named \"testkey\".","633":"A secret can also be supplied via a {337/} value in the prefix, but if it is not the default is to use the keystore password (which is what you get when you build a keytore and don't specify a secret).","634":"If you do supply a secret it is recommended that you also encrypt the secrets using a custom {338/}.","635":"Key rotation is hardly ever necessary on cryptographic grounds if the keys are only being used to encrypt a few bytes of configuration data (ie they are not being used elsewhere), but occasionally you might need to change the keys if there is a security breach for instance.","636":"In that case all the clients would need to change their source config files (eg in git) and use a new {339/} prefix in all the ciphers, checking beforehand of course that the key alias is available in the Config Server keystore.","637":"Tip","638":"\nthe {340/} prefixes can also be added to plaintext posted\nto the {341/} endpoint, if you want to let the Config Server\nhandle all encryption as well as decryption.\n","639":"Serving Encrypted {16/}","640":"Sometimes you want the clients to decrypt the configuration locally, instead of doing it in the server.","641":"In that case you can still have /encrypt and /decrypt endpoints (if you provide the {342/} configuration to locate a key), but you need to explicitly switch off the decryption of outgoing properties using {343/}.","642":"If you don't care about the endpoints, then it should work if you configure neither the key nor the enabled flag.","643":"Serving Alternative Formats","644":"The default JSON format from the environment endpoints is perfect for consumption by {45/} applications because it maps directly onto the {344/} abstraction.","645":"If you prefer you can consume the same data as YAML or Java properties by adding a suffix to the resource path (\".yml\", \".yaml\" or \".properties\").","646":"This can be useful for consumption by applications that do not care about the structure of the JSON endpoints, or the extra metadata they provide, for example an application that is not using {45/} might benefit from the simplicity of this approach.","647":"The YAML and properties representations have an additional flag (provided as a boolean query parameter {345/}) to signal that placeholders in the source documents, in the standard {45/} {346/} form, should be resolved in the output where possible before rendering.","648":"This is a useful feature for consumers that don't know about the {45/} placeholder conventions.","649":"Note","650":"there are limitations in using the YAML or properties formats, mainly in relation to the loss of metadata.","651":"The JSON is structured as an ordered list of property sources, for example, with names that correlate with the source.","652":"The YAML and properties forms are coalesced into a single map, even if the origin of the values has multiple sources, and the names of the original source files are lost.","653":"The YAML representation is not necessarily a faithful representation of the YAML source in a backing repository either: it is constructed from a list of flat property sources, and assumptions have to be made about the form of the keys.","654":"Serving Plain Text","655":"Instead of using the {347/} abstraction (or one of the alternative representations of it in YAML or properties format) your applications might need generic plain text configuration files, tailored to their environment.","656":"The Config Server provides these through an additional endpoint at {348/} where \"name\", \"profile\" and \"label\" have the same meaning as the regular environment endpoint, but \"path\" is a file name (eg {349/}).","657":"The source files for this endpoint are located in the same way as for the environment endpoints: the same search path is used as for properties or YAML files, but instead of aggregating all matching resources, only the first one to match is returned.","658":"After a resource is located, placeholders in the normal format ({350/}) are resolved using the effective {351/} for the application name, profile and label supplied.","659":"In this way the resource endpoint is tightly integrated with the environment endpoints.","660":"Example, if you have this layout for a GIT (or SVN) repository:","661":"where {352/} looks like this:","662":"and {353/} like this:","663":"then the {354/} resource looks like this:","664":"and {355/} like this:","665":"Note","666":"\njust like the source files for environment configuration, the\n\"profile\" is used to resolve the file name, so if you want a\nprofile-specific file then {356/} will be\nresolved by a file called {357/} (in preference\nto {358/}).\n","667":"Embedding the Config Server","668":"The Config Server runs best as a standalone application, but if you need to you can embed it in another application.","669":"Just use the {359/} annotation.","670":"An optional property that can be useful in this case is {360/} which is a flag to indicate that the server should configure itself from its own remote repository.","671":"The flag is off by default because it can delay startup, but when embedded in another application it makes sense to initialize the same way as any other application.","672":"Note","673":"\nIt should be obvious, but remember that if you use the bootstrap\nflag the config server will need to have its name and repository URI\nconfigured in {361/}.\n","674":"To change the location of the server endpoints you can (optionally) set {362/}, eg \"/config\", to serve the resources under a prefix.","675":"The prefix should start but not end with a \"/\".","676":"It is applied to the {363/} in the Config Server (ie underneath the {15/} prefixes {364/} and {365/}).","677":"If you want to read the configuration for an application directly from the backend repository (instead of from the config server) that's basically an embedded config server with no endpoints.","678":"You can switch off the endpoints entirely if you don't use the {366/} annotation (just set {367/}).","679":"Push Notifications and {5/}","680":"Many source code repository providers (like Github, Gitlab or Bitbucket for instance) will notify you of changes in a repository through a webhook.","681":"You can configure the webhook via the provider's user interface as a URL and a set of events in which you are interested.","682":"For instance Github will POST to the webhook with a JSON body containing a list of commits, and a header \"X-Github-Event\" equal to \"push\".","683":"If you add a dependency on the {368/} library and activate the {5/} in your Config Server, then a \"/monitor\" endpoint is enabled.","684":"When the webhook is activated the Config Server will send a {369/} targeted at the applications it thinks might have changed.","685":"The change detection can be strategized, but by default it just looks for changes in files that match the application name (eg \"foo.properties\" is targeted at the \"foo\" application, and \"application.properties\" is targeted at all applications).","686":"The strategy if you want to override the behaviour is {370/} which accepts the request headers and body as parameters and returns a list of file paths that changed.","687":"The default configuration works out of the box with Github, Gitlab or Bitbucket.","688":"In addition to the JSON notifications from Github, Gitlab or Bitbucket you can trigger a change notification by POSTing to \"/monitor\" with a form-encoded body parameters {371/}.","689":"This will broadcast to applications matching the \"{name}\" pattern (can contain wildcards).","690":"Note","691":"\nthe {372/} will only be transmitted if\nthe {373/} is activated in the Config Server and in the\nclient application.\n","692":"Note","693":"\nthe default configuration also detects filesystem changes in\nlocal git repositories (the webhook is not used in that case but as\nsoon as you edit a config file a refresh will be broadcast).\n","694":"{7/} Client","695":"A {15/} application can take immediate advantage of the {45/}\nConfig Server (or other external property sources provided by the\napplication developer), and it will also pick up some additional\nuseful features related to {374/} change events.","696":"Config First Bootstrap","697":"This is the default behaviour for any application which has the {45/} Cloud Config Client on the classpath.","698":"When a config client starts up it binds to the Config Server (via the bootstrap configuration property {375/}) and initializes {45/} {376/} with remote property sources.","699":"The net result of this is that all client apps that want to consume\nthe Config Server need a {377/} (or an environment variable)\nwith the server address in {378/} (defaults to\n\"http://localhost:8888\").","700":"Discovery First Bootstrap","701":"If you are using a `DiscoveryClient implementation, such as {11/} Netflix\nand {42/} Service Discovery or {11/} {36/} ({11/} {18/} does\nnot support this yet), then you can have the Config Server register with the\nDiscovery Service if you want to, but in the default \"Config First\" mode,\nclients won’t be able to take advantage of the registration.","702":"If you prefer to use {379/} to locate the Config Server, you can do that by setting {380/} (default \"false\").","703":"The net result of that is that client apps all need a {381/} (or an environment variable) with the appropriate discovery configuration.","704":"For example, with {11/} Netflix, you need to define the {42/} server address, eg in {382/}.","705":"The price for using this option is an extra network round trip on start up to locate the service registration.","706":"The benefit is that the Config Server can change its co-ordinates, as long as the Discovery Service is a fixed point.","707":"The default service id is \"configserver\" but you can change that on the client with {383/} (and on the server in the usual way for a service, eg by setting {384/}).","708":"The discovery client implementations all support some kind of metadata map (eg for {42/} we have {385/}).","709":"Some additional properties of the Config Server may need to be configured in its service registration metadata so that clients can connect correctly.","710":"If the Config Server is secured with HTTP Basic you can configure the credentials as \"username\" and \"password\".","711":"And if the Config Server has a context path you can set \"configPath\".","712":"Example, for a Config Server that is a {42/} client:","713":"bootstrap.yml","714":"Config Client Fail Fast","715":"In some cases, it may be desirable to fail startup of a service if it cannot connect to the Config Server.","716":"If this is the desired behavior, set the bootstrap configuration property {386/} and the client will halt with an Exception.","717":"Config Client Retry","718":"If you expect that the config server may occasionally be unavailable when your app starts, you can ask it to keep trying after a failure.","719":"First you need to set {387/}, and then you need to add {388/} and {389/} to your classpath.","720":"The default behaviour is to retry 6 times with an initial backoff interval of 1000ms and an exponential multiplier of 1.1 for subsequent backoffs.","721":"You can configure these properties (and others) using {390/} configuration properties.","722":"Tip","723":"To take full control of the retry add a {391/} of type {392/} with id \"configServerRetryInterceptor\".","724":"{45/} Retry has a {393/} that makes it easy to create one.","725":"Locating Remote Configuration Resources","726":"The Config Service serves property sources from {394/}, where the default bindings in the client app are","727":"\"name\" = {395/}","728":"\"profile\" = {396/} (actually {397/})","729":"\"label\" = \"master\"","730":"All of them can be overridden by setting {398/} (where {399/} is \"name\", \"profile\" or \"label\").","731":"The \"label\" is useful for rolling back to previous versions of configuration;","732":"with the default Config Server implementation it can be a git label, branch name or commit id.","733":"Label can also be provided as a comma-separated list, in which case the items in the list are tried on-by-one until one succeeds.","734":"This can be useful when working on a feature branch, for instance, when you might want to align the config label with your branch, but make it optional (eg {400/}).","735":"Security","736":"If you use HTTP Basic security on the server then clients just need to know the password (and username if it isn't the default).","737":"You can do that via the config server URI, or via separate username and password properties, eg","738":"bootstrap.yml","739":"or","740":"bootstrap.yml","741":"The {401/} and {402/}\nvalues override anything that is provided in the URI.","742":"If you deploy your apps on Cloud Foundry then the best way to provide the password is through service credentials, eg in the URI, since then it doesn't even need to be in a config file.","743":"An example which works locally and for a user-provided service on Cloud Foundry named \"configserver\":","744":"bootstrap.yml","745":"If you use another form of security you might need to provide a\n{403/} to the {404/} (e.g. by\ngrabbing it in the bootstrap context and injecting one).","746":"{11/} Netflix","747":"This project provides Netflix OSS integrations for {15/} apps through autoconfiguration and binding to the {45/} Environment and other {45/} programming model idioms.","748":"With a few simple annotations you can quickly enable and configure the common patterns inside your application and build large distributed systems with battle-tested Netflix components.","749":"The patterns provided include Service Discovery ({42/}), Circuit Breaker ({22/}), Intelligent Routing ({39/}) and Client Side Load Balancing ({41/}).","750":"Service Discovery: {42/} Clients","751":"Service Discovery is one of the key tenets of a microservice based architecture.","752":"Trying to hand configure each client or some form of convention can be very difficult to do and can be very brittle.","753":"{42/} is the Netflix Service Discovery Server and Client.","754":"The server can be configured and deployed to be highly available, with each server replicating state about the registered services to the others.","755":"Registering with {42/}","756":"When a client registers with {42/}, it provides meta-data about itself such as host and port, health indicator URL, home page etc. {42/} receives heartbeat messages from each instance belonging to a service.","757":"If the heartbeat fails over a configurable timetable, the instance is normally removed from the registry.","758":"Example eureka client:","759":"(ie utterly normal {15/} app).","760":"In this example we use {405/} explicitly, but with only {42/} available you could also use {406/}.","761":"Configuration is required to locate the {42/} server.","762":"Example:","763":"application.yml","764":"where \"defaultZone\" is a magic string fallback value that provides the\nservice URL for any client that doesn’t express a preference\n(i.e. it’s a useful default).","765":"The default application name (service ID), virtual host and non-secure\nport, taken from the {407/}, are {408/},\n{409/} and {410/} respectively.","766":"{411/} makes the app into both a {42/} \"instance\" (ie it registers itself) and a \"client\" (ie it can query the registry to locate other services).","767":"The instance behaviour is driven by {412/} configuration keys, but the defaults will be fine if you ensure that your application has a {413/} (this is the default for the {42/} service ID, or VIP).","768":"See EurekaInstanceConfigBean and EurekaClientConfigBean for more details of the configurable options.","769":"Authenticating with the {42/} Server","770":"HTTP basic authentication will be automatically added to your eureka client if one of the {414/} URLs has credentials embedded in it (curl style, like {415/}).","771":"For more complex needs you can create a {416/} of type {417/} and inject {418/} instances into it, all of which will be applied to the calls from the client to the server.","772":"Note","773":"\nBecause of a limitation in {42/} it isn’t possible to support\nper-server basic auth credentials, so only the first set that are\nfound will be used.\n","774":"Status Page and Health Indicator","775":"The status page and health indicators for a {42/} instance default to \"/info\" and \"/health\" respectively, which are the default locations of useful endpoints in a {3/} application.","776":"You need to change these, even for an Actuator application if you use a non-default context path or servlet path (eg {419/}) or management endpoint path (eg {420/}).","777":"Example:","778":"application.yml","779":"These links show up in the metadata that is consumed by clients, and\nused in some scenarios to decide whether to send requests to your\napplication, so it’s helpful if they are accurate.","780":"Registering a Secure Application","781":"If your app wants to be contacted over HTTPS you can set two flags in the {421/}, viz {422/} respectively.","782":"This will make {42/} publish instance information showing an explicit preference for secure communication.","783":"The {45/} Cloud {423/} will always return an {424/} URI for a service configured this way, and the {42/} (native) instance information will have a secure health check URL.","784":"Because of the way {42/} works internally, it will still publish a non-secure URL for status and home page unless you also override those explicitly.","785":"You can use placeholders to configure the eureka instance urls, eg","786":"application.yml","787":"(Note that {425/} is a native placeholder only available\nin later versions of {42/}. You could achieve the same thing with\n{45/} placeholders as well, e.g. using {426/}.)","788":"Note","789":"If your app is running behind a proxy, and the SSL termination is in the proxy (eg if you run in Cloud Foundry or other platforms as a service) then you will need to ensure that the proxy \"forwarded\" headers are intercepted and handled by the application.","790":"An embedded Tomcat container in a {15/} app does this automatically if it has explicit configuration for the 'X-Forwarded-\\*` headers.","791":"A sign that you got this wrong will be that the links rendered by your app to itself will be wrong (the wrong host, port or protocol).","792":"{42/}’s Health Checks","793":"By default, {42/} uses the client heartbeat to determine if a client is up.","794":"Unless specified otherwise the Discovery Client will not propagate the current health check status of the application per the {3/}.","795":"Which means that after successful registration {42/} will always announce that the application is in 'UP' state.","796":"This behaviour can be altered by enabling {42/} health checks, which results in propagating application status to {42/}.","797":"As a consequence every other application won't be sending traffic to application in state other then 'UP'.","798":"application.yml","799":"If you require more control over the health checks, you may consider\nimplementing your own {427/}.","800":"{42/} Metadata for Instances and Clients","801":"It's worth spending a bit of time understanding how the {42/} metadata works, so you can use it in a way that makes sense in your platform.","802":"There is standard metadata for things like hostname, IP address, port numbers, status page and health check.","803":"These are published in the service registry and used by clients to contact the services in a straightforward way.","804":"Additional metadata can be added to the instance registration in the {428/}, and this will be accessible in the remote clients, but in general will not change the behaviour of the client, unless it is made aware of the meaning of the metadata.","805":"There are a couple of special cases described below where {11/} already assigns meaning to the metadata map.","806":"Using {42/} on Cloudfoundry","807":"Cloudfoundry has a global router so that all instances of the same app have the same hostname (it's the same in other PaaS solutions with a similar architecture).","808":"This isn't necessarily a barrier to using {42/}, but if you use the router (recommended, or even mandatory depending on the way your platform was set up), you need to explicitly set the hostname and port numbers (secure or non-secure) so that they use the router.","809":"You might also want to use instance metadata so you can distinguish between the instances on the client (eg in a custom load balancer).","810":"By default, the {429/} is {430/}.","811":"For example:","812":"application.yml","813":"Depending on the way the security rules are set up in your Cloudfoundry instance, you might be able to register and use the IP address of the host VM for direct service-to-service calls.","814":"This feature is not (yet) available on Pivotal Web Services ( PWS ).","815":"Using {42/} on AWS","816":"If the application is planned to be deployed to an AWS cloud, then the {42/} instance will have to be configured to be Amazon aware and this can be done by customizing the EurekaInstanceConfigBean the following way:","817":"Changing the {42/} Instance ID","818":"A vanilla Netflix {42/} instance is registered with an ID that is equal to its host name (ie only one service per host).","819":"{11/} {42/} provides a sensible default that looks like this: {431/}.","820":"For example {432/}.","821":"Using {11/} you can override this by providing a unique identifier in {433/}.","822":"For example:","823":"application.yml","824":"With this metadata, and multiple service instances deployed on localhost, the random value will kick in there to make the instance unique.","825":"In Cloudfoundry the {434/} will be populated automatically in a {3/} application, so the random value will not be needed.","826":"Using the EurekaClient","827":"Once you have an app that is {435/} (or {436/}) you can use it to discover service instances from the {42/} Server .","828":"One way to do that is to use the native {437/} (as opposed to the {45/} Cloud {438/}), eg","829":"Tip","830":"Don't use the {439/} in {440/} method or in a {441/} method (or anywhere where the {442/} might not be started yet).","831":"It is initialized in a {443/} (with {444/}) so the earliest you can rely on it being available is in another {445/} with higher phase.","832":"Alternatives to the native Netflix EurekaClient","833":"You don't have to use the raw Netflix {446/} and usually it is more convenient to use it behind a wrapper of some sort.","834":"{45/} Cloud has support for {29/} (a REST client builder) and also {45/} {447/} using the logical {42/} service identifiers (VIPs) instead of physical URLs.","835":"To configure {41/} with a fixed list of physical servers you can simply set {448/} to a comma-separated list of physical addresses (or hostnames), where {449/} is the ID of the client.","836":"You can also use the {450/}\nwhich provides a simple API for discovery clients that is not specific\nto Netflix, e.g.","837":"Why is it so Slow to Register a Service?","838":"Being an instance also involves a periodic heartbeat to the registry (via the client's {451/}) with default duration 30 seconds.","839":"A service is not available for discovery by clients until the instance, the server and the client all have the same metadata in their local cache (so it could take 3 heartbeats).","840":"You can change the period using {452/} and this will speed up the process of getting clients connected to other services.","841":"In production it's probably better to stick with the default because there are some computations internally in the server that make assumptions about the lease renewal period.","842":"Service Discovery: {42/} Server","843":"Example eureka server (e.g. using spring-cloud-starter-eureka-server to set up the classpath):","844":"The server has a home page with a UI, and HTTP API endpoints per the\nnormal {42/} functionality under {453/}.","845":"{42/} background reading: see flux capacitor and google group discussion.","846":"Tip","847":"Due to Gradle's dependency resolution rules and the lack of a parent bom feature, simply depending on spring-cloud-starter-eureka-server can cause failures on application startup.","848":"To remedy this the {15/} Gradle plugin must be added and the {45/} cloud starter parent bom must be imported like so:","849":"build.gradle","850":"High Availability, Zones and Regions","851":"The {42/} server does not have a backend store, but the service instances in the registry all have to send heartbeats to keep their registrations up to date (so this can be done in memory).","852":"Clients also have an in-memory cache of eureka registrations (so they don't have to go to the registry for every single request to a service).","853":"By default every {42/} server is also a {42/} client and requires (at least one) service URL to locate a peer.","854":"If you don't provide it the service will run and work, but it will shower your logs with a lot of noise about not being able to register with the peer.","855":"See also below for details of {41/}\nsupport on the client side for Zones and Regions.","856":"Standalone Mode","857":"The combination of the two caches (client and server) and the heartbeats make a standalone {42/} server fairly resilient to failure, as long as there is some sort of monitor or elastic runtime keeping it alive (eg Cloud Foundry).","858":"In standalone mode, you might prefer to switch off the client side behaviour, so it doesn't keep trying and failing to reach its peers.","859":"Example:","860":"application.yml (Standalone {42/} Server)","861":"Notice that the {454/} is pointing to the same host as the local\ninstance.","862":"Peer Awareness","863":"{42/} can be made even more resilient and available by running multiple instances and asking them to register with each other.","864":"In fact, this is the default behaviour, so all you need to do to make it work is add a valid {455/} to a peer, eg","865":"application.yml (Two Peer Aware {42/} Servers)","866":"In this example we have a YAML file that can be used to run the same server on 2 hosts (peer1 and peer2), by running it in different {45/} profiles.","867":"You could use this configuration to test the peer awareness on a single host (there's not much value in doing that in production) by manipulating {456/} to resolve the host names.","868":"In fact, the {457/} is not needed if you are running on a machine that knows its own hostname (it is looked up using {458/} by default).","869":"You can add multiple peers to a system, and as long as they are all\ndirectly connected to each other, they will synchronize\nthe registrations amongst themselves.","870":"application.yml (Three Peer Aware {42/} Servers)","871":"Prefer IP Address","872":"In some cases, it is preferable for {42/} to advertise the IP Adresses of services rather than the hostname.","873":"Set {459/} to {460/} and when the application registers with eureka, it will use its IP Address rather than its hostname.","874":"Circuit Breaker: {22/} Clients","875":"Netflix has created a library called {22/} that implements the circuit breaker pattern .","876":"In a microservice architecture it is common to have multiple layers of service calls.","877":"Figure 1. Microservice Graph","878":"A service failure in the lower level of services can cause cascading failure all the way up to the user.","879":"When calls to a particular service reach a certain threshold (20 failures in 5 seconds is the default in {22/}), the circuit opens and the call is not made.","880":"In cases of error and an open circuit a fallback can be provided by the developer.","881":"Figure 2. {22/} fallback prevents cascading failures","882":"Having an open circuit stops cascading failures and allows overwhelmed or failing services time to heal.","883":"The fallback can be another {22/} protected call, static data or a sane empty value.","884":"Fallbacks may be chained so the first fallback makes some other business call which in turn falls back to static data.","885":"Example boot app:","886":"The {461/} is provided by a Netflix contrib library called \"javanica\" .","887":"{11/} automatically wraps {45/} beans with that annotation in a proxy that is connected to the {22/} circuit breaker.","888":"The circuit breaker calculates when to open and close the circuit, and what to do in case of a failure.","889":"To configure the {462/} you can use the {463/} attribute with a list of {464/} annotations.","890":"See here for more details.","891":"See the {22/} wiki for details on the properties available.","892":"Propagating the Security Context or using {45/} Scopes","893":"If you want some thread local context to propagate into a {465/} the default declaration will not work because it executes the command in a thread pool (in case of timeouts).","894":"You can switch {22/} to use the same thread as the caller using some configuration, or directly in the annotation, by asking it to use a different \"Isolation Strategy\".","895":"For example:","896":"The same thing applies if you are using {466/} or {467/}.","897":"You will know when you need to do this because of a runtime exception that says it can't find the scoped context.","898":"Health Indicator","899":"The state of the connected circuit breakers are also exposed in the\n{468/} endpoint of the calling application.","900":"{22/} Metrics Stream","901":"To enable the {22/} metrics stream include a dependency on {469/}.","902":"This will expose the {470/} as a management endpoint.","903":"Circuit Breaker: {22/} Dashboard","904":"One of the main benefits of {22/} is the set of metrics it gathers about each HystrixCommand.","905":"The {22/} Dashboard displays the health of each circuit breaker in an efficient manner.","906":"Figure 3. {22/} Dashboard","907":"To run the {22/} Dashboard annotate your {15/} main class with {471/}.","908":"You then visit {472/} and point the dashboard to an individual instances {473/} endpoint in a {22/} client application.","910":"Looking at an individual instances {22/} data is not very useful in terms of the overall health of the system.","911":"{12/} is an application that aggregates all of the relevant {474/} endpoints into a combined {475/} for use in the {22/} Dashboard.","912":"Individual instances are located via {42/}.","913":"Running {12/} is as simple as annotating your main class with the {476/} annotation (eg using spring-cloud-starter-turbine to set up the classpath).","914":"All of the documented configuration properties from the {12/} 1 wiki apply.","915":"The only difference is that the {477/} does not need the port prepended as this is handled automatically unless {478/}.","916":"The configuration key {479/} is a list of eureka serviceIds that turbine will use to lookup instances.","917":"The turbine stream is then used in the {22/} dashboard using a url that looks like: {480/} (the cluster parameter can be omitted if the name is \"default\").","918":"The {481/} parameter must match an entry in {482/}.","919":"Values returned from eureka are uppercase, thus we expect this example to work if there is an app registered with {42/} called \"customers\":","920":"The {483/} can be customized by a SPEL expression in {484/} with root an instance of {485/}.","921":"The default value is {486/}, which means that the {42/} serviceId ends up as the cluster key (ie the {487/} for customers has an {488/} of \"CUSTOMERS\").","922":"A different example would be {489/}, which would get the cluster name from the AWS ASG name.","923":"Another example:","924":"In this case, the cluster name from 4 services is pulled from their metadata map, and is expected to have values that include \"SYSTEM\" and \"USER\".","925":"To use the \"default\" cluster for all apps you need a string literal expression (with single quotes, and escaped with double quotes if it is in YAML as well):","926":"{11/} provides a {490/} that has all the dependencies you need to get a {12/} server running.","927":"Just create a {15/} application and annotate it with {491/}.","928":"Note","929":"by default the native Netflix behaviour built into {12/} does not allow multiple processes per host, per cluster (the key to the instance id is the hostname).","930":"{11/} generalizes this a bit, allowing the host and port to be used as the key, but only if you set the property {492/}","931":"{12/} Stream","932":"In some environments (eg in a PaaS setting), the classic {12/} model of pulling metrics from all the distributed {22/} commands doesn't work.","933":"In that case you might want to have your {22/} commands push metrics to {12/}, and {11/} enables that with messaging.","934":"All you need to do on the client is add a dependency to {493/} and the {494/} of your choice (see {9/} documentation for details on the brokers, and how to configure the client credentials, but it should work out of the box for a local broker).","935":"On the server side Just create a {15/} application and annotate it with {495/} and by default it will come up on port 8989 (point your {22/} dashboard to that port, any path).","936":"You can customize the port using either {496/} or {497/}.","937":"If you have {498/} and {499/} on the classpath as well, then you can open up the Actuator endpoints on a separate port (with Tomcat by default) by providing a {500/} which is different.","938":"You can then point the {22/} Dashboard to the {12/} Stream Server instead of individual {22/} streams.","939":"If {12/} Stream is running on port 8989 on myhost, then put {501/} in the stream input field in the {22/} Dashboard.","940":"Circuits will be prefixed by their respective serviceId, followed by a dot, then the circuit name.","941":"{11/} provides a {502/} that has all the dependencies you need to get a {12/} Stream server running - just add the Stream binder of your choice, eg {503/}.","942":"You need Java 8 to run the app because it is Netty-based.","943":"Client Side Load Balancer: {41/}","944":"{41/} is a client side load balancer which gives you a lot of control over the behaviour of HTTP and TCP clients.","945":"{29/} already uses {41/}, so if you are using {504/} then this section also applies.","946":"A central concept in {41/} is that of the named client.","947":"Each load balancer is part of an ensemble of components that work together to contact a remote server on demand, and the ensemble has a name that you give it as an application developer (eg using the {505/} annotation).","948":"{11/} creates a new ensemble as an {506/} on demand for each named client using {507/}.","949":"This contains (amongst other things) an {508/}, a {509/}, and a {510/}.","950":"Customizing the {41/} Client","951":"You can configure some bits of a {41/} client using external properties in {511/}, which is no different than using the Netflix APIs natively, except that you can use {15/} configuration files.","952":"The native options can be inspected as static fields in {512/} (part of ribbon-core).","953":"{11/} also lets you take full control of the client by declaring additional configuration (on top of the {513/}) using {514/}.","954":"Example:","955":"In this case the client is composed from the components already in\n{515/} together with any in {516/}\n(where the latter generally will override the former).","956":"Warning","957":"The {517/} has to be {518/} but take care that it is not in a {519/} for the main application context, otherwise it will be shared by all the {520/}.","958":"If you use {521/} (or {522/}) you need to take steps to avoid it being included (for instance put it in a separate, non-overlapping package, or specify the packages to scan explicitly in the {523/}).","959":"{11/} Netflix provides the following beans by default for ribbon\n({524/} beanName: {525/}):","960":"{526/} ribbonClientConfig: {527/}","961":"{528/} ribbonRule: {529/}","962":"{530/} ribbonPing: {531/}","963":"{532/} ribbonServerList: {533/}","964":"{534/} ribbonServerListFilter: {535/}","965":"{536/} ribbonLoadBalancer: {537/}","966":"Creating a bean of one of those type and placing it in a {538/} configuration (such as {539/} above) allows you to override each one of the beans described.","967":"Example:","968":"This replaces the {540/} with {541/}.","969":"Using {41/} with {42/}","970":"When {42/} is used in conjunction with {41/} the {542/} is overridden with an extension of {543/} which populates the list of servers from {42/}.","971":"It also replaces the {544/} interface with {545/} which delegates to {42/} to determine if a server is up.","972":"The {546/} that is installed by default is a {547/} and the purpose of this is to make physical metadata available to the load balancer without using AWS AMI metadata (which is what Netflix relies on).","973":"By default the server list will be constructed with \"zone\" information as provided in the instance metadata (so on the remote clients set {548/}), and if that is missing it can use the domain name from the server hostname as a proxy for zone (if the flag {549/} is set).","974":"Once the zone information is available it can be used in a {550/}.","975":"By default it will be used to locate a server in the same zone as the client because the default is a {551/}.","976":"The zone of the client is determined the same way as the remote instances by default, ie via {552/}.","977":"Note","978":"\nThe orthodox \"archaius\" way to set the client zone is via a\nconfiguration property called \"@zone\", and {11/} will use that\nin preference to all other settings if it is available (note that the\nkey will have to be quoted in YAML configuration).\n","979":"Note","980":"If there is no other source of zone data then a guess is made based on the client configuration (as opposed to the instance configuration).","981":"We take {553/}, which is a map from region name to a list of zones, and pull out the first zone for the instance's own region (ie the {554/}, which defaults to \"us-east-1\" for comatibility with native Netflix).","982":"Example: How to Use {41/} Without {42/}","983":"{42/} is a convenient way to abstract the discovery of remote servers so you don't have to hard code their URLs in clients, but if you prefer not to use it, {41/} and {29/} are still quite amenable.","984":"Suppose you have declared a {555/} for \"stores\", and {42/} is not in use (and not even on the classpath).","985":"The {41/} client defaults to a configured server list, and you can supply the configuration like this","986":"application.yml","987":"Example: Disable {42/} use in {41/}","988":"Setting the property {556/} will explicitly\ndisable the use of {42/} in {41/}.","989":"application.yml","990":"Using the {41/} API Directly","991":"You can also use the {557/} directly.","992":"Example:","993":"Declarative REST Client: {29/}","994":"{29/} is a declarative web service client.","995":"It makes writing web service clients easier.","996":"To use {29/} create an interface and annotate it.","997":"It has pluggable annotation support including {29/} annotations and JAX-RS annotations.","998":"{29/} also supports pluggable encoders and decoders.","999":"{11/} adds support for {45/} MVC annotations and for using the same {558/} used by default in {45/} Web.","1000":"{11/} integrates {41/} and {42/} to provide a load balanced http client when using {29/}.","1001":"Example spring boot app","1002":"StoreClient.java","1003":"In the {559/} annotation the String value (\"stores\" above) is an arbitrary client name, which is used to create a {41/} load balancer (see below for details of {41/} support ).","1004":"You can also specify a URL using the {560/} attribute (absolute value or just a hostname).","1005":"The name of the bean in the application context is the fully qualified name of the interface.","1006":"An alias is also created which is the 'name' attribute plus 'FeignClient'.","1007":"For the example above, {561/} could be used to reference the bean.","1008":"The {41/} client above will want to discover the physical addresses for the \"stores\" service.","1009":"If your application is a {42/} client then it will resolve the service in the {42/} service registry.","1010":"If you don't want to use {42/}, you can simply configure a list of servers in your external configuration (see above for example ).","1011":"Overriding {29/} Defaults","1012":"A central concept in {11/}'s {29/} support is that of the named client.","1013":"Each feign client is part of an ensemble of components that work together to contact a remote server on demand, and the ensemble has a name that you give it as an application developer using the {562/} annotation.","1014":"{11/} creates a new ensemble as an {563/} on demand for each named client using {564/}.","1015":"This contains (amongst other things) an {565/}, a {566/}, and a {567/}.","1016":"{11/} lets you take full control of the feign client by declaring additional configuration (on top of the {568/}) using {569/}.","1017":"Example:","1018":"In this case the client is composed from the components already in {570/} together with any in {571/} (where the latter will override the former).","1019":"Warning","1020":"The {572/} has to be {573/} but take care that it is not in a {574/} for the main application context, otherwise it will be used for every {575/}.","1021":"If you use {576/} (or {577/}) you need to take steps to avoid it being included (for instance put it in a separate, non-overlapping package, or specify the packages to scan explicitly in the {578/}).","1022":"Note","1023":"\nThe {579/} attribute is now deprecated in favor of the {580/} attribute.\n","1024":"Warning","1025":"Previously, using the {581/} attribute, did not require the {582/} attribute.","1026":"Using {583/} is now required.","1027":"Placeholders are supported in the {584/} and {585/} attributes.","1028":"{11/} Netflix provides the following beans by default for feign ({586/} beanName: {587/}):","1029":"{588/} feignDecoder: {589/} (which wraps a {590/})","1030":"{591/} feignEncoder: {592/}","1031":"{593/} feignLogger: {594/}","1032":"{595/} feignContract: {596/}","1033":"{597/} feignBuilder: {598/}","1034":"{11/} Netflix does not provide the following beans by default for feign, but still looks up beans of these types from the application context to create the feign client:","1035":"Creating a bean of one of those type and placing it in a {599/} configuration (such as {600/} above) allows you to override each one of the beans described.","1036":"Example:","1037":"This replaces the {601/} with {602/} and adds a {603/} to the collection of {604/}.","1038":"Default configurations can be specified in the {605/} attribute {606/} in a similar manner as described above.","1039":"The difference is that this configuration will apply to all feign clients.","1040":"{29/} {22/} Support","1041":"If {22/} is on the classpath, by default {29/} will wrap all methods with a circuit breaker.","1042":"Returning a {607/} is also available.","1043":"This lets you use reactive patterns (with a call to {608/} or {609/} or asynchronous use (with a call to {610/}).","1044":"To disable {22/} support for {29/}, set {611/}.","1045":"To disable {22/} support on a per-client basis create a vanilla {612/} with the \"prototype\" scope, e.g.:","1046":"{29/} {22/} Fallbacks","1047":"{22/} supports the notion of a fallback: a default code path that is executed when they circuit is open or there is an error.","1048":"To enable fallbacks for a given {613/} set the {614/} attribute to the class name that implements the fallback.","1049":"Warning","1050":"There is a limitation with the implementation of fallbacks in {29/} and how {22/} fallbacks work.","1051":"Fallbacks are currently not supported for methods that return {615/} and {616/}.","1052":"{29/} Inheritance Support","1053":"{29/} supports boilerplate apis via single-inheritance interfaces.","1054":"This allows grouping common operations into convenient base interfaces.","1055":"UserService.java","1056":"UserResource.java","1057":"UserClient.java","1058":"Note","1059":"It is generally not advisable to share an interface between a server and a client.","1060":"It introduces tight coupling, and also actually doesn't work with {45/} MVC in its current form (method parameter mapping is not inherited).","1061":"{29/} request/response compression","1062":"You may consider enabling the request or response GZIP compression for your {29/} requests.","1063":"You can do this by enabling one of the properties:","1064":"{29/} request compression gives you settings similar to what you may set for your web server:","1065":"These properties allow you to be selective about the compressed media types and minimum request threshold length.","1066":"{29/} logging","1067":"A logger is created for each {29/} client created.","1068":"By default the name of the logger is the full class name of the interface used to create the {29/} client.","1069":"{29/} logging only responds to the {617/} level.","1070":"application.yml","1071":"The {618/} object that you may configure per client, tells {29/} how much to log.","1072":"Choices are:","1073":"{619/}, No logging (DEFAULT).","1074":"{620/}, Log only the request method and URL and the response status code and execution time.","1075":"{621/}, Log the basic information along with request and response headers.","1076":"{622/}, Log the headers, body, and metadata for both requests and responses.","1077":"For example, the following would set the {623/} to {624/}:","1078":"External Configuration: {24/}","1079":"{24/} is the Netflix client side configuration library.","1080":"It is the library used by all of the Netflix OSS components for configuration.","1081":"{24/} is an extension of the Apache Commons Configuration project.","1082":"It allows updates to configuration by either polling a source for changes or for a source to push changes to the client.","1083":"{24/} uses Dynamic<Type>Property classes as handles to properties.","1084":"{24/} Example","1085":"{24/} has its own set of configuration files and loading priorities.","1086":"{45/} applications should generally not use {24/} directly, but the need to configure the Netflix tools natively remains.","1087":"{11/} has a {45/} Environment Bridge so {24/} can read properties from the {45/} Environment.","1088":"This allows {15/} projects to use the normal configuration toolchain, while allowing them to configure the Netflix tools, for the most part, as documented.","1089":"Router and Filter: {39/}","1090":"Routing in an integral part of a microservice architecture.","1091":"For example, {625/} may be mapped to your web application, {626/} is mapped to the user service and {627/} is mapped to the shop service.","1092":"{39/} is a JVM based router and server side load balancer by Netflix.","1093":"Netflix uses {39/} for the following:","1094":"Authentication","1095":"Insights","1096":"Stress Testing","1097":"Canary Testing","1098":"Dynamic Routing","1099":"Service Migration","1100":"Load Shedding","1101":"Security","1102":"Static Response handling","1103":"Active/Active traffic management","1104":"{39/}’s rule engine allows rules and filters to be written in essentially any JVM language, with built in support for Java and Groovy.","1105":"Note","1106":"\nThe configuration property {628/} has been replaced by two new properties, {629/} and {630/} which default to 200 and 20 respectively.\n","1107":"Embedded {39/} Reverse Proxy","1108":"{11/} has created an embedded {39/} proxy to ease the development of a very common use case where a UI application wants to proxy calls to one or more back end services.","1109":"This feature is useful for a user interface to proxy to the backend services it requires, avoiding the need to manage CORS and authentication concerns independently for all the backends.","1110":"To enable it, annotate a {15/} main class with {631/}, and this forwards local calls to the appropriate service.","1111":"By convention, a service with the ID \"users\", will receive requests from the proxy located at {632/} (with the prefix stripped).","1112":"The proxy uses {41/} to locate an instance to forward to via discovery, and all requests are executed in a hystrix command, so failures will show up in {22/} metrics, and once the circuit is open the proxy will not try to contact the service.","1113":"Note","1114":"\nthe {39/} starter does not include a discovery client, so for\nroutes based on service IDs you need to provide one of those\non the classpath as well (e.g. {42/} is one choice).\n","1115":"To skip having a service automatically added, set {633/} to a list of service id patterns.","1116":"If a service matches a pattern that is ignored, but also included in the explicitly configured routes map, then it will be unignored.","1117":"Example:","1118":"application.yml","1119":"In this example, all services are ignored except \"users\".","1120":"To augment or change\nthe proxy routes, you can add external configuration like the\nfollowing:","1121":"application.yml","1122":"This means that http calls to \"/myusers\" get forwarded to the \"users\"\nservice (for example \"/myusers/101\" is forwarded to \"/101\").","1123":"To get more fine-grained control over a route you can specify the path\nand the serviceId independently:","1124":"application.yml","1125":"This means that http calls to \"/myusers\" get forwarded to the \"users_service\" service.","1126":"The route has to have a \"path\" which can be specified as an ant-style pattern, so \"/myusers/*\" only matches one level, but \"/myusers/**\" matches hierarchically.","1127":"The location of the backend can be specified as either a \"serviceId\"\n(for a service from discovery) or a \"url\" (for a physical location), e.g.","1128":"application.yml","1129":"These simple url-routes don't get executed as a {634/} nor can you loadbalance multiple URLs with {41/}.","1130":"To achieve this, specify a service-route and configure a {41/} client for the serviceId (this currently requires disabling {42/} support in {41/}: see above for more information ), eg","1131":"application.yml","1132":"You can provide convention between serviceId and routes using regexmapper.","1133":"It uses regular expression named groups to extract variables from serviceId and inject them into a route pattern.","1134":"ApplicationConfiguration.java","1135":"This means that a serviceId \"myusers-v1\" will be mapped to route \"/v1/myusers/**\".","1136":"Any regular expression is accepted but all named groups must be present in both servicePattern and routePattern.","1137":"If servicePattern does not match a serviceId, the default behavior is used.","1138":"In the example above, a serviceId \"myusers\" will be mapped to route \"/myusers/**\" (no version detected) This feature is disable by default and only applies to discovered services.","1139":"To add a prefix to all mappings, set {635/} to a value, such as {636/}.","1140":"The proxy prefix is stripped from the request before the request is forwarded by default (switch this behaviour off with {637/}).","1141":"You can also switch off the stripping of the service-specific prefix from individual routes, eg","1142":"application.yml","1143":"In this example, requests to \"/myusers/101\" will be forwarded to \"/myusers/101\" on the \"users\" service.","1144":"The {638/} entries actually bind to an object of type {639/}.","1145":"If you look at the properties of that object you will see that it also has a \"retryable\" flag.","1146":"Set that flag to \"true\" to have the {41/} client automatically retry failed requests (and if you need to you can modify the parameters of the retry operations using the {41/} client configuration).","1147":"The {640/} header is added to the forwarded requests by default.","1148":"To turn it off set {641/}.","1149":"The prefix path is stripped by default, and the request to the backend picks up a header \"X-Forwarded-Prefix\" (\"/myusers\" in the examples above).","1150":"An application with {642/} could act as a standalone\nserver if you set a default route (\"/\"), for example {643/} would route all traffic (i.e. \"/**\") to the \"home\" service.","1151":"If more fine-grained ignoring is needed, you can specify specific patterns to ignore.","1152":"These patterns are evaluated at the start of the route location process, which means prefixes should be included in the pattern to warrant a match.","1153":"Ignored patterns span all services and supersede any other route specification.","1154":"application.yml","1155":"This means that all calls such as \"/myusers/101\" will be forwarded to \"/101\" on the \"users\" service.","1156":"But calls including \"/admin/\" will not resolve.","1157":"Cookies and Sensitive Headers","1158":"It's OK to share headers between services in the same system, but you probably don't want sensitive headers leaking downstream into external servers.","1159":"You can specify a list of ignored headers as part of the route configuration.","1160":"Cookies play a special role because they have well-defined semantics in browsers, and they are always to be treated as sensitive.","1161":"If the consumer of your proxy is a browser, then cookies for downstream services also cause problems for the user because they all get jumbled up (all downstream services look like they come from the same place).","1162":"If you are careful with the design of your services, for example if only one of the downstream services sets cookies, then you might be able to let them flow from the backend all the way up to the caller.","1163":"Also, if your proxy sets cookies and all your back end services are part of the same system, it can be natural to simply share them (and for instance use {45/} Session to link them up to some shared state).","1164":"Other than that, any cookies that get set by downstream services are likely to be not very useful to the caller, so it is recommended that you make (at least) \"Set-Cookie\" and \"Cookie\" into sensitive headers for routes that are not part of your domain.","1165":"Even for routes that are part of your domain, try to think carefully about what it means before allowing cookies to flow between them and the proxy.","1166":"The sensitive headers can be configured as a comma-separated list per\nroute, e.g.","1167":"application.yml","1168":"Sensitive headers can also be set globally by setting {644/}.","1169":"If {645/} is set on a route, this will override the global {646/} setting.","1170":"Note","1171":"this is the default value for {647/}, so you don't need to set it unless you want it to be different.","1172":"NB this is new in {11/} Netflix 1.1 (in 1.0 the user had no control over headers and all cookies flow in both directions).","1173":"In addition to the per-route sensitive headers, you can set a global value for {648/} for values that should be discarded (both request and response) during interactions with downstream services.","1174":"By default these are empty, if {45/} Security is not on the classpath, and otherwise they are initialized to a set of well-known \"security\" headers (eg involving caching) as specified by {45/} Security.","1175":"The assumption in this case is that the downstream services might add these headers too, and we want the values from the proxy.","1176":"The Routes Endpoint","1177":"If you are using {649/} with tha {3/} you will enable (by default) an additional endpoint, available via HTTP as {650/}.","1178":"A GET to this endpoint will return a list of the mapped routes.","1179":"A POST will force a refresh of the existing routes (eg in case there have been changes in the service catalog).","1180":"Note","1181":"\nthe routes should respond automatically to changes in the\nservice catalog, but the POST to /routes is a way to force the change\nto happen immediately.\n","1182":"Strangulation Patterns and Local {13/}","1183":"A common pattern when migrating an existing application or API is to \"strangle\" old endpoints, slowly replacing them with different implementations.","1184":"The {39/} proxy is a useful tool for this because you can use it to handle all traffic from clients of the old endpoints, but redirect some of the requests to new ones.","1185":"Example configuration:","1186":"application.yml","1187":"In this example we are strangling the \"legacy\" app which is mapped to all requests that do not match one of the other patterns.","1188":"Paths in {651/} have been extracted into a new service with an external URL.","1189":"And paths in {652/} are forwared so they can be handled locally, eg with a normal {45/} {653/}.","1190":"Paths in {654/} are also forwarded, but with a different prefix (ie {655/} is forwarded to {656/}).","1191":"Note","1192":"\nThe ignored patterns aren’t completely ignored, they just\naren’t handled by the proxy (so they are also effectively forwarded\nlocally).\n","1193":"Uploading Files through {39/}","1194":"If you {657/} you can use the proxy paths to upload files and it should just work as long as the files are small.","1195":"For large files there is an alternative path which bypasses the {45/} {658/} (to avoid multipart processing) in \"/zuul/*\".","1196":"Ie if {659/} then you can POST large files to \"/zuul/customers/*\".","1197":"The servlet path is externalized via {660/}.","1198":"Extremely large files will also require elevated timeout settings if the proxy route takes you through a {41/} load balancer, eg","1199":"application.yml","1200":"Note that for streaming to work with large files, you need to use chunked encoding in the request (which some browsers do not do by default).","1201":"Eg on the command line:","1202":"Plain Embedded {39/}","1203":"You can also run a {39/} server without the proxying, or switch on parts of the proxying platform selectively, if you use {661/} (instead of {662/}).","1204":"Any beans that you add to the application of type {663/} will be installed automatically, as they are with {664/}, but without any of the proxy filters being added automatically.","1205":"In this case the routes into the {39/} server are still specified by configuring \"zuul.routes.*\", but there is no service discovery and no proxying, so the \"serviceId\" and \"url\" settings are ignored.","1206":"For example:","1207":"application.yml","1208":"maps all paths in \"/api/**\" to the {39/} filter chain.","1209":"Disable {39/} Filters","1210":"{39/} for {11/} comes with a number of {665/} beans enabled by default in both proxy and server mode.","1211":"See the zuul filters package for the possible filters that are enabled.","1212":"If you want to disable one, simply set {666/}.","1213":"By convention, the package after {667/} is the {39/} filter type.","1214":"For example to disable {668/} set {669/}.","1215":"Polyglot support with Sidecar","1216":"Do you have non-jvm languages you want to take advantage of {42/}, {41/} and Config Server?","1217":"The {11/} Netflix Sidecar was inspired by Netflix Prana .","1218":"It includes a simple http api to get all of the instances (ie host and port) for a given service.","1219":"You can also proxy service calls through an embedded {39/} proxy which gets its route entries from {42/}.","1220":"The {7/} Server can be accessed directly via host lookup or through the {39/} Proxy.","1221":"The non-jvm app should implement a health check so the Sidecar can report to eureka if the app is up or down.","1222":"To enable the Sidecar, create a {15/} application with {670/}.","1223":"This annotation includes {671/}, {672/}, and {673/}.","1224":"Run the resulting application on the same host as the non-jvm application.","1225":"To configure the side car add {674/} and {675/} to {676/}.","1226":"The {677/} property is the port the non-jvm app is listening on.","1227":"This is so the Sidecar can properly register the app with {42/}.","1228":"The {678/} is a uri accessible on the non-jvm app that mimicks a {15/} health indicator.","1229":"It should return a json document like the following:","1230":"health-uri-document","1231":"Here is an example application.yml for a Sidecar application:","1232":"application.yml","1233":"The api for the {679/} method is {680/}.","1234":"Here is an example response for {681/} that returns two instances on different hosts.","1235":"This api is accessible to the non-jvm app (if the sidecar is on port 5678) at {682/}.","1236":"/hosts/customers","1237":"The {39/} proxy automatically adds routes for each service known in eureka to {683/}, so the customers service is available at {684/}.","1238":"The Non-jvm app can access the customer service via {685/} (assuming the sidecar is listening on port 5678).","1239":"If the Config Server is registered with {42/}, non-jvm application can access it via the {39/} proxy.","1240":"If the serviceId of the ConfigServer is {686/} and the Sidecar is on port 5678, then it can be accessed at http://localhost:5678/configserver","1241":"Non-jvm app can take advantage of the Config Server's ability to return YAML documents.","1242":"For example, a call to http://sidecar.local.spring.io:5678/configserver/default-master.yml might result in a YAML document like the following","1243":"RxJava with {45/} MVC","1244":"{11/} Netflix includes the RxJava.","1245":"RxJava is a Java VM implementation of Reactive Extensions: a library for composing asynchronous and event-based programs by using observable sequences.","1246":"{11/} Netflix provides support for returning {687/} objects from {45/} MVC Controllers.","1247":"It also supports using {688/} objects for Server-sent events (SSE) .","1248":"This can be very convenient if your internal APIs are already built using RxJava (see {29/} {22/} Support for examples).","1249":"Here are some examples of using {689/}:","1250":"If you have an {690/}, rather than a single, you can use {691/} or {692/}.","1251":"Here are some examples:","1252":"If you have a streaming endpoint and client, SSE could be an option.","1253":"To convert {693/} to a {45/} {694/} use {695/}.","1254":"Here are some examples:","1255":"Metrics: {23/}, {37/}, and {31/}","1256":"When used together, {23/}/{37/} and {31/} provide a near real-time operational insight platform.","1257":"{23/} and {37/} are Netflix's metrics collection libraries.","1258":"{31/} is a Netflix metrics backend to manage dimensional time series data.","1259":"{37/} served Netflix for several years and is still usable, but is gradually being phased out in favor of {23/}, which is only designed to work with Java 8. {11/} Netflix provides support for both, but Java 8 based applications are encouraged to use {23/}.","1260":"Dimensional vs. Hierarchical Metrics","1261":"{3/} metrics are hierarchical and metrics are separated only by name.","1262":"These names often follow a naming convention that embeds key/value attribute pairs (dimensions) into the name separated by periods.","1263":"Consider the following metrics for two endpoints, root and star-star:","1264":"The first metric gives us a normalized count of successful requests against the root endpoint per unit of time.","1265":"But what if the system had 20 endpoints and you want to get a count of successful requests against all the endpoints?","1266":"Some hierarchical metrics backends would allow you to specify a wild card such as {696/} that would read all 20 metrics and aggregate the results.","1267":"Alternatively, you could provide a {697/} that intercepts and records a metric like {698/} for all successful requests irrespective of the endpoint, but now you must write 20+1 different metrics.","1268":"Similarly if you want to know the total number of successful requests for all endpoints in the service, you could specify a wild card such as {699/} {700/}.","1269":"Even in the presence of wildcarding support on a hierarchical metrics backend, naming consistency can be difficult.","1270":"Specifically the position of these tags in the name string can slip with time, breaking queries.","1271":"For example, suppose we add an additional dimension to the hierarchical metrics above for HTTP method.","1272":"Then {701/} becomes {702/}, etc. Our {703/} suddenly no longer has the same semantic meaning.","1273":"Furthermore, if the new dimension is not applied uniformly across the codebase, certain queries may become impossible.","1274":"This can quickly get out of hand.","1275":"Netflix metrics are tagged (aka dimensional).","1276":"Each metric has a name, but this single named metric can contain multiple statistics and 'tag' key/value pairs that allows more querying flexibility.","1277":"In fact, the statistics themselves are recorded in a special tag.","1278":"Recorded with Netflix {37/} or {23/}, a timer for the root endpoint described above contains 4 statistics per status code, where the count statistic is identical to {3/}'s counter.","1279":"In the event that we have encountered an HTTP 200 and 400 thus far, there will be 8 available data points:","1280":"Default Metrics Collection","1281":"Without any additional dependencies or configuration, a {11/} based service will autoconfigure a {37/} {704/} and begin collecting metrics on every {45/} MVC request.","1282":"By default, a {37/} timer with the name {705/} will be recorded for each MVC request which is tagged with:","1283":"HTTP method","1284":"HTTP status (e.g. 200, 400, 500)","1285":"URI (or \"root\" if the URI is empty), sanitized for {31/}","1286":"The exception class name, if the request handler threw an exception","1287":"The caller, if a request header with a key matching {706/} is set on the request.","1288":"There is no default key for {707/}.","1289":"You must add it to your application properties if you wish to collect caller information.","1290":"Set the {708/} property to change the name of the metric from {709/} to a name you provide.","1291":"If {45/} AOP is enabled and {710/} is present on your runtime classpath, {11/} will also collect metrics on every client call made with {711/}.","1292":"A {37/} timer with the name of {712/} will be recorded for each MVC request which is tagged with:","1293":"HTTP method","1294":"HTTP status (e.g. 200, 400, 500), \"CLIENT_ERROR\" if the response returned null, or \"IO_ERROR\" if an {713/} occurred during the execution of the {714/} method","1295":"URI, sanitized for {31/}","1296":"Client name","1297":"Metrics Collection: {23/}","1298":"To enable {23/} metrics, include a dependency on {715/}:","1299":"In {23/} parlance, a meter is a named, typed, and tagged configuration and a metric represents the value of a given meter at a point in time.","1300":"{23/} meters are created and controlled by a registry, which currently has several different implementations.","1301":"{23/} provides 4 meter types: counter, timer, gauge, and distribution summary.","1302":"{11/} {23/} integration configures an injectable {716/} instance for you.","1303":"Specifically, it configures a {717/} instance in order to unify the collection of REST metrics and the exporting of metrics to the {31/} backend under a single {37/} API.","1304":"Practically, this means that your code may use a mixture of {37/} monitors and {23/} meters and both will be scooped up by {3/} {718/} instances and both will be shipped to the {31/} backend.","1305":"{23/} Counter","1306":"A counter is used to measure the rate at which some event is occurring.","1307":"The counter records a single time-normalized statistic.","1308":"{23/} Timer","1309":"A timer is used to measure how long some event is taking.","1310":"{11/} automatically records timers for {45/} MVC requests and conditionally {719/} requests, which can later be used to create dashboards for request related metrics like latency:","1311":"Request Latency","1312":"image::RequestLatency.png []","1313":"The timer simultaneously records 4 statistics: count, max, totalOfSquares, and totalTime.","1314":"The count statistic will always match the single normalized value provided by a counter if you had called {720/} once on the counter for each time you recorded a timing, so it is rarely necessary to count and time separately for a single operation.","1315":"For long running operations, {23/} provides a special {721/}.","1316":"{23/} Gauge","1317":"Gauges are used to determine some current value like the size of a queue or number of threads in a running state.","1318":"Since gauges are sampled, they provide no information about how these values fluctuate between samples.","1319":"The normal use of a gauge involves registering the gauge once in initialization with an id, a reference to the object to be sampled, and a function to get or compute a numeric value based on the object.","1320":"The reference to the object is passed in separately and the {23/} registry will keep a weak reference to the object.","1321":"If the object is garbage collected, then {23/} will automatically drop the registration.","1322":"See the note in {23/}'s documentation about potential memory leaks if this API is misused.","1323":"{23/} Distribution Summaries","1324":"A distribution summary is used to track the distribution of events.","1325":"It is similar to a timer, but more general in that the size does not have to be a period of time.","1326":"For example, a distribution summary could be used to measure the payload sizes of requests hitting a server.","1327":"Metrics Collection: {37/}","1328":"Warning","1329":"\nIf your code is compiled on Java 8, please use {23/} instead of {37/} as {23/} is destined to replace {37/} entirely in the long term.\n","1330":"In {37/} parlance, a monitor is a named, typed, and tagged configuration and a metric represents the value of a given monitor at a point in time.","1331":"{37/} monitors are logically equivalent to {23/} meters.","1332":"{37/} monitors are created and controlled by a {722/}.","1333":"In spite of the above warning, {37/} does have a wider array of monitor options than {23/} has meters.","1334":"{11/} integration configures an injectable {723/} instance for you.","1335":"Once you have created the appropriate {724/} type in {37/}, the process of recording data is wholly similar to {23/}.","1336":"Creating {37/} Monitors","1337":"If you are using the {37/} {725/} instance provided by {11/} (specifically, an instance of {726/}), {37/} provides convenience classes for retrieving counters and timers .","1338":"These convenience classes ensure that only one {727/} is registered for each unique combination of name and tags.","1339":"To manually create a Monitor type in {37/}, especially for the more exotic monitor types for which convenience methods are not provided, instantiate the appropriate type by providing a {728/} instance:","1340":"Metrics Backend: {31/}","1341":"{31/} was developed by Netflix to manage dimensional time series data for near real-time operational insight.","1342":"{31/} features in-memory data storage, allowing it to gather and report very large numbers of metrics, very quickly.","1343":"{31/} captures operational intelligence.","1344":"Whereas business intelligence is data gathered for analyzing trends over time, operational intelligence provides a picture of what is currently happening within a system.","1345":"{11/} provides a {729/} that has all the dependencies you need.","1346":"Then just annotate your {15/} application with {730/} and provide a location for your running {31/} server with the {731/} property.","1347":"Global tags","1348":"{11/} enables you to add tags to every metric sent to the {31/} backend.","1349":"Global tags can be used to separate metrics by application name, environment, region, etc.","1350":"Each bean implementing {732/} will contribute to the global tag list:","1351":"Using {31/}","1352":"To bootstrap a in-memory standalone {31/} instance:","1353":"Tip","1354":"\nAn {31/} standalone node running on an r3.2xlarge (61GB RAM) can handle roughly 2 million metrics per minute for a given 6 hour window.\n","1355":"Once running and you have collected a handful of metrics, verify that your setup is correct by listing tags on the {31/} server:","1356":"Tip","1357":"\nAfter executing several requests against your service, you can gather some very basic information on the request latency of every request by pasting the following url in your browser: {733/}\n","1358":"The {31/} wiki contains a compilation of sample queries for various scenarios.","1359":"Make sure to check out the alerting philosophy and docs on using double exponential smoothing to generate dynamic alert thresholds.","1361":"This section goes into more detail about how you can work with {9/}.","1362":"It covers topics such as creating and running stream applications.","1363":"Introducing {9/}","1364":"{9/} is a framework for building message-driven microservice applications.","1365":"{9/} builds upon {15/} to create standalone, production-grade {45/} applications, and uses {8/} to provide connectivity to message brokers.","1366":"It provides opinionated configuration of middleware from several vendors, introducing the concepts of persistent publish-subscribe semantics, consumer groups, and partitions.","1367":"You can add the {734/} annotation to your application to get immediate connectivity to a message broker, and you can add {735/} to a method to cause it to receive events for stream processing.","1368":"The following is a simple sink application which receives external messages.","1369":"The {736/} annotation takes one or more interfaces as parameters (in this case, the parameter is a single {737/} interface).","1370":"An interface declares input and/or output channels.","1371":"{9/} provides the interfaces {738/}, {739/}, and {740/};","1372":"you can also define your own interfaces.","1373":"The following is the definition of the {741/} interface:","1374":"The {742/} annotation identifies an input channel , through which received messages enter the application;","1375":"the {743/} annotation identifies an output channel , through which published messages leave the application.","1376":"The {744/} and {745/} annotations can take a channel name as a parameter;","1377":"if a name is not provided, the name of the annotated method will be used.","1378":"{9/} will create an implementation of the interface for you.","1379":"You can use this in the application by autowiring it, as in the following example of a test case.","1380":"Main Concepts","1381":"{9/} provides a number of abstractions and primitives that simplify the writing of message-driven microservice applications.","1382":"This section gives an overview of the following:","1383":"{9/}’s application model","1384":"The {32/} abstraction","1385":"Persistent publish-subscribe support","1386":"Consumer group support","1387":"Partitioning support","1388":"A pluggable {32/} API","1389":"Application Model","1390":"A {9/} application consists of a middleware-neutral core.","1391":"The application communicates with the outside world through input and output channels injected into it by {9/}.","1392":"Channels are connected to external brokers through middleware-specific {32/} implementations.","1393":"Figure 4. {9/} Application","1394":"Fat JAR","1395":"{9/} applications can be run in standalone mode from your IDE for testing.","1396":"To run a {9/} application in production, you can create an executable (or \"fat\") JAR by using the standard {15/} tooling provided for Maven or Gradle.","1397":"The {32/} Abstraction","1398":"{9/} provides {32/} implementations for {40/} , {38/} MQ , Redis , and Gemfire .","1399":"{9/} also includes a TestSupportBinder , which leaves a channel unmodified so that tests can interact with channels directly and reliably assert on what is received.","1400":"You can use the extensible API to write your own {32/}.","1401":"{9/} uses {15/} for configuration, and the {32/} abstraction makes it possible for a {9/} application to be flexible in how it connects to middleware.","1402":"For example, deployers can dynamically choose, at runtime, the destinations (eg, the {40/} topics or RabbitMQ exchanges) to which channels connect.","1403":"Such configuration can be provided through external configuration properties and in any form supported by {15/} (including application arguments, environment variables, and {746/} or {747/} files).","1404":"In the sink example from the Introducing {9/} section, setting the application property {748/} to {749/} will cause it to read from the {750/} {40/} topic, or from a queue bound to the {751/} RabbitMQ exchange.","1405":"{9/} automatically detects and uses a binder found on the classpath.","1406":"You can easily use different types of middleware with the same code: just include a different binder at build time.","1407":"For more complex use cases, you can also package multiple binders with your application and have it choose the binder, and even whether to use different binders for different channels, at runtime.","1408":"Persistent Publish-Subscribe Support","1409":"Communication between applications follows a publish-subscribe model, where data is broadcast through shared topics.","1410":"This can be seen in the following figure, which shows a typical deployment for a set of interacting {9/} applications.","1411":"Figure 5. {9/} Publish-Subscribe","1412":"Data reported by sensors to an HTTP endpoint is sent to a common destination named {752/}.","1413":"From the destination, it is independently processed by a microservice application that computes time-windowed averages and by another microservice application that ingests the raw data into HDFS.","1414":"In order to process the data, both applications declare the topic as their input at runtime.","1415":"The publish-subscribe communication model reduces the complexity of both the producer and the consumer, and allows new applications to be added to the topology without disruption of the existing flow.","1416":"For example, downstream from the average-calculating application, you can add an application that calculates the highest temperature values for display and monitoring.","1417":"You can then add another application that interprets the same flow of averages for fault detection.","1418":"Doing all communication through shared topics rather than point-to-point queues reduces coupling between microservices.","1419":"While the concept of publish-subscribe messaging is not new, {9/} takes the extra step of making it an opinionated choice for its application model.","1420":"By using native middleware support, {9/} also simplifies use of the publish-subscribe model across different platforms.","1421":"Consumer Groups","1422":"While the publish-subscribe model makes it easy to connect applications through shared topics, the ability to scale up by creating multiple instances of a given application is equally important.","1423":"When doing this, different instances of an application are placed in a competing consumer relationship, where only one of the instances is expected to handle a given message.","1424":"{9/} models this behavior through the concept of a consumer group .","1425":"({9/} consumer groups are similar to and inspired by {40/} consumer groups.) Each consumer binding can use the {753/} property to specify a group name.","1426":"For the consumers shown in the following figure, this property would be set as {754/} or {755/}.","1427":"Figure 6. {9/} Consumer Groups","1428":"All groups which subscribe to a given destination receive a copy of published data, but only one member of each group receives a given message from that destination.","1429":"By default, when a group is not specified, {9/} assigns the application to an anonymous and independent single-member consumer group that is in a publish-subscribe relationship with all other consumer groups.","1430":"Durability","1431":"Consistent with the opinionated application model of {9/}, consumer group subscriptions are durable .","1432":"That is, a binder implementation ensures that group subscriptions are persistent, and once at least one subscription for a group has been created, the group will receive messages, even if they are sent while all applications in the group are stopped.","1433":"Note","1434":"Anonymous subscriptions are non-durable by nature.","1435":"For some binder implementations (eg, RabbitMQ), it is possible to have non-durable group subscriptions.","1436":"In general, it is preferable to always specify a consumer group when binding an application to a given destination.","1437":"When scaling up a {9/} application, you must specify a consumer group for each of its input bindings.","1438":"This prevents the application's instances from receiving duplicate messages (unless that behavior is desired, which is unusual).","1439":"Partitioning Support","1440":"{9/} provides support for partitioning data between multiple instances of a given application.","1441":"In a partitioned scenario, the physical communication medium (eg, the broker topic) is viewed as being structured into multiple partitions.","1442":"One or more producer application instances send data to multiple consumer application instances and ensure that data identified by common characteristics are processed by the same consumer instance.","1443":"{9/} provides a common abstraction for implementing partitioned processing use cases in a uniform fashion.","1444":"Partitioning can thus be used whether the broker itself is naturally partitioned (eg, {40/}) or not (eg, RabbitMQ).","1445":"Figure 7. {9/} Partitioning","1446":"Partitioning is a critical concept in stateful processing, where it is critiical, for either performance or consistency reasons, to ensure that all related data is processed together.","1447":"For example, in the time-windowed average calculation example, it is important that all measurements from any given sensor are processed by the same application instance.","1448":"Note","1449":"To set up a partitioned processing scenario, you must configure both the data-producing and the data-consuming ends.","1450":"Programming Model","1451":"This section describes {9/}'s programming model.","1452":"{9/} provides a number of predefined annotations for declaring bound input and output channels as well as how to listen to channels.","1453":"Declaring and Binding Channels","1454":"Triggering Binding Via {756/}","1455":"You can turn a {45/} application into a {9/} application by applying the {757/} annotation to one of the application's configuration classes.","1456":"The {758/} annotation itself is meta-annotated with {759/} and triggers the configuration of {9/} infrastructure:","1457":"The {760/} annotation can take as parameters one or more interface classes that contain methods which represent bindable components (typically message channels).","1458":"Note","1459":"In {9/} 1.0, the only supported bindable components are the {45/} Messaging {761/} and its extensions {762/} and {763/}.","1460":"Future versions should extend this support to other types of components, using the same mechanism.","1461":"In this documentation, we will continue to refer to channels.","1462":"{764/} and {765/}","1463":"A {9/} application can have an arbitrary number of input and output channels defined in an interface as {766/} and {767/} methods:","1464":"Using this interface as a parameter to {768/} will trigger the creation of three bound channels named {769/}, {770/}, and {771/}, respectively.","1465":"Customizing Channel Names","1466":"Using the {772/} and {773/} annotations, you can specify a customized channel name for the channel, as shown in the following example:","1467":"In this example, the created bound channel will be named {774/}.","1468":"{775/}, {776/}, and {777/}","1469":"For easy addressing of the most common use cases, which involve either an input channel, an output channel, or both, {9/} provides three predefined interfaces out of the box.","1470":"{778/} can be used for an application which has a single outbound channel.","1471":"{779/} can be used for an application which has a single inbound channel.","1472":"{780/} can be used for an application which has both an inbound channel and an outbound channel.","1473":"{9/} provides no special handling for any of these interfaces;","1474":"they are only provided out of the box.","1475":"Accessing Bound Channels","1476":"Injecting the Bound Interfaces","1477":"For each bound interface, {9/} will generate a bean that implements the interface.","1478":"Invoking a {781/}-annotated or {782/}-annotated method of one of these beans will return the relevant bound channel.","1479":"The bean in the following example sends a message on the output channel when its {783/} method is invoked.","1480":"It invokes {784/} on the injected {785/} bean to retrieve the target channel.","1481":"Injecting Channels Directly","1482":"Bound channels can be also injected directly:","1483":"If the name of the channel is customized on the declaring annotation, that name should be used instead of the method name.","1484":"Given the following declaration:","1485":"The channel will be injected as shown in the following example:","1486":"Producing and Consuming Messages","1487":"You can write a {9/} application using either {8/} annotations or {9/}'s {786/} annotation.","1488":"The {787/} annotation is modeled after other {45/} Messaging annotations (such as {788/}, {789/}, {790/}, etc.) but adds content type management and type coercion features.","1489":"Native {8/} Support","1490":"Because {9/} is based on {8/}, Stream completely inherits Integration's foundation and infrastructure as well as the component itself.","1491":"For example, you can attach the output channel of a {791/} to a {792/}:","1492":"Or you can use a processor’s channels in a transformer:","1493":"Using @StreamListener for Automatic Content Type Handling","1494":"Complementary to its {8/} support, {9/} provides its own {793/} annotation, modeled after other {45/} Messaging annotations (eg {794/}, {795/}, {796/}, etc.).","1495":"The {797/} annotation provides a simpler model for handling inbound messages, especially when dealing with use cases that involve content type management and type coercion.","1496":"{9/} provides an extensible {798/} mechanism for handling data conversion by bound channels and for, in this case, dispatching to methods annotated with {799/}.","1497":"The following is an example of an application which processes external {800/} events:","1498":"The distinction between {801/} and a {8/} {802/} is seen when considering an inbound {803/} that has a {804/} payload and a {805/} header of {806/}.","1499":"In the case of {807/}, the {808/} mechanism will use the {809/} header to parse the {810/} payload into a {811/} object.","1500":"As with other {45/} Messaging methods, method arguments can be annotated with {812/}, {813/} and {814/}.","1501":"Note","1502":"For methods which return data, you must use the {815/} annotation to specify the output binding destination for data returned by the method:","1503":"Note","1504":"In the case of RabbitMQ, content type headers can be set by external applications.","1505":"{9/} supports them as part of an extended internal protocol used for any type of transport (including transports, such as {40/}, that do not normally support headers).","1506":"Aggregation","1507":"{9/} provides support for aggregating multiple applications together, connecting their input and output channels directly and avoiding the additional cost of exchanging messages via a broker.","1508":"As of version 1.0 of {9/}, aggregation is supported only for the following types of applications:","1509":"sources - applications with a single output channel named {816/}, typically having a single binding of the type {817/}","1510":"sinks - applications with a single input channel named {818/}, typically having a single binding of the type {819/}","1511":"processors - applications with a single input channel named {820/} and a single output channel named {821/}, typically having a single binding of the type {822/}.","1512":"They can be aggregated together by creating a sequence of interconnected applications, in which the output channel of an element in the sequence is connected to the input channel of the next element, if it exists.","1513":"A sequence can start with either a source or a processor , it can contain an arbitrary number of processors and must end with either a processor or a sink .","1514":"Depending on the nature of the starting and ending element, the sequence may have one or more bindable channels, as follows:","1515":"if the sequence starts with a source and ends with a sink, all communication between the applications is direct and no channels will be bound","1516":"if the sequence starts with a processor, then its input channel will become the {823/} channel of the aggregate and will be bound accordingly","1517":"if the sequence ends with a processor, then its output channel will become the {824/} channel of the aggregate and will be bound accordingly","1518":"Aggregation is performed using the {825/} utility class, as in the following example.","1519":"Let's consider a project in which we have source, processor and a sink, which may be defined in the project, or may be contained in one of the project's dependencies.","1520":"Each configuration can be used for running a separate component, but in this case they can be aggregated together as follows:","1521":"The starting component of the sequence is provided as argument to the {826/} method.","1522":"The ending component of the sequence is provided as argument to the {827/} method.","1523":"Intermediate processors are provided as argument to the {828/} method.","1524":"Multiple processors of the same type can be chained together (eg for pipelining transformations with different configurations).","1525":"For each component, the builder can provide runtime arguments for {15/} configuration.","1526":"RxJava support","1527":"{9/} provides support for RxJava-based processors through the {829/} available in {830/}.","1528":"An implementation of {831/} will receive {832/} as an input that represents the flow of inbound message payloads.","1529":"The {833/} method is invoked once at startup for setting up the data flow.","1530":"You can enable the use of RxJava-based processors and use them in your processor application by using the {834/} annotation.","1531":"{835/} is meta-annotated with {836/} and will create the {837/} binding.","1532":"Here is an example of an RxJava-based processor:","1533":"Note","1534":"When implementing an RxJava processor, it is important to handle exceptions as part of your processing flow.","1535":"Uncaught exceptions will be treated as errors by RxJava and will cause the {838/} to complete, disrupting the flow.","1537":"{9/} provides a {32/} abstraction for use in connecting to physical destinations at the external middleware.","1538":"This section provides information about the main concepts behind the {21/}, its main components, and implementation-specific details.","1539":"Producers and Consumers","1540":"Figure 8. Producers and Consumers","1541":"A producer is any component that sends messages to a channel.","1542":"The channel can be bound to an external message broker via a {32/} implementation for that broker.","1543":"When invoking the {839/} method, the first parameter is the name of the destination within the broker, the second parameter is the local channel instance to which the producer will send messages, and the third parameter contains properties (such as a partition key expression) to be used within the adapter that is created for that channel.","1544":"A consumer is any component that receives messages from a channel.","1545":"As with a producer, the consumer's channel can be bound to an external message broker.","1546":"When invoking the {840/} method, the first parameter is the destination name, and a second parameter provides the name of a logical group of consumers.","1547":"Each group that is represented by consumer bindings for a given destination receives a copy of each message that a producer sends to that destination (ie, publish-subscribe semantics).","1548":"If there are multiple consumer instances bound using the same group name, then messages will be load-balanced across those consumer instances so that each message sent by a producer is consumed by only a single consumer instance within each group (ie, queueing semantics).","1550":"The {21/} consists of a number of interfaces, out-of-the box utility classes and discovery strategies that provide a pluggable mechanism for connecting to external middleware.","1551":"The key point of the SPI is the {841/} interface which is a strategy for connecting inputs and outputs to external middleware.","1552":"The interface is parameterized, offering a number of extension points:","1553":"input and output bind targets - as of version 1.0, only {842/} is supported, but this is intended to be used as an extension point in the future;","1554":"extended consumer and producer properties - allowing specific {32/} implementations to add supplemental properties which can be supported in a type-safe manner.","1555":"A typical binder implementation consists of the following","1556":"a class that implements the {843/} interface;","1557":"a {45/} {844/} class that creates a bean of the type above along with the middleware connection infrastructure;","1558":"a {845/} file found on the classpath containing one or more binder definitions, e.g.","1559":"{32/} Detection","1560":"{9/} relies on implementations of the {21/} to perform the task of connecting channels to message brokers.","1561":"Each {32/} implementation typically connects to one type of messaging system.","1562":"Out of the box, {9/} provides binders for {40/}, RabbitMQ, and Redis.","1563":"Classpath Detection","1564":"By default, {9/} relies on {15/}'s auto-configuration to configure the binding process.","1565":"If a single {32/} implementation is found on the classpath, {9/} will use it automatically.","1566":"For example, a {9/} project that aims to bind only to RabbitMQ can simply add the following dependency:","1567":"Multiple {20/} on the Classpath","1568":"When multiple binders are present on the classpath, the application must indicate which binder is to be used for each channel binding.","1569":"Each binder configuration contains a {846/}, which is a simple properties file:","1570":"Similar files exist for the other provided binder implementations (eg, {40/}), and custom binder implementations are expected to provide them, as well.","1571":"The key represents an identifying name for the binder implementation, whereas the value is a comma-separated list of configuration classes that each contain one and only one bean definition of type {847/}.","1572":"{32/} selection can either be performed globally, using the {848/} property (eg, {849/}) or individually, by configuring the binder on each channel binding.","1573":"For instance, a processor application which reads from {40/} and writes to RabbitMQ can specify the following configuration:","1574":"Connecting to Multiple Systems","1575":"By default, binders share the application's {15/} auto-configuration, so that one instance of each binder found on the classpath will be created.","1576":"If your application should connect to more than one broker of the same type, you can specify multiple binder configurations, each with different environment settings.","1577":"Note","1578":"Turning on explicit binder configuration will disable the default binder configuration process altogether.","1579":"If you do this, all binders in use must be included in the configuration.","1580":"Frameworks that intend to use {9/} transparently may create binder configurations that can be referenced by name, but will not affect the default binder configuration.","1581":"In order to do so, a binder configuration may have its {850/} flag set to false, eg {851/}.","1582":"This denotes a configuration that will exist independently of the default binder configuration process.","1583":"For example, this is the typical configuration for a processor application which connects to two RabbitMQ broker instances:","1584":"{32/} configuration properties","1585":"The following properties are available when creating custom binder configurations.","1586":"They must be prefixed with {852/}.","1587":"type","1588":"The binder type.","1589":"It typically references one of the binders found on the classpath, in particular a key in a {853/} file.","1590":"By default, it has the same value as the configuration name.","1591":"inheritEnvironment","1592":"Whether the configuration will inherit the environment of the application itself.","1593":"Default {854/}.","1594":"environment","1595":"Root for a set of properties that can be used to customize the environment of the binder.","1596":"When this is configured, the context in which the binder is being created is not a child of the application context.","1597":"This allows for complete separation between the binder components and the application components.","1598":"Default {855/}.","1599":"defaultCandidate","1600":"Whether the binder configuration is a candidate for being considered a default binder, or can be used only when explicitly referenced.","1601":"This allows adding binder configurations without interfering with the default processing.","1602":"Default {856/}.","1603":"Implementation strategies","1604":"This section details the binder implementation strategies for {40/} and {38/} MQ, in what concerns mapping the {9/} concepts onto the middleware concepts.","1606":"Figure 9. {17/}","1607":"The {17/} implementation maps the destination to a {40/} topic.","1608":"The consumer group maps directly to the same {40/} concept.","1609":"{9/} does not use the high-level consumer, but implements a similar concept for the simple consumer.","1610":"RabbitMQ {32/}","1611":"Figure 10. RabbitMQ {32/}","1612":"The RabbitMQ {32/} implementation maps the destination to a {857/}.","1613":"For each consumer group, a {858/} will be bound to that {859/}.","1614":"Each consumer instance that binds will trigger creation of a corresponding RabbitMQ {860/} instance for its group's {861/}.","1615":"Configuration Options","1616":"{9/} supports general configuration options as well as configuration for bindings and binders.","1617":"Some binders allow additional binding properties to support middleware-specific features.","1618":"Configuration options can be provided to {9/} applications via any mechanism supported by {15/}.","1619":"This includes application arguments, environment variables, and YAML or .properties files.","1621":"spring.cloud.stream.instanceCount","1622":"The number of deployed instances of an application.","1623":"Must be set for partitioning and if using {40/}.","1624":"Default: {862/}.","1625":"spring.cloud.stream.instanceIndex","1626":"The instance index of the application: a number from {863/} to {864/}-1.","1627":"Used for partitioning and with {40/}.","1628":"Automatically set in Cloud Foundry to match the application's instance index.","1629":"spring.cloud.stream.dynamicDestinations","1630":"A list of destinations that can be bound dynamically (for example, in a dynamic routing scenario).","1631":"If set, only listed destinations can be bound.","1632":"Default: empty (allowing any destination to be bound).","1633":"spring.cloud.stream.defaultBinder","1634":"The default binder to use, if multiple binders are configured.","1635":"See Multiple {20/} on the Classpath .","1636":"Default: empty.","1637":"spring.cloud.stream.overrideCloudConnectors","1638":"This property is only applicable when the {865/} profile is active and {11/} Connectors are provided with the application.","1639":"If the property is false (the default), the binder will detect a suitable bound service (eg a RabbitMQ service bound in Cloud Foundry for the RabbitMQ binder) and will use it for creating connections (usually via {11/} Connectors).","1640":"When set to true, this property instructs binders to completely ignore the bound services and rely on {15/} properties (eg relying on the {866/} properties provided in the environment for the RabbitMQ binder).","1641":"The typical usage of this property is to be nested in a customized environment when connecting to multiple systems .","1642":"Default: false.","1643":"Binding {16/}","1644":"Binding properties are supplied using the format {867/}.","1645":"The {868/} represents the name of the channel being configured (eg, {869/} for a {870/}).","1646":"In what follows, we indicate where we have omitted the {871/} prefix and focus just on the property name, with the understanding that the prefix will be included at runtime.","1647":"{16/} for Use of {9/}","1648":"The following binding properties are available for both input and output bindings and\nmust be prefixed with {872/}.","1649":"destination","1650":"The target destination of a channel on the bound middleware (eg, the RabbitMQ exchange or {40/} topic).","1651":"If the channel is bound as a consumer, it could be bound to multiple destinations and the destination names can be specified as comma separated String values.","1652":"If not set, the channel name is used instead.","1653":"group","1654":"The consumer group of the channel.","1655":"Applies only to inbound bindings.","1656":"See Consumer Groups .","1657":"Default: null (indicating an anonymous consumer).","1658":"contentType","1659":"The content type of the channel.","1660":"//See [content type management] .","1661":"Default: null (so that no type coercion is performed).","1662":"binder","1663":"The binder used by this binding.","1664":"See Multiple {20/} on the Classpath for details.","1665":"Default: null (the default binder will be used, if one exists).","1666":"Consumer properties","1667":"The following binding properties are available for input bindings only and must be prefixed with {873/}.","1668":"concurrency","1669":"The concurrency of the inbound consumer.","1670":"Default: {874/}.","1671":"partitioned","1672":"Whether the consumer receives data from a partitioned producer.","1673":"Default: {875/}.","1674":"headerMode","1675":"When set to {876/}, disables header parsing on input.","1676":"Effective only for messaging middleware that does not support message headers natively and requires header embedding.","1677":"Useful when inbound data is coming from outside {9/} applications.","1678":"Default: {877/}.","1679":"maxAttempts","1680":"The number of attempts of re-processing an inbound message.","1681":"Default: {878/}.","1682":"backOffInitialInterval","1683":"The backoff initial interval on retry.","1684":"Default: {879/}.","1685":"backOffMaxInterval","1686":"The maximum backoff interval.","1687":"Default: {880/}.","1688":"backOffMultiplier","1689":"The backoff multiplier.","1690":"Default: {881/}.","1691":"Producer {16/}","1692":"The following binding properties are available for output bindings only and must be prefixed with {882/}.","1693":"partitionKeyExpression","1694":"A SpEL expression that determines how to partition outbound data.","1695":"If set, or if {883/} is set, outbound data on this channel will be partitioned, and {884/} must be set to a value greater than 1 to be effective.","1696":"The two options are mutually exclusive.","1697":"See Partitioning Support .","1698":"Default: null.","1699":"partitionKeyExtractorClass","1700":"A {885/} implementation.","1701":"If set, or if {886/} is set, outbound data on this channel will be partitioned, and {887/} must be set to a value greater than 1 to be effective.","1702":"The two options are mutually exclusive.","1703":"See Partitioning Support .","1704":"Default: null.","1705":"partitionSelectorClass","1706":"A {888/} implementation.","1707":"Mutually exclusive with {889/}.","1708":"If neither is set, the partition will be selected as the {890/}, where {891/} is computed via either {892/} or {893/}.","1709":"Default: null.","1710":"partitionSelectorExpression","1711":"A SpEL expression for customizing partition selection.","1712":"Mutually exclusive with {894/}.","1713":"If neither is set, the partition will be selected as the {895/}, where {896/} is computed via either {897/} or {898/}.","1714":"Default: null.","1715":"partitionCount","1716":"The number of target partitions for the data, if partitioning is enabled.","1717":"Must be set to a value greater than 1 if the producer is partitioned.","1718":"On {40/}, interpreted as a hint;","1719":"the larger of this and the partition count of the target topic is used instead.","1720":"Default: {899/}.","1721":"requiredGroups","1722":"A comma-separated list of groups to which the producer must ensure message delivery even if they start after it has been created (e.g., by pre-creating durable queues in RabbitMQ).","1723":"headerMode","1724":"When set to {900/}, disables header embedding on output.","1725":"Effective only for messaging middleware that does not support message headers natively and requires header embedding.","1726":"Useful when producing data for non-{9/} applications.","1727":"Default: {901/}.","1728":"{32/}-Specific Configuration","1729":"The following binder, consumer, and producer properties are specific to binder implementations.","1730":"{28/} Settings","1731":"RabbitMQ {32/} {16/}","1732":"By default, the RabbitMQ binder uses {15/}'s {902/}, and it therefore supports all {15/} configuration options for RabbitMQ.","1733":"(For reference, consult the {15/} documentation .) RabbitMQ configuration options use the {903/} prefix.","1734":"In addition to the {15/} options, the RabbitMQ binder supports the following properties:","1735":"spring.cloud.stream.rabbit.binder.adminAddresses","1736":"A comma-separated list of RabbitMQ management plugin URLs.","1737":"Only used when {904/} contains more than one entry.","1738":"Each entry in this list must have a corresponding entry in {905/}.","1739":"Default: empty.","1740":"spring.cloud.stream.rabbit.binder.nodes","1741":"A comma-separated list of RabbitMQ node names.","1742":"When more than one entry, used to locate the server address where a queue is located.","1743":"Each entry in this list must have a corresponding entry in {906/}.","1744":"Default: empty.","1745":"spring.cloud.stream.rabbit.binder.compressionLevel","1746":"Compression level for compressed bindings.","1747":"See {907/}.","1748":"Default: {908/} (BEST_LEVEL).","1749":"RabbitMQ Consumer {16/}","1750":"The following properties are available for {38/} consumers only and\nmust be prefixed with {909/}.","1751":"acknowledgeMode","1752":"The acknowledge mode.","1753":"Default: {910/}.","1754":"autoBindDlq","1755":"Whether to automatically declare the DLQ and bind it to the binder DLX.","1756":"Default: {911/}.","1757":"durableSubscription","1758":"Whether subscription should be durable.","1759":"Only effective if {912/} is also set.","1760":"Default: {913/}.","1761":"maxConcurrency","1762":"Default: {914/}.","1763":"prefetch","1764":"Prefetch count.","1765":"Default: {915/}.","1766":"prefix","1767":"A prefix to be added to the name of the {916/} and queues.","1768":"Default: \"\".","1769":"recoveryInterval","1770":"The interval between connection recovery attempts, in milliseconds.","1771":"Default: {917/}.","1772":"requeueRejected","1773":"Whether delivery failures should be requeued.","1774":"Default: {918/}.","1775":"requestHeaderPatterns","1776":"The request headers to be transported.","1777":"Default: {919/}.","1778":"replyHeaderPatterns","1779":"The reply headers to be transported.","1780":"Default: {920/}.","1781":"republishToDlq","1782":"By default, messages which fail after retries are exhausted are rejected.","1783":"If a dead-letter queue (DLQ) is configured, RabbitMQ will route the failed message (unchanged) to the DLQ.","1784":"If set to {921/}, the bus will republish failed messages to the DLQ with additional headers, including the exception message and stack trace from the cause of the final failure.","1785":"transacted","1786":"Whether to use transacted channels.","1787":"Default: {922/}.","1788":"txSize","1789":"The number of deliveries between acks.","1790":"Default: {923/}.","1791":"{38/} Producer {16/}","1792":"The following properties are available for {38/} producers only and\nmust be prefixed with {924/}.","1793":"autoBindDlq","1794":"Whether to automatically declare the DLQ and bind it to the binder DLX.","1795":"Default: {925/}.","1796":"batchingEnabled","1797":"Whether to enable message batching by producers.","1798":"Default: {926/}.","1799":"batchSize","1800":"The number of messages to buffer when batching is enabled.","1801":"Default: {927/}.","1802":"batchBufferLimit","1803":"Default: {928/}.","1804":"batchTimeout","1805":"Default: {929/}.","1806":"compress","1807":"Whether data should be compressed when sent.","1808":"Default: {930/}.","1809":"deliveryMode","1810":"Delivery mode.","1811":"Default: {931/}.","1812":"prefix","1813":"A prefix to be added to the name of the {932/} exchange.","1814":"Default: \"\".","1815":"requestHeaderPatterns","1816":"The request headers to be transported.","1817":"Default: {933/}.","1818":"replyHeaderPatterns","1819":"The reply headers to be transported.","1820":"Default: {934/}.","1821":"{40/}-Specific Settings","1823":"spring.cloud.stream.kafka.binder.brokers","1824":"A list of brokers to which the {40/} binder will connect.","1825":"Default: {935/}.","1826":"spring.cloud.stream.kafka.binder.defaultBrokerPort","1827":"{936/} allows hosts specified with or without port information (eg, {937/}).","1828":"This sets the default port when no port is configured in the broker list.","1829":"Default: {938/}.","1830":"spring.cloud.stream.kafka.binder.zkNodes","1831":"A list of ZooKeeper nodes to which the {40/} binder can connect.","1832":"Default: {939/}.","1833":"spring.cloud.stream.kafka.binder.defaultZkPort","1834":"{940/} allows hosts specified with or without port information (eg, {941/}).","1835":"This sets the default port when no port is configured in the node list.","1836":"Default: {942/}.","1837":"spring.cloud.stream.kafka.binder.headers","1838":"The list of custom headers that will be transported by the binder.","1839":"Default: empty.","1840":"spring.cloud.stream.kafka.binder.offsetUpdateTimeWindow","1841":"The frequency, in milliseconds, with which offsets are saved.","1842":"Ignored if {943/}.","1843":"Default: {944/}.","1844":"spring.cloud.stream.kafka.binder.offsetUpdateCount","1845":"The frequency, in number of updates, which which consumed offsets are persisted.","1846":"Ignored if {945/}.","1847":"Mutually exclusive with {946/}.","1848":"Default: {947/}.","1849":"spring.cloud.stream.kafka.binder.requiredAcks","1850":"The number of required acks on the broker.","1851":"Default: {948/}.","1852":"spring.cloud.stream.kafka.binder.minPartitionCount","1853":"Effective only if {949/} or {950/} is set.","1854":"The global minimum number of partitions that the binder will configure on topics on which it produces/consumes data.","1855":"It can be superseded by the {951/} setting of the producer or by the value of {952/} * {953/} settings of the producer (if either is larger).","1856":"Default: {954/}.","1857":"spring.cloud.stream.kafka.binder.replicationFactor","1858":"The replication factor of auto-created topics if {955/} is active.","1859":"Default: {956/}.","1860":"spring.cloud.stream.kafka.binder.autoCreateTopics","1861":"If set to {957/}, the binder will create new topics automatically.","1862":"If set to {958/}, the binder will rely on the topics being already configured.","1863":"In the latter case, if the topics do not exist, the binder will fail to start.","1864":"Of note, this setting is independent of the {959/} setting of the broker and it does not influence it: if the server is set to auto-create topics, they may be created as part of the metadata retrieval request, with default broker settings.","1865":"Default: {960/}.","1866":"spring.cloud.stream.kafka.binder.autoAddPartitions","1867":"If set to {961/}, the binder will create add new partitions if required.","1868":"If set to {962/}, the binder will rely on the partition size of the topic being already configured.","1869":"If the partition count of the target topic is smaller than the expected value, the binder will fail to start.","1870":"Default: {963/}.","1871":"spring.cloud.stream.kafka.binder.socketBufferSize","1872":"Size (in bytes) of the socket buffer to be used by the {40/} consumers.","1873":"Default: {964/}.","1874":"{40/} Consumer {16/}","1875":"The following properties are available for {40/} consumers only and\nmust be prefixed with {965/}.","1876":"autoCommitOffset","1877":"Whether to autocommit offsets when a message has been processed.","1878":"If set to {966/}, an {967/} header will be available in the message headers for late acknowledgment.","1879":"Default: {968/}.","1880":"autoCommitOnError","1881":"Effective only if {969/} is set to {970/}.","1882":"If set to {971/} it suppresses auto-commits for messages that result in errors, and will commit only for successful messages, allows a stream to automatically replay from the last successfully processed message, in case of persistent failures.","1883":"If set to {972/}, it will always auto-commit (if auto-commit is enabled).","1884":"If not set (default), it effectively has the same value as {973/}, auto-committing erroneous messages if they are sent to a DLQ, and not committing them otherwise.","1885":"Default: not set.","1886":"recoveryInterval","1887":"The interval between connection recovery attempts, in milliseconds.","1888":"Default: {974/}.","1889":"resetOffsets","1890":"Whether to reset offsets on the consumer to the value provided by {975/}.","1891":"Default: {976/}.","1892":"startOffset","1893":"The starting offset for new groups, or when {977/} is {978/}.","1894":"Allowed values: {979/}, {980/}.","1895":"Default: null (equivalent to {981/}).","1896":"enableDlq","1897":"When set to true, it will send enable DLQ behavior for the consumer.","1898":"Messages that result in errors will be forwarded to a topic named {982/}.","1899":"This provides an alternative option to the more common {40/} replay scenario for the case when the number of errors is relatively small and replaying the entire original topic may be too cumbersome.","1900":"Default: {983/}.","1901":"{40/} Producer {16/}","1902":"The following properties are available for {40/} producers only and\nmust be prefixed with {984/}.","1903":"bufferSize","1904":"Upper limit, in bytes, of how much data the {40/} producer will attempt to batch before sending.","1905":"Default: {985/}.","1906":"sync","1907":"Whether the producer is synchronous.","1908":"Default: {986/}.","1909":"batchTimeout","1910":"How long the producer will wait before sending in order to allow more messages to accumulate in the same batch.","1911":"(Normally the producer does not wait at all, and simply sends all the messages that accumulated while the previous send was in progress.) A non-zero value may increase throughput at the expense of latency.","1912":"Default: {987/}.","1913":"maxRequestSize","1914":"The maximum size of a message sending request.","1915":"Default: {988/}.","1916":"configuration","1917":"Map with a key/value pair containing generic {40/} producer properties.","1918":"Default: Empty map.","1919":"Content Type and Transformation","1920":"To allow you to propagate information about the content type of produced messages, {9/} attaches, by default, a {989/} header to outbound messages.","1921":"For middleware that does not directly support headers, {9/} provides its own mechanism of automatically wrapping outbound messages in an envelope of its own.","1922":"For middleware that does support headers, {9/} applications may receive messages with a given content type from non-{9/} applications.","1923":"{9/} can handle messages based on this information in two ways:","1924":"Through its {990/} settings on inbound and outbound channels","1925":"Through its argument mapping performed for methods annotated with {991/}","1926":"{9/} allows you to declaratively configure type conversion for inputs and outputs using the {992/} property of a binding.","1927":"Note that general type conversion may also be accomplished easily by using a transformer inside your application.","1928":"Currently, {9/} natively supports the following type conversions commonly used in streams:","1929":"JSON to/from POJO","1930":"JSON to/from org.springframework.tuple.Tuple","1931":"Object to/from byte[] : Either the raw bytes serialized for remote transport, bytes emitted by an application, or converted to bytes using Java serialization(requires the object to be Serializable)","1932":"String to/from byte[]","1933":"Object to plain text (invokes the object’s toString() method)","1934":"Where JSON represents either a byte array or String payload containing JSON.","1935":"Currently, Objects may be converted from a JSON byte array or String.","1936":"Converting to JSON always produces a String.","1937":"MIME types","1938":"{993/} values are parsed as media types, eg, {994/} or {995/}.","1939":"MIME types are especially useful for indicating how to convert to String or byte[] content.","1940":"{9/} also uses MIME type format to represent Java types, using the general type {996/} with a {997/} parameter.","1941":"For example, {998/} or {999/} can be set as the {1000/} property of an input binding.","1942":"In addition, {9/} provides custom MIME types, notably, {1001/} to specify a Tuple.","1943":"MIME types and Java types","1944":"The type conversions {9/} provides out of the box are summarized in the following table:","1945":"Source Payload","1946":"Target Payload","1947":"content-type header","1948":"content-type","1949":"Comments","1950":"JSON is tailored for Tuple","1951":"will apply any Charset specified in the content-type header","1952":"will apply any Charset specified in the content-type header","1953":"Conversion applies to payloads that require type conversion.","1954":"For example, if a module produces an XML string with outputType=application/json, the payload will not be converted from XML to JSON.","1955":"This is because the payload at the module's output channel is already a String so no conversion will be applied at runtime.","1956":"While conversion is supported for both input and output channels, it is especially recommended to be used for the conversion of outbound messages.","1957":"For the conversion of inbound messages, especially when the target is a POJO, the {1002/} support will perform the conversion automatically.","1958":"{1003/} and Message Conversion","1959":"The {1004/} annotation provides a convenient way for converting incoming messages without the need to specify the content type of an input channel.","1960":"During the dispatching process to methods annotated with {1005/}, a conversion will be applied automatically if the argument requires it.","1961":"For example, let's consider a message with the String content {1006/} and a {1007/} header of {1008/} is received on the input channel.","1962":"Let us consider the following application that receives it:","1963":"The argument of the method will be populated automatically with the POJO containing the unmarshalled form of the JSON String.","1964":"Inter-Application Communication","1965":"Connecting Multiple Application Instances","1966":"While {9/} makes it easy for individual {15/} applications to connect to messaging systems, the typical scenario for {9/} is the creation of multi-application pipelines, where microservice applications send data to each other.","1967":"You can achieve this scenario by correlating the input and output destinations of adjacent applications.","1968":"Supposing that a design calls for the Time Source application to send data to the Log Sink application, you can use a common destination named {1009/} for bindings within both applications.","1969":"Time Source will set the following property:","1970":"Log Sink will set the following property:","1971":"Instance Index and Instance Count","1972":"When scaling up {9/} applications, each instance can receive information about how many other instances of the same application exist and what its own instance index is.","1973":"{9/} does this through the {1010/} and {1011/} properties.","1974":"For example, if there are three instances of a HDFS sink application, all three instances will have {1012/} set to {1013/}, and the individual applications will have {1014/} set to {1015/}, {1016/}, and {1017/}, respectively.","1975":"When {9/} applications are deployed via {11/} Data Flow, these properties are configured automatically;","1976":"when {9/} applications are launched independently, these properties must be set correctly.","1977":"By default, {1018/} is {1019/}, and {1020/} is {1021/}.","1978":"In a scaled-up scenario, correct configuration of these two properties is important for addressing partitioning behavior (see below) in general, and the two properties are always required by certain binders (e.g., the {40/} binder) in order to ensure that data are split correctly across multiple consumer instances.","1979":"Partitioning","1980":"Configuring Output Bindings for Partitioning","1981":"An output binding is configured to send partitioned data by setting one and only one of its {1022/} or {1023/} properties, as well as its {1024/} property.","1982":"For example, the following is a valid and typical configuration:","1983":"Based on the above example configuration, data will be sent to the target partition using the following logic.","1984":"A partition key's value is calculated for each message sent to a partitioned output channel based on the {1025/}.","1985":"The {1026/} is a SpEL expression which is evaluated against the outbound message for extracting the partitioning key.","1986":"Tip","1987":"If a SpEL expression is not sufficient for your needs, you can instead calculate the partition key value by setting the property {1027/} to a class which implements the {1028/} interface.","1988":"While the SpEL expression should usually suffice, more complex cases may use the custom implementation strategy.","1989":"Once the message key is calculated, the partition selection process will determine the target partition as a value between {1029/} and {1030/}.","1990":"The default calculation, applicable in most scenarios, is based on the formula {1031/}.","1991":"This can be customized on the binding, either by setting a SpEL expression to be evaluated against the key (via the {1032/} property) or by setting a {1033/} implementation (via the {1034/} property).","1992":"Additional properties can be configured for more advanced scenarios, as described in the following section.","1993":"Note","1994":"The {40/} binder will use the {1035/} setting as a hint to create a topic with the given partition count (in conjunction with the {1036/}, the maximum of the two being the value being used).","1995":"Exercise caution when configuring both {1037/} for a binder and {1038/} for an application, as the larger value will be used.","1996":"If a topic already exists with a smaller partition count and {1039/} is disabled (the default), then the binder will fail to start.","1997":"If a topic already exists with a smaller partition count and {1040/} is enabled, new partitions will be added.","1998":"If a topic already exists with a larger number of partitions than the maximum of ({1041/} and {1042/}), the existing partition count will be used.","1999":"Configuring Input Bindings for Partitioning","2000":"An input binding is configured to receive partitioned data by setting its {1043/} property, as well as the {1044/} and {1045/} properties on the application itself, as in the following example:","2001":"The {1046/} value represents the total number of application instances between which the data need to be partitioned, and the {1047/} must be a unique value across the multiple instances, between {1048/} and {1049/}.","2002":"The instance index helps each application instance to identify the unique partition (or, in the case of {40/}, the partition set) from which it receives data.","2003":"It is important to set both values correctly in order to ensure that all of the data is consumed and that the application instances receive mutually exclusive datasets.","2004":"While a scenario which using multiple instances for partitioned data processing may be complex to set up in a standalone case, {11/} Dataflow can simplify the process significantly by populating both the input and output values correctly as well as relying on the runtime infrastructure to provide information about the instance index and instance count.","2005":"Testing","2006":"{9/} provides support for testing your microservice applications without connecting to a messaging system.","2007":"You can do that by using the {1050/}.","2008":"This is useful especially for unit testing your microservices.","2009":"The {1051/} allows users to interact with the bound channels and inspect what messages are sent and received by the application","2010":"For outbound message channels, the {1052/} registers a single subscriber and retains the messages emitted by the application in a {1053/}.","2011":"They can be retrieved during tests and have assertions made against them.","2012":"The user can also send messages to inbound message channels, so that the consumer application can consume the messages.","2013":"The following example shows how to test both input and output channels on a processor.","2014":"In the example above, we are creating an application that has an input and an output channel, bound through the {1054/} interface.","2015":"The bound interface is injected into the test so we can have access to both channels.","2016":"We are sending a message on the input channel and we are using the {1055/} provided by {9/}'s test support to capture the message has been sent to the output channel as a result.","2017":"Once we have received the message, we can validate that the component functions correctly.","2018":"Health Indicator","2019":"{9/} provides a health indicator for binders.","2020":"It is registered under the name of {1056/} and can be enabled or disabled by setting the {1057/} property.","2021":"Samples","2022":"For {9/} samples, please refer to the spring-cloud-stream-samples repository on GitHub.","2023":"Getting Started","2024":"To get started with creating {9/} applications, visit the {45/} Initializr and create a new Maven project named \"GreetingSource\".","2025":"Select {15/} version 1.3.4 SNAPSHOT and search or tick the checkbox for Stream {40/} (we will be using {40/} for messaging).","2026":"Next, create a new class, {1058/}, in the same package as the {1059/} class.","2027":"Give it the following code:","2028":"The {1060/} annotation is what triggers the creation of {8/} infrastructure components.","2029":"Specifically, it will create a {40/} connection factory, a {40/} outbound channel adapter, and the message channel defined inside the Source interface:","2030":"The auto-configuration also creates a default poller, so that the {1061/} method will be invoked once per second.","2031":"The standard {8/} {1062/} annotation sends a message to the source's output channel, using the return value as the payload of the message.","2032":"To test-drive this setup, run a {40/} message broker.","2033":"An easy way to do this is to use a Docker image:","2034":"Build the application:","2035":"The consumer application is coded in a similar manner.","2036":"Go back to Initializr and create another project, named LoggingSink.","2037":"Then create a new class, {1063/}, in the same package as the class {1064/} and with the following code:","2038":"Build the application:","2039":"To connect the GreetingSource application to the LoggingSink application, each application must share the same destination name.","2040":"Starting up both applications as shown below, you will see the consumer application printing \"hello world\" and a timestamp to the console:","2041":"(The different server port prevents collisions of the HTTP port used to service the {3/} endpoints in the two applications.)","2042":"The output of the LoggingSink application will look something like the following:","2044":"{5/} links nodes of a distributed system with a lightweight message broker.","2045":"This can then be used to broadcast state changes (eg configuration changes) or other management instructions.","2046":"A key idea is that the Bus is like a distributed Actuator for a {15/} application that is scaled out, but it can also be used as a communication channel between apps.","2047":"The only implementation currently is with an AMQP broker as the transport, but the same basic feature set (and some more depending on the transport) is on the roadmap for other transports.","2048":"Quick Start","2049":"{5/} works by adding {15/} autconfiguration if it detects itself on the classpath.","2050":"All you need to do to enable the bus is to add {1065/} or {1066/} to your dependency management and {11/} takes care of the rest.","2051":"Make sure the broker (RabbitMQ or {40/}) is available and configured: running on localhost you shouldn't have to do anything, but if you are running remotely use {11/} Connectors, or {15/} conventions to define the broker credentials, eg for {38/}","2052":"application.yml","2053":"The bus currently supports sending messages to all nodes listening or all nodes for a particular service (as defined by {42/}).","2054":"More selector criteria may be added in the future (ie. only service X nodes in data center Y, etc…).","2055":"There are also some http endpoints under the {1067/} actuator namespace.","2056":"There are currently two implemented.","2057":"The first, {1068/}, sends key/value pairs to update each node's {45/} Environment.","2058":"The second, {1069/}, will reload each application's configuration, just as if they had all been pinged on their {1070/} endpoint.","2059":"Note","2060":"\nThe Bus starters cover {38/} and {40/}, because those are the two most common implementations, but {9/} is quite flexible and binder will work combined with {1071/}.\n","2061":"Addressing an Instance","2062":"The HTTP endpoints accept a \"destination\" parameter, eg \"/bus/refresh?destination=customers:9000\", where the destination is an {1072/} ID.","2063":"If the ID is owned by an instance on the Bus then it will process the message and all other instances will ignore it.","2064":"{15/} sets the ID for you in the {1073/} to a combination of the {1074/}, active profiles and {1075/} by default.","2065":"Addressing all instances of a service","2066":"The \"destination\" parameter is used in a {45/} {1076/} (with the path separator as a colon {1077/}) to determine if an instance will process the message.","2067":"Using the example from above, \"/bus/refresh?destination=customers:**\" will target all instances of the \"customers\" service regardless of the profiles and ports set as the {1078/} ID.","2068":"Application Context ID must be unique","2069":"The bus tries to eliminate processing an event twice, once from the original {1079/} and once from the queue.","2070":"To do this, it checks the sending application context id againts the current application context id.","2071":"If multiple instances of a service have the same application context id, events will not be processed.","2072":"Running on a local machine, each service will be on a different port and that will be part of the application context id.","2073":"Cloud Foundry supplies an index to differentiate.","2074":"To ensure that the application context id is the unique, set {1080/} to something unique for each instance of a service.","2075":"For example, in lattice, set {1081/} in application.properties (or bootstrap.properties if using configserver).","2076":"Customizing the Message Broker","2077":"{5/} uses {9/} to broadcast the messages so to get messages to flow you only need to include the binder implementation of your choice in the classpath.","2078":"There are convenient starters specifically for the bus with AMQP (RabbitMQ) and {40/} ({1082/}).","2079":"Generally speaking {9/} relies on {15/} autoconfiguration conventions for configuring middleware, so for instance the AMQP broker address can be changed with {1083/} configuration properties.","2080":"{5/} has a handful of native configuration properties in {1084/} (eg {1085/} is the name of the topic to use the the externall middleware).","2081":"Normally the defaults will suffice.","2082":"To lean more about how to customize the message broker settings\nconsult the {9/} documentation.","2083":"Tracing {26/}","2084":"Bus events (subclasses of {1086/}) can be traced by setting {1087/}.","2085":"If you do this then the {15/} {1088/} (if it is present) will show each event sent and all the acks from each service instance.","2086":"Example (from the {1089/} endpoint):","2087":"This trace shows that a {1090/} was sent from\n{1091/}, broadcast to all services, and it was received\n(acked) by {1092/} and {1093/}.","2088":"To handle the ack signals yourself you could add an {1094/} for the {1095/} and {1096/} types to your app (and enable tracing).","2089":"Or you could tap into the {1097/} and mine the data from there.","2090":"Note","2091":"Any Bus application can trace acks, but sometimes it will be useful to do this in a central service that can do more complex queries on the data.","2092":"Or forward it to a specialized tracing service.","2093":"Broadcasting Your Own {34/}","2094":"The Bus can carry any event of type {1098/}, but the default transport is JSON and the deserializer needs to know which types are going to be used ahead of time.","2095":"To register a new type it needs to be in a subpackage of {1099/}.","2096":"You can use {1100/} on your custom class or rely on the default strategy which is to use the simple name of the class.","2097":"Note that both the producer and the consumer will need access to the class definition.","2099":"Adrian Cole, Spencer Gibb, Marcin Grzejszczak, Dave Syer","2100":"Brixton.BUILD-SNAPSHOT","2101":"{6/} implements a distributed tracing solution for {11/}.","2102":"Terminology","2103":"{6/} borrows Dapper’s terminology.","2104":"Span: The basic unit of work.","2105":"For example, sending an RPC is a new span, as is sending a response to an RPC.","2106":"Span's are identified by a unique 64-bit ID for the span and another 64-bit ID for the trace the span is a part of.","2107":"Spans also have other data, such as descriptions, timestamped events, key-value annotations (tags), the ID of the span that caused them, and process ID's (normally IP address).","2108":"Spans are started and stopped, and they keep track of their timing information.","2109":"Once you create a span, you must stop it at some point in the future.","2110":"Tip","2111":"The initial span that starts a trace is called a {1101/}.","2112":"The value of span id of that span is equal to trace id.","2113":"Trace: A set of {30/} forming a tree-like structure.","2114":"For example, if you are running a distributed big-data store, a trace might be formed by a put request.","2115":"Annotation: is used to record existence of an event in time.","2116":"Some of the core annotations used to define the start and stop of a request are:","2117":"cs - Client Sent - The client has made a request.","2118":"This annotation depicts the start of the span.","2119":"sr - Server Received - The server side got the request and will start processing it.","2120":"If one subtracts the cs timestamp from this timestamp one will receive the network latency.","2121":"ss - Server Sent - Annotated upon completion of request processing (when the response got sent back to the client).","2122":"If one subtracts the sr timestamp from this timestamp one will receive the time needed by the server side to process the request.","2123":"cr - Client Received - Signifies the end of the span.","2124":"The client has successfully received the response from the server side.","2125":"If one subtracts the cs timestamp from this timestamp one will receive the whole time needed by the client to receive the response from the server.","2126":"Visualization of what Span and Trace will look in a system together with the {43/} annotations:","2127":"Each color of a note signifies a span (7 {30/} - from A to G ).","2128":"If you have such information in the note:","2129":"That means that the current span has Trace-Id set to X , Span-Id set to D .","2130":"It also has emitted Client Sent event.","2131":"This is how the visualization of the parent / child relationship of {30/} would look like:","2132":"Purpose","2133":"In the following sections the example from the image above will be taken into consideration.","2134":"Distributed tracing with {43/}","2135":"Altogether there are 7 {30/} .","2136":"If you go to traces in {43/} you will see this number in the second trace:","2137":"However if you pick a particular trace then you will see 4 {30/}:","2138":"Note","2139":"When picking a particular trace you will see merged {30/}.","2140":"That means that if there were 2 {30/} sent to {43/} with Server Received and Server Sent / Client Received and Client Sent annotations then they will presented as a single span.","2141":"Why is there a difference between the 7 and 4 {30/} in this case?","2142":"2 {30/} come from {1102/} span.","2143":"It has the Server Received (SR) and Server Sent (SS) annotations.","2144":"2 {30/} come from the RPC call from {1103/} to {1104/} to the {1105/} endpoint.","2145":"It has the Client Sent (CS) and Client Received (CR) annotations on {1106/} side.","2146":"It also has Server Received (SR) and Server Sent (SS) annotations on the {1107/} side.","2147":"Physically there are 2 {30/} but they form 1 logical span related to an RPC call.","2148":"2 {30/} come from the RPC call from {1108/} to {1109/} to the {1110/} endpoint.","2149":"It has the Client Sent (CS) and Client Received (CR) annotations on {1111/} side.","2150":"It also has Server Received (SR) and Server Sent (SS) annotations on the {1112/} side.","2151":"Physically there are 2 {30/} but they form 1 logical span related to an RPC call.","2152":"2 {30/} come from the RPC call from {1113/} to {1114/} to the {1115/} endpoint.","2153":"It has the Client Sent (CS) and Client Received (CR) annotations on {1116/} side.","2154":"It also has Server Received (SR) and Server Sent (SS) annotations on the {1117/} side.","2155":"Physically there are 2 {30/} but they form 1 logical span related to an RPC call.","2156":"So if we count the physical {30/} we have 1 from {1118/}, 2 from {1119/} calling {1120/}, 2 form {1121/} calling {1122/} and 2 from {1123/} calling {1124/}.","2157":"Altogether 7 {30/}.","2158":"Logically we see the information of Total Spans: 4 because we have 1 span related to the incoming request\nto {1125/} and 3 {30/} related to RPC calls.","2159":"Visualizing errors","2160":"{43/} allows you to visualize errors in your trace.","2161":"When an exception was thrown and wasn't caught then we're setting proper tags on the span which {43/} can properly colorize.","2162":"You could see in the list of traces one trace that was in red color.","2163":"That's because there was an exception thrown.","2164":"If you click that trace then you’ll see a similar picture","2165":"Then if you click on one of the {30/} you’ll see the following","2166":"As you can see you can easily see the reason for an error and the whole stacktrace related to it.","2167":"Live examples","2168":"Click Pivotal Web Services icon to see it live!Click Pivotal Web Services icon to see it live!","2169":"The dependency graph in {43/} would look like this:","2170":"Click Pivotal Web Services icon to see it live!Click Pivotal Web Services icon to see it live!","2171":"Log correlation","2172":"When grepping the logs of those four applications by trace id equal to e.g. {1126/} one would get the following:","2173":"If you're using a log aggregating tool like Kibana , Splunk etc. you can order the events that took place.","2174":"An example of Kibana would look like this:","2175":"If you want to use Logstash here is the Grok pattern for Logstash:","2176":"Note","2177":"\nIf you want to use Grok together with the logs from Cloud Foundry you have to use this pattern:\n","2178":"JSON Logback with Logstash","2179":"Often you do not want to store your logs in a text file but in a JSON file that Logstash can immediately pick.","2180":"To do that you have to do the following (for readability we're passing the dependencies in the {1127/} notation.","2181":"Dependencies setup","2182":"Ensure that Logback is on the classpath ({1128/})","2183":"Add Logstash Logback encode - example for version {1129/} : {1130/}","2184":"Logback setup","2185":"Below you can find an example of a Logback configuration (file named logback-spring.xml) that:","2186":"logs information from the application in a JSON format to a {1131/} file","2187":"has commented out two additional appenders - console and standard log file","2188":"has the same logging pattern as the one presented in the previous section","2189":"Note","2190":"If you're using a custom {1132/} then you have to pass the {1133/} in {1134/} instead of {1135/} property file.","2191":"Otherwise your custom logback file won't read the property properly.","2192":"Adding to the project","2193":"Only Sleuth (log correlation)","2194":"If you want to profit only from {6/} without the {43/} integration just add\nthe {1136/} module to your project.","2195":"Maven","2196":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2197":"Add the dependency to {1137/}","2198":"Gradle","2199":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2200":"Add the dependency to {1138/}","2201":"Sleuth with {43/} via HTTP","2202":"If you want both Sleuth and {43/} just add the {1139/} dependency.","2203":"Maven","2204":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2205":"Add the dependency to {1140/}","2206":"Gradle","2207":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2208":"Add the dependency to {1141/}","2209":"Sleuth with {43/} via {9/}","2210":"If you want both Sleuth and {43/} just add the {1142/} dependency.","2211":"Maven","2212":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2213":"Add the dependency to {1143/}","2214":"Add the dependency to {1144/} - that way all dependant dependencies will be downloaded","2215":"Add a binder (e.g. {38/} binder) to tell {9/} what it should bind to","2216":"Gradle","2217":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2218":"Add the dependency to {1145/}","2219":"Add the dependency to {1146/} - that way all dependant dependencies will be downloaded","2220":"Add a binder (e.g. {38/} binder) to tell {9/} what it should bind to","2221":"{6/} Stream {43/} Collector","2222":"If you want to start a {6/} Stream {43/} collector just add the {1147/}\ndependency","2223":"Maven","2224":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2225":"Add the dependency to {1148/}","2226":"Add the dependency to {1149/} - that way all dependant dependencies will be downloaded","2227":"Add a binder (e.g. {38/} binder) to tell {9/} what it should bind to","2228":"Gradle","2229":"In order not to pick versions by yourself it’s much better if you add the dependency management via\nthe {45/} BOM","2230":"Add the dependency to {1150/}","2231":"Add the dependency to {1151/} - that way all dependant dependencies will be downloaded","2232":"Add a binder (e.g. {38/} binder) to tell {9/} what it should bind to","2233":"and then just annotate your main class with {1152/} annotation:","2234":"Additional resources","2235":"Marcin Grzejszczak talking about {6/} and {43/}","2236":"click here to see the video","2237":"Features","2238":"Adds trace and span ids to the Slf4J MDC, so you can extract all the logs from a given trace or span in a log aggregator.","2239":"Example logs:","2240":"notice the {1153/} entries from the MDC:","2241":"spanId - the id of a specific operation that took place","2242":"appname - the name of the application that logged the span","2243":"traceId - the id of the latency graph that contains the span","2244":"exportable - whether the log should be exported to {43/} or not.","2245":"When would you like the span not to be exportable?","2246":"In the case in which you want to wrap some operation in a Span and have it written to the logs only.","2247":"Provides an abstraction over common distributed tracing data models: traces, {30/} (forming a DAG), annotations, key-value annotations.","2248":"Loosely based on HTrace, but {43/} (Dapper) compatible.","2249":"Sleuth records timing information to aid in latency analysis.","2250":"Using sleuth, you can pinpoint causes of latency in your applications.","2251":"Sleuth is written to not log too much, and to not cause your production application to crash.","2252":"propagates structural data about your call-graph in-band, and the rest out-of-band.","2253":"includes opinionated instrumentation of layers such as HTTP","2254":"includes sampling policy to manage volume","2255":"can report to a {43/} system for query and visualization","2256":"Instruments common ingress and egress points from {45/} applications (servlet filter, async endpoints,\nrest template, scheduled actions, message channels, zuul filters, feign client).","2257":"Sleuth includes default logic to join a trace across http or messaging boundaries.","2258":"For example, http propagation works via {43/}-compatible request headers.","2259":"This propagation logic is defined and customized via {1154/} and {1155/} implementations.","2260":"Provides simple metrics of accepted / dropped {30/}.","2261":"If {1156/} then the app will generate and collect {43/}-compatible traces.","2262":"By default it sends them via HTTP to a {43/} server on localhost (port 9411).","2263":"Configure the location of the service using {1157/}.","2264":"If {1158/} then the app will generate and collect traces via {9/} .","2265":"Your app automatically becomes a producer of tracer messages that are sent over your broker of choice (eg RabbitMQ, Apache {40/}, Redis).","2266":"Important","2267":"If using {43/} or Stream, configure the percentage of {30/} exported using {1159/} (default 0.1, ie 10%).","2268":"Otherwise you might think that Sleuth is not working cause it's omitting some {30/}.","2269":"Note","2270":"the SLF4J MDC is always set and logback users will immediately see the trace and span ids in logs per the example above.","2271":"Other logging systems have to configure their own formatter to get the same result.","2272":"The default is {1160/} set to {1161/} (this is a {15/} feature for logback users).","2273":"This means that if you're not using SLF4J this pattern WILL NOT be automatically applied .","2274":"Sampling","2275":"In distributed tracing the data volumes can be very high so sampling can be important (you usually don't need to export all {30/} to get a good picture of what is happening).","2276":"{6/} has a {1162/} strategy that you can implement to take control of the sampling algorithm.","2277":"Samplers do not stop span (correlation) ids from being generated, but they do prevent the tags and events being attached and exported.","2278":"By default you get a strategy that continues to trace if a span is already active, but new ones are always marked as non-exportable.","2279":"If all your apps run with this sampler you will see traces in logs, but not in any remote store.","2280":"For testing the default is often enough, and it probably is all you need if you are only using the logs (eg with an ELK aggregator).","2281":"If you are exporting span data to {43/} or {9/}, there is also an {1163/} that exports everything and a {1164/} that samples a fixed fraction of {30/}.","2282":"Note","2283":"the {1165/} is the default if you are using {1166/} or {1167/}.","2284":"You can configure the exports using {1168/}.","2285":"The passed value needs to be a double from {1169/} to {1170/} so it's not a percentage.","2286":"For backwards compatibility reasons we're not changing the property name.","2287":"A sampler can be installed just by creating a bean definition, e.g:","2288":"Instrumentation","2289":"{6/} instruments all your {45/} application automatically, so you shouldn't have to do anything to activate it.","2290":"The instrumentation is added using a variety of technologies according to the stack that is available, eg for a servlet web application we use a {1171/}, and for {8/} we use {1172/}.","2291":"You can customize the keys used in span tags.","2292":"To limit the volume of span data, by default an HTTP request will be tagged only with a handful of metadata like the status code, host and URL.","2293":"You can add request headers by configuring {1173/} (a list of header names).","2294":"Note","2295":"\nRemember that tags are only collected and exported if there is a\n{1174/} that allows it (by default there is not, so there is no\ndanger of accidentally collecting too much data without configuring\nsomething).\n","2296":"Note","2297":"Currently the instrumentation in {6/} is eager - it means that we're actively trying to pass the tracing context between threads.","2298":"Also timing events are captured even when sleuth isn't exporting data to a tracing system.","2299":"This approach may change in the future towards being lazy on this matter.","2300":"Span lifecycle","2301":"You can do the following operations on the Span by means of org.springframework.cloud.sleuth.Tracer interface:","2302":"start - when you start a span its name is assigned and start timestamp is recorded.","2303":"close - the span gets finished (the end time of the span is recorded) and if the span is exportable then it will be eligible for collection to {43/}.","2304":"The span is also removed from the current thread.","2305":"continue - a new instance of span will be created whereas it will be a copy of the\none that it continues.","2306":"detach - the span doesn't get stopped or closed.","2307":"It only gets removed from the current thread.","2308":"create with explicit parent - you can create a new span and set an explicit parent to it","2309":"Tip","2310":"{45/} creates the instance of {1175/} for you.","2311":"In order to use it all you need is to just autowire it.","2312":"Creating and closing {30/}","2313":"You can manually create {30/} by using the Tracer interface.","2314":"In this example we could see how to create a new instance of span.","2315":"Assuming that there already was a span present in this thread then it would become the parent of that span.","2316":"Important","2317":"Always clean after you create a span!","2318":"Don't forget to close a span if you want to send it to {43/}.","2319":"Continuing {30/}","2320":"Sometimes you don't want to create a new span but you want to continue one.","2321":"Example of such a situation might be (of course it all depends on the use-case):","2322":"AOP - If there was already a span created before an aspect was reached then you might not want to create a new span.","2323":"{22/} - executing a {22/} command is most likely a logical part of the current processing.","2324":"It's in fact only a technical implementation detail that you wouldn't necessarily want to reflect in tracing as a separate being.","2325":"The continued instance of span is equal to the one that it continues:","2326":"To continue a span you can use the Tracer interface.","2327":"Important","2328":"Always clean after you create a span!","2329":"Don't forget to detach a span if some work was done started in one thread (eg thread X) and it's waiting for other threads (eg Y, Z) to finish.","2330":"Then the {30/} in the threads Y, Z should be detached at the end of their work.","2331":"When the results are collected the span in thread X should be closed.","2332":"Creating {30/} with an explicit parent","2333":"There is a possibility that you want to start a new span and provide an explicit parent of that span.","2334":"Let's assume that the parent of a span is in one thread and you want to start a new span in another thread.","2335":"The {1176/} method of the {1177/} interface is the method you are looking for.","2336":"Important","2337":"After having created such a span remember to close it.","2338":"Otherwise you will see a lot of warnings in your logs related to the fact that you have a span present in the current thread other than the one you're trying to close.","2339":"What's worse your {30/} won't get closed properly thus will not get collected to {43/}.","2340":"Naming {30/}","2341":"Picking a span name is not a trivial task.","2342":"Span name should depict an operation name.","2343":"The name should be low cardinality (eg not include identifiers).","2344":"Since there is a lot of instrumentation going on some of the span names will be\nartificial like:","2345":"{1178/} when received by a Controller with a method name {1179/}","2346":"{1180/} for asynchronous operations done via wrapped {1181/} and {1182/}.","2347":"{1183/} annotated methods will return the simple name of the class.","2348":"Fortunately, for the asynchronous processing you can provide explicit naming.","2349":"@SpanName annotation","2350":"You can do name the span explicitly via the {1184/} annotation.","2351":"In this case, when processed in the following manner:","2352":"The span will be named {1185/}.","2353":"toString() method","2354":"It's pretty rare to create separate classes for {1186/} or {1187/}.","2355":"Typically one creates an anonymous instance of those classes.","2356":"You can't annotate such classes thus to override that, if there is no {1188/} annotation present, we're checking if the class has a custom implementation of the {1189/} method.","2357":"So executing such code:","2358":"will lead in creating a span named {1190/}.","2359":"Customizations","2360":"Thanks to the {1191/} and {1192/} you can customize the way {30/}\nare created and propagated.","2361":"There are currently two built-in ways to pass tracing information between processes:","2362":"via {8/}","2363":"via HTTP","2364":"Span ids are extracted from {43/}-compatible (B3) headers (either {1193/} or HTTP headers), to start or join an existing trace.","2365":"Trace information is injected into any outbound requests so the next hop can extract them.","2367":"For {8/} these are the beans responsible for creation of a Span from a {1194/}\n and filling in the {1195/} with tracing information.","2368":"You can override them by providing your own implementation and by adding a {1196/} annotation\nto your bean definition.","2369":"HTTP","2370":"For HTTP these are the beans responsible for creation of a Span from a {1197/}.","2371":"You can override them by providing your own implementation and by adding a {1198/} annotation\nto your bean definition.","2372":"Example","2373":"Let’s assume that instead of the standard {43/} compatible tracing HTTP header names\nyou have","2374":"for trace id - {1199/}","2375":"for span id - {1200/}","2376":"This is a an example of a {1201/}","2377":"And you could register it like this:","2378":"{6/} does not add trace/span related headers to the Http Response for security reasons.","2379":"If you need the headers then a custom {1202/} that injects the headers into the Http Response and a Servlet filter which makes use of this can be added the following way:","2380":"And you could register them like this:","2381":"Custom SA tag in {43/}","2382":"Sometimes you want to create a manual Span that will wrap a call to an external service which is not instrumented.","2383":"What you can do is to create a span with the {1203/} tag that will contain a value of the service that you want to call.","2384":"Below you can see an example of a call to Redis that is wrapped in such a span.","2385":"Important","2386":"Remember not to add both {1204/} tag and the {1205/} tag!","2387":"You have to add only {1206/}.","2388":"Custom service name","2389":"By default Sleuth assumes that when you send a span to {43/}, you want the span's service name to be equal to {1207/} value.","2390":"That's not always the case though.","2391":"There are situations in which you want to explicitly provide a different service name for all {30/} coming from your application.","2392":"To achieve that it's enough to just pass the following property to your application to override that value (example for {1208/} service name):","2393":"{19/} as Messages","2394":"You can accumulate and send span data over {9/} by including the {1209/} jar as a dependency, and adding a Channel {32/} implementation (eg {1210/} for RabbitMQ or {1211/} for {40/}).","2395":"This will automatically turn your app into a producer of messages with payload type {1212/}.","2396":"{43/} Consumer","2397":"There is a special convenience annotation for setting up a message consumer for the Span data and pushing it into a {43/} {1213/}.","2398":"This application","2399":"will listen for the Span data on whatever transport you provide via a {9/} {1214/} (eg include {1215/} for RabbitMQ, and similar starters exist for Redis and {40/}).","2400":"If you add the following UI dependency","2401":"Then you’ll have your app a\n{43/} server, which hosts\nthe UI and api on port 9411.","2402":"The default {1216/} is in-memory (good for demos and getting started quickly).","2403":"For a more robust solution you can add MySQL and {1217/} to your classpath and enable the JDBC {1218/} via configuration, eg:","2404":"Note","2405":"\nThe {1219/} is also annotated with\n{1220/} so the process will also expose the standard\n{43/} server endpoints for collecting {30/} over HTTP, and for\nquerying in the {43/} Web UI.\n","2406":"Custom Consumer","2407":"A custom consumer can also easily be implemented using {1221/} and binding to the {1222/}.","2408":"Example:","2409":"Note","2410":"\nthe sample consumer application above explicitly excludes\n{1223/} so it doesn’t send messages to itself,\nbut this is optional (you might actually want to trace requests into\nthe consumer app).\n","2411":"Metrics","2412":"Currently {6/} registers very simple metrics related to {30/}.","2413":"It's using the {15/}'s metrics support to calculate the number of accepted and dropped {30/}.","2414":"Each time a span gets sent to {43/} the number of accepted {30/} will increase.","2415":"If there's an error then the number of dropped {30/} will get increased.","2416":"Integrations","2417":"Runnable and Callable","2418":"If you’re wrapping your logic in {1224/} or {1225/} it’s enough to wrap those classes in their Sleuth representative.","2419":"Example for {1226/}:","2420":"Example for {1227/}:","2421":"That way you will ensure that a new Span is created and closed for each execution.","2423":"Custom Concurrency Strategy","2424":"We're registering a custom that wraps all {1228/} instances into their Sleuth representative - the {1229/}.","2425":"The strategy either starts or continues a span depending on the fact whether tracing was already going on before the {22/} command was called.","2426":"To disable the custom {22/} Concurrency Strategy set the {1230/} to {1231/}.","2427":"Manual Command setting","2428":"Assuming that you have the following {1232/}:","2429":"In order to pass the tracing information you have to wrap the same logic in the Sleuth version of the {1233/} which is the\n{1234/}:","2430":"RxJava","2431":"We're registering a custom that wraps all {1235/} instances into their Sleuth representative - the {1236/}.","2432":"The hook either starts or continues a span depending on the fact whether tracing was already going on before the Action was scheduled.","2433":"To disable the custom RxJavaSchedulersHook set the {1237/} to {1238/}.","2434":"You can define a list of regular expressions for thread names, for which you don't want a Span to be created.","2435":"Just provide a comma separated list of regular expressions in the {1239/} property.","2436":"HTTP integration","2437":"Features from this section can be disabled by providing the {1240/} property with value equal to {1241/}.","2438":"HTTP Filter","2439":"Via the {1242/} all sampled incoming requests result in creation of a Span.","2440":"That Span's name is {1243/} + the path to which the request was sent.","2441":"Eg if the request was sent to {1244/} then the name will be {1245/}.","2442":"You can configure which URIs you would like to skip via the {1246/} property.","2443":"If you have {1247/} on classpath then its value of {1248/} gets appended to the provided skip pattern.","2444":"HandlerInterceptor","2445":"Since we want the span names to be precise we're using a {1249/} that either wraps an existing {1250/} or is added directly to the list of existing {1251/}.","2446":"The {1252/} adds a special request attribute to the given {1253/}.","2447":"If the the {1254/} doesn't see this attribute set it will create a \"fallback\" span which is an additional span created on the server side so that the trace is presented properly in the UI.","2448":"Seeing that most likely signifies that there is a missing instrumentation.","2449":"In that case please file an issue in {6/}.","2450":"Async Servlet support","2451":"If your controller returns a {1255/} or a {1256/} {6/} will continue the existing span instead of creating a new one.","2452":"HTTP client integration","2453":"Synchronous Rest Template","2454":"We're injecting a {1257/} interceptor that ensures that all the tracing information is passed to the requests.","2455":"Each time a call is made a new Span is created.","2456":"It gets closed upon receiving the response.","2457":"In order to block the synchronous {1258/} features just set {1259/} to {1260/}.","2458":"Important","2459":"You have to register {1261/} as a bean so that the interceptors will get injected.","2460":"If you create a {1262/} instance with a {1263/} keyword then the instrumentation WILL NOT work.","2461":"Asynchronous Rest Template","2462":"Important","2463":"A traced version of an {1264/} bean is registered for you out of the box.","2464":"If you have your own bean you have to wrap it in a {1265/} representation.","2465":"The best solution is to only customize the {1266/} and / or {1267/}.","2466":"If you have your own {1268/} and you don't wrap it your calls WILL NOT GET TRACED .","2467":"Custom instrumentation is set to create and close Spans upon sending and receiving requests.","2468":"You can customize the {1269/} and the {1270/} by registering your beans.","2469":"Remember to use tracing compatible implementations (eg don't forget to wrap {1271/} in a {1272/}).","2470":"Example of custom request factories:","2471":"To block the {1273/} features set {1274/} to {1275/}.","2472":"To disable creation of the default {1276/} set {1277/} to {1278/}.","2473":"If you don't want to create {1279/} at all set {1280/} to {1281/}.","2475":"By default {6/} provides integration with feign via the {1282/}.","2476":"You can disable it entirely by setting {1283/} to false.","2477":"If you do so then no {29/} related instrumentation will take place.","2478":"Part of {29/} instrumentation is done via a {1284/}.","2479":"You can disable it by providing the {1285/} equal to {1286/}.","2480":"If you set it like this then {6/} will not instrument any of your custom {29/} components.","2481":"All the default instrumentation however will be still there.","2482":"Asynchronous communication","2483":"@Async annotated methods","2484":"In {6/} we're instrumenting async related components so that the tracing information is passed between threads.","2485":"You can disable this behaviour by setting the value of {1287/} to {1288/}.","2486":"If you annotate your method with {1289/} then we’ll automatically create a new Span with the following characteristics:","2487":"the Span name will be the annotated method name","2488":"the Span will be tagged with that method’s class name and the method name too","2489":"@Scheduled annotated methods","2490":"In {6/} we're instrumenting scheduled method execution so that the tracing information is passed between threads.","2491":"You can disable this behaviour by setting the value of {1290/} to {1291/}.","2492":"If you annotate your method with {1292/} then we’ll automatically create a new Span with the following characteristics:","2493":"the Span name will be the annotated method name","2494":"the Span will be tagged with that method’s class name and the method name too","2495":"If you want to skip Span creation for some {1293/} annotated classes you can set the\n{1294/} with a regular expression that will match the fully qualified name of the\n{1295/} annotated class.","2496":"Tip","2497":"If you are using {1296/} and {1297/} together, Span will be created for each {22/} metrics and sent to {43/}.","2498":"This may be annoying.","2499":"You can prevent this by setting {1298/}","2500":"Executor, ExecutorService and ScheduledExecutorService","2501":"We're providing {1299/}, {1300/} and {1301/}.","2502":"Those implementations are creating Spans each time a new task is submitted, invoked or scheduled.","2503":"Here you can see an example of how to pass tracing information with {1302/} when working with {1303/}:","2504":"Messaging","2505":"{6/} integrates with {8/} .","2506":"It creates {30/} for publish and subscribe events.","2507":"To disable {8/} instrumentation, set {1304/} to false.","2508":"{6/} up till version 1.0.4 is sending invalid tracing headers when using messaging.","2509":"Those headers are actually the same as the ones sent in HTTP (they contain a {1305/}) in its name.","2510":"For the sake of backwards compatibility in 1.0.4 we've started sending both valid and invalid headers.","2511":"Please upgrade to 1.0.4 because in {6/} 1.1 we will remove the support for the deprecated headers.","2512":"Since 1.0.4 you can provide the {1306/} pattern to explicitly provide the names of channels that you want to include for tracing.","2513":"By default all channels are included.","2515":"We're registering {39/} filters to propagate the tracing information (the request header is enriched with tracing data).","2516":"To disable {39/} support set the {1307/} property to {1308/}.","2517":"Running examples","2518":"You can find the running examples deployed in the Pivotal Web Services .","2519":"Check them out in the following links:","2520":"{43/} for apps presented in the samples to the top","2521":"{43/} for Brewery on PWS, its Github Code","2523":"This project provides {36/} integrations for {15/} apps through autoconfiguration and binding to the {45/} Environment and other {45/} programming model idioms.","2524":"With a few simple annotations you can quickly enable and configure the common patterns inside your application and build large distributed systems with {36/} based components.","2525":"The patterns provided include Service Discovery, Control Bus and Configuration.","2526":"Intelligent Routing ({39/}) and Client Side Load Balancing ({41/}), Circuit Breaker ({22/}) are provided by integration with {11/} Netflix.","2527":"Install {36/}","2528":"Please see the installation documentation for instructions on how to install {36/}.","2529":"{36/} Agent","2530":"A {36/} Agent client must be available to all {11/} {36/} applications.","2531":"By default, the Agent client is expected to be at {1309/}.","2532":"See the Agent documentation for specifics on how to start an Agent client and how to connect to a cluster of {36/} Agent Servers.","2533":"For development, after you have installed {44/}, you may start a {36/} Agent using the following command:","2534":"This will start an agent in server mode on port 8500, with the ui available at http://localhost:8500","2535":"Service Discovery with {36/}","2536":"Service Discovery is one of the key tenets of a microservice based architecture.","2537":"Trying to hand configure each client or some form of convention can be very difficult to do and can be very brittle.","2538":"{36/} provides Service Discovery services via an HTTP API and DNS .","2539":"{11/} {36/} leverages the HTTP API for service registration and discovery.","2540":"This does not prevent non-{11/} applications from leveraging the DNS interface.","2541":"{36/} Agents servers are run in a cluster that communicates via a gossip protocol and uses the Raft consensus protocol .","2542":"Registering with {36/}","2543":"When a client registers with {36/}, it provides meta-data about itself such as host and port, id, name and tags.","2544":"An HTTP Check is created by default that {36/} hits the {1310/} endpoint every 10 seconds.","2545":"If the health check fails, the service instance is marked as critical.","2546":"Example {36/} client:","2547":"(ie utterly normal {15/} app).","2548":"If the {36/} client is located somewhere other than {1311/}, the configuration is required to locate the client.","2549":"Example:","2550":"application.yml","2551":"Caution","2552":"\nIf you use {11/} {36/} Config, the above values will need to be placed in {1312/} instead of {1313/}.\n","2553":"The default service name, instance id and port, taken from the {1314/}, are {1315/}, the {45/} Context ID and {1316/} respectively.","2554":"{1317/} make the app into both a {36/} \"service\" (i.e. it registers itself) and a \"client\" (i.e. it can query {36/} to locate other services).","2555":"HTTP Health Check","2556":"The health check for a {36/} instance defaults to \"/health\", which is the default locations of a useful endpoint in a {3/} application.","2557":"You need to change these, even for an Actuator application if you use a non-default context path or servlet path (eg {1318/}) or management endpoint path (eg {1319/}).","2558":"The interval that {36/} uses to check the health endpoint may also be configured.","2559":"\"10s\" and \"1m\" represent 10 seconds and 1 minute respectively.","2560":"Example:","2561":"application.yml","2562":"Metadata and {36/} tags","2563":"{36/} does not yet support metadata on services.","2564":"{11/}'s {1320/} has a {1321/} field.","2565":"{11/} {36/} uses {36/} tags to approximate metadata until {36/} officially supports metadata.","2566":"Tags with the form {1322/} will be split and used as a {1323/} key and value respectively.","2567":"Tags without the equal {1324/} sign, will be used as both the key and value.","2568":"application.yml","2569":"The above configuration will result in a map with {1325/} and {1326/}.","2570":"Making the {36/} Instance ID Unique","2571":"By default a {44/} instance is registered with an ID that is equal to its {45/} Application Context ID.","2572":"By default, the {45/} Application Context ID is {1327/}.","2573":"For most cases, this will allow multiple instances of one service to run on one machine.","2574":"If further uniqueness is required, Using {11/} you can override this by providing a unique identifier in {1328/}.","2575":"For example:","2576":"application.yml","2577":"With this metadata, and multiple service instances deployed on localhost, the random value will kick in there to make the instance unique.","2578":"In Cloudfoundry the {1329/} will be populated automatically in a {3/} application, so the random value will not be needed.","2579":"Using the DiscoveryClient","2580":"{11/} has support for {29/} (a REST client builder) and also {45/} {1330/} using the logical service names instead of physical URLs.","2581":"You can also use the {1331/} which provides a simple API for discovery clients that is not specific to Netflix, e.g.","2582":"Distributed Configuration with {36/}","2583":"{36/} provides a Key/Value Store for storing configuration and other metadata.","2584":"{11/} {36/} Config is an alternative to the Config Server and Client .","2585":"Configuration is loaded into the {45/} Environment during the special \"bootstrap\" phase.","2586":"Configuration is stored in the {1332/} folder by default.","2587":"Multiple {1333/} instances are created based on the application's name and the active profiles that mimicks the {7/} order of resolving properties.","2588":"For example, an application with the name \"testApp\" and with the \"dev\" profile will have the following property sources created:","2589":"The most specific property source is at the top, with the least specific at the bottom.","2590":"{16/} is the {1334/} folder are applicable to all applications using {44/} for configuration.","2591":"{16/} in the {1335/} folder are only available to the instances of the service named \"testApp\".","2592":"Configuration is currently read on startup of the application.","2593":"Sending a HTTP POST to {1336/} will cause the configuration to be reloaded.","2594":"Watching the key value store (which {36/} supports) is not currently possible, but will be a future addition to this project.","2595":"How to activate","2596":"Including a dependency on {1337/} will enable auto-configuration that will setup {11/} {36/} Config.","2597":"Customizing","2598":"{36/} Config may be customized using the following properties:","2599":"bootstrap.yml","2600":"{1338/} setting this value to \"false\" disables {36/} Config","2601":"{1339/} sets the base folder for configuration values","2602":"{1340/} sets the folder name used by all applications","2603":"{1341/} sets the value of the separator used to separate the profile name in property sources with profiles","2604":"YAML or {16/} with Config","2605":"It may be more convenient to store a blob of properties in YAML or {16/} format as opposed to individual key/value pairs.","2606":"Set the {1342/} property to {1343/} or {1344/}.","2607":"For example to use YAML:","2608":"bootstrap.yml","2609":"YAML must be set in the appropriate {1345/} key in {44/}.","2610":"Using the defaults above the keys would look like:","2611":"You could store a YAML document in any of the keys listed above.","2612":"You can change the data key using {1346/}.","2613":"git2consul with Config","2614":"git2consul is a {36/} community project that loads files from a git repository to individual keys into {36/}.","2615":"By default the names of the keys are names of the files.","2616":"YAML and {16/} files are supported with file extensions of {1347/} and {1348/} respectively.","2617":"Set the {1349/} property to {1350/}.","2618":"For example:","2619":"bootstrap.yml","2620":"Given the following keys in {1351/}, the {1352/} profile and an application name of {1353/}:","2621":"the following property sources would be created:","2622":"The value of each key needs to be a properly formatted YAML or {16/} file.","2623":"Fail Fast","2624":"It may be convenient in certain circumstances (like local development or certain test scenarios) to not fail if {44/} isn't available for configuration.","2625":"Setting {1354/} in {1355/} will cause the configuration module to log a warning rather than throw an exception.","2626":"This will allow the application to continue startup normally.","2627":"{36/} Retry","2628":"If you expect that the {44/} agent may occasionally be unavailable when your app starts, you can ask it to keep trying after a failure.","2629":"You need to add {1356/} and {1357/} to your classpath.","2630":"The default behaviour is to retry 6 times with an initial backoff interval of 1000ms and an exponential multiplier of 1.1 for subsequent backoffs.","2631":"You can configure these properties (and others) using {1358/} configuration properties.","2632":"This works with both {11/} {36/} Config and Discovery registration.","2633":"Tip","2634":"To take full control of the retry add a {1359/} of type {1360/} with id \"consulRetryInterceptor\".","2635":"{45/} Retry has a {1361/} that makes it easy to create one.","2636":"{5/} with {36/}","2637":"Coming in a later release.","2638":"Circuit Breaker with {22/}","2639":"Applications can use the {22/} Circuit Breaker provided by the {11/} Netflix project by including this starter in the projects pom.xml: {1362/}.","2640":"{22/} doesn't depend on the Netflix Discovery Client.","2641":"The {1363/} annotation should be placed on a configuration class (usually the main class).","2642":"Then methods can be annotated with {1364/} to be protected by a circuit breaker.","2643":"See the documentation for more details.","2644":"{22/} metrics aggregation with {12/} and {36/}","2645":"{12/} (provided by the {11/} Netflix project), aggregates multiple instances {22/} metrics streams, so the dashboard can display an aggregate view.","2646":"{12/} uses the {1365/} interface to lookup relevant instances.","2647":"To use {12/} with {11/} {36/}, configure the {12/} application in a manner similar to the following examples:","2648":"pom.xml","2649":"Notice that the {12/} dependency is not a starter.","2650":"The turbine starter includes support for Netflix {42/}.","2651":"application.yml","2652":"The {1366/} and {1367/} sections must match, so it’s useful to put the comma-separated list of service ID’s into a separate configuration property.","2653":"{12/}.java","2655":"This project provides {18/} integrations for {15/} apps through autoconfiguration and binding to the {45/} Environment and other {45/} programming model idioms.","2656":"With a few simple annotations you can quickly enable and configure the common patterns inside your application and build large distributed systems with {18/} based components.","2657":"The patterns provided include Service Discovery and Configuration.","2658":"Intelligent Routing ({39/}) and Client Side Load Balancing ({41/}), Circuit Breaker ({22/}) are provided by integration with {11/} Netflix.","2659":"Install {18/}","2660":"Please see the installation documentation for instructions on how to install {18/}.","2661":"Service Discovery with {18/}","2662":"Service Discovery is one of the key tenets of a microservice based architecture.","2663":"Trying to hand configure each client or some form of convention can be very difficult to do and can be very brittle.","2664":"Curator (A java library for {18/}) provides Service Discovery services via Service Discovery Extension .","2665":"{11/} {18/} leverages this extension for service registration and discovery.","2666":"How to activate","2667":"Including a dependency on {1368/} will enable auto-configuration that will setup {11/} {18/} Discovery.","2668":"Registering with {18/}","2669":"When a client registers with {18/}, it provides meta-data about itself such as host and port, id and name.","2670":"Example {18/} client:","2671":"(ie utterly normal {15/} app).","2672":"If {18/} is located somewhere other than {1369/}, the configuration is required to locate the server.","2673":"Example:","2674":"application.yml","2675":"Caution","2676":"\nIf you use {11/} {18/} Config, the above values will need to be placed in {1370/} instead of {1371/}.\n","2677":"The default service name, instance id and port, taken from the {1372/}, are {1373/}, the {45/} Context ID and {1374/} respectively.","2678":"{1375/} makes the app into both a {18/} \"service\" (i.e. it registers itself) and a \"client\" (i.e. it can query {18/} to locate other services).","2679":"Using the DiscoveryClient","2680":"{11/} has support for {29/} (a REST client builder) and also {45/} {1376/} using the logical service names instead of physical URLs.","2681":"You can also use the {1377/} which provides a simple API for discovery clients that is not specific to Netflix, e.g.","2682":"{18/} Dependencies","2683":"Using the {18/} Dependencies","2684":"{11/} {18/} gives you a possibility to provide dependencies of your application as properties.","2685":"As dependencies you can understand other applications that are registered in {18/} and which you would like to call via {29/} (a REST client builder) and also {45/} {1378/} .","2686":"You can also benefit from the {18/} Dependency Watchers functionality that lets you control and monitor what is the state of your dependencies and decide what to do with that.","2687":"How to activate {18/} Dependencies","2688":"Including a dependency on {1379/} will enable auto-configuration that will setup {11/} {18/} Dependencies.","2689":"If you have to have the {1380/} section properly set up - check the subsequent section for more details then the feature is active","2690":"You can have the dependencies turned off even if you've provided the dependencies in your properties.","2691":"Just set the property {1381/} to false (defaults to {1382/}).","2692":"Setting up {18/} Dependencies","2693":"Let’s take a closer look at an example of dependencies representation:","2694":"application.yml","2695":"Let's now go through each part of the dependency one by one.","2696":"The root property name is {1383/}.","2697":"Aliases","2698":"Below the root property you have to represent each dependency has by an alias due to the constraints of {41/} (the application id has to be placed in the URL thus you can't pass any complex path like /foo/bar/name).","2699":"The alias will be the name that you will use instead of serviceId for {1384/}, {1385/} or {1386/}.","2700":"In the aforementioned examples the aliases are {1387/} and {1388/}.","2701":"Example of {29/} usage with {1389/} would be:","2702":"Path","2703":"Represented by {1390/} yaml property.","2704":"Path is the path under which the dependency is registered under {18/}.","2705":"Like presented before {41/} operates on URLs thus this path is not compliant with its requirement.","2706":"That is why {11/} {18/} maps the alias to the proper path.","2707":"Load balancer type","2708":"Represented by {1391/} yaml property.","2709":"If you know what kind of load balancing strategy has to be applied when calling this particular dependency then you can provide it in the yaml file and it will be automatically applied.","2710":"You can choose one of the following load balancing strategies","2711":"STICKY - once chosen the instance will always be called","2712":"RANDOM - picks an instance randomly","2713":"ROUND_ROBIN - iterates over instances over and over again","2714":"Content-Type template and version","2715":"Represented by {1392/} and {1393/} yaml property.","2716":"If you version your api via the {1394/} header then you don't want to add this header to each of your requests.","2717":"Also if you want to call a new version of the API you don't want to roam around your code to bump up the API version.","2718":"That's why you can provide a {1395/} with a special {1396/} placeholder.","2719":"That placeholder will be filled by the value of the {1397/} yaml property.","2720":"Let's take a look at an example.","2721":"Having the following {1398/}:","2722":"and the following {1399/}:","2723":"Will result in setting up of a {1400/} header for each request:","2724":"Default headers","2725":"Represented by {1401/} map in yaml","2726":"Sometimes each call to a dependency requires setting up of some default headers.","2727":"In order not to do that in code you can set them up in the yaml file.","2728":"Having the following {1402/} section:","2729":"Results in adding the {1403/} and {1404/} headers with appropriate list of values in your HTTP request.","2730":"Obligatory dependencies","2731":"Represented by {1405/} property in yaml","2732":"If one of your dependencies is required to be up and running when your application is booting then it’s enough to set up the {1406/} property in the yaml file.","2733":"If your application can't localize the required dependency during boot time it will throw an exception and the {45/} Context will fail to set up.","2734":"In other words your application won't be able to start if the required dependency is not registered in {18/}.","2735":"You can read more about {11/} {18/} Presence Checker in the following sections.","2736":"Stubs","2737":"You can provide a colon separated path to the JAR containing stubs of the dependency.","2738":"Example","2739":"means that for a particular dependencies can be found under:","2740":"groupId: {1407/}","2741":"artifactId: {1408/}","2742":"classifier: {1409/} - this is the default value","2743":"This is actually equal to","2744":"since {1410/} is the default classifier.","2745":"Configuring {11/} {18/} Dependencies","2746":"There is a bunch of properties that you can set to enable / disable parts of {18/} Dependencies functionalities.","2747":"{1411/} - if you don’t set this property you won’t benefit from {18/} Dependencies","2748":"{1412/} (enabled by default) - {41/} requires explicit global configuration or a particular one for a dependency.","2749":"By turning on this property runtime load balancing strategy resolution is possible and you can profit from the {1413/} section of the {18/} Dependencies.","2750":"The configuration that needs this property has an implementation of {1414/} that delegates to the {1415/} presented in the next bullet","2751":"{1416/} (enabled by default) - thanks to this property the custom {1417/} knows that the part of the URI passed to {41/} might actually be the alias that has to be resolved to a proper path in {18/}.","2752":"Without this property you won't be able to register applications under nested paths.","2753":"{1418/} (enabled by default) - this property registers such a {1419/} that automatically will append appropriate headers and content types with version as presented in the Dependency configuration.","2754":"Without this setting of those two parameters will not be operational.","2755":"{1420/} (enabled by default) - when enabled will modify the request headers of {1421/} annotated {1422/} so that it passes headers and content type with version set in Dependency configuration.","2756":"Wihtout this setting of those two parameters will not be operational.","2757":"{11/} {18/} Dependency Watcher","2758":"The Dependency Watcher mechanism allows you to register listeners to your dependencies.","2759":"The functionality is in fact an implementation of the {1423/} pattern.","2760":"When a dependency changes its state (UP or DOWN) then some custom logic can be applied.","2761":"How to activate","2762":"{11/} {18/} Dependencies functionality needs to be enabled to profit from Dependency Watcher mechanism.","2763":"Registering a listener","2764":"In order to register a listener you have to implement an interface {1424/} and register it as a bean.","2765":"The interface gives you one method:","2766":"If you want to register a listener for a particular dependency then the {1425/} would be the discriminator for your concrete implementation.","2767":"{1426/} will provide you with information whether your dependency has changed to {1427/} or {1428/}.","2768":"Presence Checker","2769":"Bound with Dependency Watcher is the functionality called Presence Checker.","2770":"It allows you to provide custom behaviour upon booting of your application to react accordingly to the state of your dependencies.","2771":"The default implementation of the abstract {1429/} class is the\n{1430/} which works in the following way.","2772":"If the dependency is marked us {1431/} and it’s not in {18/} then upon booting your application will throw an exception and shutdown","2773":"If dependency is not {1432/} the {1433/} will log that application is missing at {1434/} level","2774":"The functionality can be overriden since the {1435/} is registered only when there is no bean of {1436/}.","2775":"Distributed Configuration with {18/}","2776":"{18/} provides a hierarchical namespace that allows clients to store arbitrary data, such as configuration data.","2777":"{11/} {18/} Config is an alternative to the Config Server and Client .","2778":"Configuration is loaded into the {45/} Environment during the special \"bootstrap\" phase.","2779":"Configuration is stored in the {1437/} namespace by default.","2780":"Multiple {1438/} instances are created based on the application's name and the active profiles that mimicks the {7/} order of resolving properties.","2781":"For example, an application with the name \"testApp\" and with the \"dev\" profile will have the following property sources created:","2782":"The most specific property source is at the top, with the least specific at the bottom.","2783":"{16/} is the {1439/} namespace are applicable to all applications using zookeeper for configuration.","2784":"{16/} in the {1440/} namespace are only available to the instances of the service named \"testApp\".","2785":"Configuration is currently read on startup of the application.","2786":"Sending a HTTP POST to {1441/} will cause the configuration to be reloaded.","2787":"Watching the configuration namespace (which {18/} supports) is not currently implemented, but will be a future addition to this project.","2788":"How to activate","2789":"Including a dependency on {1442/} will enable auto-configuration that will setup {11/} {18/} Config.","2790":"Customizing","2791":"{18/} Config may be customized using the following properties:","2792":"bootstrap.yml","2793":"{1443/} setting this value to \"false\" disables {18/} Config","2794":"{1444/} sets the base namespace for configuration values","2795":"{1445/} sets the name used by all applications","2796":"{1446/} sets the value of the separator used to separate the profile name in property sources with profiles","2798":"{15/} CLI provides {45/} Boot command line features for {45/} Cloud .","2799":"You can write Groovy scripts to run {11/} component applications (eg {1447/}).","2800":"You can also easily do things like encryption and decryption to support {7/} clients with secret configuration values.","2801":"With the Launcher CLI you can launch services like {42/}, {43/}, Config Server conveniently all at once from the command line (very useful at development time).","2802":"Installation","2803":"To install, make\nsure you have\n{15/} CLI\n(1.4.1 or better):","2804":"E.g. for SDKMan users","2805":"and install the {11/} plugin","2806":"Important","2807":"Prerequisites: to use the encryption and decryption features you need the full-strength JCE installed in your JVM (it's not there by default).","2808":"You can download the \"Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files\" from Oracle, and follow instructions for installation (essentially replace the 2 policy files in the JRE lib/security directory with the ones that you downloaded).","2809":"Running {11/} Services in Development","2810":"The Launcher CLI can be used to run common services like {42/}, Config Server etc. from the command line.","2811":"To list the available services you can do {1448/}, and to launch a default set of services just {1449/}.","2812":"To choose the services to deploy, just list them on the command line, eg","2813":"Summary of supported deployables:","2814":"Service","2815":"Name","2816":"Address","2817":"Description","2818":"{42/} server for service registration and discovery.","2819":"All the other services show up in its catalog by default.","2820":"{7/} Server running in the \"native\" profile and serving configuration from the local directory ./launcher","2821":"Relation database service.","2822":"Use a file path for {1450/} (eg {1451/}) when you connect.","2823":"Remember that you can add {1452/} or {1453/} to connect with compatibility to other server types.","2824":"Any {11/} app that declares {22/} circuit breakers publishes metrics on {1454/}.","2825":"Type that address into the dashboard to visualize all the metrics,","2826":"{11/} Dataflow server with UI at /admin-ui.","2827":"Connect the Dataflow shell to target at root path.","2828":"{43/} Server with UI for visualizing traces.","2829":"Stores span data in memory and accepts them via HTTP POST of JSON data.","2830":"Each of these apps can be configured using a local YAML file with the same name (in the current working directory or a subdirectory called \"config\" or in {1455/}).","2831":"Eg in {1456/} you might want to do something like this to locate a local git repository for the backend:","2832":"configserver.yml","2833":"Adding Additional Applications","2834":"Additional applications can be added to {1457/} (not\n{1458/} because that would replace the defaults), e.g. with","2835":"config/cloud.yml","2836":"when you list the apps:","2837":"(notice the additional apps at the start of the list).","2838":"Writing Groovy Scripts and Running Applications","2839":"{11/} CLI has support for most of the {11/} declarative features, such as the {1459/} class of annotations.","2840":"For example, here is a fully functional {42/} server","2841":"app.groovy","2842":"which you can run from the command line like this","2843":"To include additional dependencies, often it suffices just to add the appropriate feature-enabling annotation, eg {1460/}, {1461/} or {1462/}.","2844":"To manually include a dependency you can use a {1463/} with the special \"{15/}\" short style artifact co-ordinates, ie with just the artifact ID (no need for group or version information), eg to set up a client app to listen on AMQP for management events from the {45/} CLoud Bus:","2845":"app.groovy","2846":"Encryption and Decryption","2847":"The {11/} CLI comes with an \"encrypt\" and a \"decrypt\" command.","2848":"Both accept arguments in the same form with a key specified as a mandatory \"--key\", eg","2849":"To use a key in a file (e.g. an RSA public key for encyption) prepend\nthe key value with \"@\" and provide the file path, e.g.","2851":"{2/} offers a set of primitives for building secure applications and services with minimum fuss.","2852":"A declarative model which can be heavily configured externally (or centrally) lends itself to the implementation of large systems of co-operating, remote components, usually with a central indentity management service.","2853":"It is also extremely easy to use in a service platform like Cloud Foundry.","2854":"Building on {15/} and {45/} Security OAuth2 we can quickly create systems that implement common patterns like single sign on, token relay and token exchange.","2855":"Quickstart","2856":"OAuth2 Single Sign On","2857":"Here’s a {11/} \"Hello World\" app with HTTP Basic\nauthentication and a single user account:","2858":"app.groovy","2859":"You can run it with {1464/} and watch the logs for the password (username is \"user\").","2860":"So far this is just the default for a {15/} app.","2861":"Here’s a {11/} app with OAuth2 SSO:","2862":"app.groovy","2863":"Spot the difference?","2864":"This app will actually behave exactly the same as the previous one, because it doesn't know it's OAuth2 credentals yet.","2865":"You can register an app in github quite easily, so try that if you want a production app on your own domain.","2866":"If you are happy to test on localhost:8080, then set up these properties in your application configuration:","2867":"application.yml","2868":"run the app above and it will redirect to github for authorization.","2869":"If you are already signed into github you won't even notice that it has authenticated.","2870":"These credentials will only work if your app is running on port 8080.","2871":"To limit the scope that the client asks for when it obtains an access token you can set {1465/} (comma separated or an array in YAML).","2872":"By default the scope is empty and it is up to to Authorization Server to decide what the defaults should be, usually depending on the settings in the client registration that it holds.","2873":"Note","2874":"The examples above are all Groovy scripts.","2875":"If you want to write the same code in Java (or Groovy) you need to add {45/} Security OAuth2 to the classpath (eg see the sample here ).","2876":"OAuth2 Protected Resource","2877":"You want to protect an API resource with an OAuth2 token?","2878":"Here's a simple example (paired with the client above):","2879":"app.groovy","2880":"and","2881":"application.yml","2882":"More Detail","2883":"Single Sign On","2884":"Note","2885":"All of the OAuth2 SSO and resource server features moved to {15/} in version 1.3.","2886":"You can find documentation in the {15/} user guide .","2887":"Token Relay","2888":"A Token Relay is where an OAuth2 consumer acts as a Client and forwards the incoming token to outgoing resource requests.","2889":"The consumer can be a pure Client (like an SSO application) or a Resource Server.","2890":"Client Token Relay","2891":"If your app is a user facing OAuth2 client (ie has declared {1466/} or {1467/}) then it has an {1468/} in request scope from {15/}.","2892":"You can create your own {1469/} from this context and an autowired {1470/}, and then the context will always forward the access token downstream, also refreshing the access token automatically if it expires.","2893":"(These are features of {45/} Security and {15/}.)","2894":"Note","2895":"{15/} (1.4.1) does not create an {1471/} automatically if you are using {1472/} tokens.","2896":"In that case you need to create your own {1473/} and configure it with {1474/}.","2897":"Client Token Relay in {39/} Proxy","2898":"If your app also has a {45/} Cloud {39/} embedded reverse proxy (using {1475/}) then you can ask it to forward OAuth2 access tokens downstream to the services it is proxying.","2899":"Thus the SSO app above can be enhanced simply like this:","2900":"app.groovy","2901":"and it will (in addition to logging the user in and grabbing a token) pass the authentication token downstream to the {1476/} services.","2902":"If those services are implemented with {1477/} then they will get a valid token in the correct header.","2903":"How does it work?","2904":"The {1478/} annotation pulls in {1479/} (which you could do manually in a traditional app), and that in turn triggers some autoconfiguration for a {1480/}, which itself is activated because {39/} is on the classpath (via {1481/}).","2905":"The filter just extracts an access token from the currently authenticated user, and puts it in a request header for the downstream requests.","2906":"Resource Server Token Relay","2907":"If your app has {1482/} you might want to relay the incoming token downstream to other services.","2908":"If you use a {1483/} to contact the downstream services then this is just a matter of how to create the template with the right context.","2909":"If your service uses {1484/} to authenticate incoming tokens (ie it is using the {1485/} configuration), then you can simply create an {1486/} using an autowired {1487/} (it will be populated by the authentication process before it hits the backend code).","2910":"Equivalently (with {15/} 1.4), you could inject a {1488/} and grab its {1489/} in your configuration.","2911":"For example:","2912":"MyConfiguration.java","2913":"This rest template will then have the same {1490/}\n(request-scoped) that is used by the authentication filter, so you can\nuse it to send requests with the same access token.","2914":"If your app is not using {1491/} but is still a client (ie it declares {1492/} or {1493/}), then with {45/} Security Cloud any {1494/} that the user creates from an {1495/} {1496/} will also forward tokens.","2915":"This feature is implemented by default as an MVC handler interceptor, so it only works in {45/} MVC.","2916":"If you are not using MVC you could use a custom filter or AOP interceptor wrapping an {1497/} to provide the same feature.","2917":"Here’s a basic\nexample showing the use of an autowired rest template created\nelsewhere (\"foo.com\" is a Resource Server accepting the same tokens as\nthe surrounding app):","2918":"MyController.java","2919":"If you don’t want to forward tokens (and that is a valid\nchoice, since you might want to act as yourself, rather than the\nclient that sent you the token), then you only need to create your own\n{1498/} instead of autowiring the default one.","2920":"{29/} clients will also pick up an interceptor that uses the\n{1499/} if it is available, so they should also do a\ntoken relay anywhere where a {1500/} would.","2921":"Configuring Authentication Downstream of a {39/} Proxy","2922":"You can control the authorization behaviour downstream of an {1501/} through the {1502/} settings.","2923":"Example:","2924":"application.yml","2925":"In this example the \"customers\" service gets an OAuth2 token relay, the \"stores\" service gets a passthrough (the authorization header is just passed downstream), and the \"recommendations\" service has its authorization header removed.","2926":"The default behaviour is to do a token relay if there is a token available, and passthru otherwise.","2927":"See\n\nProxyAuthenticationProperties for full details.","2929":"{11/} for Cloudfoundry makes it easy to run {11/} apps in Cloud Foundry (the Platform as a Service).","2930":"Cloud Foundry has the notion of a \"service\", which is middlware that you \"bind\" to an app, essentially providing it with an environment variable containing credentials (eg the location and username to use for the service).","2931":"The {1503/} project provides basic support for\nsome enhanced features of webapps in Cloud Foundry: binding\nautomatically to single-sign-on services and optionally enabling\nsticky routing for discovery.","2932":"The {1504/} project provides an\nimplementation of {4/} {1505/} so you can\n{1506/} and provide your credentials as\n{1507/} and then you\ncan use the {1508/} directly or via a {1509/}\n(also {1510/} if you are not connecting to\nPivotal Web Services).","2933":"The first time you use it the discovery client might be slow owing to\nthe fact that it has to get an access token from Cloud Foundry.","2934":"Discovery","2935":"Here’s a {11/} app with Cloud Foundry discovery:","2936":"app.groovy","2937":"If you run it without any service bindings:","2938":"It will show its app name in the home page.","2939":"The {1511/} can lists all the apps in a space, according to the credentials it is authenticated with, where the space defaults to the one the client is running in (if any).","2940":"If neither org nor space are configured, they default per the user's profile in Cloud Foundry.","2941":"Single Sign On","2942":"Note","2943":"All of the OAuth2 SSO and resource server features moved to {15/} in version 1.3.","2944":"You can find documentation in the {15/} user guide .","2945":"This project provides automatic binding from CloudFoundry service credentials to the {15/} features.","2946":"If you have a CloudFoundry service called \"sso\", for instance, with credentials containing \"client_id\", \"client_secret\" and \"auth_domain\", it will bind automatically to the {45/} OAuth2 client that you enable with {1512/} (from {15/}).","2947":"The name of the service can be parameterized using {1513/}.","2948":"{11/} Cluster","2949":"{11/} Cluster offers a set of primitives for building \"cluster\" features into a distributed system.","2950":"Example are leadership election, consistent storage of cluster state, global locks and one-time tokens.","2951":"{33/} Election","2952":"{33/} election allows application to work together with other applications to coordinate a cluster leadership via a third party system.","2953":"Currently we provide integrations with {1514/}, {1515/} and {1516/}.","2954":"From user perspective election is working via interfaces {1517/} and {1518/}.","2955":"{1519/} contains access to leadership's {1520/} and {1521/} and also have methods {1522/} and {1523/}.","2956":"These callback methods are useful if default {1524/} implementation is changed.","2957":"{33/} election is auto-configured if {1525/} and either {1526/}, {1527/} or {1528/} jars are found from a classpath.","2958":"In case where both jars are found leader election is created using both systems.","2959":"See sections {18/} , {25/} and {35/} for more information about a created beans.","2960":"Default {1529/} created from auto-configuration is\n{1530/} which\ncurrently only logs granted and revoked events.","2961":"If there's a need for disable all leader related auto-configuration, a {1531/} can be set to false which then allows to do manual configuration even if the jars an on a classpath.","2962":"{16/} {1532/} and {1533/} can be used to set default identifier and role.","2963":"If you are interested to simple get notification of granted and revoked events one option is to attach event listener into spring application context.","2964":"{34/} {1534/} and {1535/} are sent as spring event objects.","2965":"Simply create your own event listener class:","2966":"and then create it as a bean.","2967":"For simply log events you can also use a utility class\n{1536/} which allows easy configuration.","2969":"{1537/} implementation for zookeeper is created with a bean name\n{1538/} which can be used to override the one\ncreated during auto-configuration.","2970":"{18/} based election can be explicitly disabled using property\n{1539/}.","2971":"Other properties {1540/} and\n{1541/} can be used to set the\nzookeeper base namespace path and connect string.","2973":"{1542/} implementation for hazelcast is created with a bean name\n{1543/} which can be used to override the one\ncreated during auto-configuration.","2974":"{25/} based election can be explicitly disabled using property {1544/}.","2975":"If you want to provide xml based configuration for {25/} instance use property {1545/} to tell location of a {25/} xml configuration file.","2976":"{1546/} is a normal spring {1547/}.","2978":"{1548/} implementation for etcd is created with a bean name\n{1549/} which can be used to override the one\ncreated during auto-configuration.","2979":"{35/} based election can be explicitly disabled using property\n{1550/}.","2980":"Multiple etcd cluster uris can be specified using property\n{1551/}","2981":"Appendix: Compendium of Configuration {16/}","2982":"Name","2983":"Default","2984":"Description","2985":"Flag to say that a process should fail if there is an encryption or decryption\n error.","2986":"A symmetric key.","2987":"As a stronger alternative consider using a keystore.","2988":"Alias for a key in the store.","2989":"Location of the key store file, e.g. classpath:/keystore.jks.","2990":"Password that locks the keystore.","2991":"Secret protecting the key (defaults to the same as the password).","2992":"The RSA algorithm to use (DEFAULT or OEAP).","2993":"Once it is set do not change it (or existing ciphers will not a decryptable).","2994":"Salt for the random secret used to encrypt cipher text.","2995":"Once it is set do not change it (or existing ciphers will not a decryptable).","2996":"Flag to indicate that \"strong\" AES encryption should be used internally.","2997":"If true then the GCM algorithm is applied to the AES encrypted bytes.","2998":"Default is false (in which case \"standard\" CBC is used instead).","2999":"Once it is set do not change it (or existing ciphers will not a decryptable).","3000":"Indicates whether server can redirect a client request to a backup server/cluster.","3001":"If set to false, the server will handle the request directly, If set to true, it may send HTTP redirect to the client, with a new server location.","3002":"Gets the list of availability zones (used in AWS data centers) for the region in\n which this instance resides.\n","3003":" The changes are effective at runtime at the next registry fetch cycle as specified\n by registryFetchIntervalSeconds.","3004":"Gets the name of the implementation which implements BackupRegistry to fetch the\n registry information as a fall back option for only the first time when the eureka\n client starts.\n","3005":" This may be needed for applications which needs additional resiliency for registry\n information without which it cannot operate.","3006":"Cache refresh executor exponential back off related property.","3007":"It is a maximum multiplier value for retry delay, in case where a sequence of timeouts occurred.","3008":"The thread pool size for the cacheRefreshExecutor to initialise with","3009":"EurekaAccept name for client data accept","3010":"This is a transient config and once the latest codecs are stable, can be removed\n (as there will only be one)","3011":"Indicates whether the eureka client should disable fetching of delta and should\n rather resort to getting the full registry information.\n","3012":" Note that the delta fetches can reduce the traffic tremendously, because the rate\n of change with the eureka server is normally much lower than the rate of fetches.\n","3013":" The changes are effective at runtime at the next registry fetch cycle as specified\n by registryFetchIntervalSeconds","3014":"Get a replacement string for Dollar sign <code>$</code> during\n serializing/deserializing information in eureka server.","3015":"Flag to indicate that the {42/} client is enabled.","3016":"This is a transient config and once the latest codecs are stable, can be removed\n (as there will only be one)","3017":"Get a replacement string for underscore sign <code>_</code> during\n serializing/deserializing information in eureka server.","3018":"Indicates how much time (in seconds) that the HTTP connections to eureka server can\n stay idle before it can be closed.\n","3019":" In the AWS environment, it is recommended that the values is 30 seconds or less,\n since the firewall cleans up the connection information after a few mins leaving\n the connection hanging in limbo","3020":"Indicates how long to wait (in seconds) before a connection to eureka server needs to timeout.","3021":"Note that the connections in the client are pooled by org.apache.http.client.HttpClient and this setting affects the actual connection creation and also the wait time to get the connection from the pool.","3022":"Gets the DNS name to be queried to get the list of eureka servers.This information\n is not required if the contract returns the service urls by implementing\n serviceUrls.\n","3023":" The DNS mechanism is used when useDnsForFetchingServiceUrls is set to true and the\n eureka client expects the DNS to configured a certain way so that it can fetch\n changing eureka servers dynamically.\n","3024":" The changes are effective at runtime.","3025":"Gets the port to be used to construct the service url to contact eureka server when\n the list of eureka servers come from the DNS.This information is not required if\n the contract returns the service urls eurekaServerServiceUrls(String).\n","3026":" The DNS mechanism is used when useDnsForFetchingServiceUrls is set to true and the\n eureka client expects the DNS to configured a certain way so that it can fetch\n changing eureka servers dynamically.\n","3027":" The changes are effective at runtime.","3028":"Indicates how long to wait (in seconds) before a read from eureka server needs to\n timeout.","3029":"Gets the total number of connections that is allowed from eureka client to all\n eureka servers.","3030":"Gets the total number of connections that is allowed from eureka client to a eureka\n server host.","3031":"Gets the URL context to be used to construct the service url to contact eureka server when the list of eureka servers come from the DNS.","3032":"This information is not required if the contract returns the service urls from eurekaServerServiceUrls.","3033":"The DNS mechanism is used when useDnsForFetchingServiceUrls is set to true and the eureka client expects the DNS to configured a certain way so that it can fetch changing eureka servers dynamically.","3034":"The changes are effective at runtime.","3035":"Indicates how often(in seconds) to poll for changes to eureka server information.","3036":"{42/} servers could be added or removed and this setting controls how soon the eureka clients should know about it.","3037":"Indicates whether this client should fetch eureka registry information from eureka\n server.","3038":"Comma separated list of regions for which the eureka registry information will be fetched.","3039":"It is mandatory to define the availability zones for each of these regions as returned by availabilityZones.","3040":"Failing to do so, will result in failure of discovery client startup.","3041":"Indicates whether to get the applications after filtering the applications for\n instances with only InstanceStatus UP states.","3042":"Indicates whether the content fetched from eureka server has to be compressed whenever it is supported by the server.","3043":"The registry information from the eureka server is compressed for optimum network traffic.","3044":"Heartbeat executor exponential back off related property.","3045":"It is a maximum multiplier value for retry delay, in case where a sequence of timeouts occurred.","3046":"The thread pool size for the heartbeatExecutor to initialise with","3047":"Indicates how long initially (in seconds) to replicate instance info to the eureka\n server","3048":"Indicates how often(in seconds) to replicate instance changes to be replicated to\n the eureka server.","3049":"Indicates whether to log differences between the eureka server and the eureka\n client in terms of registry information.\n","3050":"{42/} client tries to retrieve only delta changes from eureka server to minimize network traffic.","3051":"After receiving the deltas, eureka client reconciles the information from the server to verify it has not missed out some information.","3052":"Reconciliation failures could happen when the client has had network issues communicating to server.If the reconciliation fails, eureka client gets the full registry information.","3053":" While getting the full registry information, the eureka client can log the\n differences between the client and the server and this setting controls that.\n","3054":" The changes are effective at runtime at the next registry fetch cycle as specified\n by registryFetchIntervalSecondsr","3055":"If set to true, local status updates via ApplicationInfoManager will trigger\n on-demand (but rate limited) register/updates to remote eureka servers","3056":"Indicates whether or not this instance should try to use the eureka server in the\n same zone for latency and/or other reason.\n","3057":" Ideally eureka clients are configured to talk to servers in the same zone\n","3058":" The changes are effective at runtime at the next registry fetch cycle as specified\n by registryFetchIntervalSeconds","3059":"Gets the proxy host to eureka server if any.","3060":"Gets the proxy password if any.","3061":"Gets the proxy port to eureka server if any.","3062":"Gets the proxy user name if any.","3063":"Gets the region (used in AWS datacenters) where this instance resides.","3064":"Indicates whether or not this instance should register its information with eureka\n server for discovery by others.\n","3065":" In some cases, you do not want your instances to be discovered whereas you just\n want do discover other instances.","3066":"Indicates how often(in seconds) to fetch the registry information from the eureka\n server.","3067":"Indicates whether the client is only interested in the registry information for a\n single VIP.","3068":"Map of availability zone to list of fully qualified URLs to communicate with eureka server.","3069":"Each value can be a single URL or a comma separated list of alternative locations.","3070":"Typically the eureka server URLs carry protocol,host,port,context and version information if any.","3071":"Example: http://ec2-256-156-243-129.compute-1.amazonaws.com:7001/eureka/","3072":" The changes are effective at runtime at the next service url refresh cycle as\n specified by eurekaServiceUrlPollIntervalSeconds.","3073":"Indicates whether the eureka client should use the DNS mechanism to fetch a list of eureka servers to talk to.","3074":"When the DNS name is updated to have additional servers, that information is used immediately after the eureka client polls for that information as specified in eurekaServiceUrlPollIntervalSeconds.","3075":" Alternatively, the service urls can be returned serviceUrls, but the users should\n implement their own mechanism to return the updated list in case of changes.\n","3076":" The changes are effective at runtime.","3077":"Flag to enable the {42/} dashboard.","3078":"Default true.","3079":"The path to the {42/} dashboard (relative to the servlet path).","3080":"Defaults to \"/\".","3081":"Gets the AWS autoscaling group name associated with this instance.","3082":"This information is specifically used in an AWS environment to automatically put an instance out of service after the instance is launched and it has been disabled for traffic..","3083":"Get the name of the application group to be registered with eureka.","3084":"Get the name of the application to be registered with eureka.","3085":"Returns the data center this instance is deployed.","3086":"This information is used to get some AWS specific instance information if the instance is deployed in AWS.","3087":"Gets the absolute health check page URL for this instance.","3088":"The users can provide the healthCheckUrlPath if the health check page resides in the same instance talking to eureka, else in the cases where the instance is a proxy for some other server, users can provide the full URL.","3089":"If the full URL is provided it takes precedence.","3090":"<p> It is normally used for making educated decisions based on the health of the instance - for example, it can be used to determine whether to proceed deployments to an entire farm or stop the deployments without causing further damage.","3091":"The full URL should follow the format http://${eureka.hostname}:7001/ where the value ${eureka.hostname} is replaced at runtime.","3092":"Gets the relative health check URL path for this instance.","3093":"The health check page URL is then constructed out of the hostname and the type of communication - secure or unsecure as specified in securePort and nonSecurePort.","3094":" It is normally used for making educated decisions based on the health of the\n instance - for example, it can be used to determine whether to proceed deployments\n to an entire farm or stop the deployments without causing further damage.","3095":"Gets the absolute home page URL for this instance.","3096":"The users can provide the homePageUrlPath if the home page resides in the same instance talking to eureka, else in the cases where the instance is a proxy for some other server, users can provide the full URL.","3097":"If the full URL is provided it takes precedence.","3098":"It is normally used for informational purposes for other services to use it as a landing page.","3099":"The full URL should follow the format http://${eureka.hostname}:7001/ where the value ${eureka.hostname} is replaced at runtime.","3100":"Gets the relative home page URL Path for this instance.","3101":"The home page URL is then constructed out of the hostName and the type of communication - secure or unsecure.","3102":" It is normally used for informational purposes for other services to use it as a\n landing page.","3103":"The hostname if it can be determined at configuration time (otherwise it will be\n guessed from OS primitives).","3104":"Initial status to register with rmeote {42/} server.","3105":"Indicates whether the instance should be enabled for taking traffic as soon as it is registered with eureka.","3106":"Sometimes the application might need to do some pre-processing before it is ready to take traffic.","3107":"Get the unique Id (within the scope of the appName) of this instance to be\n registered with eureka.","3108":"Get the IPAdress of the instance.","3109":"This information is for academic purposes only as the communication from other instances primarily happen using the information supplied in {@link #getHostName(boolean)}.","3110":"Indicates the time in seconds that the eureka server waits since it received the\n last heartbeat before it can remove this instance from its view and there by\n disallowing traffic to this instance.\n","3111":"Setting this value too long could mean that the traffic could be routed to the instance even though the instance is not alive.","3112":"Setting this value too small could mean, the instance may be taken out of traffic because of temporary network glitches.This value to be set to atleast higher than the value specified in leaseRenewalIntervalInSeconds.","3113":"Indicates how often (in seconds) the eureka client needs to send heartbeats to eureka server to indicate that it is still alive.","3114":"If the heartbeats are not received for the period specified in leaseExpirationDurationInSeconds, eureka server will remove the instance from its view, there by disallowing traffic to this instance.","3115":" Note that the instance could still not take traffic if it implements\n HealthCheckCallback and then decides to make itself unavailable.","3116":"Gets the metadata name/value pairs associated with this instance.","3117":"This information is sent to eureka server and can be used by other instances.","3118":"Get the namespace used to find properties.","3119":"Ignored in {11/}.","3120":"Get the non-secure port on which the instance should receive traffic.","3121":"Indicates whether the non-secure port should be enabled for traffic or not.","3122":"Flag to say that, when guessing a hostname, the IP address of the server should be\n used in prference to the hostname reported by the OS.","3123":"Gets the absolute secure health check page URL for this instance.","3124":"The users can provide the secureHealthCheckUrl if the health check page resides in the same instance talking to eureka, else in the cases where the instance is a proxy for some other server, users can provide the full URL.","3125":"If the full URL is provided it takes precedence.","3126":"<p> It is normally used for making educated decisions based on the health of the instance - for example, it can be used to determine whether to proceed deployments to an entire farm or stop the deployments without causing further damage.","3127":"The full URL should follow the format http://${eureka.hostname}:7001/ where the value ${eureka.hostname} is replaced at runtime.","3128":"Get the Secure port on which the instance should receive traffic.","3129":"Indicates whether the secure port should be enabled for traffic or not.","3130":"Gets the secure virtual host name defined for this instance.\n","3131":" This is typically the way other instance would find this instance by using the\n secure virtual host name.Think of this as similar to the fully qualified domain\n name, that the users of your services will need to find this instance.","3132":"Gets the absolute status page URL path for this instance.","3133":"The users can provide the statusPageUrlPath if the status page resides in the same instance talking to eureka, else in the cases where the instance is a proxy for some other server, users can provide the full URL.","3134":"If the full URL is provided it takes precedence.","3135":"It is normally used for informational purposes for other services to find about the status of this instance.","3136":"Users can provide a simple HTML indicating what is the current status of the instance.","3137":"Gets the relative status page URL path for this instance.","3138":"The status page URL is then constructed out of the hostName and the type of communication - secure or unsecure as specified in securePort and nonSecurePort.","3139":"It is normally used for informational purposes for other services to find about the status of this instance.","3140":"Users can provide a simple HTML indicating what is the current status of the instance.","3141":"Gets the virtual host name defined for this instance.\n","3142":" This is typically the way other instance would find this instance by using the\n virtual host name.Think of this as similar to the fully qualified domain name, that\n the users of your services will need to find this instance.","3143":"The list of supported mime types.","3144":"The minimum threshold content size.","3145":"Flag to indicate that the config server health indicator should be installed.","3146":"Flag to inidicate that the hystrix health indicator should be installed.","3147":"Authentication strategy per route.","3148":"Service that wants to listen to acks.","3149":"By default null (meaning all services).","3150":"Flag to switch off acks (default on).","3151":"Name of {9/} destination for messages.","3152":"Flag to indicate that the bus is enabled.","3153":"Flag to switch off environment change events (default on).","3154":"Flag to switch off refresh events (default on).","3155":"Flag to switch on tracing of acks (default off).","3156":"Email address of user to authenticate.","3157":"Flag to indicate that discovery is enabled.","3158":"Password for user to authenticate and obtain token.","3159":"URL of Cloud Foundry API (Cloud Controller).","3160":"Flag to indicate that {@link #isSystemPropertiesOverride() systemPropertiesOverride} can be used.","3161":"Set to false to prevent users from changing the default accidentally.","3162":"Default true.","3163":"Flag to indicate that config server discovery is enabled (config server URL will be\n looked up via discovery).","3164":"Service id to locate config server.","3165":"Flag to say that remote configuration is enabled.","3166":"Default true;","3167":"Flag to indicate that failure to connect to the server is fatal (default false).","3168":"The label name to use to pull remote configuration properties.","3169":"The default is set on the server (generally \"master\" for a git based server).","3170":"Name of application used to fetch remote properties.","3171":"Flag to indicate that when {@link #setAllowOverride(boolean) allowOverride} is true, external properties should take lowest priority, and not override any existing property sources (including local config files).","3172":"Default false.","3173":"Flag to indicate that the external properties should override system properties.","3174":"Default true.","3175":"The password to use (HTTP Basic) when contacting the remote server.","3176":"The default profile to use when fetching remote configuration (comma-separated).","3177":"Default is \"default\".","3178":"Initial retry interval in milliseconds.","3179":"Maximum number of attempts.","3180":"Maximum interval for backoff.","3181":"Multiplier for next interval.","3182":"The URI of the remote server (default http://localhost:8888).","3183":"The username to use (HTTP Basic) when contacting the remote server.","3184":"If format is Format.PROPERTIES or Format.YAML\n then the following field is used as key to look up {44/} for configuration.","3185":"Throw exceptions during config lookup if true, otherwise, log warnings.","3186":"Is service discovery enabled?","3187":"How often to perform the health check (e.g. 10s)","3188":"Alternate server path to invoke for health checking","3189":"Timeout for health check (e.g. 10s)","3190":"Custom health check url to override default","3191":"Hostname to use when accessing server","3192":"Unique service instance id","3193":"IP address to use when accessing service (must also set preferIpAddress\n                        to use)","3194":"Suffix to use when registering management service","3195":"Tags to use when registering management service","3196":"Port to register the service under (defaults to listening port)","3197":"Source of how we will determine the address to use","3198":"Use ip address rather than hostname during registration","3199":"Add the 'passing` parameter to /v1/health/service/serviceName.","3200":"This pushes health check passing to the server.","3201":"Register as a service in {44/}.","3202":"Register health check in {44/}.","3203":"Useful during development of a service.","3204":"Whether to register an http or https service","3205":"Map of serviceId's → tag to query for in server list.","3206":"This allows filtering services by a single tag.","3207":"Service name","3208":"Tags to use when registering service","3209":"Is {14/} {44/} enabled","3210":"{36/} agent hostname.","3211":"Defaults to 'localhost'.","3212":"{36/} agent port.","3213":"Defaults to '8500'.","3214":"Initial retry interval in milliseconds.","3215":"Maximum number of attempts.","3216":"Maximum interval for backoff.","3217":"Multiplier for next interval.","3218":"The default hostname.","3219":"Used in case of errors.","3220":"The default ipaddress.","3221":"Used in case of errors.","3222":"List of Java regex expressions for network interfaces that will be ignored.","3223":"Timeout in seconds for calculating hostname.","3224":"Default health endpoint that will be checked to verify that a dependency is alive","3225":"Mapping of alias to ZookeeperDependency.","3226":"From {41/} perspective the alias is actually serviceID since {41/} can't accept nested structures in serviceID","3227":"Gets the metadata name/value pairs associated with this instance.","3228":"This information is sent to zookeeper and can be used by other instances.","3229":"Common prefix that will be applied to all {18/} dependencies' paths","3230":"Fixed delay for default poller.","3231":"Maximum messages per poll for the default poller.","3232":"Simple name of the class with a method annotated with {@code @Async}\n from which the asynchronous process started\n","3233":" @see org.springframework.scheduling.annotation.Async","3234":"Name of the method annotated with {@code @Async}\n","3235":" @see org.springframework.scheduling.annotation.Async","3236":"Prefix for header names if they are added as tags.","3237":"Name of the thread that executed the async method\n","3238":" @see org.springframework.scheduling.annotation.Async","3239":"Additional headers that should be added as tags if they exist.","3240":"If the header value is multi-valued, the tag value will be a comma-separated, single-quoted list.","3241":"The domain portion of the URL or host header.","3242":"Example: \"mybucket.s3.amazonaws.com\".","3243":"Used to filter by host as opposed to ip address.","3244":"The HTTP method, or verb, such as \"GET\" or \"POST\".","3245":"Used to filter against an http route.","3246":"The absolute http path, without any query parameters.","3247":"Example: \"/objects/abcd-ff\".","3248":"Used to filter against an http route, portably with zipkin v1.","3249":"In zipkin v1, only equals filters are supported.","3250":"Dropping query parameters makes the number of distinct URIs less.","3251":"For example, one can query for the same resource, regardless of signing parameters encoded in the query line.","3252":"This does not reduce cardinality to a HTTP single route.","3253":"For example, it is common to express a route as an http URI template like \"/resource/{resource_id}\".","3254":"In systems where only equals queries are available, searching for {@code http.uri=/resource} won't match if the actual request was \"/resource/abcd-ff\".","3255":"Historical note: This was commonly expressed as \"http.uri\" in zipkin, eventhough it was most often just a path.","3256":"Prefix for header names if they are added as tags.","3257":"The size of the non-empty HTTP request body, in bytes.","3258":"Ex.","3260":" <p>Large uploads can exceed limits or contribute directly to latency.","3261":"The size of the non-empty HTTP response body, in bytes.","3262":"Ex.","3264":" <p>Large downloads can exceed limits or contribute directly to latency.","3265":"The HTTP response code, when not in 2xx range.","3266":"Ex.","3267":"\"503\" Used to filter for error status.","3268":"2xx range are not logged as success codes are less interesting for latency troubleshooting.","3269":"Omitting saves at least 20 bytes per span.","3270":"The entire URL, including the scheme, host and query parameters if available.","3271":"Ex.","3272":"\"https://mybucket.s3.amazonaws.com/objects/abcd-ff?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Algorithm=AWS4-HMAC-SHA256…\" Combined with {@link #method}, you can understand the fully-qualified request line.","3273":"This is optional as it may include private data or be of considerable length.","3274":"Name of the command group.","3275":"{22/} uses the command group key to group together commands such as for reporting, alerting, dashboards, or team/library ownership.","3276":" @see com.netflix.hystrix.HystrixCommandGroupKey","3277":"Name of the command key.","3278":"Describes the name for the given command.","3279":"A key to represent a {@link com.netflix.hystrix.HystrixCommand} for monitoring, circuit-breakers, metrics publishing, caching and other such uses.","3280":" @see com.netflix.hystrix.HystrixCommandKey","3281":"Prefix for header names if they are added as tags.","3282":"Name of the thread pool key.","3283":"The thread-pool key represents a {@link com.netflix.hystrix.HystrixThreadPool} for monitoring, metrics publishing, caching, and other such uses.","3284":"A {@link com.netflix.hystrix.HystrixCommand} is associated with a single {@link com.netflix.hystrix.HystrixThreadPool} as retrieved by the {@link com.netflix.hystrix.HystrixThreadPoolKey} injected into it, or it defaults to one created using the {@link com.netflix.hystrix.HystrixCommandGroupKey} it is created with.","3285":" @see com.netflix.hystrix.HystrixThreadPoolKey","3286":"Additional headers that should be added as tags if they exist.","3287":"If the header value is not a String it will be converted to a String using its toString() method.","3288":"An estimate of the size of the payload if available.","3289":"The type of the payload.","3290":"Prefix for header names if they are added as tags.","3291":"Percentage of requests that should be sampled.","3292":"Eg 1.0 - 100% requests should be sampled.","3293":"The precision is whole-numbers only (ie there's no support for 0.1% of the traces)."},"errors":{},"nouns":{"0":"Spring Cloud for Cloud Foundry","1":"spring.application.name","2":"Spring Cloud Security","3":"Spring Boot Actuator","4":"Spring Cloud Commons","5":"Spring Cloud Bus","6":"Spring Cloud Sleuth","7":"Spring Cloud Config","8":"Spring Integration","9":"Spring Cloud Stream","10":"Spring Boot Cloud CLI","11":"Spring Cloud","12":"Turbine","13":"Forwards","14":"spring cloud","15":"Spring Boot","16":"Properties","17":"Kafka Binder","18":"Zookeeper","19":"Span Data","20":"Binders","21":"Binder SPI","22":"Hystrix","23":"Spectator","24":"Archaius","25":"Hazelcast","26":"Bus Events","28":"Rabbit-Specific","29":"Feign","30":"spans","31":"Atlas","32":"Binder","33":"Leader","34":"Events","35":"Etcd","36":"Consul","37":"Servo","38":"Rabbit","39":"Zuul","40":"Kafka","41":"Ribbon","42":"Eureka","43":"Zipkin","44":"consul","45":"Spring"},"name":"spring-cloud-brixton","timestamp":1494043058362});</script></body></html>